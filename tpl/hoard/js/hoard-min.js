"use strict";var hoard={search_options:{},map:null,set_up:function(t){const o=this,a=document.getElementById("row_detail");if(void 0!==t.section_id&&t.section_id>0){o.get_row_data({section_id:t.section_id}).then((function(e){console.log("[set_up->get_row_data] response:",e),e.result&&e.result.length>0?o.draw_row({target:a,ar_rows:e.result}).then((function(){const t=JSON.parse(e.result[0].map);o.draw_map({map_data:t})})):a.innerHTML="Sorry. Empty result for section_id: "+t.section_id}))}else a.innerHTML="Error. Invalid section_id";return!0},get_row_data:function(t){const o=t.section_id,a="section_id="+parseInt(o);return data_manager.request({body:{dedalo_get:"records",db_name:page_globals.WEB_DB,lang:page_globals.WEB_CURRENT_LANG_CODE,table:"hoards",ar_fields:["*"],sql_filter:a,limit:1,count:!1,offset:0,resolve_portals_custom:{coins_data:"coins"}}})},draw_row:function(t){const o=this;return new Promise((function(a){const e=t.ar_rows[0],n=t.target;for(console.log("draw_row row_object:",e),o.row_object=e,!0===SHOW_DEBUG&&console.log("coin row_object:",e);n.hasChildNodes();)n.removeChild(n.lastChild);const r=new DocumentFragment,s=hoard_row.draw_hoard(e);r.appendChild(s),n.appendChild(r),a(n)}))},draw_map:function(t){const o=t.map_data,a=o,e=document.getElementById("map_container");this.map=this.map||new map_factory,this.map.init({map_container:e,map_position:a,popup_builder:page.map_popup_builder,popup_options:page.maps_config.popup_options,source_maps:page.maps_config.source_maps});const n=this.map_data(o);return this.map.parse_data_to_map(n,null).then((function(){e.classList.remove("hide_opacity")})),!0},map_data:function(t){console.log("--map_data data:",t);const o=Array.isArray(t)?t:[t],a=[];for(let t=0;t<o.length;t++){const e={lat:o[t].lat,lon:o[t].lon,data:{}};a.push(e)}return console.log("--map_data data_clean:",a),a}};