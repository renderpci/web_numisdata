"use strict";var common={get_json_data:function(e,t,n){const r=e+"?d="+Date.now(),a=JSON.stringify(t);var o=-1!=navigator.userAgent.indexOf("MSIE"),_=/rv:11.0/i.test(navigator.userAgent);if(o||_){var s=tstring.incompatible_browser||"Warning: Internet explorer is not supported. Please use a modern browser like Chrome, Firefox, Safari, Opera, Edje..";return alert(s),!1}return void 0===n&&(n=!0),new Promise((function(e,t){var o=new XMLHttpRequest;o.open("POST",r,n),o.setRequestHeader("Content-type","application/json"),o.responseType="json",o.onload=function(n){200===o.status?e(o.response):t(Error("Reject error. Data don't load. error code: "+o.statusText+" - url: "+r))},o.onerror=function(e){t(Error("There was a network error. data_send: "+r+"?"+a+"statusText: "+o.statusText))},o.send(a)}))},create_dom_element:function(e){var t=e.element_type,n=e.parent,r=e.class_name,a=e.style,o=e.data_set;void 0===o&&void 0!==e.dataset&&(o=e.dataset);var _=e.custom_function_events,s=e.title_label,i=e.text_node,l=e.text_content,c=e.inner_html,p=e.href,m=e.id,d=e.draggable,u=e.value,g=e.download,f=e.src,v=e.type;const h=document.createElement(t);if(m&&(h.id=m),"a"===t&&(h.href=p||"javascript:;"),r&&(h.className=r),a)for(y in a)h.style[y]=a[y];if(s&&(h.title=s),o)for(var y in o)h.dataset[y]=o[y];if(u&&(h.value=u),v&&h.setAttribute("type",v),_){const e=_.length;for(var b=0;b<e;b++){var w=_[b].name,E=_[b].type,x=_[b].function_arguments;this.create_custom_events(h,E,w,x)}}if(i)if("span"===t)h.textContent=i;else{var S=document.createElement("span");S.innerHTML=" "+i,h.appendChild(S)}else l?h.textContent=l:c&&(h.innerHTML=c);return n&&n.appendChild(h),d&&(h.draggable=d),g&&h.setAttribute("download",g),f&&(h.src=f),h},build_player:function(e){!0===SHOW_DEBUG&&console.log("[common.build_player] options",e);var t=e.type||["video/mp4"],n=e.src||[""];Array.isArray(n)||(n=[n]);var r=document.createElement("video");r.id=e.id||"video_player",r.controls=e.controls||!0,r.poster=e.poster||"",r.className=e.class||"video-js video_hidden",r.preload=e.preload||"auto",r.dataset.setup="{}",e.height&&(r.height=e.height),e.width&&(r.width=e.width);for(var a=0;a<n.length;a++){var o=document.createElement("source");o.src=n[a],o.type=t[a],r.appendChild(o)}var _=e.ar_subtitles||null;if(_)for(a=0;a<_.length;a++){var s=_[a],i=document.createElement("track");i.kind="subtitles",i.src=s.src,i.srclang=s.srclang,i.label=s.label,s.srclang===e.default&&(i.default=!0),r.appendChild(i)}var l=document.createElement("p");l.className="vjs-no-js";var c,p=document.createTextNode("To view this video please enable JavaScript, and consider upgrading to a web browser that supports HTML5 video");return l.appendChild(p),r.appendChild(l),setTimeout((function(){window.ready((function(t){(c=videojs(r)).ready((function(){this.addClass("video_show")})),!0===e.play&&c.play()}))}),1),r},timestamp_to_fecha:function(e){if(!e||e.length<4)return null;if(10===e.length)var t=e.substring(0,4),n=e.substring(5,7),r=e.substring(8,10)+"-"+n+"-"+t;else{var a=new Date(e);t=a.getFullYear(),n=a.getMonth();function o(e){return e<10?"0"+e:e}r=o(a.getDate())+"-"+o(n+1)+"-"+t}return r},local_to_remote_path:function(e){if(!e)return null;const t=page_globals.WEB_ENTITY;return e=(e=e.replace("/dedalo4/","/dedalo/")).replace("/media_test/media_"+t,"/media"),e=page_globals.__WEB_BASE_URL__+e},get_posterframe_from_video:function(e){var t=e,n=(t=(t=t.replace(/\/404\//g,"/posterframe/")).replace(/\.mp4/g,".jpg")).split("?");return void 0!==n[0]&&(t=n[0]),t},open_note:function(e,t){for(var n=t.length-1;n>=0;n--){var r=t[n];if(e.dataset.tag_id===r.id)return $.colorbox({html:r.label,transition:"none"}),!0}return!1},set_background_color:function(e,t){e.setAttribute("crossOrigin","");const n=(new BackgroundColorTheif).getBackGroundColor(e);return t.style.backgroundColor="rgb("+n[0]+","+n[1]+","+n[2]+")",n},build_slider:function(e){const t=e.container;return new Promise((function(n){var r=common.create_dom_element({element_type:"ul",class_name:"slides",parent:t});const a=e.ar_elements.length;for(let t=0;t<a;t++){const a=e.ar_elements[t],l=a.image,c=a.title||null,p=a.text||null;if(!(l.length<4)){var o=common.create_dom_element({element_type:"li",class_name:"row_image",parent:r});common.create_dom_element({element_type:"div",class_name:"image_bg",parent:o}).style.backgroundImage="url("+l+")";var _=common.create_dom_element({element_type:"div",class_name:"image_text",parent:o}),s=common.create_dom_element({element_type:"h1",text_content:c,parent:_});common.create_dom_element({element_type:"a",parent:s}),common.create_dom_element({element_type:"span",text_content:p,parent:_});if(0===t){var i=new Image;i.addEventListener("load",(function(){n(r)}),!1),i.src=l}}}}))},get_scrollbar_width:function(){var e=document.createElement("div");e.style.visibility="hidden",e.style.width="100px",e.style.msOverflowStyle="scrollbar",document.body.appendChild(e);var t=e.offsetWidth;e.style.overflow="scroll";var n=document.createElement("div");n.style.width="100%",e.appendChild(n);var r=n.offsetWidth;return e.parentNode.removeChild(e),t-r},has_scrollbar:function(){if("number"==typeof window.innerWidth)return window.innerWidth>document.documentElement.clientWidth;var e,t,n=document.documentElement||document.body;void 0!==n.currentStyle&&(e=n.currentStyle.overflow),e=e||window.getComputedStyle(n,"").overflow,void 0!==n.currentStyle&&(t=n.currentStyle.overflowY),t=t||window.getComputedStyle(n,"").overflowY;var r=n.scrollHeight>n.clientHeight,a=/^(visible|auto)$/.test(e)||/^(visible|auto)$/.test(t);return r&&a||("scroll"===e||"scroll"===t)},clone_deep:function(e){const t=this;let n,r;if("object"!=typeof e)return e;if(!e)return e;if("[object Array]"===Object.prototype.toString.apply(e)){for(n=[],r=0;r<e.length;r+=1)n[r]=t.clone_deep(e[r]);return n}for(r in n={},e)e.hasOwnProperty(r)&&(n[r]=t.clone_deep(e[r]));return n}};function ready(e){"loading"!==document.readyState?e():document.addEventListener("DOMContentLoaded",e)}!function(e,t,n){n=n||window;var r=!1;n.addEventListener(e,(function(){r||(r=!0,requestAnimationFrame((function(){n.dispatchEvent(new CustomEvent(t)),r=!1})))}))}("resize","optimizedResize");var page={trigger_url:page_globals.__WEB_ROOT_WEB__+"/web/trigger.web.php",maps_config:{source_maps:[{name:"DARE",url:"//dh.gu.se/tiles/imperium/{z}/{x}/{y}.png",options:{maxZoom:11},default:!0},{name:"OSM",url:"//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",options:{maxZoom:19}},{name:"Map Tiles",url:"https://api.maptiler.com/maps/basic/256/{z}/{x}/{y}@2x.png?key=udlBrEEE2SPm1In5dCNb",options:{maxZoom:20}},{name:"ARCGIS",url:"//server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",options:{}}],popup_options:{maxWidth:420,closeButton:!1,className:"map_popup"},markers:{mint:{iconUrl:page_globals.__WEB_TEMPLATE_WEB__+"/assets/images/map/purple.png",shadowUrl:page_globals.__WEB_TEMPLATE_WEB__+"/assets/images/map/marker-shadow.png",iconSize:[47,43],shadowSize:[41,41],iconAnchor:[10,19],shadowAnchor:[0,20],popupAnchor:[12,-20]},findspot:{iconUrl:page_globals.__WEB_TEMPLATE_WEB__+"/assets/images/map/orange.png",shadowUrl:page_globals.__WEB_TEMPLATE_WEB__+"/assets/images/map/marker-shadow.png",iconSize:[47,43],shadowSize:[41,41],iconAnchor:[10,19],shadowAnchor:[0,20],popupAnchor:[12,-20]},hoard:{iconUrl:page_globals.__WEB_TEMPLATE_WEB__+"/assets/images/map/green.png",shadowUrl:page_globals.__WEB_TEMPLATE_WEB__+"/assets/images/map/marker-shadow.png",iconSize:[47,43],shadowSize:[41,41],iconAnchor:[10,19],shadowAnchor:[0,20],popupAnchor:[12,-20]}}},setup:function(){var e=this;return window.ready((function(){e.hilite_lang(page_globals.WEB_CURRENT_LANG_CODE);const t=document.getElementById("footer");t&&setTimeout((function(){t.classList.remove("hidded")}),500)})),!0},hilite_lang:function(e){const t=document.getElementById("page_lang_selector");if(t){const n=t.querySelectorAll("a");for(let t=0;t<n.length;t++)-1!==n[t].href.indexOf(e)&&n[t].classList.add("selected")}return!0},load_more_items:function(e){var t=JSON.parse(e.dataset.template_map),n=document.getElementById(e.dataset.target),r=document.createElement("div");r.classList.add("spinner_list"),n.appendChild(r);var a={mode:"load_more_items",template_map:t};return common.get_json_data(this.trigger_url,a,!0).then((function(a){if(console.log("[page.load_more_items] response",a),null===a)console.log("[page.load_more_items] Error. Null response");else{var o=document.createElement("div");o.innerHTML=a.html;for(var _=o.children;_.length>0;)n.appendChild(_[0]);t.offset=t.offset+t.max_records,e.dataset.template_map=JSON.stringify(t),t.offset>=t.total_records&&(e.style.display="none")}r.remove()}))},adjust_image_size:function(e){e.style.opacity=0;var t=document.createElement("img");return t.src=e.style.backgroundImage.replace(/"/g,"").replace(/url\(|\)$/gi,""),t.addEventListener("load",(function(t){var n=this.width;this.height>n&&e.classList.add("vertical"),e.style.opacity=1}),!1),!0},adjust_footer_position:function(){let e=!1;const t=document.getElementById("wrapper");if(!t)return console.log("top_container not found !"),!1;t.offsetHeight>window.innerHeight&&(e=!0);!0===SHOW_DEBUG&&console.log("scrollbar:",e);const n=document.getElementById("footer");return!1===e?n.classList.add("fixed"):n.classList.remove("fixed"),e},activate_tooltips:function(e){SHOW_DEBUG,$(e).each((function(){new Tooltip($(this),{placement:"top"})}))},build_paginator_html:function(e,t,n){const r=t;r.dataset.total=e.total;const a=e.ar_nodes,o=a.length;for(let e=0;e<o;e++){const t=a[e];let n=t.label,o="page "+t.type+" "+t.id;if(!1===t.active&&(o+=" unactive"),"previous"!==t.id&&"next"!==t.id&&"last"!==t.id&&"first"!==t.id||(n=""),!0===t.selected&&(o+=" selected"),"extra"===t.type){o=t.type;common.create_dom_element({element_type:"span",class_name:o,text_content:n,parent:r})}else{common.create_dom_element({element_type:"a",class_name:o,text_content:n,dataset:{offset:t.offset_value,active:t.active},parent:r});t.active}}return r.addEventListener("click",this.paginator_click_event),r},paginator_click_event:function(e){const t=this,n=e.target;if("true"!==n.dataset.active)return!1;const r=parseInt(n.parentNode.dataset.total),a=n.dataset.offset,o=document.getElementById("search_form"),_=main_home.search(o,null,a,r);return _.then((function(e){t.result_container})),_},add_spinner:function(e){if(e){const t=common.create_dom_element({element_type:"img",class_name:"spinner_svg",src:page_globals.__WEB_ROOT_WEB__+"/tpl/assets/images/spinner.svg"});e.appendChild(t)}else console.warn("[add_spinner] Error on get target ",e);return!0},remove_spinner:function(e){const t=e.querySelector(".spinner_svg");return!!t&&(t.remove(),!0)},remote_image:function(e){if(e){let t="";return t=-1!==e.indexOf("v5/media_test")?e.replace(/\/v5\/media_test\/media_monedaiberica\//g,page_globals.__WEB_MEDIA_BASE_URL__+"/dedalo/media/"):e.replace(/\/dedalo\/media_test\/media_monedaiberica\//g,page_globals.__WEB_MEDIA_BASE_URL__+"/dedalo/media/"),t}return null},parse_legend_svg:function(e){return-1!==e.indexOf("http")?e:e.replace(/\/dedalo\/media\/svg\//g,page_globals.__WEB_MEDIA_BASE_URL__+"/dedalo/media/svg/")},parse_catalog_data:function(e){const t=this;Array.isArray(e)||(e=[e]);const n=[],r=e.length;for(let a=0;a<r;a++){const r=e[a];r.ref_coins_image_obverse=common.local_to_remote_path(r.ref_coins_image_obverse),r.ref_coins_image_reverse=common.local_to_remote_path(r.ref_coins_image_reverse),r.ref_coins_image_obverse_thumb=r.ref_coins_image_obverse?r.ref_coins_image_obverse.replace("/1.5MB/","/thumb/"):null,r.ref_coins_image_reverse_thumb=r.ref_coins_image_reverse?r.ref_coins_image_reverse.replace("/1.5MB/","/thumb/"):null,r.ref_type_legend_obverse=r.ref_type_legend_obverse?t.parse_legend_svg(r.ref_type_legend_obverse):null,r.ref_type_legend_reverse=r.ref_type_legend_reverse?t.parse_legend_svg(r.ref_type_legend_reverse):null,r.ref_type_symbol_obverse=r.ref_type_symbol_obverse?t.parse_legend_svg(r.ref_type_symbol_obverse):null,r.ref_type_symbol_reverse=r.ref_type_symbol_reverse?t.parse_legend_svg(r.ref_type_symbol_reverse):null,r.term_data=JSON.parse(r.term_data),r.term_section_id=r.term_data?r.term_data[0]:null,r.children=JSON.parse(r.children),r.parent=JSON.parse(r.parent),r.ref_type_averages_diameter=r.ref_type_averages_diameter?parseFloat(r.ref_type_averages_diameter.replace(",",".")):null,r.ref_type_averages_weight=r.ref_type_averages_weight?parseFloat(r.ref_type_averages_weight.replace(",",".")):null,n.push(r)}for(let t=0;t<r;t++){const r=n[t];if("types"===r.term_table&&r.children){const t=[],n=[];for(let a=0;a<r.children.length;a++){const o=r.children[a],_=e.find(e=>e.section_id==o);_&&_.ref_type_averages_weight&&n.push(_.ref_type_averages_weight),_&&_.ref_type_averages_diameter&&t.push(_.ref_type_averages_diameter)}const a=n.reduce((e,t)=>e+t,0)/n.length,o=t.reduce((e,t)=>e+t,0)/t.length;r.ref_type_averages_weight=a,r.ref_type_averages_diameter=o,r.ref_type_total_weight_items=n.length,r.ref_type_total_diameter_items=t.length}}return n},parse_type_data:function(e){const t=this;if(Array.isArray(e)){const n=[];for(let r=0;r<e.length;r++)n.push(t.parse_type_data(e[r]));return n}const n=e;if(n.ref_coins_image_obverse=common.local_to_remote_path(e.ref_coins_image_obverse),n.ref_coins_image_reverse=common.local_to_remote_path(e.ref_coins_image_reverse),n.ref_coins_union)for(let e=0;e<n.ref_coins_union.length;e++)n.ref_coins_union[e].image_obverse&&(n.ref_coins_union[e].image_obverse=common.local_to_remote_path(n.ref_coins_union[e].image_obverse)),n.ref_coins_union[e].image_reverse&&(n.ref_coins_union[e].image_reverse=common.local_to_remote_path(n.ref_coins_union[e].image_reverse));return n.uri=t.parse_iri_data(n.uri),n.legend_obverse=n.legend_obverse?t.parse_legend_svg(n.legend_obverse):null,n.legend_reverse=n.legend_reverse?t.parse_legend_svg(n.legend_reverse):null,n},parse_coin_data:function(e){const t=this;if(Array.isArray(e)){const n=[];for(let r=0;r<e.length;r++)n.push(t.parse_coin_data(e[r]));return n}const n=e;return n.image_obverse=common.local_to_remote_path(e.image_obverse),n.image_reverse=common.local_to_remote_path(e.image_reverse),n.type_data&&n.type_data.length>0&&(n.type_data=t.parse_type_data(n.type_data)),n.legend_obverse=n.legend_obverse?t.parse_legend_svg(n.legend_obverse):null,n.legend_reverse=n.legend_reverse?t.parse_legend_svg(n.legend_reverse):null,n.countermark_obverse=n.countermark_obverse?t.parse_legend_svg(n.countermark_obverse):null,n.countermark_reverse=n.countermark_reverse?t.parse_legend_svg(n.countermark_reverse):null,n.ref_auction_date=t.parse_date(n.ref_auction_date),n.find_date=t.parse_date(n.find_date),n.mib_uri=page_globals.__WEB_BASE_URL__+page_globals.__WEB_ROOT_WEB__+"/coin/"+n.section_id,n.uri=t.parse_iri_data(n.uri),n.bibliography=page.parse_publication(n.bibliography_data),n.mint=void 0!==n.type_data[0]?n.type_data[0].mint:null,n.type_number=void 0!==n.type_data[0]?n.type_data[0].number:null,n},parse_iri_data:function(e){const t=[];if(!e||e.length<1)return t;const n=e.split(" | ");for(let e=0;e<n.length;e++){const r=n[e].split(", ");if(r.length>1&&void 0===r[1])continue;const a=1===r.length?r[0]:r[1];let o=1===r.length?"":r[0];if(o.length<1)try{o=new URL(a).hostname}catch(e){console.error(e)}t.push({label:o,value:a})}return t},remove_gaps:function(e,t){return e.split(t).filter(Boolean).join(t)},split_data:function(e,t){return e?e.split(t):[]},is_empty:function(e){return e&&e.length>0},parse_date:function(e){if(!e||e.length<4)return null;const t=e.substring(0,4),n=e.substring(5,7),r=e.substring(8,10),a=[];r&&"00"!=r&&a.push(r),n&&"00"!=n&&a.push(n),t&&"00"!=t&&a.push(t);return a.join("-")},parse_publication:function(e){const t=[],n=e.length;for(let r=0;r<n;r++){const n=e[r];n._publications=[];const a=JSON.parse(n.publications_data),o=a.length;if(o>0){const e=page.split_data(n.ref_publications_authors," # "),r=page.split_data(n.ref_publications_date," # "),_=page.split_data(n.ref_publications_editor," # "),s=page.split_data(n.ref_publications_magazine," # "),i=page.split_data(n.ref_publications_place," # "),l=page.split_data(n.ref_publications_title," # "),c=page.split_data(n.ref_publications_url," # ");for(let p=0;p<o;p++){const o=a[p],m={reference:n.section_id,section_id:o,authors:e[p]||null,date:r[p]||null,editor:_[p]||null,magazine:s[p]||null,place:i[p]||null,title:l[p]||null,url:c[p]||null};n._publications.push(m),t.push(m)}}}return t},activate_images_gallery:function(e,t){if(!0===t){const e=document.querySelectorAll(".poptrox-overlay");if(e)for(let t=e.length-1;t>=0;t--)e[t].remove()}return $(e).poptrox({baseZIndex:2e4,fadeSpeed:1,overlayOpacity:.5,popupCloserText:"",popupHeight:150,popupWidth:150,popupLoaderText:"",popupSpeed:1,selector:"a.image_link",usePopupCaption:!1,usePopupCloser:!0,usePopupDefaultStyling:!1,usePopupForceClose:!0,usePopupLoader:!0,usePopupNav:!0,windowMargin:50})},map_popup_builder:function(e){const t=common.create_dom_element({element_type:"div",class_name:"popup_wrapper"}),n=e.group,r=new Intl.Collator("es",{sensitivity:"base",ignorePunctuation:!0});n.sort((e,t)=>r.compare(e.title,t.title));const a=function(e){const n=e.section_id,r=e.title||"Undefined title "+n,a=e.description,o=common.create_dom_element({element_type:"div",class_name:"popup_item",parent:t});common.create_dom_element({element_type:"div",class_name:"text_title",inner_html:r,parent:o});if(a&&a.length>3){common.create_dom_element({element_type:"div",class_name:"text_description",inner_html:a,parent:o})}},o=n.length;return function e(r,_){for(let e=r;e<_;e++)a(n[e]);if(_<o-1){const n=common.create_dom_element({element_type:"input",type:"button",value:tstring.load_more||"Load more..",class_name:"more_node btn btn-light btn-block primary",parent:t});n.addEventListener("click",(function(){const t=this.offset+1;e(t,t+100<o?t+100:o),this.remove()})),n.offset=_}}(0,100<o?100:o),t}};page.parse_type_data=function(e){const t=this;if(Array.isArray(e)){const n=[];for(let r=0;r<e.length;r++)n.push(t.parse_type_data(e[r]));return n}const n=e;if(n.ref_coins_image_obverse=common.local_to_remote_path(e.ref_coins_image_obverse),n.ref_coins_image_reverse=common.local_to_remote_path(e.ref_coins_image_reverse),n.ref_coins_union)for(let e=0;e<n.ref_coins_union.length;e++)n.ref_coins_union[e].image_obverse&&(n.ref_coins_union[e].image_obverse=common.local_to_remote_path(n.ref_coins_union[e].image_obverse)),n.ref_coins_union[e].image_reverse&&(n.ref_coins_union[e].image_reverse=common.local_to_remote_path(n.ref_coins_union[e].image_reverse));return n.uri=t.parse_iri_data(n.uri),n.legend_obverse=n.legend_obverse?t.parse_legend_svg(n.legend_obverse):null,n.legend_reverse=n.legend_reverse?t.parse_legend_svg(n.legend_reverse):null,n.material=n.material?page.trim_char(page.remove_gaps(n.material," | "),"|"):null,n.symbol_obverse=n.symbol_obverse?page.trim_char(page.remove_gaps(n.symbol_obverse," | "),"|"):null,n.symbol_reverse=n.symbol_reverse?page.trim_char(page.remove_gaps(n.symbol_reverse," | "),"|"):null,n.symbol_obverse_data=JSON.parse(n.symbol_obverse_data),n.symbol_reverse_data=JSON.parse(n.symbol_reverse_data),n},page.parse_coin_data=function(e){const t=this;if(Array.isArray(e)){const n=[];for(let r=0;r<e.length;r++)n.push(t.parse_coin_data(e[r]));return n}const n=e;return n.image_obverse=common.local_to_remote_path(e.image_obverse),n.image_reverse=common.local_to_remote_path(e.image_reverse),n.type_data&&n.type_data.length>0&&(n.type_data=t.parse_type_data(n.type_data)),n.type=n.type?page.remove_gaps(n.type," | "):null,n.legend_obverse=n.legend_obverse?t.parse_legend_svg(n.legend_obverse):null,n.legend_reverse=n.legend_reverse?t.parse_legend_svg(n.legend_reverse):null,n.countermark_obverse=n.countermark_obverse?t.parse_legend_svg(n.countermark_obverse):null,n.countermark_reverse=n.countermark_reverse?t.parse_legend_svg(n.countermark_reverse):null,n.ref_auction_date=t.parse_date(n.ref_auction_date),n.find_date=t.parse_date(n.find_date),n.mib_uri=page_globals.__WEB_BASE_URL__+page_globals.__WEB_ROOT_WEB__+"/coin/"+n.section_id,n.uri=t.parse_iri_data(n.uri),n.bibliography=page.parse_publication(n.bibliography_data),n.mint=void 0!==n.type_data[0]?n.type_data[0].mint:null,n.type_number=void 0!==n.type_data[0]?n.type_data[0].number:null,n},page.parse_catalog_data=function(e){const t=this;Array.isArray(e)||(e=[e]);const n=[],r=e.length;for(let a=0;a<r;a++){const r=e[a];r.ref_coins_image_obverse=common.local_to_remote_path(r.ref_coins_image_obverse),r.ref_coins_image_reverse=common.local_to_remote_path(r.ref_coins_image_reverse),r.ref_coins_image_obverse_thumb=r.ref_coins_image_obverse?r.ref_coins_image_obverse.replace("/1.5MB/","/thumb/"):null,r.ref_coins_image_reverse_thumb=r.ref_coins_image_reverse?r.ref_coins_image_reverse.replace("/1.5MB/","/thumb/"):null,r.ref_type_legend_obverse=r.ref_type_legend_obverse?t.parse_legend_svg(r.ref_type_legend_obverse):null,r.ref_type_legend_reverse=r.ref_type_legend_reverse?t.parse_legend_svg(r.ref_type_legend_reverse):null,r.ref_type_symbol_obverse=r.ref_type_symbol_obverse?t.parse_legend_svg(r.ref_type_symbol_obverse):null,r.ref_type_symbol_reverse=r.ref_type_symbol_reverse?t.parse_legend_svg(r.ref_type_symbol_reverse):null,r.term_data=JSON.parse(r.term_data),r.term_section_id=r.term_data?r.term_data[0]:null,r.children=JSON.parse(r.children),r.parent=JSON.parse(r.parent),r.ref_type_averages_diameter=r.ref_type_averages_diameter?parseFloat(r.ref_type_averages_diameter.replace(",",".")):null,r.ref_type_total_diameter_items=r.ref_type_total_diameter_items?parseFloat(r.ref_type_total_diameter_items.replace(",",".")):null,r.ref_type_averages_weight=r.ref_type_averages_weight?parseFloat(r.ref_type_averages_weight.replace(",",".")):null,r.ref_type_total_weight_items=r.ref_type_total_weight_items?parseFloat(r.ref_type_total_weight_items.replace(",",".")):null,r.ref_type_material=page.trim_char(r.ref_type_material,"|"),n.push(r)}for(let t=0;t<r;t++){const r=n[t];if("types"===r.term_table&&r.children){const t=[],n=[];for(let a=0;a<r.children.length;a++){const o=r.children[a],_=e.find(e=>e.section_id==o);if(_&&_.ref_type_averages_weight){const e=_.ref_type_total_weight_items,t=new Array(e).fill(_.ref_type_averages_weight);n.push(...t)}if(_&&_.ref_type_averages_diameter){const e=_.ref_type_total_diameter_items,n=new Array(e).fill(_.ref_type_averages_diameter);t.push(...n)}}const a=n.reduce((e,t)=>e+t,0)/n.length,o=t.reduce((e,t)=>e+t,0)/t.length;r.ref_type_averages_weight=a,r.ref_type_averages_diameter=o,r.ref_type_total_weight_items=n.length,r.ref_type_total_diameter_items=t.length}}return n},page.parse_publication=function(e){const t=[],n=e.length;for(let r=0;r<n;r++){const n=e[r];n._publications=[];const a=JSON.parse(n.publications_data),o=a.length;if(o>0){const e=page.split_data(n.ref_publications_authors," # "),r=page.split_data(n.ref_publications_date," # "),_=page.split_data(n.ref_publications_editor," # "),s=page.split_data(n.ref_publications_magazine," # "),i=page.split_data(n.ref_publications_place," # "),l=page.split_data(n.ref_publications_title," # "),c=page.split_data(n.ref_publications_url," # ");for(let p=0;p<o;p++){const o=a[p],m={reference:n.section_id,section_id:o,authors:e[p]||null,date:r[p]||null,editor:_[p]||null,magazine:s[p]||null,place:i[p]||null,title:l[p]||null,url:c[p]||null};n._publications.push(m),t.push(m)}}}return t};var paginator={build_page_nodes:function(e,t,n,r){SHOW_DEBUG,e=parseInt(e),t=parseInt(t),n=parseInt(n),r=parseInt(r);const a=[];if(e<1)return a;void 0===r&&(r=6),a.push({label:tstring.first||"<<",offset_value:0,type:"navigator",active:n>=t,id:"first"}),a.push({label:tstring.prev||"Prev",offset_value:n-t>0?n-t:0,type:"navigator",active:n>=t,id:"previous"});const o=Math.ceil(e/t),_=Math.ceil(n/t)+1;let s=Math.ceil(r/2);_<=s&&(s=2*s-_+1),SHOW_DEBUG;for(var i=1;i<=o;i++){const e=i-1==n/t,r=!e,o=(i-1)*t;(i>=_-s&&i<=_||i>=_-s&&i<=_+s)&&a.push({label:i,offset_value:o,type:"page",selected:e,active:r,id:i})}a.push({label:tstring.next||"Next",offset_value:n+t,type:"navigator",active:n<e-t,id:"next"}),a.push({label:tstring.last||">>",offset_value:(o-1)*t,type:"navigator",active:n<e-t,id:"last"});return SHOW_DEBUG,{total:e,limit:t,offset:n,nodes:r,n_pages:o,n_pages_group:s,current_page:_,ar_nodes:a}},build_paginator_html:function(e,t,n){const r=this,a=new DocumentFragment,o=e.ar_nodes||[],_=o.length;for(let t=0;t<_;t++){const _=o[t];let s="",i=_.label;switch(_.type){case"navigator":s=_.type+" "+_.id;break;case"page":s=_.type+""}!0===_.selected&&(s+=" selected");const l=common.create_dom_element({element_type:"a",class_name:s+(_.active?"":" unactive"),text_content:i,parent:a});!0===_.active&&l.addEventListener("click",(function(t){const a="function"==typeof n?n:r.goto_url;return"function"==typeof a&&a({offset:_.offset_value,total:e.total})}))}const s=common.create_dom_element({element_type:"div",class_name:"paginator_wrapper navigator"});return s.appendChild(a),t&&t.appendChild(s),s},goto_url:function(e){const t="../?total="+e.total+"&offset="+e.offset;return window.location.href=t,!0},get_full_paginator:function(e){const t=e.total,n=e.limit,r=e.offset,a=e.n_nodes,o=e.callback||null,_=this.build_page_nodes(t,n,r,a);return this.build_paginator_html(_,!1,o)},get_totals_node:function(e){const t=e.total,n=(e.limit,e.offset),r=e.count,a=0==t?0:Math.ceil(1*n)||1,o=n+r,_=0===t?tstring.showed+" "+t:tstring.showed+" "+a+" "+tstring.to+" "+o+" "+tstring.of+" "+t;return common.create_dom_element({element_type:"div",class_name:"totals",text_content:_})}};!function(){const e=function(){};e.prototype.request=async function(e){console.log("++++ request options:",e);const t=e.url||page_globals.JSON_TRIGGER_URL,n=e.method||"POST",r=e.mode||"cors",a=e.cache||"no-cache",o=e.credentials||"same-origin",_=e.headers||{"Content-Type":"application/json"},s=e.redirect||"follow",i=e.referrer||"no-referrer",l=e.body;return l.code||(l.code=page_globals.API_WEB_USER_CODE),l.lang||(l.lang=page_globals.WEB_CURRENT_LANG_CODE),fetch(t,{method:n,mode:r,cache:a,credentials:o,headers:_,redirect:s,referrer:i,body:JSON.stringify(l)}).then((function(e){if(!e.ok)throw console.warn("-> handle_errors response:",e),Error(e.statusText);return e})).then(e=>e.json().then(e=>e)).catch(e=>(console.error("!!!!! [page data_manager.request] ERROR:",e),{result:!1,msg:e.message,error:e}))},window.data_manager=new e,window.event_manager=new function(){this.events=[],this.last_token=-1,this.subscribe=function(e,t){const n="event_"+String(++this.last_token),r={event_name:e,token:n,callback:t};return this.events.push(r),n},this.unsubscribe=function(e){return this.events.map((t,n,r)=>{t.token===e&&r.splice(n,1)})},this.publish=function(e,t={}){const n=this.events.filter(t=>t.event_name===e);return!!n&&n.map(e=>e.callback(t))},this.get_events=function(){return this.events},this.fire_event=function(e,t){var n;if(e.ownerDocument)n=e.ownerDocument;else{if(9!=e.nodeType)throw new Error("Invalid node passed to fireEvent: "+e.id);n=e}if(e.dispatchEvent){var r="";switch(t){case"click":case"mousedown":case"mouseup":r="MouseEvents";break;case"focus":case"change":case"blur":case"select":r="HTMLEvents";break;default:throw"fireEvent: Couldn't find an event class for event '"+t+"'."}var a="change"!=t;(o=n.createEvent(r)).initEvent(t,a,!0),o.synthetic=!0,e.dispatchEvent(o,!0)}else if(e.fireEvent){var o;(o=n.createEventObject()).synthetic=!0,e.fireEvent("on"+t,o)}},this.when_in_dom=function(e,t){const n=new MutationObserver((function(r){document.contains(e)&&(n.disconnect(),t(this))}));return n.observe(document,{attributes:!1,childList:!0,characterData:!1,subtree:!0}),n}},setTimeout((function(){console.log("Activated app_utils !"),console.log("Avilable data_manager:",data_manager),console.log("Avilable event_manager:",event_manager)}),10)}();var biblio_row_fields={biblio_object:null,caller:null,get_typology:function(){const e=this.biblio_object.typology||"[]",t=JSON.parse(e);return"1"==(void 0!==t[0]?t[0]:0)?"book":"article"},author:function(){const e=this.biblio_object,t=common.create_dom_element({element_type:"div",class_name:"info_line author"});if(!0===dedalo_logged){common.create_dom_element({element_type:"a",class_name:"section_id go_to_dedalo",text_content:e.section_id+" "+this.get_typology(),href:"/dedalo/lib/dedalo/main/?t=rsc205&id="+e.section_id,parent:t}).setAttribute("target","_blank")}if(e.authors&&e.authors.length>0){const r=e.authors_data,a=r.length,o=[];for(var n=0;n<a;n++){const e=[];r[n].surname&&e.push(r[n].surname),r[n].name&&e.push(r[n].name);const t=e.join(", ");o.push(t)}const _=o.join("; ");common.create_dom_element({element_type:"div",class_name:"info_value",text_content:_,parent:t})}else common.create_dom_element({element_type:"div",class_name:"info_value",text_content:"Undefined author",parent:t});return t},publication_date:function(){const e=this.biblio_object,t=common.create_dom_element({element_type:"div"}),n=e.publication_date.split("-");let r=parseInt(n[0]);return r=r+"-"+parseInt(n[1]),n[2],parseInt(n[2])>0&&(r=r+"-"+parseInt(n[2])),common.create_dom_element({element_type:"div",class_name:"info_value",text_content:r,parent:t}),t.classList.remove("hide"),t},row_title:function(){const e=this.biblio_object,t=this.get_typology(),n=e.pdf||"[]",r=JSON.parse(n),a=r.length,o=common.create_dom_element({element_type:"div",class_name:"info_line row_title"}),_=e.title||"",s="book"===t?" italic":"";common.create_dom_element({element_type:"div",class_name:"title"+s+(a>0?" blue":""),text_content:_,parent:o});for(let e=0;e<a;e++){const t=r[e];common.create_dom_element({element_type:"div",class_name:"pdf",title:t.title,parent:o}).addEventListener("click",e=>{window.open(t.iri,"PDF","menubar=yes,location=yes,resizable=yes,scrollbars=yes,status=yes")})}return o},row_body:function(){const e=this.biblio_object,t=this.get_typology(),n=common.create_dom_element({element_type:"div",class_name:"info_line row_body "+t});switch(t){case"book":e.place&&common.create_dom_element({element_type:"div",class_name:"info_value place grey",text_content:e.place,parent:n}),e.editor&&common.create_dom_element({element_type:"div",class_name:"info_value editor grey",text_content:": "+e.editor,parent:n});break;default:if(e.magazine&&common.create_dom_element({element_type:"div",class_name:"info_value magazine grey italic",text_content:e.magazine,parent:n}),e.serie&&common.create_dom_element({element_type:"div",class_name:"info_value serie grey",text_content:": "+e.serie,parent:n}),e.volume){const t=e.serie.length>0?", "+e.volume:e.volume;common.create_dom_element({element_type:"div",class_name:"info_value volume grey italic",text_content:t,parent:n})}if(e.other_people_name&&e.other_people_name.length>0){const t=e.other_people_name.split(" | "),r=e.other_people_role.split(" | ");for(let a=0;a<t.length;a++){const o=t[a],_=void 0!==r[a]?" ("+r[a]+")":"",s=e.serie.length>0||e.volume&&e.volume.length>0?", "+o+_:o+_;common.create_dom_element({element_type:"div",class_name:"info_value other_people_name grey",text_content:s,parent:n})}}if(e.physical_description){const t=e.serie.length>0||e.volume&&e.volume.length>0?", "+e.physical_description:e.physical_description;common.create_dom_element({element_type:"div",class_name:"info_value physical_description grey",text_content:t,parent:n})}}return n},row_url:function(){const e=this.biblio_object,t=common.create_dom_element({element_type:"div",class_name:"info_line row_url"}),n=e.url_data;if(n&&n.length>0){const e=JSON.parse(n),r=e.length;for(let n=0;n<r;n++){const a=e[n];common.create_dom_element({element_type:"a",class_name:"url_data",title:a.title,text_content:a.title,href:a.iri,parent:t}),!(n%2)&&n<r&&r>1&&common.create_dom_element({element_type:"span",class_name:"separator",text_content:" | ",parent:t})}}return t},descriptors:function(e){const t=this,n=(this.biblio_object,common.create_dom_element({element_type:"div",class_name:"info_line descriptors"})),r=e.split(" - ")
;for(let e=0;e<r.length;e++){const a=r[e];common.create_dom_element({element_type:"a",class_name:"descriptors_link",text_content:a,parent:n}).addEventListener("click",(function(){t.caller.search_item("descriptors",a)}))}return n},row_bibliography:function(){const e=this.biblio_object,t=common.create_dom_element({element_type:"div",class_name:"info_line row_title"}),n=e.ref_publications_authors?e.ref_publications_authors+". ":"";common.create_dom_element({element_type:"span",inner_html:n,parent:t});const r=e.ref_publications_date?"("+e.ref_publications_date+") ":"";common.create_dom_element({element_type:"span",inner_html:r,parent:t});const a=e.ref_publications_title?"<em>"+e.ref_publications_title+". </em>":"";common.create_dom_element({element_type:"span",inner_html:a,parent:t});const o=e.ref_publications_magazine?e.ref_publications_magazine+". ":"";common.create_dom_element({element_type:"span",inner_html:o,parent:t});const _=e.pages?" p."+e.pages+". ":"";common.create_dom_element({element_type:"span",inner_html:_,parent:t});const s=e.reference?" ref."+e.reference+". ":"";common.create_dom_element({element_type:"span",inner_html:s,parent:t});const i=e.sheet?" s."+e.sheet+". ":"";common.create_dom_element({element_type:"span",inner_html:i,parent:t});const l=e.ref_publications_place?" s."+e.ref_publications_place+". ":"";common.create_dom_element({element_type:"span",inner_html:l,parent:t});const c=e.ref_publications_url?'<a href="'+e.ref_publications_url+'">'+e.ref_publications_url+" </a> ":"";return common.create_dom_element({element_type:"span",inner_html:c,parent:t}),t}};