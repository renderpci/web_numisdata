"use strict";var page={trigger_url:page_globals.__WEB_ROOT_WEB__+"/web/trigger.web.php",maps_config:{source_maps:[{name:"DARE",url:"//dh.gu.se/tiles/imperium/{z}/{x}/{y}.png",options:{maxZoom:11},default:!0},{name:"OSM",url:"//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",options:{maxZoom:19}},{name:"Map Tiles",url:"https://api.maptiler.com/maps/basic/256/{z}/{x}/{y}@2x.png?key=udlBrEEE2SPm1In5dCNb",options:{maxZoom:20}},{name:"ARCGIS",url:"//server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",options:{}}],popup_options:{maxWidth:420,closeButton:!1,className:"map_popup"},markers:{mint:{iconUrl:page_globals.__WEB_TEMPLATE_WEB__+"/assets/images/map/purple.png",shadowUrl:page_globals.__WEB_TEMPLATE_WEB__+"/assets/images/map/marker-shadow.png",iconSize:[47,43],shadowSize:[41,41],iconAnchor:[10,19],shadowAnchor:[0,20],popupAnchor:[12,-20]},findspot:{iconUrl:page_globals.__WEB_TEMPLATE_WEB__+"/assets/images/map/orange.png",shadowUrl:page_globals.__WEB_TEMPLATE_WEB__+"/assets/images/map/marker-shadow.png",iconSize:[47,43],shadowSize:[41,41],iconAnchor:[10,19],shadowAnchor:[0,20],popupAnchor:[12,-20]},hoard:{iconUrl:page_globals.__WEB_TEMPLATE_WEB__+"/assets/images/map/green.png",shadowUrl:page_globals.__WEB_TEMPLATE_WEB__+"/assets/images/map/marker-shadow.png",iconSize:[47,43],shadowSize:[41,41],iconAnchor:[10,19],shadowAnchor:[0,20],popupAnchor:[12,-20]}}},setup:function(){var e=this;return window.ready((function(){e.hilite_lang(page_globals.WEB_CURRENT_LANG_CODE);const t=document.getElementById("footer");t&&setTimeout((function(){t.classList.remove("hidded")}),500)})),!0},hilite_lang:function(e){const t=document.getElementById("page_lang_selector");if(t){const n=t.querySelectorAll("a");for(let t=0;t<n.length;t++)-1!==n[t].href.indexOf(e)&&n[t].classList.add("selected")}return!0},load_more_items:function(e){var t=JSON.parse(e.dataset.template_map),n=document.getElementById(e.dataset.target),o=document.createElement("div");o.classList.add("spinner_list"),n.appendChild(o);var r={mode:"load_more_items",template_map:t};return common.get_json_data(this.trigger_url,r,!0).then((function(r){if(console.log("[page.load_more_items] response",r),null===r)console.log("[page.load_more_items] Error. Null response");else{var a=document.createElement("div");a.innerHTML=r.html;for(var _=a.children;_.length>0;)n.appendChild(_[0]);t.offset=t.offset+t.max_records,e.dataset.template_map=JSON.stringify(t),t.offset>=t.total_records&&(e.style.display="none")}o.remove()}))},adjust_image_size:function(e){e.style.opacity=0;var t=document.createElement("img");return t.src=e.style.backgroundImage.replace(/"/g,"").replace(/url\(|\)$/gi,""),t.addEventListener("load",(function(t){var n=this.width;this.height>n&&e.classList.add("vertical"),e.style.opacity=1}),!1),!0},adjust_footer_position:function(){let e=!1;const t=document.getElementById("wrapper");if(!t)return console.log("top_container not found !"),!1;t.offsetHeight>window.innerHeight&&(e=!0);!0===SHOW_DEBUG&&console.log("scrollbar:",e);const n=document.getElementById("footer");return!1===e?n.classList.add("fixed"):n.classList.remove("fixed"),e},activate_tooltips:function(e){SHOW_DEBUG,$(e).each((function(){new Tooltip($(this),{placement:"top"})}))},build_paginator_html:function(e,t,n){const o=t;o.dataset.total=e.total;const r=e.ar_nodes,a=r.length;for(let e=0;e<a;e++){const t=r[e];let n=t.label,a="page "+t.type+" "+t.id;if(!1===t.active&&(a+=" unactive"),"previous"!==t.id&&"next"!==t.id&&"last"!==t.id&&"first"!==t.id||(n=""),!0===t.selected&&(a+=" selected"),"extra"===t.type){a=t.type;common.create_dom_element({element_type:"span",class_name:a,text_content:n,parent:o})}else{common.create_dom_element({element_type:"a",class_name:a,text_content:n,dataset:{offset:t.offset_value,active:t.active},parent:o});t.active}}return o.addEventListener("click",this.paginator_click_event),o},paginator_click_event:function(e){const t=this,n=e.target;if("true"!==n.dataset.active)return!1;const o=parseInt(n.parentNode.dataset.total),r=n.dataset.offset,a=document.getElementById("search_form"),_=main_home.search(a,null,r,o);return _.then((function(e){t.result_container})),_},add_spinner:function(e){if(e){const t=common.create_dom_element({element_type:"img",class_name:"spinner_svg",src:page_globals.__WEB_ROOT_WEB__+"/tpl/assets/images/spinner.svg"});e.appendChild(t)}else console.warn("[add_spinner] Error on get target ",e);return!0},remove_spinner:function(e){const t=e.querySelector(".spinner_svg");return!!t&&(t.remove(),!0)},remote_image:function(e){if(e){let t="";return t=-1!==e.indexOf("v5/media_test")?e.replace(/\/v5\/media_test\/media_monedaiberica\//g,page_globals.__WEB_MEDIA_BASE_URL__+"/dedalo/media/"):e.replace(/\/dedalo\/media_test\/media_monedaiberica\//g,page_globals.__WEB_MEDIA_BASE_URL__+"/dedalo/media/"),t}return null},parse_legend_svg:function(e){return-1!==e.indexOf("http")?e:e.replace(/\/dedalo\/media\/svg\//g,page_globals.__WEB_MEDIA_BASE_URL__+"/dedalo/media/svg/")},parse_catalog_data:function(e){const t=this;if(Array.isArray(e)){const n=[],o=e.length;for(let r=0;r<o;r++)n.push(t.parse_catalog_data(e[r]));return n}const n=e;return n.ref_coins_image_obverse=common.local_to_remote_path(e.ref_coins_image_obverse),n.ref_coins_image_reverse=common.local_to_remote_path(e.ref_coins_image_reverse),n.ref_coins_image_obverse_thumb=n.ref_coins_image_obverse?n.ref_coins_image_obverse.replace("/1.5MB/","/thumb/"):null,n.ref_coins_image_reverse_thumb=n.ref_coins_image_reverse?n.ref_coins_image_reverse.replace("/1.5MB/","/thumb/"):null,n.ref_type_legend_obverse=n.ref_type_legend_obverse?t.parse_legend_svg(n.ref_type_legend_obverse):null,n.ref_type_legend_reverse=n.ref_type_legend_reverse?t.parse_legend_svg(n.ref_type_legend_reverse):null,n.ref_type_symbol_obverse=n.ref_type_symbol_obverse?t.parse_legend_svg(n.ref_type_symbol_obverse):null,n.ref_type_symbol_reverse=n.ref_type_symbol_reverse?t.parse_legend_svg(n.ref_type_symbol_reverse):null,n.term_data=JSON.parse(n.term_data),n.term_section_id=n.term_data?n.term_data[0]:null,n},parse_type_data:function(e){const t=this;if(Array.isArray(e)){const n=[];for(let o=0;o<e.length;o++)n.push(t.parse_type_data(e[o]));return n}const n=e;if(n.ref_coins_image_obverse=common.local_to_remote_path(e.ref_coins_image_obverse),n.ref_coins_image_reverse=common.local_to_remote_path(e.ref_coins_image_reverse),n.ref_coins_union)for(let e=0;e<n.ref_coins_union.length;e++)n.ref_coins_union[e].image_obverse&&(n.ref_coins_union[e].image_obverse=common.local_to_remote_path(n.ref_coins_union[e].image_obverse)),n.ref_coins_union[e].image_reverse&&(n.ref_coins_union[e].image_reverse=common.local_to_remote_path(n.ref_coins_union[e].image_reverse));return n.uri=t.parse_iri_data(n.uri),n.legend_obverse=n.legend_obverse?t.parse_legend_svg(n.legend_obverse):null,n.legend_reverse=n.legend_reverse?t.parse_legend_svg(n.legend_reverse):null,n},parse_coin_data:function(e){const t=this;if(Array.isArray(e)){const n=[];for(let o=0;o<e.length;o++)n.push(t.parse_coin_data(e[o]));return n}const n=e;return n.image_obverse=common.local_to_remote_path(e.image_obverse),n.image_reverse=common.local_to_remote_path(e.image_reverse),n.type_data&&n.type_data.length>0&&(n.type_data=t.parse_type_data(n.type_data)),n.legend_obverse=n.legend_obverse?t.parse_legend_svg(n.legend_obverse):null,n.legend_reverse=n.legend_reverse?t.parse_legend_svg(n.legend_reverse):null,n.countermark_obverse=n.countermark_obverse?t.parse_legend_svg(n.countermark_obverse):null,n.countermark_reverse=n.countermark_reverse?t.parse_legend_svg(n.countermark_reverse):null,n.ref_auction_date=t.parse_date(n.ref_auction_date),n.find_date=t.parse_date(n.find_date),n.mib_uri=page_globals.__WEB_BASE_URL__+page_globals.__WEB_ROOT_WEB__+"/coin/"+n.section_id,n.uri=t.parse_iri_data(n.uri),n.bibliography=page.parse_publication(n.bibliography_data),n.mint=void 0!==n.type_data[0]?n.type_data[0].mint:null,n.type_number=void 0!==n.type_data[0]?n.type_data[0].number:null,n},parse_iri_data:function(e){const t=[];if(!e||e.length<1)return t;const n=e.split(" | ");for(let e=0;e<n.length;e++){const o=n[e].split(", ");if(o.length>1&&void 0===o[1])continue;const r=1===o.length?o[0]:o[1];let a=1===o.length?"":o[0];if(a.length<1)try{a=new URL(r).hostname}catch(e){console.error(e)}t.push({label:a,value:r})}return t},remove_gaps:function(e,t){return e.split(t).filter(Boolean).join(t)},split_data:function(e,t){return e?e.split(t):[]},is_empty:function(e){return e&&e.length>0},parse_date:function(e){if(!e||e.length<4)return null;const t=e.substring(0,4),n=e.substring(5,7),o=e.substring(8,10),r=[];o&&"00"!=o&&r.push(o),n&&"00"!=n&&r.push(n),t&&"00"!=t&&r.push(t);return r.join("-")},parse_publication:function(e){const t=[],n=e.length;for(let o=0;o<n;o++){const n=e[o];n._publications=[];const r=JSON.parse(n.publications_data),a=r.length;if(a>0){const e=page.split_data(n.ref_publications_authors," # "),o=page.split_data(n.ref_publications_date," # "),_=page.split_data(n.ref_publications_editor," # "),s=page.split_data(n.ref_publications_magazine," # "),i=page.split_data(n.ref_publications_place," # "),l=page.split_data(n.ref_publications_title," # "),p=page.split_data(n.ref_publications_url," # ");for(let c=0;c<a;c++){const a=r[c],m={reference:n.section_id,section_id:a,authors:e[c]||null,date:o[c]||null,editor:_[c]||null,magazine:s[c]||null,place:i[c]||null,title:l[c]||null,url:p[c]||null};n._publications.push(m),t.push(m)}}}return t},activate_images_gallery:function(e,t){if(!0===t){const e=document.querySelectorAll(".poptrox-overlay");if(e)for(let t=e.length-1;t>=0;t--)e[t].remove()}return $(e).poptrox({baseZIndex:2e4,fadeSpeed:1,overlayOpacity:.5,popupCloserText:"",popupHeight:150,popupWidth:150,popupLoaderText:"",popupSpeed:1,selector:"a.image_link",usePopupCaption:!1,usePopupCloser:!0,usePopupDefaultStyling:!1,usePopupForceClose:!0,usePopupLoader:!0,usePopupNav:!0,windowMargin:50})},map_popup_builder:function(e){const t=common.create_dom_element({element_type:"div",class_name:"popup_wrapper"}),n=e.group,o=new Intl.Collator("es",{sensitivity:"base",ignorePunctuation:!0});n.sort((e,t)=>o.compare(e.title,t.title));const r=function(e){const n=e.section_id,o=e.title||"Undefined title "+n,r=e.description,a=common.create_dom_element({element_type:"div",class_name:"popup_item",parent:t});common.create_dom_element({element_type:"div",class_name:"text_title",inner_html:o,parent:a});if(r&&r.length>3){common.create_dom_element({element_type:"div",class_name:"text_description",inner_html:r,parent:a})}},a=n.length;return function e(o,_){for(let e=o;e<_;e++)r(n[e]);if(_<a-1){const n=common.create_dom_element({element_type:"input",type:"button",value:tstring.load_more||"Load more..",class_name:"more_node btn btn-light btn-block primary",parent:t});n.addEventListener("click",(function(){const t=this.offset+1;e(t,t+100<a?t+100:a),this.remove()})),n.offset=_}}(0,100<a?100:a),t}};