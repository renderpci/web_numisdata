"use strict";page.parse_type_data=function(e){const _=this;if(Array.isArray(e)){const r=[];for(let t=0;t<e.length;t++)r.push(_.parse_type_data(e[t]));return r}const r=e;return"object"!=typeof r&&(console.log("parse_type_data row:",r),console.trace()),r.parsed||(r.ref_coins_image_obverse=void 0!==e.ref_coins_image_obverse?common.local_to_remote_path(e.ref_coins_image_obverse):null,r.ref_coins_image_reverse=void 0!==e.ref_coins_image_reverse?common.local_to_remote_path(e.ref_coins_image_reverse):null,r.ref_coins_union&&Array.isArray(r.ref_coins_union)&&r.ref_coins_union.length>0&&(r.ref_coins_union=page.parse_coin_data(r.ref_coins_union)),r.uri=_.parse_iri_data(r.uri),r.legend_obverse=r.legend_obverse?_.parse_legend_svg(r.legend_obverse):null,r.legend_reverse=r.legend_reverse?_.parse_legend_svg(r.legend_reverse):null,r.material=r.material?page.trim_char(page.remove_gaps(r.material," | "),"|"):null,r.symbol_obverse=r.symbol_obverse?page.trim_char(page.remove_gaps(r.symbol_obverse," | "),"|"):null,r.symbol_reverse=r.symbol_reverse?page.trim_char(page.remove_gaps(r.symbol_reverse," | "),"|"):null,r.symbol_obverse_data=JSON.parse(r.symbol_obverse_data),r.symbol_reverse_data=JSON.parse(r.symbol_reverse_data),r.parsed=!0),r},page.parse_coin_data=function(e){const _=this;if(Array.isArray(e)){const _=[];for(let r=0;r<e.length;r++)_.push(page.parse_coin_data(e[r]));return _}const r=e;if("object"!=typeof r&&(console.log("parse_coin_data row:",r),console.trace()),r.parsed)return r;if(r.image_obverse=common.local_to_remote_path(e.image_obverse),r.image_obverse_thumb=r.image_obverse?r.image_obverse.replace("/1.5MB/","/thumb/"):null,r.image_reverse=common.local_to_remote_path(e.image_reverse),r.image_reverse_thumb=r.image_reverse?r.image_reverse.replace("/1.5MB/","/thumb/"):null,r.type_data&&Array.isArray(r.type_data)&&r.type_data.length>0&&(r.type_data=_.parse_type_data(r.type_data)),r.type=r.type?page.remove_gaps(r.type," | "):null,r.legend_obverse=r.legend_obverse?_.parse_legend_svg(r.legend_obverse):null,r.legend_reverse=r.legend_reverse?_.parse_legend_svg(r.legend_reverse):null,r.countermark_obverse=r.countermark_obverse?_.parse_legend_svg(r.countermark_obverse):null,r.countermark_reverse=r.countermark_reverse?_.parse_legend_svg(r.countermark_reverse):null,r.ref_auction=r.ref_auction?JSON.parse(r.ref_auction):null,r.ref_auction_date=r.ref_auction_date?JSON.parse(r.ref_auction_date):null,r.ref_auction_number=r.ref_auction_number?JSON.parse(r.ref_auction_number):null,r.ref_auction_group=null,r.ref_auction&&r.ref_auction.length>0){r.ref_auction_group=[];for(let e=0;e<r.ref_auction.length;e++)r.ref_auction_group.push({name:r.ref_auction[e],date:void 0!==r.ref_auction_date[e]?_.parse_date(r.ref_auction_date[e]):"",number:void 0!==r.ref_auction_number[e]?r.ref_auction_number[e]:""})}if(r.ref_related_coin_auction=r.ref_related_coin_auction?JSON.parse(r.ref_related_coin_auction):null,r.ref_related_coin_auction_date=r.ref_related_coin_auction_date?JSON.parse(r.ref_related_coin_auction_date):null,r.ref_related_coin_auction_number=r.ref_related_coin_auction_number?JSON.parse(r.ref_related_coin_auction_number):null,r.ref_related_coin_auction_group=null,r.ref_related_coin_auction&&r.ref_related_coin_auction.length>0){r.ref_related_coin_auction_group=[];for(let e=0;e<r.ref_related_coin_auction.length;e++)r.ref_related_coin_auction_group.push({name:r.ref_related_coin_auction[e],date:void 0!==r.ref_related_coin_auction_date[e]?_.parse_date(r.ref_related_coin_auction_date[e]):"",number:void 0!==r.ref_related_coin_auction_number[e]?r.ref_related_coin_auction_number[e]:""})}return r.find_date=_.parse_date(r.find_date),r.mib_uri=page_globals.__WEB_BASE_URL__+page_globals.__WEB_ROOT_WEB__+"/coin/"+r.section_id,r.uri=_.parse_iri_data(r.uri),r.bibliography_data&&Array.isArray(r.bibliography_data)&&(r.bibliography=page.parse_publication(r.bibliography_data)),r.mint=r.type_dat&&void 0!==r.type_data[0]?r.type_data[0].mint:null,r.type_number=r.type_data&&void 0!==r.type_data[0]?r.type_data[0].number:null,r.parsed=!0,r},page.parse_catalog_data=function(e){const _=this;if(!e)return[];Array.isArray(e)||(e=[e]);const r=[],t=e.length;for(let n=0;n<t;n++){const t=e[n];t.parsed||(t.coins_data_union=t.coins_data_union?JSON.parse(t.coins_data_union):null,t.ref_coins_image_obverse=common.local_to_remote_path(t.ref_coins_image_obverse),t.ref_coins_image_reverse=common.local_to_remote_path(t.ref_coins_image_reverse),t.ref_coins_image_obverse_thumb=t.ref_coins_image_obverse?t.ref_coins_image_obverse.replace("/1.5MB/","/thumb/"):null,t.ref_coins_image_reverse_thumb=t.ref_coins_image_reverse?t.ref_coins_image_reverse.replace("/1.5MB/","/thumb/"):null,t.ref_type_legend_obverse=t.ref_type_legend_obverse?_.parse_legend_svg(t.ref_type_legend_obverse):null,t.ref_type_legend_reverse=t.ref_type_legend_reverse?_.parse_legend_svg(t.ref_type_legend_reverse):null,t.ref_type_symbol_obverse=t.ref_type_symbol_obverse?_.parse_legend_svg(t.ref_type_symbol_obverse):null,t.ref_type_symbol_reverse=t.ref_type_symbol_reverse?_.parse_legend_svg(t.ref_type_symbol_reverse):null,t.term_data=JSON.parse(t.term_data),t.term_section_id=t.term_data?t.term_data[0]:null,t.children=JSON.parse(t.children),t.parent=t.parent&&Array.isArray(t.parent)?(a=t.parent,page.parse_catalog_data(a)):JSON.parse(t.parent),t.ref_type_averages_diameter=t.ref_type_averages_diameter?parseFloat(t.ref_type_averages_diameter.replace(",",".")):null,t.ref_type_total_diameter_items=t.ref_type_total_diameter_items?parseFloat(t.ref_type_total_diameter_items.replace(",",".")):null,t.ref_type_averages_weight=t.ref_type_averages_weight?parseFloat(t.ref_type_averages_weight.replace(",",".")):null,t.ref_type_total_weight_items=t.ref_type_total_weight_items?parseFloat(t.ref_type_total_weight_items.replace(",",".")):null,t.ref_type_material=page.trim_char(t.ref_type_material,"|"),r.push(t))}var a;for(let _=0;_<t;_++){const t=r[_];if(!t.parsed&&"types"===t.term_table&&t.children){const _=[],r=[];for(let a=0;a<t.children.length;a++){const n=t.children[a],o=e.find(e=>e.section_id==n);if(o&&o.ref_type_averages_weight){const e=o.ref_type_total_weight_items,_=new Array(e).fill(o.ref_type_averages_weight);r.push(..._)}if(o&&o.ref_type_averages_diameter){const e=o.ref_type_total_diameter_items,r=new Array(e).fill(o.ref_type_averages_diameter);_.push(...r)}}const a=r.reduce((e,_)=>e+_,0)/r.length,n=_.reduce((e,_)=>e+_,0)/_.length;t.ref_type_averages_weight=a,t.ref_type_averages_diameter=n,t.ref_type_total_weight_items=r.length,t.ref_type_total_diameter_items=_.length}t.parsed=!0}return r},page.parse_publication=function(e){const _=[],r=e.length;for(let t=0;t<r;t++){const r=e[t];if(r.parsed)continue;r._publications=[];const a=JSON.parse(r.publications_data),n=a.length;if(n>0){const e=page.split_data(r.ref_publications_authors," # "),t=page.split_data(r.ref_publications_date," # "),o=page.split_data(r.ref_publications_editor," # "),s=page.split_data(r.ref_publications_magazine," # "),i=page.split_data(r.ref_publications_place," # "),l=page.split_data(r.ref_publications_title," # "),p=page.split_data(r.ref_publications_url," # ");for(let c=0;c<n;c++){const n=a[c],u={reference:r.section_id,section_id:n,authors:e[c]||null,date:t[c]||null,editor:o[c]||null,magazine:s[c]||null,place:i[c]||null,title:l[c]||null,url:p[c]||null};r._publications.push(u),_.push(u)}}r.parsed=!0}return _},page.parse_map_global_data=function(e){const _=e.length;for(let r=0;r<_;r++){const _=e[r];if(!_.parsed){if(_.georef_geojson=_.georef_geojson?JSON.parse(_.georef_geojson):null,_.coins_list=_.coins_list?JSON.parse(_.coins_list):[],_.types_list=_.types_list?JSON.parse(_.types_list):[],_.georef_geojson&&_.georef_geojson.length>0){const e=function(e){let _;switch(e){case"mints":_="mint";break;case"hoards":_="hoard";break;case"findspots":_="findspot"}return _}(_.table),r=_.coins_list?_.coins_list.length:0,t=_.types_list?_.types_list.length:0,a='<span class="note">'+(tstring[e]||e)+"</span> "+_.name,n=(tstring.coins||"Coins")+" "+r+"<br>"+(tstring.types||"Types")+" "+t,o={section_id:_.section_id,title:a,coins_total:r,types_total:t,description:n,ref_section_id:_.ref_section_id,ref_section_tipo:_.ref_section_tipo,table:_.table,name:_.name,term_id:_.section_id},s=page.maps_config.markers[e],i={lat:null,lon:null,geojson:_.georef_geojson,marker_icon:s,data:o};_.item=i}else _.item=null;_.parsed=!0}}return e},page.parse_iri_data=function(e){const _=[];if(!e||e.length<1)return _;const r=e.split(" | ");for(let e=0;e<r.length;e++){const t=r[e].split(", ");if(t.length>1&&void 0===t[1])continue;const a=1===t.length?t[0]:t[1];let n=1===t.length?"":t[0];if(n.length<1)try{n=new URL(a).hostname}catch(e){console.error(e)}_.push({label:n,value:a})}return _};