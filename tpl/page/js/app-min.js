"use strict";var page={trigger_url:page_globals.__WEB_ROOT_WEB__+"/web/trigger.web.php",maps_config:{source_maps:[{name:"DARE",url:"//dh.gu.se/tiles/imperium/{z}/{x}/{y}.png",options:{maxZoom:11},default:!0},{name:"OSM",url:"//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",options:{maxZoom:19}},{name:"Map Tiles",url:"https://api.maptiler.com/maps/basic/256/{z}/{x}/{y}@2x.png?key=udlBrEEE2SPm1In5dCNb",options:{maxZoom:20}},{name:"ARCGIS",url:"//server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",options:{}}],popup_options:{maxWidth:420,closeButton:!1,className:"map_popup"},markers:{mint:{iconUrl:page_globals.__WEB_TEMPLATE_WEB__+"/assets/images/map/purple.png",shadowUrl:page_globals.__WEB_TEMPLATE_WEB__+"/assets/images/map/marker-shadow.png",iconSize:[47,43],shadowSize:[41,41],iconAnchor:[10,19],shadowAnchor:[0,20],popupAnchor:[12,-20]},findspot:{iconUrl:page_globals.__WEB_TEMPLATE_WEB__+"/assets/images/map/orange.png",shadowUrl:page_globals.__WEB_TEMPLATE_WEB__+"/assets/images/map/marker-shadow.png",iconSize:[47,43],shadowSize:[41,41],iconAnchor:[10,19],shadowAnchor:[0,20],popupAnchor:[12,-20]},hoard:{iconUrl:page_globals.__WEB_TEMPLATE_WEB__+"/assets/images/map/green.png",shadowUrl:page_globals.__WEB_TEMPLATE_WEB__+"/assets/images/map/marker-shadow.png",iconSize:[47,43],shadowSize:[41,41],iconAnchor:[10,19],shadowAnchor:[0,20],popupAnchor:[12,-20]}}},setup:function(){var e=this;return window.ready((function(){e.hilite_lang(page_globals.WEB_CURRENT_LANG_CODE);const t=document.getElementById("footer");t&&setTimeout((function(){t.classList.remove("hidded")}),500)})),!0},hilite_lang:function(e){const t=document.getElementById("page_lang_selector");if(t){const r=t.querySelectorAll("a");for(let t=0;t<r.length;t++)-1!==r[t].href.indexOf(e)&&r[t].classList.add("selected")}return!0},load_more_items:function(e){var t=JSON.parse(e.dataset.template_map),r=document.getElementById(e.dataset.target),n=document.createElement("div");n.classList.add("spinner_list"),r.appendChild(n);var a={mode:"load_more_items",template_map:t};return common.get_json_data(this.trigger_url,a,!0).then((function(a){if(console.log("[page.load_more_items] response",a),null===a)console.log("[page.load_more_items] Error. Null response");else{var o=document.createElement("div");o.innerHTML=a.html;for(var s=o.children;s.length>0;)r.appendChild(s[0]);t.offset=t.offset+t.max_records,e.dataset.template_map=JSON.stringify(t),t.offset>=t.total_records&&(e.style.display="none")}n.remove()}))},adjust_image_size:function(e){e.style.opacity=0;var t=document.createElement("img");return t.src=e.style.backgroundImage.replace(/"/g,"").replace(/url\(|\)$/gi,""),t.addEventListener("load",(function(t){var r=this.width;this.height>r&&e.classList.add("vertical"),e.style.opacity=1}),!1),!0},adjust_footer_position:function(){let e=!1;const t=document.getElementById("wrapper");if(!t)return console.log("top_container not found !"),!1;t.offsetHeight>window.innerHeight&&(e=!0);!0===SHOW_DEBUG&&console.log("scrollbar:",e);const r=document.getElementById("footer");return!1===e?r.classList.add("fixed"):r.classList.remove("fixed"),e},activate_tooltips:function(e){SHOW_DEBUG,$(e).each((function(){new Tooltip($(this),{placement:"top"})}))},build_paginator_html:function(e,t,r){const n=t;n.dataset.total=e.total;const a=e.ar_nodes,o=a.length;for(let e=0;e<o;e++){const t=a[e];let r=t.label,o="page "+t.type+" "+t.id;if(!1===t.active&&(o+=" unactive"),"previous"!==t.id&&"next"!==t.id&&"last"!==t.id&&"first"!==t.id||(r=""),!0===t.selected&&(o+=" selected"),"extra"===t.type){o=t.type;common.create_dom_element({element_type:"span",class_name:o,text_content:r,parent:n})}else{common.create_dom_element({element_type:"a",class_name:o,text_content:r,dataset:{offset:t.offset_value,active:t.active},parent:n});t.active}}return n.addEventListener("click",this.paginator_click_event),n},paginator_click_event:function(e){const t=this,r=e.target;if("true"!==r.dataset.active)return!1;const n=parseInt(r.parentNode.dataset.total),a=r.dataset.offset,o=document.getElementById("search_form"),s=main_home.search(o,null,a,n);return s.then((function(e){t.result_container})),s},add_spinner:function(e){if(e){const t=common.create_dom_element({element_type:"img",class_name:"spinner_svg",src:page_globals.__WEB_ROOT_WEB__+"/tpl/assets/images/spinner.svg"});e.appendChild(t)}else console.warn("[add_spinner] Error on get target ",e);return!0},remove_spinner:function(e){const t=e.querySelector(".spinner_svg");return!!t&&(t.remove(),!0)},remote_image:function(e){if(e){let t="";return t=-1!==e.indexOf("v5/media_test")?e.replace(/\/v5\/media_test\/media_monedaiberica\//g,page_globals.__WEB_MEDIA_BASE_URL__+"/dedalo/media/"):e.replace(/\/dedalo\/media_test\/media_monedaiberica\//g,page_globals.__WEB_MEDIA_BASE_URL__+"/dedalo/media/"),t}return null},parse_legend_svg:function(e){if(-1!==e.indexOf("http"))return e;e=e.replace(/\/dedalo\/media\/svg\//g,page_globals.__WEB_MEDIA_BASE_URL__+"/dedalo/media/svg/");return page.remove_gaps(page.trim_char(e,"|")," | ")},parse_iri_data:function(e){const t=[];if(!e||e.length<1)return t;const r=e.split(" | ");for(let e=0;e<r.length;e++){const n=r[e].split(", ");if(n.length>1&&void 0===n[1])continue;const a=1===n.length?n[0]:n[1];let o=1===n.length?"":n[0];if(o.length<1)try{o=new URL(a).hostname}catch(e){console.error(e)}t.push({label:o,value:a})}return t},remove_gaps:function(e,t){return e.split(t).filter(Boolean).join(t)},trim_char:function(e,t){if(!e)return e;for(;e.charAt(0)==t;)e=e.substring(1);for(;e.charAt(e.length-1)==t;)e=e.substring(0,e.length-1);return e},split_data:function(e,t){return e?e.split(t):[]},is_empty:function(e){return e&&e.length>0},parse_date:function(e){if(!e||e.length<4)return null;const t=e.substring(0,4),r=e.substring(5,7),n=e.substring(8,10),a=[];n&&"00"!=n&&a.push(n),r&&"00"!=r&&a.push(r),t&&"00"!=t&&a.push(t);return a.join("-")},activate_images_gallery:function(e,t){if(!0===t){const e=document.querySelectorAll(".poptrox-overlay");if(e)for(let t=e.length-1;t>=0;t--)e[t].remove()}return $(e).poptrox({baseZIndex:2e4,fadeSpeed:1,overlayOpacity:.5,popupCloserText:"",popupHeight:150,popupWidth:150,popupLoaderText:"",popupSpeed:1,selector:"a.image_link",usePopupCaption:!1,usePopupCloser:!0,usePopupDefaultStyling:!1,usePopupForceClose:!0,usePopupLoader:!0,usePopupNav:!0,windowMargin:50})},map_popup_builder:function(e){const t=common.create_dom_element({element_type:"div",class_name:"popup_wrapper"}),r=e.group,n=new Intl.Collator("es",{sensitivity:"base",ignorePunctuation:!0});r.sort((e,t)=>n.compare(e.title,t.title));const a=function(e){const r=e.section_id,n=e.title||"Undefined title "+r,a=e.description,o=common.create_dom_element({element_type:"div",class_name:"popup_item",parent:t});common.create_dom_element({element_type:"div",class_name:"text_title",inner_html:n,parent:o});if(a&&a.length>3){common.create_dom_element({element_type:"div",class_name:"text_description",inner_html:a,parent:o})}},o=r.length;return function e(n,s){for(let e=n;e<s;e++)a(r[e]);if(s<o-1){const r=common.create_dom_element({element_type:"input",type:"button",value:tstring.load_more||"Load more..",class_name:"more_node btn btn-light btn-block primary",parent:t});r.addEventListener("click",(function(){const t=this.offset+1;e(t,t+100<o?t+100:o),this.remove()})),r.offset=s}}(0,100<o?100:o),t},parse_type_data:function(e){const t=this;if(Array.isArray(e)){const r=[];for(let n=0;n<e.length;n++)r.push(t.parse_type_data(e[n]));return r}const r=e;if(r.ref_coins_image_obverse=common.local_to_remote_path(e.ref_coins_image_obverse),r.ref_coins_image_reverse=common.local_to_remote_path(e.ref_coins_image_reverse),r.ref_coins_union)for(let e=0;e<r.ref_coins_union.length;e++)r.ref_coins_union[e].image_obverse&&(r.ref_coins_union[e].image_obverse=common.local_to_remote_path(r.ref_coins_union[e].image_obverse)),r.ref_coins_union[e].image_reverse&&(r.ref_coins_union[e].image_reverse=common.local_to_remote_path(r.ref_coins_union[e].image_reverse));return r.uri=t.parse_iri_data(r.uri),r.legend_obverse=r.legend_obverse?t.parse_legend_svg(r.legend_obverse):null,r.legend_reverse=r.legend_reverse?t.parse_legend_svg(r.legend_reverse):null,r.material=r.material?page.trim_char(page.remove_gaps(r.material," | "),"|"):null,r.symbol_obverse=r.symbol_obverse?page.trim_char(page.remove_gaps(r.symbol_obverse," | "),"|"):null,r.symbol_reverse=r.symbol_reverse?page.trim_char(page.remove_gaps(r.symbol_reverse," | "),"|"):null,r.symbol_obverse_data=JSON.parse(r.symbol_obverse_data),r.symbol_reverse_data=JSON.parse(r.symbol_reverse_data),r},parse_coin_data:function(e){const t=this;if(Array.isArray(e)){const r=[];for(let n=0;n<e.length;n++)r.push(t.parse_coin_data(e[n]));return r}const r=e;return r.image_obverse=common.local_to_remote_path(e.image_obverse),r.image_reverse=common.local_to_remote_path(e.image_reverse),r.type_data&&r.type_data.length>0&&(r.type_data=t.parse_type_data(r.type_data)),r.type=r.type?page.remove_gaps(r.type," | "):null,r.legend_obverse=r.legend_obverse?t.parse_legend_svg(r.legend_obverse):null,r.legend_reverse=r.legend_reverse?t.parse_legend_svg(r.legend_reverse):null,r.countermark_obverse=r.countermark_obverse?t.parse_legend_svg(r.countermark_obverse):null,r.countermark_reverse=r.countermark_reverse?t.parse_legend_svg(r.countermark_reverse):null,r.ref_auction_date=t.parse_date(r.ref_auction_date),r.find_date=t.parse_date(r.find_date),r.mib_uri=page_globals.__WEB_BASE_URL__+page_globals.__WEB_ROOT_WEB__+"/coin/"+r.section_id,r.uri=t.parse_iri_data(r.uri),r.bibliography=page.parse_publication(r.bibliography_data),r.mint=void 0!==r.type_data[0]?r.type_data[0].mint:null,r.type_number=void 0!==r.type_data[0]?r.type_data[0].number:null,r},parse_catalog_data:function(e){const t=this;Array.isArray(e)||(e=[e]);const r=[],n=e.length;for(let a=0;a<n;a++){const n=e[a];n.ref_coins_image_obverse=common.local_to_remote_path(n.ref_coins_image_obverse),n.ref_coins_image_reverse=common.local_to_remote_path(n.ref_coins_image_reverse),n.ref_coins_image_obverse_thumb=n.ref_coins_image_obverse?n.ref_coins_image_obverse.replace("/1.5MB/","/thumb/"):null,n.ref_coins_image_reverse_thumb=n.ref_coins_image_reverse?n.ref_coins_image_reverse.replace("/1.5MB/","/thumb/"):null,n.ref_type_legend_obverse=n.ref_type_legend_obverse?t.parse_legend_svg(n.ref_type_legend_obverse):null,n.ref_type_legend_reverse=n.ref_type_legend_reverse?t.parse_legend_svg(n.ref_type_legend_reverse):null,n.ref_type_symbol_obverse=n.ref_type_symbol_obverse?t.parse_legend_svg(n.ref_type_symbol_obverse):null,n.ref_type_symbol_reverse=n.ref_type_symbol_reverse?t.parse_legend_svg(n.ref_type_symbol_reverse):null,n.term_data=JSON.parse(n.term_data),n.term_section_id=n.term_data?n.term_data[0]:null,n.children=JSON.parse(n.children),n.parent=JSON.parse(n.parent),n.ref_type_averages_diameter=n.ref_type_averages_diameter?parseFloat(n.ref_type_averages_diameter.replace(",",".")):null,n.ref_type_total_diameter_items=n.ref_type_total_diameter_items?parseFloat(n.ref_type_total_diameter_items.replace(",",".")):null,n.ref_type_averages_weight=n.ref_type_averages_weight?parseFloat(n.ref_type_averages_weight.replace(",",".")):null,n.ref_type_total_weight_items=n.ref_type_total_weight_items?parseFloat(n.ref_type_total_weight_items.replace(",",".")):null,n.ref_type_material=n.ref_type_material?page.remove_gaps(page.trim_char(n.ref_type_material,"|")," | "):null,r.push(n)}for(let t=0;t<n;t++){const n=r[t];if("types"===n.term_table&&n.children){const t=[],r=[];for(let a=0;a<n.children.length;a++){const o=n.children[a],s=e.find(e=>e.section_id==o);if(s&&s.ref_type_averages_weight){const e=s.ref_type_total_weight_items,t=new Array(e).fill(s.ref_type_averages_weight);r.push(...t)}if(s&&s.ref_type_averages_diameter){const e=s.ref_type_total_diameter_items,r=new Array(e).fill(s.ref_type_averages_diameter);t.push(...r)}}const a=r.reduce((e,t)=>e+t,0)/r.length,o=t.reduce((e,t)=>e+t,0)/t.length;n.ref_type_averages_weight=a,n.ref_type_averages_diameter=o,n.ref_type_total_weight_items=r.length,n.ref_type_total_diameter_items=t.length}}return r},parse_publication:function(e){const t=[],r=e.length;for(let n=0;n<r;n++){const r=e[n];r._publications=[];const a=JSON.parse(r.publications_data),o=a.length;if(o>0){const e=page.split_data(r.ref_publications_authors," # "),n=page.split_data(r.ref_publications_date," # "),s=page.split_data(r.ref_publications_editor," # "),_=page.split_data(r.ref_publications_magazine," # "),i=page.split_data(r.ref_publications_place," # "),l=page.split_data(r.ref_publications_title," # "),c=page.split_data(r.ref_publications_url," # ");for(let p=0;p<o;p++){const o=a[p],m={reference:r.section_id,section_id:o,authors:e[p]||null,date:n[p]||null,editor:s[p]||null,magazine:_[p]||null,place:i[p]||null,title:l[p]||null,url:c[p]||null};r._publications.push(m),t.push(m)}}}return t}};!function(){const e=function(){};e.prototype.request=async function(e){console.log("++++ request options:",e);const t=e.url||page_globals.JSON_TRIGGER_URL,r=e.method||"POST",n=e.mode||"cors",a=e.cache||"no-cache",o=e.credentials||"same-origin",s=e.headers||{"Content-Type":"application/json"},_=e.redirect||"follow",i=e.referrer||"no-referrer",l=e.body;return l.code||(l.code=page_globals.API_WEB_USER_CODE),l.lang||(l.lang=page_globals.WEB_CURRENT_LANG_CODE),fetch(t,{method:r,mode:n,cache:a,credentials:o,headers:s,redirect:_,referrer:i,body:JSON.stringify(l)}).then((function(e){if(!e.ok)throw console.warn("-> handle_errors response:",e),Error(e.statusText);return e})).then(e=>e.json().then(e=>e)).catch(e=>(console.error("!!!!! [page data_manager.request] ERROR:",e),{result:!1,msg:e.message,error:e}))},window.data_manager=new e,window.event_manager=new function(){this.events=[],this.last_token=-1,this.subscribe=function(e,t){const r="event_"+String(++this.last_token),n={event_name:e,token:r,callback:t};return this.events.push(n),r},this.unsubscribe=function(e){return this.events.map((t,r,n)=>{t.token===e&&n.splice(r,1)})},this.publish=function(e,t={}){const r=this.events.filter(t=>t.event_name===e);return!!r&&r.map(e=>e.callback(t))},this.get_events=function(){return this.events},this.fire_event=function(e,t){var r;if(e.ownerDocument)r=e.ownerDocument;else{if(9!=e.nodeType)throw new Error("Invalid node passed to fireEvent: "+e.id);r=e}if(e.dispatchEvent){var n="";switch(t){case"click":case"mousedown":case"mouseup":n="MouseEvents";break;case"focus":case"change":case"blur":case"select":n="HTMLEvents";break;default:throw"fireEvent: Couldn't find an event class for event '"+t+"'."}var a="change"!=t;(o=r.createEvent(n)).initEvent(t,a,!0),o.synthetic=!0,e.dispatchEvent(o,!0)}else if(e.fireEvent){var o;(o=r.createEventObject()).synthetic=!0,e.fireEvent("on"+t,o)}},this.when_in_dom=function(e,t){const r=new MutationObserver((function(n){document.contains(e)&&(r.disconnect(),t(this))}));return r.observe(document,{attributes:!1,childList:!0,characterData:!1,subtree:!0}),r}},setTimeout((function(){console.log("Activated app_utils !"),console.log("Avilable data_manager:",data_manager),console.log("Avilable event_manager:",event_manager)}),10)}();