var web_ts_term=new function(){this.url_trigger=page_globals.__WEB_TEMPLATE_WEB__+"/lib/web_ts_term/trigger.web_ts_term.php",this.ar_childrens_loaded={},this.ar_index_loaded={},$(document).ready(function(){var e=JSON.parse(localStorage.getItem("ar_loaded_web_ts_term"));for(var t in"undefined"!=typeof web_ts_term_to_open&&(e=web_ts_term_to_open),e)if("loaded"==e[t]){var r=document.querySelector('div.icon_show_childrens[data-term_id="'+t+'"]');r&&web_ts_term.toggle_childrens(r,!1)}web_ts_term.highlight_terms()}),this.toggle_childrens=function(e,t){var r=void 0!==window.tree_mode&&window.tree_mode,o=e.dataset.term_id,a={mode:"toggle_childrens",term_id:e.dataset.term_id,ar_childrens:JSON.parse(e.dataset.ar_childrens),tree_mode:r};!1!==t&&(t=!0),e.classList.toggle("arrow_dow");var d=document.getElementById("childrens_wrapper_"+o);return d?"none"==d.style.display&&"closed"==web_ts_term.ar_childrens_loaded[o]?(d.style.display="block",web_ts_term.ar_childrens_loaded[o]="loaded",localStorage.setItem("ar_loaded_web_ts_term",JSON.stringify(web_ts_term.ar_childrens_loaded)),!1):"block"===d.style.display?(d.style.display="none",web_ts_term.ar_childrens_loaded[o]="closed",localStorage.setItem("ar_loaded_web_ts_term",JSON.stringify(web_ts_term.ar_childrens_loaded)),!1):(d.classList.add("loading"),d.style.display="block",void $.ajax({url:this.url_trigger,data:a,type:"POST",async:t}).done(function(e){/Error/.test(e)?(d.innerHTML="[toggle_childrens] Request failed: \n"+e,!0===SHOW_DEBUG&&console.log(e)):(d.innerHTML=e,web_ts_term.ar_childrens_loaded[o]="loaded",localStorage.setItem("ar_loaded_web_ts_term",JSON.stringify(web_ts_term.ar_childrens_loaded)),tpl_common.activate_tooltips())}).fail(function(e,t){console.log("Error: "+e.statusText+" ("+t+")"),d.innerHTML="Sorry. Failed load"}).always(function(){d.classList.remove("loading")})):alert("Error")},this.highlight_terms=function(){var e=window.ar_highlight?JSON.parse(window.ar_highlight):[],t=e.length;if(t>0)for(var r=t-1;r>=0;r--){var o=e[r];document.getElementById("web_ts_term_"+o)&&document.getElementById("web_ts_term_"+o).classList.add("highlight_term"),document.getElementById("button_toggle_indexation_"+o)&&web_ts_term.toggle_indexation(document.getElementById("button_toggle_indexation_"+o))}},this.toggle_indexation=function(e){const t=e.dataset.term,r=e.dataset.term_id,o=JSON.parse(e.dataset.ar_indexation);var a={mode:"toggle_indexation",term_id:r,term:t,ar_indexation:o},d=document.getElementById("index_wrapper_"+r);return"table"==d.style.display?(d.style.display="none",!1):web_ts_term.ar_index_loaded[r]?(d.style.display="table",!1):(d.classList.add("loading"),d.style.display="table",void $.ajax({url:this.url_trigger,data:a,type:"POST"}).done(function(e){const o=JSON.parse(e);for(;d.hasChildNodes();)d.removeChild(d.lastChild);const a=o.result,_=a.length,l=[];for(var i=0;i<_;i++){const e=a[i],o=e.node_id;if(-1!==l.indexOf(o))continue;const _=e.node_id,s=e.group_locators,n=0,c=e.group_locators.length,m=e.image_url,g=ui.thematic.build_indexation_item({node_id:_,term_id:r,term:t,locator_json:s,locator_key:n,total_locators:c,image_url:m});d.appendChild(g),l.push(o)}tpl_common.activate_tooltips()}).fail(function(e,t){console.log("Error: "+e.statusText+" ("+t+")"),d.innerHTML="Sorry. Failed load"}).always(function(){d.classList.remove("loading")}))},this.reset_tree=function(){localStorage.removeItem("ar_loaded_web_ts_term")}};