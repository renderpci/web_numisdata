{"version":3,"names":["COLOR_PALETTE","chart_wrapper","div_wrapper","options","this","constructor","Error","_n_charts_created","id","_display_download","display_download","_download_chart_container","undefined","plot_container","_display_control_panel","display_control_panel","controls_container","d3_chart_wrapper","call","svg","toggle_visibility","element","attr","transition","linspace","start","stop","nsteps","delta","d3","range","map","i","prototype","id_string","render","replaceChildren","_render_download_panel","render_plot","render_control_panel","supported_formats","get_supported_export_formats","length","download_chart_container","common","create_dom_element","element_type","class_name","style","display","parent","format_select","width","format","value","text_content","toUpperCase","addEventListener","self","download_chart","filename","download_func_name","Object","setPrototypeOf","select","append","download_chart_as_svg","svg_data","node","outerHTML","svg_blob","Blob","type","url","URL","createObjectURL","tmpLink","href","setAttribute","click","remove","revokeObjectURL","CURVES","Basis","curveBasis","curveBasisClosed","curveBasisOpen","Bundle","curveBundle","curveBumpX","curveBumpY","Cardinal","curveCardinal","curveCardinalClosed","curveCardinalOpen","curveCatmullRom","curveCatmullRomClosed","curveCatmullRomOpen","Linear","curveLinear","curveLinearClosed","curveMonotoneX","curveMonotoneY","Natural","curveNatural","Step","curveStep","curveStepAfter","curveStepBefore","compute_n_bins","boxvio_chart_wrapper","data","obj","_overflow","overflow","_data","_sort_xaxis","sort_xaxis","_group_names","keys","sort","_colors","name","_ylabel","ylabel","yaxis_padding","_metrics","fromEntries","entries","values","calc_metrics","_outliers","filter","v","lower_fence","upper_fence","_data_extents","extent","_data_extent","flat","_full_width","Math","sqrt","_full_height","_chart","margin","top","right","bottom","left","height","yscale","scaleLinear","domain","clamp","yaxis","axisLeft","tickFormat","violin_scale_default","violin_scale","box_scale_default","box_scale","xscale","scaleBand","xaxis","axisBottom","xticklabel_angle","n_bins_default","sturges","n_bins","JSON","parse","stringify","histogram","bin","thresholds","bins","supported_curves","violin_curve","_graphics","root_g","xaxis_g","yaxis_g","violins_g","violins","boxes_g","outliers","_controls","max_bins_multiplier","metrics","max","quartile3","median","mean","iqr","quartile1","min","quantile","chartjs_chart_wrapper","canvas","chart","histogram_wrapper","_density","_n_bins_default","_n_bins","_xlabel","xlabel","_n_decimals","_max_bins_multiplier","_bar_color","ceil","log2","rice","pow","doane","n","sigma","std","deviation","sum","skew","abs","scott","freedman_diaconis","set_violin_scale","scale","selectAll","_render_violins","set_n_bins","_render_violin","set_violin_curve","curve_name","set_box_scale","_render_boxes","_render_axis","g","_apply_xticklabel_angle","text","angle","is_g_ready","bandwidth","max_count","x_num","datum","area","x0","d","x1","y","curve","boxes","box_width","color","group_box","outlier","whiskers","_render_violin_curve_selector","_render_checkboxes","_render_scale_sliders","_render_n_bins_control","curve_select_id","curve_select","show_violins_checkbox_id","show_violins_checkbox","checked","show_boxes_checkbox_id","show_boxes_checkbox","show_outliers_checkbox_id","show_outliers_checkbox","group","violin_scale_slider","Number","box_scale_slider","group_select_id","group_select","violin_n_bins_slider","download_chart_as_png","toBase64Image","_tweak_c2s","offsetWidth","offsetHeight","animation","reponsive","svgContext","C2S","Chart","config","_config","encodeURIComponent","getSerializedSvg","getContext","contextId","__canvas","getAttribute","listener","eventListenerOptions","get_density","set_density","density","bin_centers","plot_data","half_bin_width","data_min","data_max","_get_plotting_data","datasets","label","_get_density_string","scales","title","update","get_n_bins","x","ticks","stepSize","plugins","tooltip","callbacks","_get_tooltip_title_callback","get_bar_color","set_bar_color","bar_color","backgroundColor","bin_width","Array","apply","index","j","reduce","partialSum","val","n_decimals","items","dataIndex","toFixed","chart_data","categoryPercentage","barPercentage","scales_options","offset","grid","callback","labels","Boolean","font","size","plugins_options","legend","parsing","normalized","slider","density_checkbox_id","density_checkbox","color_picker_container","window","iro","ColorPicker","layoutDirection","layout","component","ui","Wheel","Slider","sliderType","on","rgbaString","analysis","form","area_name","row","export_data_container","form_items_container","diameter_chart_container","weight_chart_container","diameter_chart_wrapper","weight_chart_wrapper","set_up","form_node","render_form","appendChild","fragment","DocumentFragment","form_factory","form_row","item_factory","tstring","mint","q_column","value_wrapper","eq","eq_in","eq_out","is_term","form_item","activate_autocomplete","table","q_table","number_key","group_op","material","denomination","submit_group","search","e","preventDefault","form_submit","reset","location","replace","pathname","operators_node","build_operators_node","form_obj","scroll_result","form_items","build_filter","scrollIntoView","behavior","block","inline","search_rows","limit","process_result","fn","columns","then","parsed_data","event_manager","publish","console","log","ele","ref_type_number","tmpData","calculable","full_coins_reference_calculable","diameter_max","full_coins_reference_diameter_max","diameter_min","full_coins_reference_diameter_min","weight","full_coins_reference_weight","weights","props","diameters","ar_fields","order","lang","page_globals","WEB_CURRENT_LANG_CODE","Promise","resolve","sql_filter","parse_sql_filter","request_body","dedalo_get","join","count","data_manager","request","body","response","page","parse_catalog_data","result"],"sources":["../../lib/charts/chart-wrapper.js","../../lib/charts/d3/d3-chart-wrapper.js","../../lib/charts/d3/utils.js","../../lib/charts/compute-n-bins.js","../../lib/charts/d3/boxvio-chart-wrapper.js","../../lib/charts/utils.js","../../lib/charts/chartjs/chartjs-chart-wrapper.js","../../lib/charts/chartjs/histogram-wrapper.js","analysis.js"],"sourcesContent":["\"use strict\";\n\n/**\n * Width (in pixels) of color picker\n * @type {number}\n */\nexport const COLOR_PICKER_WIDTH = 200\n\n/**\n * Default name for the chart -> when exporting,\n * `<name>.<format>`\n * @type {string}\n */\nconst DEFAULT_CHART_NAME = 'chart'\n\n/**\n * Color palette, totally stolen from matplotlib\n * @type {string[]}\n */\nexport const COLOR_PALETTE = ['#1f77b4', '#ff7f0e', '#2ca02c', '#d62728', '#9467bd', '#8c564b', '#e377c2', '#17becf']\n\n\n/**\n * Chart wrapper class (download panel, plot, and control panel)\n * \n * The `render` method must be called for the chart to be rendered to the DOM!!!\n * \n * Within the provided div wrapper, it will create three divs:\n * 1. If download is supported, a div to containing the download section, with\n *    id `chart<id>_download_chart_container` class `download_chart_container`\n * 2. A div to contain the plot itself, with id `chart<id>_plot_wrapper` class `plot_wrapper` \n * 3. A div to contain the control panel, with id `chart<id>_control_panel` and class `control_panel`\n * \n * It clears the container div during render, so subclasses should work with the dom\n * after the render methods of this superclass (`render_plot` and `render_control_panel`) have been called.\n * In other words, subclasses should override those specific methods instead of the general `render` function\n * \n * Last reminder, the constructor is the place to do data processing exclusively. All rendering to the DOM\n * must be done in the specific render methods. Otherwise, bugs WILL appear.\n * @class\n * @abstract\n * @param {Element} div_wrapper\n * @param {Object} options configuration options\n * @param {boolean} options.display_download whether to display the download panel (default `false`)\n * @param {boolean} options.display_control_panel whether to display the control panel (default `false`)\n */\nexport function chart_wrapper(div_wrapper, options) {\n    if (this.constructor === chart_wrapper) {\n        throw new Error(\"Abstract class 'chart_wrapper' cannot be instantiated\")\n    }\n    chart_wrapper._n_charts_created++;\n    /**\n     * Unique identifier for the chart.\n     * \n     * Subclasses MUST use this in order to assing IDs\n     * to DOM elements, in order to avoid bugs and cross-chart events\n     * @type {number}\n     * @protected\n     */\n    this.id = chart_wrapper._n_charts_created\n    /**\n     * Div element wrapping the chart itself and\n     * the controls\n     * @type {Element}\n     * @protected\n     */\n    this.div_wrapper = div_wrapper\n    /**\n     * Whether to display the download panel\n     * @type {boolean}\n     * @private\n     */\n    this._display_download = options.display_download || false\n    /**\n     * Div container for chart download\n     * @type {Element}\n     * @private\n     */\n    this._download_chart_container = undefined\n    /**\n     * Div inside the div_wrapper, that just wraps the drawing\n     * @type {Element}\n     * @protected\n     */\n    this.plot_container = undefined\n    /**\n     * Whether to display the control panel\n     * @type {boolean}\n     * @private\n     */\n     this._display_control_panel = options.display_control_panel || false\n    /**\n     * Div container for user controls\n     * Used freely by each subclass\n     * @type {Element}\n     * @protected\n     */\n    this.controls_container = undefined\n}\n\n/**\n * Amount of created charts\n * @type {number}\n * @static\n * @private\n */\nchart_wrapper._n_charts_created = 0;\n\n/**\n * Get a string representing the ID of the chart\n * @returns {string} the id as a string\n *          (`'chart1'`, `'chart2'`, ...)\n */\nchart_wrapper.prototype.id_string = function () {\n    return `chart${this.id}`\n}\n\n/**\n * Render the chart\n * \n * Empties the div wrapper and resets properties\n * \n * Subclasses must call this method at the top\n * of their own implementation\n * @name chart_wrapper#render\n * @function\n * @public\n */\nchart_wrapper.prototype.render = function () {\n    // Save this chart_wrapper intance\n    /**\n     * This chart_wrapper intance\n     * @type {chart_wrapper}\n     */\n    const self = this\n    // Remove all children in the div_wrapper\n    this.div_wrapper.replaceChildren()\n\n    // Create the chart download section\n    if (this._display_download) {\n        this._render_download_panel()\n    }\n\n    // Create the div for wrapping the plot\n    this.render_plot()\n\n    // Create the div for the control panel\n    if (this._display_control_panel) {\n        this.render_control_panel()\n    }\n\n}\n\n/**\n * Render the download panel to the DOM\n * @function\n * @private\n * @name chart_wrapper#_render_download_panel\n */\nchart_wrapper.prototype._render_download_panel = function () {\n    const supported_formats = this.get_supported_export_formats()\n    if (supported_formats.length) {\n        this.download_chart_container = common.create_dom_element({\n            element_type: 'div',\n            id: `${this.id_string()}_download_chart_container`,\n            class_name: 'o-purple download_chart_container',\n            style: {\n                'display': 'flex',\n                'flex-direction': 'row',\n                'justify-content': 'center',\n            },\n            parent: this.div_wrapper,\n        })\n        const format_select = common.create_dom_element({\n            element_type: 'select',\n            id: `${this.id_string()}_chart_export_format`,\n            style: {\n                'width': '80%',\n            },\n            parent: this.download_chart_container,\n            // TODO: add ARIA attributes?\n        })\n        for (const format of supported_formats) {\n            common.create_dom_element({\n                element_type: 'option',\n                value: format,\n                text_content: format.toUpperCase(),\n                parent: format_select,\n            })\n        }\n        const chart_download_button = common.create_dom_element({\n            element_type: 'button',\n            text_content: 'Download',\n            style: {\n                'width': '20%',\n            },\n            parent: this.download_chart_container,\n        })\n        chart_download_button.addEventListener('click', () => {\n            self.download_chart(format_select.value)\n        })\n    }\n}\n\n/**\n * Render the plot to the DOM\n * \n * Subclasses should override this method and make\n * use of the plot container\n * @function\n * @protected\n * @name chart_wrapper#render_plot\n */\nchart_wrapper.prototype.render_plot = function () {\n    this.plot_container = common.create_dom_element({\n        element_type: 'div',\n        id: `${this.id_string()}_plot_wrapper`,\n        class_name: 'o-purple plot_wrapper',\n        parent: this.div_wrapper,\n    })\n}\n\n/**\n * Render the control panel to the DOM\n * \n * Subclasses should override this method and make\n * use of the controls container\n * @function\n * @protected\n * @name chart_wrapper#render_control_panel\n */\nchart_wrapper.prototype.render_control_panel = function () {\n    this.controls_container = common.create_dom_element({\n        element_type: 'div',\n        id: `${this.id_string()}_control_panel`,\n        class_name: 'o-green control_panel',\n        parent: this.div_wrapper,\n    })\n}\n\n/**\n * Download the chart as an image\n * \n * For each supported format in the subclass,\n * @see chart_wrapper#get_supported_export_formats\n * the subclass must implement a method called\n * `download_chart_as_<format>`\n * @param {string} format the image format\n * @function\n * @abstract\n * @name chart_wrapper#download_chart\n */\nchart_wrapper.prototype.download_chart = function (format) {\n    /**\n     * File name for the chart\n     * @type {string}\n     */\n    const filename = `${DEFAULT_CHART_NAME}.${format}`\n    /**\n     * Function name for downloading with the particular format\n     * @type {string}\n     */\n    const download_func_name = `download_chart_as_${format}`\n    if (this[download_func_name] === undefined) {\n        throw new Error(`${download_func_name} is not implemented!`)\n    }\n    this[download_func_name](filename)\n}\n\n/**\n * Get the supported chart export formats\n * \n * Subclasses must return their own supported formats, if any, e.g.,\n * `['png', 'jpg', 'eps']`. If no format is supported, there is no\n * need to override this method.\n * @function\n * @returns {string[]} the supported formats\n * @name chart_wrapper#get_supported_export_formats\n */\nchart_wrapper.prototype.get_supported_export_formats = function () {\n    return []\n}","\"use strict\";\n\nimport { chart_wrapper } from \"../chart-wrapper\";\n\n/**\n * D3 chart wrapper class\n * \n * Appends an `svg` tag to the provided div.\n * \n * Subclasses MUST specify the viewBox of the svg, so that it responds to window resizing\n * The created svg tag has width=100%, spanning the width of the parent element. Subclasses\n * can alter this behavior by modifying the svg after the superclass `render_plot` method has been\n * called\n * @param {Element} div_wrapper the div containing the chart\n * @param {Object} options configuration options\n * @param {boolean} options.display_download whether to display the download panel (default `true`)\n * @param {boolean} options.display_control_panel whether to display the control panel (default `true`)\n * @class\n * @abstract\n * @extends chart_wrapper\n */\nexport function d3_chart_wrapper(div_wrapper, options) {\n    if (this.constructor === d3_chart_wrapper) {\n        throw new Error(\"Abstract class 'd3_chart_wrapper' cannot be instantiated\")\n    }\n    chart_wrapper.call(this, div_wrapper, options)\n    /**\n     * D3 selection object for the root `svg` tag\n     * @protected\n     */\n    this.svg = undefined\n\n}\n// Set prototype chain\nObject.setPrototypeOf(d3_chart_wrapper.prototype, chart_wrapper.prototype)\n\n/**\n * Render the plot to the DOM\n * \n * Subclasses must call this method at the top\n * of their own implementation. Then, they can\n * make use of the svg d3.selection object\n * @function\n * @protected\n * @name chart_wrapper#render_plot\n */\nd3_chart_wrapper.prototype.render_plot = function () {\n    chart_wrapper.prototype.render_plot.call(this)\n\n    this.svg = d3.select(this.plot_container)\n        .append('svg')\n        // When drawing SVG to canvas with an `Image`, if we don't add version and xmlns the `Image` will never load :(\n        .attr('version', '1.1')\n        .attr('xmlns', 'http://www.w3.org/2000/svg')\n        .attr('width', '100%')\n}\n\n/**\n * Get the supported chart export formats\n * @function\n * @returns {string[]} the supported formats\n * @name d3_chart_wrapper#get_supported_export_formats\n */\nd3_chart_wrapper.prototype.get_supported_export_formats = function () {\n    return ['svg']\n}\n\n/**\n * Download the chart as svg\n * @param {string} filename the name of the file\n * @function\n * @name d3_chart_wrapper#_download_chart_as_svg\n */\nd3_chart_wrapper.prototype.download_chart_as_svg = function (filename) {\n    const svg_data = this.svg.node().outerHTML\n    const svg_blob = new Blob([svg_data], { type: \"image/svg+xml;charset=utf-8\" })\n    const url = URL.createObjectURL(svg_blob)\n    /**\n     * Temporary link\n     * @type {Element}\n     */\n    const tmpLink = common.create_dom_element({\n        element_type: 'a',\n        href: url,\n    })\n    tmpLink.setAttribute('download', filename)\n    tmpLink.click()\n    tmpLink.remove()\n    URL.revokeObjectURL(url)\n}","/**\n * Toggle visibility of a d3 selection element\n * @param {d3.selection} element the elememt\n */\nexport function toggle_visibility(element) {\n    if (element.attr('opacity') == 0) {\n        element.transition().attr('opacity', 1)\n    } else {\n        element.transition().attr('opacity', 0)\n    }\n}\n\n/**\n * Get an array of values, evenly spaced over an\n * interval\n * \n * https://gist.github.com/davebiagioni/1ac21feb1c2db04be4e6\n * @param {number} start start value\n * @param {number} stop stop value\n * @param {number} nsteps amount of spets\n * @returns {number[]} the values\n */\nexport function linspace(start, stop, nsteps){\n    const delta = (stop-start)/(nsteps-1)\n    return d3.range(nsteps).map((i) => start+i*delta)\n}\n\n/**\n * Map from name to d3 curve\n * https://github.com/d3/d3/blob/main/API.md#curves\n * @type {Object.<string, d3.curve>}\n */\nexport const CURVES = {\n    // cubic basis spline, repeating the end points\n    'Basis': d3.curveBasis,\n    // a closed cubic basis spline\n    'Basis closed': d3.curveBasisClosed,\n    // a cubic basis spline\n    'Basis open': d3.curveBasisOpen,\n    // a straightened cubic basis spline (works only with d3.line, not d3.area!)\n    'Bundle': d3.curveBundle,\n    // a cubic Bézier spline with horizontal tangents\n    'Bump X': d3.curveBumpX,\n    // a cubic Bézier spline with vertical tangents\n    'Bump Y': d3.curveBumpY,\n    // a cubic cardinal spline, with one-sided difference at each end\n    'Cardinal': d3.curveCardinal,\n    // a closed cubic cardinal spline\n    'Cardinal closed': d3.curveCardinalClosed,\n    // a cubic cardinal spline\n    'Cardinal open': d3.curveCardinalOpen,\n    // a cubic Catmull–Rom spline, with one-sided difference at each end\n    'Catmull-Rom': d3.curveCatmullRom,\n    // a closed cubic Catmull–Rom spline\n    'Catmull-Rom closed': d3.curveCatmullRomClosed,\n    // a cubic Catmull–Rom spline\n    'Catmull-Rom open': d3.curveCatmullRomOpen,\n    // a polyline\n    'Linear': d3.curveLinear,\n    // a closed polyline.\n    'Linear closed': d3.curveLinearClosed,\n    // a cubic spline that, given monotonicity in x, preserves it in y\n    'Monotone X': d3.curveMonotoneX,\n    // a cubic spline that, given monotonicity in y, preserves it in x\n    'Monotone Y': d3.curveMonotoneY,\n    // a natural cubic spline\n    'Natural': d3.curveNatural,\n    // a piecewise constant function\n    'Step': d3.curveStep,\n    // a piecewise constant function\n    'Step after': d3.curveStepAfter,\n    // a piecewise constant function\n    'Step before': d3.curveStepBefore,\n}\n","/**\n * Implements methods for computing the number of\n * bins based on the data values\n * \n * Each method takes an array of data values as input\n * and outputs the number of bins\n * @class\n */\nexport function compute_n_bins() {}\n\n/**\n * Compute number of bins with the square root rule\n * @param {number[]} values the datapoints\n * @returns {number} the number of bins \n */\ncompute_n_bins.sqrt = function (values) {\n\treturn Math.ceil(Math.sqrt(values.length))\n}\n\n/**\n * Compute number of bins with the Sturges rule\n * @param {number[]} values the datapoints\n * @returns {number} the number of bins \n */\ncompute_n_bins.sturges = function (values) {\n\treturn Math.ceil(Math.log2(values.length)) + 1\n}\n\n/**\n * Compute number of bins with the Rice rule\n * @param {number[]} values the datapoints\n * @returns {number} the number of bins \n */\ncompute_n_bins.rice = function (values) {\n\treturn Math.ceil(2*Math.pow(values.length, 1/3))\n}\n\n/**\n * Compute number of bins with Doane's formula\n * \n * @param {number[]} values the datapoints\n * @returns {number} the number of bins \n */\ncompute_n_bins.doane = function (values) {\n\tconst n = values.length\n\tif (n < 2) {\n\t\tthrow new Error(\"Doane's rule needs at least 2 datapoints\")\n\t}\n\tconst sigma = Math.sqrt(6*(n-2)/((n+1)*(n+3)))\n\tconst std = d3.deviation(values)\n\tconst mean = d3.mean(values)\n\tconst sum = d3.sum(values)\n\t// The adjusted Fisher-Pearson skewness coefficient\n\t// https://www.itl.nist.gov/div898/software/dataplot/refman2/auxillar/skewness.htm\n\tconst skew = (Math.sqrt(n*(n+1))/(n-2))*((sum-n*mean)/(n*Math.pow(std, 3)))\n\treturn 1 + Math.ceil(Math.log2(n)) + Math.ceil(Math.log2(1+Math.abs(skew)/sigma))\n}\n\n/**\n * Compute number of bins with Scott's normal\n * reference rule\n * @param {number[]} values the datapoints\n * @returns {number} the number of bins \n */\ncompute_n_bins.scott = function (values) {\n\tif (values.length < 2) {\n\t\tthrow new Error(\n\t\t\t\"Cannot compute standard deviation of an array with less than 2 values\"\n\t\t)\n\t}\n\treturn Math.ceil(\n\t\t(d3.max(values)-d3.min(values))*Math.pow(values.length, 1/3)/(3.49*d3.deviation(values))\n\t)\n}\n\n/**\n * Compute number of bins with Freedman-Diaconis' choice\n * @param {number[]} values the datapoints\n * @returns {number} the number of bins \n */\ncompute_n_bins.freedman_diaconis = function (values) {\n\tconst quartile3 = d3.quantile(values, 0.75)\n\tconst quartile1 = d3.quantile(values, 0.25)\n\tconst iqr =  quartile3 - quartile1\n\tif (quartile1 === quartile3) {\n\t\tthrow new Error(\"IQR is 0!\")\n\t}\n\treturn Math.ceil(\n\t\t(d3.max(values)-d3.min(values))*Math.pow(values.length, 1/3)/(2*iqr)\n\t)\n}\n","\"use strict\";\n\nimport { d3_chart_wrapper } from \"./d3-chart-wrapper\";\nimport { COLOR_PALETTE } from \"../chart-wrapper\";\nimport { toggle_visibility, linspace, CURVES } from \"./utils\";\nimport { compute_n_bins } from \"../compute-n-bins\";\nimport { deepcopy } from \"../utils\"\n\n\n/**\n * Boxplot + violin chart wrapper\n * \n * Inspired in http://bl.ocks.org/asielen/d15a4f16fa618273e10f,\n * https://d3-graph-gallery.com/graph/violin_basicHist.html,\n * https://d3-graph-gallery.com/graph/boxplot_show_individual_points.html\n * \n * @param {Element} div_wrapper the div to work in\n * @param {{[group_name: string]: number[]}} data the input data: group name\n *        and array of values\n * @param {Object} options configuration options\n * @param {boolean} options.display_download whether to display the download panel (default `false`)\n * @param {boolean} options.display_control_panel whether to display the control panel (default `false`)\n * @param {boolean} options.sort_xaxis whether to sort the xaxis (default `false`)\n * @param {string} options.ylabel the y-label (default `null`)\n * @param {boolean} options.overflow whether to go beyond the width of the plot container (default `false`)\n * @param {number} options.xticklabel_angle the angle (in degrees) for the xtick labels (default `0`)\n * @class\n * @extends d3_chart_wrapper\n */\nexport function boxvio_chart_wrapper(div_wrapper, data, options) {\n    d3_chart_wrapper.call(this, div_wrapper, options)\n    /**\n     * Whether to go beyond the width of the plot container\n     * @type {boolean}\n     */\n    this._overflow = options.overflow || false\n    /**\n     * Data: group name to array of values\n     * @type {Object.<string, number[]>}\n     * @private\n     */\n    this._data = data\n    /**\n     * Whether to sort the xaxis\n     * @type {boolean}\n     * @private\n     */\n    this._sort_xaxis = options.sort_xaxis || false\n    /**\n     * Group names\n     * @type {string[]}\n     * @private\n     */\n    this._group_names = this._sort_xaxis ? Object.keys(this._data).sort() : Object.keys(this._data)\n    /**\n     * Colors\n     * @type {string[]}\n     * @private\n     */\n    this._colors = this._group_names.map((name, i) => COLOR_PALETTE[i % COLOR_PALETTE.length])\n    /**\n     * The label for the y axis\n     * @type {string}\n     * @private\n     */\n    this._ylabel = options.ylabel || null\n    /**\n     * Padding for the y axis, to account for the label and ticks\n     * @type {number}\n     */\n    this.yaxis_padding = this._ylabel ? 62 : 35;\n    /**\n     * Boxplot metrics for each group name\n     * @type {{[group_name: string]: {\n     *  max: number,\n     *  upper_fence: number,\n     *  quartile3: number,\n     *  median: number,\n     *  mean: number,\n     *  iqr: number,\n     *  quartile1: number,\n     *  lower_fence: number,\n     *  min: number,\n     * }}}\n     * @private\n     */\n    this._metrics = Object.fromEntries(Object.entries(data).map(\n        ([name, values]) => [name, calc_metrics(values)]\n    ))\n    /**\n     * Outliers per group name\n     * @type {{[group_name: string]: number[]}}\n     * @private\n     */\n    this._outliers = Object.fromEntries(Object.entries(data).map(\n        ([name, values]) => [\n            name,\n            values.filter(\n                (v) => v < this._metrics[name].lower_fence || v > this._metrics[name].upper_fence\n            )\n        ]\n    ))\n    /**\n     * Maximum and minimum values of each group\n     * @type {Object.<string, [number, number]>}\n     */\n    this._data_extents = Object.fromEntries(Object.entries(data).map(\n        ([name, values]) => [name, d3.extent(values)]\n    ))\n    /**\n     * Maximum and minimum of the input data\n     * @type {[number, number]}\n     */\n    this._data_extent = d3.extent(Object.values(this._data_extents).flat())\n    /**\n     * Full width of svg\n     * @type {number}\n     */\n    this._full_width = 330.664701211*Math.sqrt(Object.keys(data).length) + -170.664701211 + this.yaxis_padding\n    /**\n     * Full height of svg\n     * @type {number}\n     */\n    this._full_height = 423\n    /**\n     * Non-graphic components of the chart: setting, scales, etc.\n     * @private\n     */\n    this._chart = {}\n    this._chart.margin = { top: 15, right: 4, bottom: 31, left: this.yaxis_padding }\n    this._chart.width = this._full_width - this._chart.margin.left - this._chart.margin.right\n    this._chart.height = this._full_height - this._chart.margin.top - this._chart.margin.bottom\n    this._chart.yscale = d3.scaleLinear()\n        .range([this._chart.height, 0])\n        .domain(this._data_extent)\n        .clamp(true)  // when input outside of domain, its output is clamped to range\n    this._chart.yaxis = d3.axisLeft(this._chart.yscale)\n    this._chart.yaxis.tickFormat(d3.format(\".1f\"))  // format y axis with 1 decimal\n    this._chart.violin_scale_default = 0.8\n    this._chart.violin_scale = this._chart.violin_scale_default\n    this._chart.box_scale_default = 0.3\n    this._chart.box_scale = this._chart.box_scale_default\n    this._chart.xscale = d3.scaleBand()\n        .domain(this._group_names)\n        .range([0, this._chart.width])\n        // .padding(1-this._chart.violin_scale)     // This is important: it is the space between 2 groups. 0 means no padding. 1 is the maximum.\n    this._chart.xaxis = d3.axisBottom(this._chart.xscale)\n    this._chart.xticklabel_angle = options.xticklabel_angle || 0\n    this._chart.n_bins_default = Object.fromEntries(Object.entries(data).map(\n        ([name, values]) => [name, compute_n_bins.sturges(values)]\n    ))\n    this._chart.n_bins = deepcopy(this._chart.n_bins_default)\n    this._chart.histogram = Object.fromEntries(Object.entries(this._data_extents).map(\n        ([name, extent]) => {\n            return [\n                name,\n                d3.bin().domain(extent).thresholds(\n                    linspace(extent[0], extent[1], this._chart.n_bins[name])\n                )\n            ]\n        }\n    ))\n    this._chart.bins = Object.fromEntries(Object.entries(data).map(\n        ([name, values]) => [name, this._chart.histogram[name](values)]\n    ))\n    this._chart.supported_curves = [\n        'Basis', 'Bump Y', 'Cardinal', 'Catmull-Rom', 'Linear',\n        'Monotone Y', 'Natural', 'Step'\n    ]\n    this._chart.violin_curve = CURVES[this._chart.supported_curves[0]]\n    /**\n     * Graphic components of the chart: d3 selection objects\n     * @private\n     * @type {{[name: string]: d3.selection | {[group: string]: d3.selection}}}\n     */\n    this._graphics = {\n        // Root g tag (translated to account for the margins)\n        root_g: null,\n        // g tag for the x-axis\n        xaxis_g: null,\n        // g tag for the y-axis\n        yaxis_g: null,\n        // g tag grouping all violins\n        violins_g: null,\n        // individual g tag for each violin (mapped by group name)\n        violins: {},\n        // g tag grouping all boxes\n        boxes_g: null,\n        // per group: g tag grouping all outliers of the group\n        outliers: {},\n    }\n    /**\n     * Control panel things\n     * @private\n     */\n    this._controls = {}\n    this._controls.max_bins_multiplier = 3\n}\n// Set prototype chain\nObject.setPrototypeOf(boxvio_chart_wrapper.prototype, d3_chart_wrapper.prototype)\n\n/**\n * Set the scale for the violins\n * @function\n * @param {number} scale the scale [0, 1]\n * @name boxvio_chart_wrapper#set_violin_scale\n */\nboxvio_chart_wrapper.prototype.set_violin_scale = function (scale) {\n    this._chart.violin_scale = scale\n    // Remove the violin graphics, only leaving its root g tag (violins_g)\n    this._graphics.violins_g.selectAll('*').remove()\n    this._render_violins(true)\n}\n\n/**\n * Set the number of bins for a particular violin\n * \n * Updates the chart accordingly\n * @param {string} name name of the group \n * @param {number} n_bins number of bins\n * @name boxvio_chart_wrapper#set_n_bins\n */\nboxvio_chart_wrapper.prototype.set_n_bins = function (name, n_bins) {\n    const chart = this._chart\n    const extent = this._data_extents[name]\n    chart.n_bins[name] = n_bins\n    chart.histogram[name].thresholds(\n        linspace(extent[0], extent[1], n_bins)\n    )\n    chart.bins[name] = chart.histogram[name](this._data[name])\n    // Delete the oath of the existing violin and redraw\n    this._graphics.violins[name].selectAll('*').remove()\n    this._render_violin(name)\n}\n\n/**\n * Set the curve for the violins\n * \n * Updates the chart accordingly\n * @param {string} curve_name name of the curve \n * @name boxvio_chart_wrapper#set_violin_curve\n */\nboxvio_chart_wrapper.prototype.set_violin_curve = function (curve_name) {\n    this._chart.violin_curve = CURVES[curve_name]\n    // Remove the violin graphics, only leaving its root g tag (violins_g)\n    this._graphics.violins_g.selectAll('*').remove()\n    this._render_violins(true)\n}\n\n/**\n * Set the scale for the boxes\n * @function\n * @param {number} scale the scale [0, 1]\n * @name boxvio_chart_wrapper#set_box_scale\n */\nboxvio_chart_wrapper.prototype.set_box_scale = function (scale) {\n    this._chart.box_scale = scale\n    // Remove the box graphics, only leaving its root g tag (boxes_g)\n    this._graphics.boxes_g.selectAll('*').remove()\n    this._render_boxes(true)\n}\n\n/**\n * Render the plot\n * @function\n * @protected\n * @name boxvio_chart_wrapper#render_plot\n */\nboxvio_chart_wrapper.prototype.render_plot = function () {\n    d3_chart_wrapper.prototype.render_plot.call(this)\n\n    if (this._overflow) {\n        this.svg.attr('width', null)\n        this.svg.attr('height', '500px')\n        this.plot_container.style = \"overflow: auto;\"\n    }\n\n    // Set viewBox of svg\n    this.svg.attr('viewBox', `0 0 ${this._full_width} ${this._full_height}`)\n\n    // Root g tag\n    this._graphics.root_g = this.svg.append('g')\n        .attr('transform', `translate(${this._chart.margin.left},${this._chart.margin.top})`)\n\n    this._render_axis()\n    this._render_violins()\n    this._render_boxes()\n\n}\n\n/**\n * Render the axis\n * @function\n * @private\n * @name boxvio_chart_wrapper#_render_axis\n */\nboxvio_chart_wrapper.prototype._render_axis = function () {\n    const g = this._graphics.root_g\n    // Render x axis\n    this._graphics.xaxis_g = g.append('g')\n    const xaxis_g = this._graphics.xaxis_g\n    xaxis_g\n        .attr('transform', `translate(0,${this._chart.height})`)\n        .call(this._chart.xaxis)\n    this._apply_xticklabel_angle()\n    \n    // Render y axis\n    this._graphics.yaxis_g = g.append('g')\n    const yaxis_g = this._graphics.yaxis_g\n    yaxis_g.append('g')\n        .call(this._chart.yaxis)\n    // Render Y axis label\n    yaxis_g.append('text')\n        .attr('text-anchor', 'middle')\n        .attr('transform', 'rotate(-90)')\n        .attr('y', -this._chart.margin.left + 20)\n        .attr('x', -this._chart.height / 2)\n        .text(this._ylabel)\n\n}\n\nboxvio_chart_wrapper.prototype._apply_xticklabel_angle = function () {\n    const angle = this._chart.xticklabel_angle\n    const xaxis_g = this._graphics.xaxis_g\n    if (angle === 0) {\n        xaxis_g.selectAll('text')\n            .attr('text-anchor', 'middle')\n            .attr('transform', `rotate(${-this._chart.xticklabel_angle})`)\n    } else {\n        xaxis_g.selectAll('text')\n            .attr('text-anchor', 'end')\n            .attr(\"dy\", `${-angle*angle*0.00006172839}em`)\n            .attr(\"dx\", \"-0.9em\")\n            .attr('transform',\n                `rotate(${-this._chart.xticklabel_angle})`\n            )\n        if (angle < 35) {\n            xaxis_g.selectAll('text')\n                .attr('dx', '-0.7em')\n        }\n    }\n}\n\n/**\n * Render the violins\n * @function\n * @private\n * @param {boolean} is_g_ready whether the g tag for violins is\n *        set up (default: `false`)\n * @name boxvio_chart_wrapper#_render_violins\n */\nboxvio_chart_wrapper.prototype._render_violins = function (is_g_ready=false) {\n\n    const chart = this._chart\n    const g = this._graphics.root_g\n\n    // Render\n    if (!is_g_ready) {\n        this._graphics.violins_g = g.append('g')\n    }\n    const violins_g = this._graphics.violins_g\n    for (const name of Object.keys(chart.bins)) {\n        this._graphics.violins[name] = violins_g.append('g')\n            .attr('transform', `translate(${chart.xscale(name)},0)`)\n        this._render_violin(name)\n    }\n\n}\n\n/**\n * Render the violins\n * @function\n * @private\n * @param {boolean} is_g_ready whether the g tag for violins is\n *        set up (default: `false`)\n * @name boxvio_chart_wrapper#_render_violins\n */\nboxvio_chart_wrapper.prototype._render_violin = function (name) {\n    const bins = this._chart.bins[name]\n    const violin_scale = this._chart.violin_scale\n    const bandwidth = this._chart.xscale.bandwidth()\n    const yscale = this._chart.yscale\n    const violin_curve = this._chart.violin_curve\n\n    // Get the largest count in a bin as it will be maximum width\n    const max_count = d3.max(bins, (bin) => bin.length)\n    // Make a linear scale to map bin counts to bandwidth\n    const x_num = d3.scaleLinear()\n        .range([0, bandwidth])\n        .domain([-max_count, max_count])\n\n    this._graphics.violins[name]\n        .append('path')\n        .datum(bins)\n            .style('stroke', 'gray')\n            .style('stroke-width', 0.4)\n            .style('fill', '#d2d2d2')\n            .attr('d', d3.area()\n                .x0((d) => x_num(-d.length*violin_scale))\n                .x1((d) => x_num(d.length*violin_scale))\n                .y((d) => yscale(d.x0))\n                .curve(violin_curve)\n            )\n}\n\n/**\n * Render the boxes (including whiskers and outliers)\n * @function\n * @private\n * @param {boolean} is_g_ready whether the g tag for boxes is\n *        set up (default: `false`)\n * @name boxvio_chart_wrapper#_render_boxes\n */\nboxvio_chart_wrapper.prototype._render_boxes = function (is_g_ready=false) {\n\n    const chart = this._chart\n    const g = this._graphics.root_g\n\n    // Draw\n    if (!is_g_ready) {\n        this._graphics.boxes_g = g.append('g')\n    }\n    const boxes = this._graphics.boxes_g\n    const bandwidth = chart.xscale.bandwidth()\n    const box_width = this._chart.box_scale * bandwidth\n\n    const whiskers_lw = 2\n    const median_lw = 3\n\n    // Iterate over the groups\n    for (const [i, name] of Object.entries(this._group_names)) {\n\n        const metrics = this._metrics[name]\n        const color = this._colors[i]\n\n        const group_box = boxes.append('g')\n            .attr('transform', `translate(${chart.xscale(name) + bandwidth / 2},0)`)\n\n        // Draw outliers\n        this._graphics.outliers[name] = group_box.append('g')\n        const outliers = this._graphics.outliers[name]\n        for (const outlier of this._outliers[name]) {\n            outliers.append('circle')\n                .attr('cx', 0)\n                .attr('cy', chart.yscale(outlier))\n                .attr('r', 4)\n                .style('fill', color)\n                .style('opacity', 0.7)\n        }\n\n        // Draw whiskers\n        const whiskers = group_box.append('g')\n        whiskers.append('line')  // vertical line\n            .attr('x1', 0)\n            .attr('y1', chart.yscale(metrics.lower_fence))\n            .attr('x2', 0)\n            .attr('y2', chart.yscale(metrics.upper_fence))\n            .attr('stroke', color)\n            .attr('stroke-width', whiskers_lw)\n        whiskers.append('line') // lower horizontal\n            .attr('x1', -box_width / 2)\n            .attr('y1', chart.yscale(metrics.lower_fence))\n            .attr('x2', box_width / 2)\n            .attr('y2', chart.yscale(metrics.lower_fence))\n            .attr('stroke', color)\n            .attr('stroke-width', whiskers_lw)\n        whiskers.append('line') // upper horizontal\n            .attr('x1', -box_width / 2)\n            .attr('y1', chart.yscale(metrics.upper_fence))\n            .attr('x2', box_width / 2)\n            .attr('y2', chart.yscale(metrics.upper_fence))\n            .attr('stroke', color)\n            .attr('stroke-width', whiskers_lw)\n\n        // Draw IQR box\n        const iqr = group_box.append('g')\n        iqr.append('rect')  // iqr rect\n            .attr('x', -box_width / 2)\n            .attr('y', chart.yscale(metrics.quartile3))\n            .attr('width', box_width)\n            .attr('height', chart.yscale(metrics.quartile1) - chart.yscale(metrics.quartile3))\n            .attr('fill', color)\n        iqr.append('line')  // median line\n            .attr('x1', -box_width / 2)\n            .attr('y1', chart.yscale(metrics.median))\n            .attr('x2', box_width / 2)\n            .attr('y2', chart.yscale(metrics.median))\n            .attr('stroke', 'black')\n            .attr('stroke-width', median_lw)\n        iqr.append('circle')  // median dot\n            .attr('cx', 0)\n            .attr('cy', chart.yscale(metrics.median))\n            .attr('r', 4.5)\n            .style('fill', 'white')\n            .attr('stroke', 'black')\n            .attr('stroke-width', 2)\n    }\n\n}\n\n/**\n * Render the control panel\n * @function\n * @protected\n * @name boxvio_chart_wrapper#render_control_panel\n */\nboxvio_chart_wrapper.prototype.render_control_panel = function () {\n    d3_chart_wrapper.prototype.render_control_panel.call(this)\n\n    this._render_violin_curve_selector()\n    this._render_checkboxes()\n    this._render_scale_sliders()\n    this._render_n_bins_control()\n\n}\n\n/**\n * Render the selector for the violin curve\n * @function\n * @private\n * @name boxvio_chart_wrapper#_render_violin_curve_selector\n */\nboxvio_chart_wrapper.prototype._render_violin_curve_selector = function () {\n    const curve_select_id = `${this.id_string()}_curve_select`\n    const curve_select = common.create_dom_element({\n        element_type: 'select',\n        id: curve_select_id,\n        parent: this.controls_container,\n        // TODO: add ARIA attributes?\n    })\n    for (const curve_name of this._chart.supported_curves) {\n        common.create_dom_element({\n            element_type: 'option',\n            value: curve_name,\n            text_content: curve_name,\n            parent: curve_select,\n        })\n    }\n    curve_select.addEventListener('change', () => {\n        this.set_violin_curve(curve_select.value)\n    })\n}\n\n/**\n * Render the checkboxes of the control panel\n * @function\n * @private\n * @name boxvio_chart_wrapper#_render_checkboxes\n */\nboxvio_chart_wrapper.prototype._render_checkboxes = function () {\n    const show_violins_checkbox_id = `${this.id_string()}_show_violins_checkbox`\n    /**\n     * Checkbox for showing violins\n     * @type {Element}\n     */\n    const show_violins_checkbox = common.create_dom_element({\n        element_type: 'input',\n        type: 'checkbox',\n        id: show_violins_checkbox_id,\n        parent: this.controls_container,\n    })\n    show_violins_checkbox.checked = true\n    /**\n     * Checkbox label for density plot\n     * @type {Element}\n     */\n    const show_violins_label = common.create_dom_element({\n        element_type: 'label',\n        text_content: 'Show violins',\n        parent: this.controls_container,\n    })\n    show_violins_label.setAttribute('for', show_violins_checkbox_id)\n    show_violins_checkbox.addEventListener('change', () => {\n        toggle_visibility(this._graphics.violins_g)\n    })\n\n    const show_boxes_checkbox_id = `${this.id_string()}_show_boxes_checkbox`\n    /**\n     * Checkbox for showing boxes\n     * @type {Element}\n     */\n     const show_boxes_checkbox = common.create_dom_element({\n        element_type: 'input',\n        type: 'checkbox',\n        id: show_boxes_checkbox_id,\n        parent: this.controls_container,\n    })\n    show_boxes_checkbox.checked = true\n    /**\n     * Checkbox label for density plot\n     * @type {Element}\n     */\n    const show_boxes_label = common.create_dom_element({\n        element_type: 'label',\n        text_content: 'Show boxes',\n        parent: this.controls_container,\n    })\n    show_boxes_label.setAttribute('for', show_boxes_checkbox_id)\n    show_boxes_checkbox.addEventListener('change', () => {\n        toggle_visibility(this._graphics.boxes_g)\n        // (DISABLED) Disable the checkbox for outliers (defined below)\n        // show_outliers_checkbox.disabled = !show_boxes_checkbox.checked\n    })\n\n    const show_outliers_checkbox_id = `${this.id_string()}_show_outliers_checkbox`\n    /**\n     * Checkbox for showing outliers\n     * @type {Element}\n     */\n    const show_outliers_checkbox = common.create_dom_element({\n        element_type: 'input',\n        type: 'checkbox',\n        id: show_outliers_checkbox_id,\n        parent: this.controls_container,\n    })\n    show_outliers_checkbox.checked = true\n    /**\n     * Checkbox label for density plot\n     * @type {Element}\n     */\n    const show_outliers_label = common.create_dom_element({\n        element_type: 'label',\n        text_content: 'Show outliers',\n        parent: this.controls_container,\n    })\n    show_outliers_label.setAttribute('for', show_outliers_checkbox_id)\n    show_outliers_checkbox.addEventListener('change', () => {\n        for (const group of Object.values(this._graphics.outliers)) {\n            toggle_visibility(group)\n        }\n    })\n}\n\n/**\n * Render the sliders of the control panel that\n * control the scale of violins and boxes\n * @function\n * @private\n * @name boxvio_chart_wrapper#_render_scale_sliders\n */\nboxvio_chart_wrapper.prototype._render_scale_sliders = function () {\n    /**\n     * Slider for violin scale\n     * @type {Element}\n     */\n    const violin_scale_slider = common.create_dom_element({\n        element_type: 'input',\n        type: 'range',\n        // value: this._chart.violin_scale_default,  // This does not work here?\n        parent: this.controls_container,\n    })\n    violin_scale_slider.setAttribute('min', 0)\n    violin_scale_slider.setAttribute('max', 1)\n    violin_scale_slider.setAttribute('step', 0.05)\n    violin_scale_slider.value = this._chart.violin_scale_default\n    violin_scale_slider.addEventListener('input', () => {\n        this.set_violin_scale(Number(violin_scale_slider.value))\n    })\n    /**\n     * Reset button for the violin_scale_slider\n     * @type {Element}\n     */\n    const violin_scale_slider_reset = common.create_dom_element({\n        element_type: 'button',\n        type: 'button',\n        text_content: 'Reset',\n        parent: this.controls_container,\n    })\n    violin_scale_slider_reset.addEventListener('click', () => {\n        violin_scale_slider.value = this._chart.violin_scale_default\n        this.set_violin_scale(Number(violin_scale_slider.value))\n    })\n\n    /**\n     * Slider for box scale\n     * @type {Element}\n     */\n    const box_scale_slider = common.create_dom_element({\n        element_type: 'input',\n        type: 'range',\n        // value: this._chart.box_scale_default,  // This does not work here?\n        parent: this.controls_container,\n    })\n    box_scale_slider.setAttribute('min', 0)\n    box_scale_slider.setAttribute('max', 1)\n    box_scale_slider.setAttribute('step', 0.05)\n    box_scale_slider.value = this._chart.box_scale_default\n    box_scale_slider.addEventListener('input', () => {\n        this.set_box_scale(Number(box_scale_slider.value))\n    })\n    /**\n     * Reset button for the box_scale_slider\n     * @type {Element}\n     */\n    const box_scale_slider_reset = common.create_dom_element({\n        element_type: 'button',\n        type: 'button',\n        text_content: 'Reset',\n        parent: this.controls_container,\n    })\n    box_scale_slider_reset.addEventListener('click', () => {\n        box_scale_slider.value = this._chart.box_scale_default\n        this.set_box_scale(Number(box_scale_slider.value))\n    })\n}\n\n/**\n * Render the control elements to change the number of bins\n * @function\n * @private\n * @name boxvio_chart_wrapper#_render_n_bins_control\n */\nboxvio_chart_wrapper.prototype._render_n_bins_control = function () {\n    const group_select_id = `${this.id_string()}_group_select`\n    const group_select = common.create_dom_element({\n        element_type: 'select',\n        id: group_select_id,\n        parent: this.controls_container,\n        // TODO: add ARIA attributes?\n    })\n    for (const name of this._group_names) {\n        common.create_dom_element({\n            element_type: 'option',\n            value: name,\n            text_content: name,\n            parent: group_select,\n        })\n    }\n    group_select.addEventListener('change', () => {\n        const name = group_select.value\n        violin_n_bins_slider.setAttribute(\n            'max',\n            this._controls.max_bins_multiplier * this._chart.n_bins_default[name]\n        )\n        violin_n_bins_slider.value = this._chart.n_bins[name]\n    })\n\n    const violin_n_bins_slider = common.create_dom_element({\n        element_type: 'input',\n        type: 'range',\n        // value: this._chart.violin_scale_default,  // This does not work here?\n        parent: this.controls_container,\n    })\n    violin_n_bins_slider.setAttribute('min', 1)\n    violin_n_bins_slider.setAttribute(\n        'max',\n        this._controls.max_bins_multiplier * this._chart.n_bins_default[group_select.value]\n    )\n    violin_n_bins_slider.value = this._chart.n_bins[group_select.value]\n    violin_n_bins_slider.addEventListener('input', () => {\n        this.set_n_bins(group_select.value, Number(violin_n_bins_slider.value))\n    })\n\n    const violin_n_bins_slider_reset = common.create_dom_element({\n        element_type: 'button',\n        type: 'button',\n        text_content: 'Reset',\n        parent: this.controls_container,\n    })\n    violin_n_bins_slider_reset.addEventListener('click', () => {\n        const name = group_select.value\n        violin_n_bins_slider.value = this._chart.n_bins_default[name]\n        this.set_n_bins(name, Number(violin_n_bins_slider.value))\n    })\n\n    const violin_all_n_bins_slider_reset = common.create_dom_element({\n        element_type: 'button',\n        type: 'button',\n        text_content: 'Reset all bins',\n        parent: this.controls_container,\n    })\n    violin_all_n_bins_slider_reset.addEventListener('click', () => {\n        const name = group_select.value\n        // Update the value of the slider\n        violin_n_bins_slider.value = this._chart.n_bins_default[name]\n        for (const [name, n_bins] of Object.entries(this._chart.n_bins_default)) {\n            this.set_n_bins(name, n_bins)\n        }\n    })\n}\n\n\n// HELPER FUNCTIONS\n\n/**\n * Compute (boxplot) metrics for the data\n * @param {number[]} values the data values\n * @returns {{\n *  max: number,\n *  upper_fence: number,\n *  quartile3: number,\n *  median: number,\n *  mean: number,\n *  iqr: number,\n *  quartile1: number,\n *  lower_fence: number,\n *  min: number,\n * }}\n */\nfunction calc_metrics(values) {\n    const metrics = {\n        max: null,\n        upper_fence: null,\n        quartile3: null,\n        median: null,\n        mean: null,\n        iqr: null,\n        quartile1: null,\n        lower_fence: null,\n        min: null,\n    }\n\n    metrics.min = d3.min(values)\n    metrics.quartile1 = d3.quantile(values, 0.25)\n    metrics.median = d3.median(values)\n    metrics.mean = d3.mean(values)\n    metrics.quartile3 = d3.quantile(values, 0.75)\n    metrics.max = d3.max(values)\n    metrics.iqr = metrics.quartile3 - metrics.quartile1\n    metrics.lower_fence = metrics.quartile1 - 1.5 * metrics.iqr\n    metrics.upper_fence = metrics.quartile3 + 1.5 * metrics.iqr\n\n    return metrics\n}","/**\n * Get a deep copy of an object\n * @param {Object} obj the object\n * @returns a deep copy of the object\n */\nexport function deepcopy(obj) {\n\treturn JSON.parse(JSON.stringify(obj))\n}","\"use strict\";\n\nimport { chart_wrapper } from \"../chart-wrapper.js\";\n\n/**\n * Chart.js chart wrapper class\n * @class\n * @abstract\n * @param {Element} div_wrapper the div conatining the chart\n * @param {Object} options configuration options\n * @param {boolean} options.display_download whether to display the download panel (default `false`)\n * @param {boolean} options.display_control_panel whether to display the control panel (default `false`)\n * @extends chart_wrapper\n */\nexport function chartjs_chart_wrapper(div_wrapper, options) {\n    if (this.constructor === chartjs_chart_wrapper) {\n        throw new Error(\"Abstract class 'chartjs_chart_wrapper' cannot be instantiated\")\n    }\n    chart_wrapper.call(this, div_wrapper, options)\n    /**\n     * Canvas instance, will be created during\n     * render\n     * @type {HTMLCanvasElement}\n     * @protected\n     */\n    this.canvas = undefined\n    /**\n     * Chart instance (chart.js)\n     * @protected\n     */\n    this.chart = undefined\n}\n// Set prototype chain\nObject.setPrototypeOf(chartjs_chart_wrapper.prototype, chart_wrapper.prototype)\n\n/**\n * Render the plot\n * \n * Subclasses must call this method at the top\n * of their own implementation. Then, they can make\n * use of the canvas and the chartjs chart instance\n * @name chartjs_chart_wrapper#render_plot\n * @function\n * @protected\n */\nchartjs_chart_wrapper.prototype.render_plot = function () {\n    chart_wrapper.prototype.render_plot.call(this)\n    // Create canvas\n    this.canvas = common.create_dom_element({\n        element_type: 'canvas',\n        id: 'result_graph',\n        class_name: 'o-blue',\n        parent: this.plot_container,\n    })\n    // Set chart instance to undefined\n    this.chart = undefined\n}\n\n/**\n * Get the supported chart export formats\n * @function\n * @returns {string[]} the supported formats\n * @name chartjs_chart_wrapper#get_supported_export_formats\n */\nchartjs_chart_wrapper.prototype.get_supported_export_formats = function () {\n    return ['png']\n}\n\n/**\n * Download the chart as png\n * @param {string} filename the name of the file\n * @function\n * @name chartjs_chart_wrapper#_download_chart_as_png\n */\nchartjs_chart_wrapper.prototype.download_chart_as_png = function (filename) {\n    /**\n     * Temporary link\n     * @type {Element}\n     */\n    const tmpLink = common.create_dom_element({\n        element_type: 'a',\n        href: this.chart.toBase64Image(),\n    })\n    tmpLink.setAttribute('download', filename)\n    tmpLink.click()\n    tmpLink.remove()\n}\n\n/**\n * FIXME: this is not working...\n * Download the chart as svg\n * @param {string} filename the name of the file\n * @function\n * @name chartjs_chart_wrapper#_download_chart_as_svg\n */\nchartjs_chart_wrapper.prototype.download_chart_as_svg = function (filename) {\n    // Tweak C2S library\n    this._tweak_c2s()\n    // Get original width and height\n    const width = this.canvas.offsetWidth\n    const height = this.canvas.offsetHeight\n    // TODO: Turn off responsiveness and animations\n    this.chart.options.animation = false\n    this.chart.options.reponsive = false\n    // Replicate chart in C2S space\n    const svgContext = C2S(width, height)\n    const svgChart = new Chart(svgContext, this.chart.config._config)\n    // Download\n    /**\n     * Temporary link\n     * @type {Element}\n     */\n    const tmpLink = common.create_dom_element({\n        element_type: 'a',\n        href: 'data:image/svg+xml;utf8,'\n            + encodeURIComponent(svgContext.getSerializedSvg()),\n    })\n    tmpLink.setAttribute('download', filename)\n    tmpLink.click()\n    tmpLink.remove()\n    // TODO: Turn on responsiveness and animations\n    this.chart.options.animation = true\n    this.chart.options.reponsive = true\n}\n\n/**\n * Some tweaks to the canvas2svg library are required for svg export to work\n * \n * Via: https://stackoverflow.com/questions/62249315/export-canvas-to-svg-file\n * @function\n * @private\n * @name chartjs_chart_wrapper#_tweak_c2s\n */\nchartjs_chart_wrapper.prototype._tweak_c2s = function () {\n    C2S.prototype.getContext = function (contextId) {\n        if (contextId === '2d' || contextId === '2D') {\n            return this;\n        }\n        return null;\n    }\n    C2S.prototype.style = function () {\n        return this.__canvas.style;\n    }\n    C2S.prototype.getAttribute = function (name) {\n        return this[name];\n    }\n    C2S.prototype.addEventListener = function (type, listener, eventListenerOptions) {\n        // nothing to do here, but we need this function :)\n    }\n}","\"use strict\";\n\nimport { chartjs_chart_wrapper } from \"./chartjs-chart-wrapper.js\";\nimport { COLOR_PICKER_WIDTH, COLOR_PALETTE } from \"../chart-wrapper.js\";\nimport { compute_n_bins } from \"../compute-n-bins.js\";\n\n/**\n * Histogram wrapper\n * @param {Element}  div_wrapper the div to work in\n * @param {number[]} data the data\n * @param {Object} options configuration options\n * @param {boolean} options.display_download whether to display the download panel (default `false`)\n * @param {boolean} options.display_control_panel whether to display the control panel (default `false`)\n * @param {string} options.xlabel the label for the x-axis (default `null` )\n * @class\n * @extends chartjs_chart_wrapper\n */\nexport function histogram_wrapper(div_wrapper, data, options) {\n    /*\n     * <Function>.call is a method that executes the defined function,\n     * but with the \"this\" variable pointing to the first argument,\n     * and the rest of the arguments being arguments of the function\n     * that is being \"called\". This essentially performs all of\n     * chart_wrapper's constructor logic on histogram_wrapper's \"this\".\n     */\n    chartjs_chart_wrapper.call(this, div_wrapper, options)\n\n    /**\n     * Data values\n     * @type {number[]}\n     * @private\n     */\n    this._data = data\n    /**\n     * Whether to perform a density plot\n     * @type {boolean}\n     * @private\n     */\n    this._density = false\n    /**\n     * Default number of bins\n     * @type {number}\n     * @private\n     */\n    this._n_bins_default = compute_n_bins.sqrt(this._data)\n    /**\n     * Number of bins in the histogram\n     * \n     * Defined as the square root of the\n     * amount of datapoints, computed\n     * during render\n     * @type {number}\n     * @private\n     */\n    this._n_bins = undefined\n    /** Label for the xaxis\n     * @type {string}\n     * @private\n    */\n    this._xlabel = options.xlabel || null\n    /**\n     * Number of decimals to display\n     * @type {number}\n     * @private\n     */\n    this._n_decimals = 3\n    /**\n     * Maximum number of bins as mutiplier of default\n     * @type {number}\n     * @private\n     */\n    this._max_bins_multiplier = 3\n    /**\n     * Default color for the bars in rgba\n     * @type {string}\n     * @private\n     */\n    this._bar_color = COLOR_PALETTE[0]\n}\n// Set prototype chain\nObject.setPrototypeOf(histogram_wrapper.prototype, chartjs_chart_wrapper.prototype)\n\n/**\n * Check whether we are doing a density plot\n * @returns {boolean} `true` if density plot,\n * \t\t\t`false` otherwise\n * @name histogram_wrapper#get_density\n * @function\n */\nhistogram_wrapper.prototype.get_density = function () {\n    return this._density\n}\n\n/**\n * Change the density plot attribute\n * @param density {boolean} `true` if density, `false` otherwise\n * @function\n * @name histogram_wrapper#set_density\n */\nhistogram_wrapper.prototype.set_density = function (density) {\n    this._density = density\n    if (!this.chart) {\n        return\n    }\n    // Update chart\n    const [\n        bin_centers, plot_data, half_bin_width, data_min, data_max\n    ] = this._get_plotting_data()\n    this.chart.data.datasets[0].label = this._get_density_string()\n    this.chart.data.datasets[0].data = plot_data\n    this.chart.options.scales.y.title.text = this._get_density_string()\n    this.chart.update()\n}\n\n/**\n * Get a string representing the plot mode\n * @returns {string} `'Density'` if we are in density\n * \t\t\tmode, `'Frequency'` otherwise\n * @function\n * @private\n * @name histogram_wrapper#_get_density_string\n */\nhistogram_wrapper.prototype._get_density_string = function () {\n    return this._density ? 'Density' : 'Frequency'\n}\n\n/**\n * Get the amount of bins in the histogram\n * @returns {number} the amount of bins\n * @function\n * @name histogram_wrapper#get_n_bins\n */\nhistogram_wrapper.prototype.get_n_bins = function () {\n    return this._n_bins\n}\n\n/**\n * Set a new number of bins for the histogram\n * \n * Updates chart instance accordingly\n * @param {number} n_bins amount of bins\n * @function\n * @name histogram_wrapper#set_n_bins\n */\nhistogram_wrapper.prototype.set_n_bins = function (n_bins) {\n    this._n_bins = n_bins\n    if (!this.chart) {\n        return\n    }\n    // Update chart\n    const [\n        bin_centers, plot_data, half_bin_width, data_min, data_max\n    ] = this._get_plotting_data()\n    this.chart.data.datasets[0].data = plot_data\n    this.chart.options.scales.x.min = data_min\n    this.chart.options.scales.x.max = data_max\n    this.chart.options.scales.x.ticks.stepSize = 2 * half_bin_width\n    this.chart.options.plugins.tooltip.callbacks.title =\n        this._get_tooltip_title_callback(bin_centers, half_bin_width)\n    this.chart.update()\n}\n\n/**\n * Get the color of the bars in the histogram\n * @returns {string} the bar color as an rgba string\n * @function\n * @name histogram_wrapper#get_bar_color\n */\nhistogram_wrapper.prototype.get_bar_color = function () {\n    return this._bar_color\n}\n\n/**\n * Set a new color for the bars in the histogram\n * \n * Updates the chart instance accordingly\n * @param {string} bar_color the new bar color for the histogram\n * @function\n * @name histogram_wrapper#set_bar_color\n */\nhistogram_wrapper.prototype.set_bar_color = function (bar_color) {\n    this._bar_color = bar_color\n    if (!this.chart) {\n        return\n    }\n    this.chart.data.datasets[0].backgroundColor = this._bar_color\n    this.chart.update()\n}\n\n/**\n * Get data needed to generate the chart\n * TODO: there is no need to recompute bin_centers unless the number of bins\n* \t\t has changed\n* @function\n* @name histogram_wrapper#_get_plotting_data\n* @private\n* \n* @returns {[number[], {x: number, y: number}[], number, number, number]}\n* \t\t\tthe bin centers, {bin centers, count per bin}, half of the bin width,\n* \t\t\tthe minimum and maximum of input data\n */\nhistogram_wrapper.prototype._get_plotting_data = function () {\n    const data_max = Math.max(...this._data)\n    const data_min = Math.min(...this._data)\n    const bin_width = (data_max - data_min) / this._n_bins\n    const half_bin_width = 0.5 * bin_width\n    /**\n     * Center of each bin\n     * @type {number[]}\n     */\n    const bin_centers = Array.apply(null, Array(this._n_bins)).map(\n        (value, index) => data_min + (2 * index + 1) * half_bin_width\n    )\n    // We bin with right-open intervals\n    /**\n     * Count per bin\n     * @type {number[]}\n     */\n    let entries = Array.apply(null, Array(this._n_bins)).map(() => 0)\n    for (let i = 0; i < this._data.length; i++) {\n        // If value is max, add it to last bin\n        if (this._data[i] === data_max) {\n            entries[this._n_bins - 1]++\n            continue\n        }\n        // Proceed as usual\n        for (let j = 0; j < this._n_bins; j++) {\n            if (this._data[i] >= bin_centers[j] - half_bin_width\n                && this._data[i] < bin_centers[j] + half_bin_width) {\n                entries[j]++\n                break\n            }\n        }\n    }\n    // Normalize if density\n    if (this._density) {\n        const sum = entries.reduce((partialSum, val) => partialSum + val, 0)\n        for (let j = 0; j < this._n_bins; j++) {\n            entries[j] /= (sum * bin_width);\n        }\n    }\n    return [\n        bin_centers,\n        bin_centers.map((val, i) => ({ x: val, y: entries[i] })),\n        half_bin_width,\n        data_min,\n        data_max,\n    ]\n}\n\n/**\n * Get callback function for tooltip title\n * @param {number[]} bin_centers the bin centers\n * @param {number} half_bin_width half of the bin width\n * @returns the callback function\n * @function\n * @private\n * @name histogram_wrapper#_get_tooltip_title_callback\n */\nhistogram_wrapper.prototype._get_tooltip_title_callback = function (bin_centers, half_bin_width) {\n    // Cannot use `this` inside inner function!!!\n    const xlabel = this._xlabel\n    const n_decimals = this._n_decimals\n    /**\n     * Callback function for the tooltip title\n     * @param {TooltipItem[]} items the tooltip item contexts\n     * @returns {string} the title of the tooltip\n     * @function\n     * @name histogram_wrapper#_get_tooltip_title_callback~inner\n     */\n    const callback = function (items) {\n        if (!items.length) {\n            return ''\n        }\n        const item = items[0]\n        const index = item.dataIndex\n        const min = bin_centers[index] - half_bin_width\n        const max = bin_centers[index] + half_bin_width\n        return `${xlabel}: ${min.toFixed(n_decimals)} `\n            + `- ${max.toFixed(n_decimals)}`\n    }\n    return callback\n}\n\n/**\n * Render the plot\n * @function\n * @protected\n * @name histogram_wrapper#render_plot\n */\nhistogram_wrapper.prototype.render_plot = function () {\n    chartjs_chart_wrapper.prototype.render_plot.call(this)\n\n    this._n_bins = this._n_bins_default\n    const [\n        bin_centers, plot_data, half_bin_width, data_min, data_max\n    ] = this._get_plotting_data()\n\n    // Split chart options\n    const chart_data = {\n        datasets: [{\n            label: this._get_density_string(),\n            data: plot_data,\n            categoryPercentage: 1,\n            barPercentage: 1,\n            backgroundColor: this._bar_color,\n        }],\n    }\n    const scales_options = {\n        x: {\n            type: 'linear',  // otherwise it goes to a category axis...\n            min: data_min,\n            max: data_max,\n            offset: false,\n            grid: {\n                offset: false,\n            },\n            ticks: {\n                stepSize: 2 * half_bin_width,\n                callback: (label, index, labels) => {\n                    return Number(label).toFixed(this._n_decimals)\n                }\n            },\n            title: {\n                display: Boolean(this._xlabel),  // Only display if there is a label\n                text: this._xlabel,\n                font: {\n                    size: 14\n                },\n            }\n        },\n        y: {\n            title: {\n                display: true,\n                text: this._get_density_string(),\n                font: {\n                    size: 14,\n                },\n            },\n        },\n    }\n    const plugins_options = {\n        legend: {\n            display: false,\n        },\n        tooltip: {\n            callbacks: {\n                title: this._get_tooltip_title_callback(bin_centers, half_bin_width),\n            },\n        },\n    }\n\n    // Render the graph\n    this.chart = new Chart(this.canvas, {\n        type: 'bar',\n        data: chart_data,\n        options: {\n            scales: scales_options,\n            plugins: plugins_options,\n            parsing: false,\n            normalized: true,\n        },\n    })\n}\n\n\n/**\n * Render the control panel\n * @function\n * @protected\n * @name histogram_wrapper#render_control_panel\n */\nhistogram_wrapper.prototype.render_control_panel = function () {\n    chartjs_chart_wrapper.prototype.render_control_panel.call(this)\n\n    // Save this histogram wrapper instance, because when we change scope\n    // we may still need to refer to it\n    /**\n     * This histogram_wrapper instance\n     * @type {histogram_wrapper}\n     */\n    const self = this\n    /**\n     * Slider for number of bins\n     * @type {Element}\n     */\n    const slider = common.create_dom_element({\n        element_type: 'input',\n        type: 'range',\n        value: this._n_bins_default,\n        parent: this.controls_container,\n    })\n    slider.setAttribute('min', 1)\n    slider.setAttribute('max', this._max_bins_multiplier * this._n_bins_default)\n    slider.addEventListener('input', () => {\n        this.set_n_bins(Number(slider.value))\n    })\n    /**\n     * Reset button for the slider\n     * @type {Element}\n     */\n    const slider_reset = common.create_dom_element({\n        element_type: 'button',\n        type: 'button',\n        text_content: 'Reset',\n        parent: this.controls_container,\n    })\n    slider_reset.addEventListener('click', () => {\n        slider.value = this._n_bins_default\n        this.set_n_bins(Number(slider.value))\n    })\n\n    const density_checkbox_id = `${this.id_string()}_density_checkbox`\n    /**\n     * Checkbox for density plot\n     * @type {Element}\n     */\n    const density_checkbox = common.create_dom_element({\n        element_type: 'input',\n        type: 'checkbox',\n        id: density_checkbox_id,\n        parent: this.controls_container,\n    })\n    /**\n     * Checkbox label for density plot\n     * @type {Element}\n     */\n    const density_checkbox_label = common.create_dom_element({\n        element_type: 'label',\n        text_content: 'Density',\n        parent: this.controls_container,\n    })\n    density_checkbox_label.setAttribute('for', density_checkbox_id)\n    density_checkbox.addEventListener('change', () => {\n        this.set_density(Boolean(density_checkbox.checked))\n    })\n    /** iro.js color picker */\n    const color_picker_container = common.create_dom_element({\n        element_type: 'div',\n        id: `${this.id_string()}_color_picker_container`,\n        parent: this.controls_container\n    })\n    const color_picker = new window.iro.ColorPicker(color_picker_container, {\n        color: this._bar_color,\n        width: COLOR_PICKER_WIDTH,\n        layoutDirection: 'horizontal',\n        layout: [\n            {\n                component: window.iro.ui.Wheel,\n            },\n            {\n                component: window.iro.ui.Slider,\n            },\n            {\n                component: window.iro.ui.Slider,\n                options: {\n                    sliderType: 'alpha',\n                }\n            },\n        ],\n    })\n    color_picker.on('color:change', function (color) {\n        self.set_bar_color(color.rgbaString)\n    })\n}","/*global tstring, page_globals, Promise, data_manager, common */\n/*eslint no-undef: \"error\"*/\n\n\"use strict\";\n\n\nimport { chart_wrapper } from \"../../lib/charts/chart-wrapper.js\";\nimport { boxvio_chart_wrapper } from \"../../lib/charts/d3/boxvio-chart-wrapper.js\";\nimport { histogram_wrapper } from \"../../lib/charts/chartjs/histogram-wrapper.js\";\n\n\nexport const analysis =  {\n\n\t// Form factory instance\n\tform: null,\n\n\tarea_name\t\t\t\t: null,\n\trow\t\t\t\t\t\t: null,\n\n\t// DOM containers\n\texport_data_container\t\t: null,\n\tform_items_container\t\t: null,\n\tdiameter_chart_container\t: null,\n\tweight_chart_container\t\t: null,\n\n\t/**\n\t * Chart wrapper instance for diameter\n\t * @type {chart_wrapper}\n\t */\n\tdiameter_chart_wrapper: null,\n\t/**\n\t * Chart wrapper instance for weight\n\t * @type {chart_wrapper}\n\t */\n\tweight_chart_wrapper: null,\n\n\n\tset_up : function(options) {\n\n\t\tconst self = this\n\n\t\t// options\n\t\t\tself.area_name\t\t\t\t\t= options.area_name\n\t\t\tself.export_data_container\t\t= options.export_data_container\n\t\t\tself.row\t\t\t\t\t\t= options.row\n\t\t\tself.form_items_container\t\t= options.form_items_container\n\t\t\tself.diameter_chart_container\t= options.diameter_chart_container\n\t\t\tself.weight_chart_container\t\t= options.weight_chart_container\n\n\t\t// form\n\t\tconst form_node = self.render_form()\n\t\tself.form_items_container.appendChild(form_node)\n\n\t\treturn true\n\t},//end set_up\n\n\t/**\n\t * RENDER FORM\n\t */\n\trender_form : function() {\n\n\t\tconst self = this\n\n\t\t// DocumentFragment is like a virtual DOM\n\t\tconst fragment = new DocumentFragment()\n\n\t\t// form_factory instance\n\t\t\tself.form = self.form || new form_factory()\n\n\t\tconst form_row = common.create_dom_element({\n\t\t\telement_type\t: \"div\",\n\t\t\tclass_name\t\t: \"form-row fields\",\n\t\t\tparent\t\t\t: fragment\n\t\t})\n\n\t\t// mint\n\t\t\tself.form.item_factory({\n\t\t\t\tid\t\t\t\t: \"mint\",\n\t\t\t\tname\t\t\t: \"mint\",\n\t\t\t\tlabel\t\t\t: tstring.mint || \"mint\",\n\t\t\t\tq_column\t\t: \"p_mint\",\n\t\t\t\tvalue_wrapper\t: ['[\"', '\"]'], // to obtain [\"value\"] in selected value only\n\t\t\t\teq\t\t\t\t: \"LIKE\",\n\t\t\t\teq_in\t\t\t: \"%\",\n\t\t\t\teq_out\t\t\t: \"%\",\n\t\t\t\tis_term\t\t\t: true,\n\t\t\t\tparent\t\t\t: form_row,\n\t\t\t\tcallback\t\t: function(form_item) {\n\t\t\t\t\tself.form.activate_autocomplete({\n\t\t\t\t\t\tform_item\t: form_item,\n\t\t\t\t\t\ttable\t\t: 'catalog'\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t})\n\t\t\n\t\t// number\n\t\t\tself.form.item_factory({\n\t\t\t\tid \t\t\t: \"number\",\n\t\t\t\tname \t\t: \"number\",\n\t\t\t\tq_column \t: \"term\",\n\t\t\t\tq_table \t: \"types\",\n\t\t\t\tlabel\t\t: tstring.number_key || \"Number & Key\",\n\t\t\t\tis_term \t: false,\n\t\t\t\tparent\t\t: form_row,\n\t\t\t\tgroup_op \t: '$or',\n\t\t\t\tcallback\t: function(form_item) {\n\t\t\t\t\tself.form.activate_autocomplete({\n\t\t\t\t\t\tform_item\t: form_item,\n\t\t\t\t\t\ttable\t\t: 'catalog'\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t})\n\t\t\n\t\t// material\n\t\t\tself.form.item_factory({\n\t\t\t\tid \t\t\t: \"material\",\n\t\t\t\tname \t\t: \"material\",\n\t\t\t\tq_column \t: \"ref_type_material\",\n\t\t\t\tq_table \t: \"any\",\n\t\t\t\tlabel\t\t: tstring.material || \"material\",\n\t\t\t\tis_term \t: false,\n\t\t\t\tparent\t\t: form_row,\n\t\t\t\tcallback\t: function(form_item) {\n\t\t\t\t\tself.form.activate_autocomplete({\n\t\t\t\t\t\tform_item\t: form_item,\n\t\t\t\t\t\ttable\t\t: 'catalog'\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t})\n\t\t\n\t\t// denomination\n\t\t\tself.form.item_factory({\n\t\t\t\tid \t\t\t: \"denomination\",\n\t\t\t\tname \t\t: \"denomination\",\n\t\t\t\tq_column \t: \"ref_type_denomination\",\n\t\t\t\tq_table \t: \"any\",\n\t\t\t\tlabel\t\t: tstring.denomination || \"denomination\",\n\t\t\t\tis_term \t: false,\n\t\t\t\tparent\t\t: form_row,\n\t\t\t\tcallback\t: function(form_item) {\n\t\t\t\t\tself.form.activate_autocomplete({\n\t\t\t\t\t\tform_item\t: form_item,\n\t\t\t\t\t\ttable\t\t: 'catalog'\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t})\n\n\t\t// submit button\n\t\t\tconst submit_group = common.create_dom_element({\n\t\t\t\telement_type\t: \"div\",\n\t\t\t\tclass_name\t\t: \"form-group field button_submit\",\n\t\t\t\tparent\t\t\t: fragment\n\t\t\t})\n\t\t\tconst submit_button = common.create_dom_element({\n\t\t\t\telement_type\t: \"input\",\n\t\t\t\ttype\t\t\t: \"submit\",\n\t\t\t\tid\t\t\t\t: \"submit\",\n\t\t\t\tvalue\t\t\t: tstring.search || \"Search\",\n\t\t\t\tclass_name\t\t: \"btn btn-light btn-block primary\",\n\t\t\t\tparent\t\t\t: submit_group\n\t\t\t})\n\t\t\tsubmit_button.addEventListener(\"click\", function (e) {\n\t\t\t\te.preventDefault()\n\t\t\t\tself.form_submit(form)\n\t\t\t})\n\n\t\t// reset button\n\t\t\tconst reset_button = common.create_dom_element({\n\t\t\t\telement_type\t: \"input\",\n\t\t\t\ttype\t\t\t: \"button\",\n\t\t\t\tid\t\t\t\t: \"button_reset\",\n\t\t\t\tvalue\t\t\t: tstring.reset || 'Reset',\n\t\t\t\tclass_name\t\t: \"btn btn-light btn-block secondary button_reset\",\n\t\t\t\tparent\t\t\t: submit_group\n\t\t\t})\n\t\t\treset_button.addEventListener(\"click\", function (e) {\n\t\t\t\te.preventDefault()\n\t\t\t\twindow.location.replace(window.location.pathname);\n\t\t\t})\n\n\t\t// operators\n\t\t\t// fragment.appendChild( forms.build_operators_node() )\n\t\t\tconst operators_node = self.form.build_operators_node()\n\t\t\tfragment.appendChild( operators_node )\n\n\t\t// the form element itself!\n\t\t\tconst form = common.create_dom_element({\n\t\t\t\telement_type\t: \"form\",\n\t\t\t\tid\t\t\t\t: \"search_form\",\n\t\t\t\tclass_name\t\t: \"form-inline\"\n\t\t\t})\n\t\t\tform.appendChild(fragment)\n\n\n\t\treturn form\n\t},//end render_form\n\n\t/**\n\t * FORM SUBMIT\n\t * Form submit launch search\n\t */\n\tform_submit : function(form_obj, options={}) {\n\t\t\n\t\tconst self = this\n\n\t\t// options\n\t\t\tconst scroll_result\t= typeof options.scroll_result===\"boolean\" ? options.scroll_result : true\n\t\t\tconst form_items\t= options.form_items || self.form.form_items\n\n\t\t// build filter\n\t\t\tconst filter = self.form.build_filter({\n\t\t\t\tform_items: form_items\n\t\t\t})\n\t\t\n\t\t// empty filter case\n\t\t\tif (!filter || filter.length<1) {\n\t\t\t\treturn false\n\t\t\t}\n\n\t\t// scroll to head result\n\t\t\tif (scroll_result) {\n\t\t\t\tthis.diameter_chart_container.scrollIntoView(\n\t\t\t\t\t{behavior: \"smooth\", block: \"start\", inline: \"nearest\"}\n\t\t\t\t);\n\t\t\t}\n\n\t\t// search rows exec against API\n\t\t\tconst js_promise = self.search_rows({\n\t\t\t\tfilter\t\t\t: filter,\n\t\t\t\tlimit\t\t\t: 0,\n\t\t\t\tprocess_result\t: {\n\t\t\t\t\tfn\t\t: 'process_result::add_parents_and_children_recursive',\n\t\t\t\t\tcolumns\t: [{name : \"parents\"}]\n\t\t\t\t}\n\t\t\t})\n\t\t\t.then((parsed_data)=>{\n\n\t\t\t\tevent_manager.publish('form_submit', parsed_data)\n\n\t\t\t\tconsole.log(parsed_data)\n\n\t\t\t\t// const diameters = parsed_data\n\t\t\t\t// \t.map((ele) => ele.full_coins_reference_diameter_max)\n\t\t\t\t// \t.flat()\n\t\t\t\t// \t.filter((v) => v)\n\t\t\t\t// console.log(diameters)\n\n\t\t\t\t// this.diameter_chart_wrapper = new histogram_wrapper(\n\t\t\t\t// \tthis.diameter_chart_container,\n\t\t\t\t// \tdiameters,\n\t\t\t\t// \t{\n\t\t\t\t// \t\txlabel: 'Diameter',\n\t\t\t\t// \t}\n\t\t\t\t// )\n\t\t\t\t// this.diameter_chart_wrapper.render()\n\n\t\t\t\tconst data = {}\n\t\t\t\tfor (const ele of parsed_data) {\n\t\t\t\t\tconst name = ele.ref_type_number\n\t\t\t\t\t// if (!['12', '59', '62', '18','11a','14'].includes(name)) continue\n\t\t\t\t\t// if (!['59', '62'].includes(name)) continue\n\t\t\t\t\tconst tmpData = {}\n\t\t\t\t\tconst calculable = ele.full_coins_reference_calculable\n\t\t\t\t\tconst diameter_max = ele.full_coins_reference_diameter_max\n\t\t\t\t\tconst diameter_min = ele.full_coins_reference_diameter_min\n\t\t\t\t\tconst weight = ele.full_coins_reference_weight\n\t\t\t\t\tif (diameter_max && diameter_max.length) {\n\t\t\t\t\t\ttmpData.diameter_max = diameter_max.filter((v, i) => v && calculable[i])\n\t\t\t\t\t}\n\t\t\t\t\tif (diameter_min && diameter_min.length) {\n\t\t\t\t\t\ttmpData.diameter_min = diameter_min.filter((v, i) => v && calculable[i])\n\t\t\t\t\t}\n\t\t\t\t\tif (weight && weight.length) {\n\t\t\t\t\t\ttmpData.weight = weight.filter((v, i) => v && calculable[i])\n\t\t\t\t\t}\n\t\t\t\t\tif (Object.keys(tmpData).length) {\n\t\t\t\t\t\tdata[name] = tmpData\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tconsole.log(data)\n\n\t\t\t\t// Weights\n\t\t\t\tconst weights = {}\n\t\t\t\tfor (const [name, props] of Object.entries(data)) {\n\t\t\t\t\tif (props.weight && props.weight.length) {\n\t\t\t\t\t\tweights[name] = props.weight\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.weight_chart_wrapper = new boxvio_chart_wrapper(\n\t\t\t\t\tthis.weight_chart_container,\n\t\t\t\t\tweights,\n\t\t\t\t\t{\n\t\t\t\t\t\tylabel: 'Weight',\n\t\t\t\t\t\toverflow: true,\n\t\t\t\t\t\tdisplay_control_panel: true,\n\t\t\t\t\t\tdisplay_download: true,\n\t\t\t\t\t\tsort_xaxis: true,\n\t\t\t\t\t\txticklabel_angle: 65,\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t\tthis.weight_chart_wrapper.render()\n\n\t\t\t\t// Diameters\n\t\t\t\tconst diameters = {}\n\t\t\t\tfor (const [name, props] of Object.entries(data)) {\n\t\t\t\t\tif (props.diameter_max && props.diameter_max.length) {\n\t\t\t\t\t\tdiameters[name] = props.diameter_max\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.diameter_chart_wrapper = new boxvio_chart_wrapper(\n\t\t\t\t\tthis.diameter_chart_container,\n\t\t\t\t\tdiameters,\n\t\t\t\t\t{\n\t\t\t\t\t\tylabel: 'Diameter',\n\t\t\t\t\t\toverflow: true,\n\t\t\t\t\t\tdisplay_control_panel: true,\n\t\t\t\t\t\tdisplay_download: true,\n\t\t\t\t\t\tsort_xaxis: true,\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t\tthis.diameter_chart_wrapper.render()\n\n\t\t\t})\n\n\t},\n\n\t/**\n\t * SEARCH_ROWS\n\t * Call to API and load json data results of search\n\t */\n\tsearch_rows : function(options) {\n\n\t\tconst self = this\n\n\t\t// sort vars\n\t\t\tconst filter\t\t\t= options.filter || null\n\t\t\tconst ar_fields\t\t\t= options.ar_fields || [\"*\"]\n\t\t\tconst order\t\t\t\t= options.order || \"norder ASC\"\n\t\t\tconst lang\t\t\t\t= page_globals.WEB_CURRENT_LANG_CODE\n\t\t\tconst process_result\t= options.process_result || null\n\t\t\tconst limit\t\t\t\t= options.limit != undefined\n\t\t\t\t\t\t\t\t\t\t? options.limit\n\t\t\t\t\t\t\t\t\t\t: 30\n\t\t\n\t\treturn new Promise(function(resolve){\n\t\t\t// parse_sql_filter\n\t\t\t\tconst group = []\n\t\t\t// parsed filters\n\t\t\t\tconst sql_filter = self.form.parse_sql_filter(filter)\n\t\t\t// request\n\t\t\t\tconst request_body = {\n\t\t\t\t\tdedalo_get\t\t: 'records',\n\t\t\t\t\ttable\t\t\t: 'catalog',\n\t\t\t\t\tar_fields\t\t: ar_fields,\n\t\t\t\t\tlang\t\t\t: lang,\n\t\t\t\t\tsql_filter\t\t: sql_filter,\n\t\t\t\t\tlimit\t\t\t: limit,\n\t\t\t\t\tgroup\t\t\t: (group.length>0) ? group.join(\",\") : null,\n\t\t\t\t\tcount\t\t\t: false,\n\t\t\t\t\torder\t\t\t: order,\n\t\t\t\t\tprocess_result\t: process_result\n\t\t\t\t}\n\t\t\t\tdata_manager.request({\n\t\t\t\t\tbody : request_body\n\t\t\t\t})\n\t\t\t\t.then((response)=>{\n\t\t\t\t\t// data parsed\n\t\t\t\t\tconst data = page.parse_catalog_data(response.result)\n\n\t\t\t\t\tresolve(data)\n\t\t\t\t})\n\t\t})\n\n\t},\n\n}//end analysis\n\n"],"mappings":"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"}