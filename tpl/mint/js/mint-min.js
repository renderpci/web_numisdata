"use strict";var mint={set_up:function(e){const t=this,n=e.section_id;return n&&t.get_row_data({section_id:n}).then((function(e){console.log("--\x3e set_up get_row_data API response:",e.result[1]);const n=e.result.find(e=>"mint"===e.id);t.draw_row({target:document.getElementById("row_detail"),ar_rows:n.result}),t.draw_map({map_data:JSON.parse(n.result[0].map),popup_data:{section_id:n.result[0].section_id,title:n.result[0].name,description:n.result[0].history.trim()}});const o=e.result.find(e=>"mint_catalog"===e.id);o.result&&t.get_types_data({section_id:o.result[0].section_id}).then((function(e){t.draw_types({target:document.getElementById("types"),ar_rows:e})}))})),!0},get_row_data:function(e){const t=e.section_id,n=[];n.push({id:"mint",options:{dedalo_get:"records",table:"mints",db_name:page_globals.WEB_DB,lang:page_globals.WEB_CURRENT_LANG_CODE,ar_fields:["section_id","lang","name","place_data","place","history","numismatic_comments","bibliography_data","map"],sql_filter:"section_id = "+parseInt(t),count:!1,resolve_portals_custom:{bibliography_data:"bibliographic_references"}}}),n.push({id:"mint_catalog",options:{dedalo_get:"records",table:"catalog",db_name:page_globals.WEB_DB,lang:page_globals.WEB_CURRENT_LANG_CODE,ar_fields:["section_id","term"],count:!1,limit:0,sql_filter:"term_data='[\""+parseInt(t)+"\"]'"}});return data_manager.request({body:{dedalo_get:"combi",ar_calls:n}})},get_types_data:function(e){const t=this,n=e.section_id;return new Promise((function(e){data_manager.request({body:{dedalo_get:"records",table:"catalog",db_name:page_globals.WEB_DB,lang:page_globals.WEB_CURRENT_LANG_CODE,ar_fields:["section_id","term_data","ref_type_denomination","term","term_table","parent","parents","children","ref_coins_image_obverse","ref_coins_image_reverse"],count:!1,limit:0,order:"norder ASC",sql_filter:"(term_table='types' OR term_table='ts_numismatic_group' OR term_table='ts_period') AND parents LIKE '%\""+parseInt(n)+"\"%'",resolve_portals_custom:{parent:"catalog",children:"catalog"}}}).then((function(n){const o=[];if(n.result&&n.result.length>0)for(let e=0;e<n.result.length;e++){const t={catalog:"MIB",section_id:n.result[e].section_id,original_table_id:n.result[e].term_data.replace(/[\["\]]/g,""),denomination:n.result[e].ref_type_denomination,term_table:n.result[e].term_table,term:n.result[e].term,parent:n.result[e].parent,parents:n.result[e].parents,children:n.result[e].children,ref_coins_image_obverse:n.result[e].ref_coins_image_obverse,ref_coins_image_reverse:n.result[e].ref_coins_image_reverse};o.push(t)}console.log("--\x3e get_types_data types_data:",o);const a=t.parse_types_data(o);e(a)}))}))},parse_types_data:function(e){var t=[];const n=e,o=e.length;for(let e=0;e<o;e++){"ts_period"===(a=n[e]).term_table&&(a.children={},null==t.period?(t.period=[],t.period.push(a)):t.period.push(a))}for(let e=0;e<o;e++){var a=n[e],_=n[e].parent[0];if("ts_numismatic_group"===a.term_table){a.children={};const e=t.period.find(e=>e.section_id===_.section_id);null==e.groups?(e.groups=[],e.groups.push(a)):e.groups.push(a)}}for(let e=0;e<o;e++){a=n[e],_=n[e].parent[0];if("types"===a.term_table)if("ts_period"===_.term_table){const e=t.period.find(e=>e.section_id===_.section_id);null==e.types?(e.types=[],e.types.push(a)):e.types.push(a)}else if("ts_numismatic_group"===_.term_table){const e=t.period.length;for(let n=0;n<e;n++){const e=t.period[n].groups.find(e=>e.section_id===_.section_id);null==e.types?(e.types=[],e.types.push(a)):e.types.push(a)}}}return console.log(t),t},draw_row:function(e){const t=e.ar_rows[0],n=e.target;for(self.row_object=t,!0===SHOW_DEBUG&&console.log("Mint row_object:",t);n.hasChildNodes();)n.removeChild(n.lastChild);const o=new DocumentFragment,a=common.create_dom_element({element_type:"div",class_name:"",parent:o});if(!0===dedalo_logged){common.create_dom_element({element_type:"a",class_name:"section_id go_to_dedalo",text_content:t.section_id,href:"/dedalo/lib/dedalo/main/?t=numisdata6&id="+t.section_id,parent:a}).setAttribute("target","_blank")}if(t.name&&t.name.length>0){const e=common.create_dom_element({element_type:"div",class_name:"line-tittle-wrap",parent:a});common.create_dom_element({element_type:"label",class_name:"value-term",text_content:tstring.name||"Name:",parent:e});const n=t.name;common.create_dom_element({element_type:"div",class_name:"line-tittle",text_content:n,parent:e})}if(t.place&&t.place.length>0){const e=common.create_dom_element({element_type:"div",class_name:"info_line separator",parent:a});common.create_dom_element({element_type:"label",class_name:"big_label",text_content:tstring.place||"Place",parent:e});const n=t.place;common.create_dom_element({element_type:"div",class_name:"info_value",text_content:n,parent:a})}if(t.history&&t.history.length>0){const e=common.create_dom_element({element_type:"div",class_name:"info_line separator",parent:a});common.create_dom_element({element_type:"label",class_name:"big_label",text_content:tstring.history||"History",parent:e});const n=t.history,o=common.create_dom_element({element_type:"div",class_name:"info_text_block",inner_html:n,parent:a});n.length>500&&r(o,a)}if(t.numismatic_comments&&t.numismatic_comments.length>0){const e=common.create_dom_element({element_type:"div",class_name:"info_line separator",parent:a});common.create_dom_element({element_type:"label",class_name:"big_label",text_content:tstring.numismatic_comments||"Numismatic comments",parent:e});const n=t.numismatic_comments,o=common.create_dom_element({element_type:"div",class_name:"info_text_block",inner_html:n,parent:a});n.length>500&&r(o,a)}if(t.bibliography_data&&t.bibliography_data.length>0){const e=common.create_dom_element({element_type:"div",class_name:"info_line separator",parent:a});common.create_dom_element({element_type:"label",class_name:"big_label",text_content:tstring.bibliographic_references||"Bibliographic references",parent:e});const n=t.bibliography_data,o=n.length,s=biblio_row_fields,m=common.create_dom_element({element_type:"div",class_name:"info_text_block",parent:a});for(var _=0;_<o;_++){const e=common.create_dom_element({element_type:"div",class_name:"bibliographic_reference",parent:m}),t=n[_];s.biblio_object=t;const o=s.row_bibliography();e.appendChild(o)}r(m,a)}return n.appendChild(o),n;function r(e,t){e.classList.add("contracted-block");const n=common.create_dom_element({element_type:"div",class_name:"text-block-separator",parent:t}),o=common.create_dom_element({element_type:"div",class_name:"separator-arrow",parent:n});n.addEventListener("click",(function(){e.classList.contains("contracted-block")?(e.classList.remove("contracted-block"),o.style.transform="rotate(-90deg)"):(e.classList.add("contracted-block"),o.style.transform="rotate(90deg)")}))}},draw_types:function(e){const t=this,n=e.target,o=e.ar_rows.period,a=o.length;for(;n.hasChildNodes();)n.removeChild(n.lastChild);const _=new DocumentFragment;common.create_dom_element({element_type:"label",text_content:tstring.tipos||"Types",parent:_});for(let e=0;e<a;e++){const n=o[e];!0===SHOW_DEBUG&&console.log("type row_object:",n);const a=common.create_dom_element({element_type:"div",class_name:"type_row",parent:_});if(!0===dedalo_logged){common.create_dom_element({element_type:"a",class_name:"section_id go_to_dedalo",text_content:n.section_id,href:"/dedalo/lib/dedalo/main/?t=numisdata3&id="+n.section_id,parent:a}).setAttribute("target","_blank")}const r=common.create_dom_element({element_type:"div",class_name:"children_container",parent:_}),s=common.create_dom_element({element_type:"div",class_name:"row_node ts_period",parent:r});if(common.create_dom_element({element_type:"div",class_name:"ts_period",text_content:n.term,parent:s}),null!=n.groups){const e=n.groups.length;for(let o=0;o<e;o++){const e=common.create_dom_element({element_type:"div",class_name:"children_container",parent:s}),a=common.create_dom_element({element_type:"div",class_name:"row_node ts_numismatic_group",parent:e});common.create_dom_element({element_type:"div",class_name:"ts_numismatic_group",text_content:n.groups[o].term,parent:a});const _=t.draw_types_block(n.groups[o].types);a.appendChild(_)}}else{const e=t.draw_types_block(n.types);s.appendChild(e)}}n.appendChild(_)},draw_types_block:function(e){const t=e;console.log(t);const n=t.length,o=common.create_dom_element({element_type:"div",class_name:"types_container"});for(let e=0;e<n;e++){const n=t[e],a=n.term.slice(0,n.term.indexOf(",")),_=common.create_dom_element({element_type:"div",class_name:"type_warp",parent:o}),r=common.create_dom_element({element_type:"div",class_name:"type_number",parent:_});common.create_dom_element({element_type:"p",text_content:"MIB "+a,parent:r}).loading="lazy";const s=common.create_dom_element({element_type:"div",class_name:"types_img",parent:_}),m=common.create_dom_element({element_type:"a",class_name:"image_link",parent:s});common.create_dom_element({element_type:"img",src:common.local_to_remote_path(n.ref_coins_image_obverse),parent:m}).loading="lazy";const l=common.create_dom_element({element_type:"a",class_name:"image_link",parent:s});if(common.create_dom_element({element_type:"img",src:common.local_to_remote_path(n.ref_coins_image_reverse),parent:l}).loading="lazy",null!=n.children){const e=n.children,t=e.length;for(let n=0;n<t;n++){const t=e[n],a=common.create_dom_element({element_type:"div",class_name:"type_warp",parent:o});common.create_dom_element({element_type:"div",class_name:"ts_period",text_content:t.term,parent:a})}}}return o},draw_map:function(e){const t=e.map_data,n=e.popup_data,o=t,a=document.getElementById("map_container");this.map=this.map||new map_factory,this.map.init({map_container:a,map_position:o,popup_builder:page.map_popup_builder,popup_options:page.maps_config.popup_options,source_maps:page.maps_config.source_maps});const _=this.map_data(t,n);return this.map.parse_data_to_map(_,null).then((function(){a.classList.remove("hide_opacity")})),!0},map_data:function(e,t){const n=Array.isArray(e)?e:[e],o=[];for(let e=0;e<n.length;e++){const a={lat:n[e].lat,lon:n[e].lon,marker_icon:page.maps_config.markers.mint,data:t};o.push(a)}return o}};