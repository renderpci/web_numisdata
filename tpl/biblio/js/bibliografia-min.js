"use strict";var bibliografia={set_up:function(e){var t=document.getElementById("search_form");if(t){for(var n=t.querySelectorAll("input.form-control"),a=n.length,o=0;o<a;o++)this.activate_autocomplete(n[o]);this.search_rows({ar_query:[]})}else if("undefined"!=typeof biblio_section_id){var r=[],l={name:"section_id",value:biblio_section_id,search_mode:"string",table:"publicaciones"};r.push(l),this.search_rows({ar_query:r})}return!0},set_value:function(e,t){for(var n=document.getElementById(e.id+"_values"),a=n.querySelectorAll(".input_values"),o=a.length-1;o>=0;o--)if(t===a[o].value)return!1;var r=tpl_common.create_dom_element({element_type:"div",class_name:"line_value",parent:n});return tpl_common.create_dom_element({element_type:"i",class_name:"far fa-trash-alt",parent:r}).addEventListener("click",function(){this.parentNode.remove()}),tpl_common.create_dom_element({element_type:"input",class_name:"input_values",parent:r,data_set:e.dataset}).value=t,!0},activate_autocomplete:function(e){var t=this,n={};return $(e).autocomplete({delay:150,minLength:1,source:function(t,a){var o=t.term;if(o in n)a(n[o]);else{var r=page_globals.__WEB_TEMPLATE_WEB__+"/page/trigger.common.php",l={q:o,mode:e.dataset.mode,q_name:e.dataset.q_name||null,q_table:e.dataset.q_table||null};!0===SHOW_DEBUG&&console.log("trigger_vars:",l),common.get_json_data(r,l).then(function(e){!0===SHOW_DEBUG&&console.log("[activate_autocomplete] response_data",e),a(e.result)},function(e){console.error("[activate_autocomplete] Failed get_json!",e)})}},select:function(e,n){return e.preventDefault(),t.set_value(this,n.item.label),this.value="",!1},focus:function(){return!1},close:function(e,t){},change:function(e,t){},response:function(e,t){}}).on("keydown",function(e){e.keyCode,$.ui.keyCode.ENTER}),!0},search_rows:function(e){var t=page_globals.__WEB_TEMPLATE_WEB__+"/biblio/trigger.biblio.php",n={mode:"search_rows",ar_query:void 0!==e.ar_query?e.ar_query:null,limit:10};!0===SHOW_DEBUG&&console.log("trigger_vars:",n);var a=document.getElementById("biblio_rows_list");a.style.opacity="0.4";common.get_json_data(t,n).then(function(e){!0===SHOW_DEBUG&&console.log("[biblio.search_rows] response:",e),e?biblio.draw_rows({target:"biblio_rows_list",ar_rows:e.result}):console.warn("[tpl_common.search_rows] Error. Received response data is null"),a.style.opacity="1"})},search:function(e,t){t&&t.preventDefault();for(var n=[],a=e.querySelectorAll("input.input_values, input.form-control"),o=a.length,r=0;r<o;r++){var l=a[r];if(l.value.length>0){var _={name:l.dataset.q_name,value:l.value,search_mode:l.dataset.search,table:l.dataset.q_table};n.push(_)}}return console.log("ar_query:",n),this.search_rows({ar_query:n}),!0},draw_rows:function(e){for(var t=document.getElementById(e.target),n=e.ar_rows;t.hasChildNodes();)t.removeChild(t.lastChild);let a=new Intl.Collator("es",{sensitivity:"base",ignorePunctuation:!0});n.sort((e,t)=>{let n=e.autoria+" "+e.fecha_publicacion,o=t.autoria+" "+t.fecha_publicacion;return a.compare(n,o)});for(var o=n.length,r=0;r<o;r++){var l=n[r],_=tpl_common.create_dom_element({element_type:"div",class_name:"biblio_row_wrapper",parent:t,data_set:{section_id:l.section_id}}),i=tpl_common.create_dom_element({element_type:"div",parent:_,class_name:"row_title"});if(l.autoria){for(var c=l.autoria_dato,s=c.length,m=[],u=0;u<s;u++){let e=c[u].apellidos+", "+c[u].nombre;m.push(e)}let e=m.join("; ");var p=tpl_common.create_dom_element({element_type:"div",parent:i,class_name:"autoria info_line"});tpl_common.create_dom_element({element_type:"div",parent:p,class_name:"info_value",text_content:e})}if(l.fecha_publicacion){var d=l.fecha_publicacion.split("-"),v=parseInt(d[0]);d[1],parseInt(d[1])>0&&(v=v+"-"+parseInt(d[1])),d[2],parseInt(d[2])>0&&(v=v+"-"+parseInt(d[2]));p=tpl_common.create_dom_element({element_type:"div",class_name:"fecha_publicacion info_line",parent:_});tpl_common.create_dom_element({element_type:"div",parent:p,class_name:"info_value",text_content:v})}var f=tpl_common.create_dom_element({element_type:"div",parent:_,class_name:"row_body"}),h=l.titulo||"";if(tpl_common.create_dom_element({element_type:"h1",parent:f,text_content:h}),l.series_colecciones||l.numero_serie){var b=[];l.series_colecciones&&b.push(l.series_colecciones),l.numero_serie&&b.push(l.numero_serie),tpl_common.create_dom_element({element_type:"em",parent:f,class_name:"series_colecciones",text_content:b.join(" ")})}var g="";if(l.lugar_publicacion){p=tpl_common.create_dom_element({element_type:"div",parent:f,class_name:"lugar_publicacion info_line"});tpl_common.create_dom_element({element_type:"div",parent:p,class_name:"info_value",text_content:l.lugar_publicacion})}if(l.description_fisica){p=tpl_common.create_dom_element({element_type:"div",parent:f,class_name:"description_fisica info_line"}),g=", ";0==l.lugar_publicacion&&(g=""),tpl_common.create_dom_element({element_type:"div",parent:p,class_name:"info_value",text_content:g+l.description_fisica})}}return!0}};$(function(){bibliografia.set_up()});