"use strict";var mint={set_up:function(e){const t=this,n=e.section_id;return n&&t.get_row_data({section_id:n}).then((function(e){console.log("--\x3e set_up get_row_data API response:",e.result[1]);const n=e.result.find(e=>"mint"===e.id);t.draw_row({target:document.getElementById("row_detail"),ar_rows:n.result}),t.draw_map({mint_map_data:JSON.parse(n.result[0].map),mint_popup_data:{section_id:n.result[0].section_id,title:n.result[0].name,description:n.result[0].history.trim()},place_data:n.result[0].place_data});const a=e.result.find(e=>"mint_catalog"===e.id);if(a.result){const e=a.result.find(e=>"mints"===e.term_table);console.log(e.section_id),t.get_types_data({section_id:e.section_id}).then((function(e){t.draw_types({target:document.getElementById("types"),ar_rows:e})}))}})),!0},get_row_data:function(e){const t=e.section_id,n=[];n.push({id:"mint",options:{dedalo_get:"records",table:"mints",db_name:page_globals.WEB_DB,lang:page_globals.WEB_CURRENT_LANG_CODE,ar_fields:["section_id","lang","name","place_data","place","history","numismatic_comments","bibliography_data","map"],sql_filter:"section_id = "+parseInt(t),count:!1,resolve_portals_custom:{bibliography_data:"bibliographic_references"}}}),n.push({id:"mint_catalog",options:{dedalo_get:"records",table:"catalog",db_name:page_globals.WEB_DB,lang:page_globals.WEB_CURRENT_LANG_CODE,ar_fields:["section_id","term","term_table"],count:!1,limit:0,sql_filter:"term_data='[\""+parseInt(t)+"\"]'"}});return data_manager.request({body:{dedalo_get:"combi",ar_calls:n}})},get_types_data:function(e){const t=this,n=e.section_id;return new Promise((function(e){data_manager.request({body:{dedalo_get:"records",table:"catalog",db_name:page_globals.WEB_DB,lang:page_globals.WEB_CURRENT_LANG_CODE,ar_fields:["section_id","norder","term_data","ref_type_denomination","term","term_table","parent","parents","children","ref_coins_image_obverse","ref_coins_image_reverse","ref_type_averages_diameter","ref_type_averages_weight","ref_type_material","ref_mint_number"],count:!1,limit:0,order:"norder ASC",sql_filter:"(term_table='types' OR term_table='ts_numismatic_group' OR term_table='ts_period') AND parents LIKE '%\""+parseInt(n)+"\"%'",resolve_portals_custom:{parent:"catalog"}}}).then((function(n){const a=[];if(console.log(n),n.result&&n.result.length>0)for(let e=0;e<n.result.length;e++){const t={catalog:"MIB",section_id:n.result[e].section_id,norder:n.result[e].norder,term_data:n.result[e].term_data,denomination:n.result[e].ref_type_denomination,term_table:n.result[e].term_table,term:n.result[e].term,parent:n.result[e].parent,parents:n.result[e].parents,children:n.result[e].children,ref_coins_image_obverse:n.result[e].ref_coins_image_obverse,ref_coins_image_reverse:n.result[e].ref_coins_image_reverse,ref_type_averages_diameter:n.result[e].ref_type_averages_diameter,ref_type_averages_weight:n.result[e].ref_type_averages_weight,ref_type_material:n.result[e].ref_type_material,ref_mint_number:n.result[e].ref_mint_number};a.push(t)}const r=t.parse_types_data(a);e(r)}))}))},parse_types_data:function(e){var t=[];const n=e;n.length;var a=n.filter(e=>"mints"===e.parent[0].term_table);for(let e=0;e<a.length;e++){var r=a[e];r.children={},r.groups=[],null==t.children?(t.children=[],t.children.push(r)):t.children.push(r)}var o=n.filter(e=>"ts_period"===e.parent[0].term_table);for(let e=0;e<o.length;e++){const n=o[e],a=n.parent[0].section_id,r=t.children.findIndex(e=>e.section_id==a);if(r>-1){var _=t.children[r].children;null!=_&&_.length>0||(t.children[r].children=[]),t.children[r].children.push(n)}}for(var l=n.filter(e=>"ts_numismatic_group"===e.parent[0].term_table),s=!1;l.length>0;)for(let e=0;e<l.length;e++){const n=l[e];console.log(n.norder),s=!1,m(t.children,n,t),s&&l.splice(e,1)}var i=n.filter(e=>"types"===e.parent[0].term_table);for(s=!1;i.length>0;)for(let e=0;e<i.length;e++){const n=i[e];s=!1,m(t.children,n,t),s&&i.splice(e,1)}function m(e,t,n){n.section_id==t.parent[0].section_id&&(s=!0,Array.isArray(n.children)||(n.children=[]),n.children.push(t)),Array.isArray(e)&&e.forEach((function(e,n){m(e.children,t,e)}))}return t},draw_row:function(e){const t=e.ar_rows[0],n=e.target;for(self.row_object=t,!0===SHOW_DEBUG&&console.log("Mint row_object:",t);n.hasChildNodes();)n.removeChild(n.lastChild);const a=new DocumentFragment,r=common.create_dom_element({element_type:"div",class_name:"",parent:a});if(!0===dedalo_logged){common.create_dom_element({element_type:"a",class_name:"section_id go_to_dedalo",text_content:t.section_id,href:"/dedalo/lib/dedalo/main/?t=numisdata6&id="+t.section_id,parent:r}).setAttribute("target","_blank")}if(t.name&&t.name.length>0){const e=common.create_dom_element({element_type:"div",class_name:"line-tittle-wrap",parent:r});let n=t.name;if(common.create_dom_element({element_type:"div",class_name:"line-tittle golden-color",text_content:n,parent:e}),t.place&&t.place.length>0){const n="| "+t.place;common.create_dom_element({element_type:"div",class_name:"info_value",text_content:n,parent:e})}}const o=common.create_dom_element({element_type:"div",class_name:"block-expandable",parent:r});let _=0;if(t.history&&t.history.length>0){const e=t.history;_+=e.length;common.create_dom_element({element_type:"div",class_name:"info_text_block",inner_html:e,parent:o})}if(t.numismatic_comments&&t.numismatic_comments.length>0){const e=t.numismatic_comments;_+=e.length;common.create_dom_element({element_type:"div",class_name:"info_text_block",inner_html:e,parent:o})}if(_>220&&s(o,r),t.bibliography_data&&t.bibliography_data.length>0){const e=common.create_dom_element({element_type:"div",class_name:"info_line separator",parent:r});common.create_dom_element({element_type:"label",class_name:"big_label",text_content:tstring.bibliographic_references||"Bibliographic references",parent:e});const n=t.bibliography_data,a=n.length,o=biblio_row_fields,_=common.create_dom_element({element_type:"div",class_name:"info_text_block",parent:r});for(var l=0;l<a;l++){const e=common.create_dom_element({element_type:"div",class_name:"bibliographic_reference",parent:_}),t=n[l];o.biblio_object=t;const a=o.row_bibliography();e.appendChild(a)}s(_,r)}return n.appendChild(a),n;function s(e,t){e.classList.add("contracted-block");const n=common.create_dom_element({element_type:"div",class_name:"text-block-separator",parent:t}),a=common.create_dom_element({element_type:"div",class_name:"separator-arrow",parent:n});n.addEventListener("click",(function(){e.classList.contains("contracted-block")?(e.classList.remove("contracted-block"),a.style.transform="rotate(-90deg)"):(e.classList.add("contracted-block"),a.style.transform="rotate(90deg)")}))}},draw_types:function(e){const t=e.ar_rows,n=e.target;let a=0,r=!1;if(t.children&&t.children.length>0){const e=t.children,l=e.length;for(;n.hasChildNodes();)n.removeChild(n.lastChild);const s=new DocumentFragment,i=tstring.coin_production||"Coin production",m=common.create_dom_element({element_type:"div",class_name:"info_line separator",parent:s});common.create_dom_element({element_type:"label",class_name:"big_label",text_content:i,parent:m});for(let t=0;t<l;t++){const n=e[t];if(!0===dedalo_logged){common.create_dom_element({element_type:"a",class_name:"section_id go_to_dedalo",text_content:n.section_id,href:"/dedalo/lib/dedalo/main/?t=numisdata3&id="+n.section_id,parent:s}).setAttribute("target","_blank")}const a=common.create_dom_element({element_type:"div",class_name:"children_container",parent:s}),r=common.create_dom_element({element_type:"div",class_name:"ts_period period_label",text_content:n.term,parent:a});common.create_dom_element({element_type:"div",class_name:"arrow",parent:r});const l=common.create_dom_element({element_type:"div",class_name:"row_node ts_period period_wrap hide",parent:a}),i=common.create_dom_element({element_type:"div",class_name:"types_container hide deep:",parent:l});common.create_dom_element({element_type:"div",class_name:"type_row",parent:s});_(r,l),_(r,i),null!=n.children&&o(n.children,null,l)}function o(e,t,n){if(null!=t&&(!function(e,t){var n=t;if("ts_numismatic_group"===e.term_table){if(a>1){const e=t.getElementsByClassName("row_node deep:"+(a-1).toString());n=e[e.length-1]}const r=common.create_dom_element({element_type:"div",class_name:"children_container",parent:n}),o=common.create_dom_element({element_type:"div",class_name:"ts_numismatic_group",text_content:e.term,parent:r});common.create_dom_element({element_type:"div",class_name:"arrow",parent:o});const l=common.create_dom_element({element_type:"div",class_name:"types_container hide deep:"+a,parent:r}),s=common.create_dom_element({element_type:"div",class_name:"row_node hide deep:"+a,parent:r});_(o,s),_(o,l)}else if("types"===e.term_table)if(null!=e.children&&e.children.length>0)r=!0;else{let o=t.getElementsByClassName("types_container deep:"+(a-1).toString()),_=a;for(;0==o.length&&_>1;)_-=1,o=t.getElementsByClassName("types_container deep:"+(_-1).toString());if(null==(n=o[o.length-1])){let e=t.getElementsByClassName("types_container");n=e[e.length-1]}let l=!1;"types"===e.parent[0].term_table&&(l=!0);const s=function(e,t){const n=e.parent[0],a=e,o=-1==a.term.indexOf(",")?a.term:a.term.slice(0,a.term.indexOf(",")),_=a.ref_mint_number?a.ref_mint_number+"/":"";let l="",s="",i="",m="",c="";if(null!=a.term_data){const e=a.term_data.replace(/[\["\]]/g,"");m=page_globals.__WEB_ROOT_WEB__+"/type/"+e,c=m}else t=!0;if(t){if(s="MIB "+_+o,i="subType_number",r){m="";let e="";e=-1==n.term.indexOf(",")?n.term:n.term.slice(0,n.term.indexOf(",")),l="MIB "+e}}else l="MIB "+_+o;const d=common.create_dom_element({element_type:"div",class_name:"type_wrap"}),p=common.create_dom_element({element_type:"div",class_name:"type_number",parent:d});common.create_dom_element({element_type:"a",inner_html:l,class_name:"type_label",href:m,parent:p}),common.create_dom_element({element_type:"a",inner_html:s,class_name:"subType_label "+i,href:c,parent:p});const g=common.create_dom_element({element_type:"div",class_name:"types_img gallery",parent:d}),f=common.create_dom_element({element_type:"a",class_name:"image_link",href:common.local_to_remote_path(a.ref_coins_image_obverse),parent:g});common.create_dom_element({element_type:"img",src:common.local_to_remote_path(a.ref_coins_image_obverse),parent:f}).loading="lazy";const u=common.create_dom_element({element_type:"a",class_name:"image_link",href:common.local_to_remote_path(a.ref_coins_image_reverse),parent:g});common.create_dom_element({element_type:"img",src:common.local_to_remote_path(a.ref_coins_image_reverse),parent:u}).loading="lazy";const h=common.create_dom_element({element_type:"div",class_name:"info_wrap",parent:d}),y=[a.ref_type_material,a.denomination,a.ref_type_averages_weight+"g",a.ref_type_averages_diameter+"mm"];return common.create_dom_element({element_type:"p",class_name:"type_info",text_content:y.join(" | "),parent:h}),page.activate_images_gallery(g),d}(e,l);n.appendChild(s),r=!1}}(t,n),null!=t.children&&t.children.sort((function(e,t){return parseInt(e.norder)>parseInt(t.norder)?1:parseInt(e.norder)<parseInt(t.norder)?-1:0}))),Array.isArray(e)){a+=1;for(let t=0;t<e.length;t++)o(e[t].children,e[t],n),e.length-1==t&&(a-=1)}}function _(e,t){const n=e.firstElementChild;e.addEventListener("click",(function(){t.classList.contains("hide")?(t.classList.remove("hide"),n.style.transform="rotate(90deg)"):(t.classList.add("hide"),n.style.transform="rotate(0deg)")}))}n.appendChild(s)}else n.remove()},draw_map:function(e){const t=this,n=e.mint_map_data,a=e.mint_popup_data,r=e.place_data;function o(e){return{section_id:e.section_id,title:e.name,description:""}}t.get_place_data({place_data:r}).then((function(e){const r=n,_=document.getElementById("map_container");t.map=t.map||new map_factory,t.map.init({map_container:_,map_position:r,popup_builder:page.map_popup_builder,popup_options:page.maps_config.popup_options,source_maps:page.maps_config.source_maps,legend:page.render_map_legend});var l=t.map_data(n,a);const s=e.result[0].result;if(s&&s.length>0)for(let e=0;e<s.length;e++){const n=JSON.parse(s[e].map),a=o(s[e]);a.type={},a.type="findspot";const r=t.map_data(n,a);l.push(r[0])}const i=e.result[1].result;if(i&&i.length>0)for(let e=0;e<i.length;e++){const n=JSON.parse(i[e].map),a=o(n[e]);a.type={},a.type="hoard";const r=t.map_data(n,a);console.log(r),l.push(r[0])}console.log(l),t.map.parse_data_to_map(l,null).then((function(){_.classList.remove("hide_opacity")}))}))},get_place_data:function(e){const t="place_data='"+e.place_data+"'";console.log(t);const n=[];n.push({id:"findspots",options:{dedalo_get:"records",table:"findspots",db_name:page_globals.WEB_DB,lang:page_globals.WEB_CURRENT_LANG_CODE,ar_fields:["*"],count:!1,sql_filter:t}}),n.push({id:"hoards",options:{dedalo_get:"records",table:"hoards",db_name:page_globals.WEB_DB,lang:page_globals.WEB_CURRENT_LANG_CODE,ar_fields:["section_id","place_data","name","map"],count:!1,sql_filter:t}});return data_manager.request({body:{dedalo_get:"combi",ar_calls:n}})},map_data:function(e,t){var n=page.maps_config.markers.mint;null!=t.type&&"findspot"===t.type?n=page.maps_config.markers.findspot:null!=t.type&&"hoard"===t.type&&(n=page.maps_config.markers.hoard);const a=Array.isArray(e)?e:[e],r=[];for(let e=0;e<a.length;e++){const o={lat:a[e].lat,lon:a[e].lon,marker_icon:n,data:t};r.push(o)}return r}};