page.parse_type_data=function(e){const r=this;if(Array.isArray(e)){const _=[];for(let a=0;a<e.length;a++)_.push(r.parse_type_data(e[a]));return _}const _=e;return"object"!=typeof _&&(console.log("parse_type_data row:",_),console.trace()),_.parsed||(_.ref_coins_image_obverse=void 0!==e.ref_coins_image_obverse?common.local_to_remote_path(e.ref_coins_image_obverse):null,_.ref_coins_image_reverse=void 0!==e.ref_coins_image_reverse?common.local_to_remote_path(e.ref_coins_image_reverse):null,_.ref_coins_union&&Array.isArray(_.ref_coins_union)&&_.ref_coins_union.length>0&&(_.ref_coins_union=page.parse_coin_data(_.ref_coins_union)),_.uri=r.parse_iri_data(_.uri),_.legend_obverse=_.legend_obverse?r.parse_legend_svg(_.legend_obverse):null,_.legend_reverse=_.legend_reverse?r.parse_legend_svg(_.legend_reverse):null,_.material=_.material?page.trim_char(page.remove_gaps(_.material," | "),"|"):null,_.symbol_obverse=_.symbol_obverse?page.trim_char(page.remove_gaps(_.symbol_obverse," | "),"|"):null,_.symbol_reverse=_.symbol_reverse?page.trim_char(page.remove_gaps(_.symbol_reverse," | "),"|"):null,_.symbol_obverse_data=JSON.parse(_.symbol_obverse_data),_.symbol_reverse_data=JSON.parse(_.symbol_reverse_data),_.parsed=!0),_},page.parse_coin_data=function(e){const r=this;if(Array.isArray(e)){const r=[];for(let _=0;_<e.length;_++)r.push(page.parse_coin_data(e[_]));return r}const _=e;if("object"!=typeof _&&(console.log("parse_coin_data row:",_),console.trace()),_.parsed)return _;if(_.image_obverse=common.local_to_remote_path(e.image_obverse),_.image_obverse_thumb=_.image_obverse?_.image_obverse.replace("/1.5MB/","/thumb/"):null,_.image_reverse=common.local_to_remote_path(e.image_reverse),_.image_reverse_thumb=_.image_reverse?_.image_reverse.replace("/1.5MB/","/thumb/"):null,_.type_data&&Array.isArray(_.type_data)&&_.type_data.length>0&&(_.type_data=r.parse_type_data(_.type_data)),_.type=_.type?page.remove_gaps(_.type," | "):null,_.legend_obverse=_.legend_obverse?r.parse_legend_svg(_.legend_obverse):null,_.legend_reverse=_.legend_reverse?r.parse_legend_svg(_.legend_reverse):null,_.countermark_obverse=_.countermark_obverse?r.parse_legend_svg(_.countermark_obverse):null,_.countermark_reverse=_.countermark_reverse?r.parse_legend_svg(_.countermark_reverse):null,_.ref_auction=_.ref_auction?JSON.parse(_.ref_auction):null,_.ref_auction_date=_.ref_auction_date?JSON.parse(_.ref_auction_date):null,_.ref_auction_number=_.ref_auction_number?JSON.parse(_.ref_auction_number):null,_.ref_auction_group=null,_.ref_auction&&_.ref_auction.length>0){_.ref_auction_group=[];for(let e=0;e<_.ref_auction.length;e++)_.ref_auction_group.push({name:_.ref_auction[e],date:void 0!==_.ref_auction_date[e]?r.parse_date(_.ref_auction_date[e]):"",number:void 0!==_.ref_auction_number[e]?_.ref_auction_number[e]:""})}if(_.ref_related_coin_auction=_.ref_related_coin_auction?JSON.parse(_.ref_related_coin_auction):null,_.ref_related_coin_auction_date=_.ref_related_coin_auction_date?JSON.parse(_.ref_related_coin_auction_date):null,_.ref_related_coin_auction_number=_.ref_related_coin_auction_number?JSON.parse(_.ref_related_coin_auction_number):null,_.ref_related_coin_auction_group=null,_.ref_related_coin_auction&&_.ref_related_coin_auction.length>0){_.ref_related_coin_auction_group=[];for(let e=0;e<_.ref_related_coin_auction.length;e++)_.ref_related_coin_auction_group.push({name:_.ref_related_coin_auction[e],date:void 0!==_.ref_related_coin_auction_date[e]?r.parse_date(_.ref_related_coin_auction_date[e]):"",number:void 0!==_.ref_related_coin_auction_number[e]?_.ref_related_coin_auction_number[e]:""})}return _.find_date=r.parse_date(_.find_date),_.mib_uri=page_globals.__WEB_BASE_URL__+page_globals.__WEB_ROOT_WEB__+"/coin/"+_.section_id,_.uri=r.parse_iri_data(_.uri),_.bibliography_data&&Array.isArray(_.bibliography_data)&&(_.bibliography=page.parse_publication(_.bibliography_data)),_.mint=_.type_dat&&void 0!==_.type_data[0]?_.type_data[0].mint:null,_.type_number=_.type_data&&void 0!==_.type_data[0]?_.type_data[0].number:null,_.parsed=!0,_},page.parse_catalog_data=function(e){const r=this;if(!e)return[];Array.isArray(e)||(e=[e]);const _=[],a=e.length;for(let t=0;t<a;t++){const a=e[t];a.parsed||(a.ref_coins_image_obverse=common.local_to_remote_path(a.ref_coins_image_obverse),a.ref_coins_image_reverse=common.local_to_remote_path(a.ref_coins_image_reverse),a.ref_coins_image_obverse_thumb=a.ref_coins_image_obverse?a.ref_coins_image_obverse.replace("/1.5MB/","/thumb/"):null,a.ref_coins_image_reverse_thumb=a.ref_coins_image_reverse?a.ref_coins_image_reverse.replace("/1.5MB/","/thumb/"):null,a.ref_type_legend_obverse=a.ref_type_legend_obverse?r.parse_legend_svg(a.ref_type_legend_obverse):null,a.ref_type_legend_reverse=a.ref_type_legend_reverse?r.parse_legend_svg(a.ref_type_legend_reverse):null,a.ref_type_symbol_obverse=a.ref_type_symbol_obverse?r.parse_legend_svg(a.ref_type_symbol_obverse):null,a.ref_type_symbol_reverse=a.ref_type_symbol_reverse?r.parse_legend_svg(a.ref_type_symbol_reverse):null,a.term_data=JSON.parse(a.term_data),a.term_section_id=a.term_data?a.term_data[0]:null,a.children=JSON.parse(a.children),a.parent=JSON.parse(a.parent),a.ref_type_averages_diameter=a.ref_type_averages_diameter?parseFloat(a.ref_type_averages_diameter.replace(",",".")):null,a.ref_type_total_diameter_items=a.ref_type_total_diameter_items?parseFloat(a.ref_type_total_diameter_items.replace(",",".")):null,a.ref_type_averages_weight=a.ref_type_averages_weight?parseFloat(a.ref_type_averages_weight.replace(",",".")):null,a.ref_type_total_weight_items=a.ref_type_total_weight_items?parseFloat(a.ref_type_total_weight_items.replace(",",".")):null,a.ref_type_material=page.trim_char(a.ref_type_material,"|"),_.push(a))}for(let r=0;r<a;r++){const a=_[r];if(!a.parsed&&"types"===a.term_table&&a.children){const r=[],_=[];for(let t=0;t<a.children.length;t++){const n=a.children[t],o=e.find(e=>e.section_id==n);if(o&&o.ref_type_averages_weight){const e=o.ref_type_total_weight_items,r=new Array(e).fill(o.ref_type_averages_weight);_.push(...r)}if(o&&o.ref_type_averages_diameter){const e=o.ref_type_total_diameter_items,_=new Array(e).fill(o.ref_type_averages_diameter);r.push(..._)}}const t=_.reduce((e,r)=>e+r,0)/_.length,n=r.reduce((e,r)=>e+r,0)/r.length;a.ref_type_averages_weight=t,a.ref_type_averages_diameter=n,a.ref_type_total_weight_items=_.length,a.ref_type_total_diameter_items=r.length}a.parsed=!0}return _},page.parse_publication=function(e){const r=[],_=e.length;for(let a=0;a<_;a++){const _=e[a];if(_.parsed)continue;_._publications=[];const t=JSON.parse(_.publications_data),n=t.length;if(n>0){const e=page.split_data(_.ref_publications_authors," # "),a=page.split_data(_.ref_publications_date," # "),o=page.split_data(_.ref_publications_editor," # "),s=page.split_data(_.ref_publications_magazine," # "),i=page.split_data(_.ref_publications_place," # "),l=page.split_data(_.ref_publications_title," # "),p=page.split_data(_.ref_publications_url," # ");for(let c=0;c<n;c++){const n=t[c],u={reference:_.section_id,section_id:n,authors:e[c]||null,date:a[c]||null,editor:o[c]||null,magazine:s[c]||null,place:i[c]||null,title:l[c]||null,url:p[c]||null};_._publications.push(u),r.push(u)}}_.parsed=!0}return r},page.parse_map_global_data=function(e){const r=[],_=e.length;for(let a=0;a<_;a++){const _=e[a],t="string"==typeof _.georef_geojson||_.georef_geojson instanceof String?JSON.parse(_.georef_geojson):_.georef_geojson;if(t&&t.length>0){const e=JSON.parse(_.coins_list)||[],a={section_id:_.section_id,title:_.name,description:(tstring.coins||"Coins")+" "+e.length},n={lat:null,lon:null,geojson:t,marker_icon:function(e){let r;switch(e){case"mints":r="mint";break;case"hoards":r="hoard";break;case"findspots":r="findspot"}return page.maps_config.markers[r]}(_.table),data:a};r.push(n)}}return console.log("parse_map_data data:",r),r},page.parse_iri_data=function(e){const r=[];if(!e||e.length<1)return r;const _=e.split(" | ");for(let e=0;e<_.length;e++){const a=_[e].split(", ");if(a.length>1&&void 0===a[1])continue;const t=1===a.length?a[0]:a[1];let n=1===a.length?"":a[0];if(n.length<1)try{n=new URL(t).hostname}catch(e){console.error(e)}r.push({label:n,value:t})}return r};