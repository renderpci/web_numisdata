"use strict";var type={trigger_url:page_globals.__WEB_TEMPLATE_WEB__+"/type/trigger.type.php",search_options:{},map:null,set_up:function(t){const a=this;return console.log("options:",t),void 0!==t.section_id&&a.get_row_data({section_id:t.section_id}).then((function(t){console.log("/// response:",t),console.log("/// row:",t.result[0]);const e=document.getElementById("row_detail");for(;e.hasChildNodes();)e.removeChild(e.lastChild);const o=t.result,i=o.find(t=>"type"===t.id),s=o.find(t=>"catalog"===t.id);i.result[0].catalog=s.result[0];const n=i.result[0];console.log("row:",n);const r=a.list_row_builder(n);e.appendChild(r)})),!0},get_row_data:function(t){const a=t.section_id,e=t.lang||page_globals.WEB_CURRENT_LANG_CODE,o=[];o.push({id:"type",options:{dedalo_get:"records",table:"types",ar_fields:["*"],lang:e,sql_filter:"section_id = "+parseInt(a),resolve_portal:!0,resolve_portals_custom:{bibliography_data:"bibliographic_references",ref_coins_union:"coins","coins.bibliography_data":"bibliographic_references",ref_coins_findspots_data:"findspots","findspots.bibliography_data":"bibliographic_references",ref_coins_hoard_data:"hoards","hoards.bibliography_data":"bibliographic_references"},count:!1}}),o.push({id:"catalog",options:{dedalo_get:"records",table:"catalog",ar_fields:["section_id","term","term_data","term_table","term_section_tipo","parents"],lang:e,sql_filter:"term_data like '%\""+parseInt(a)+"\"%' AND term_table ='types'",resolve_portal:!0,resolve_portals_custom:{parents:"catalog"},count:!1}}),console.log("ar_calls:",o);return data_manager.request({body:{dedalo_get:"combi",ar_calls:o}})},list_row_builder:function(t){const a=this;a.parse_publication(t.bibliography_data);const e=t.ref_coins_union.length;for(let o=0;o<e;o++){const e=t.ref_coins_union[o];a.parse_publication(e.bibliography_data)}const o=t.ref_coins_findspots_data.length;for(let e=0;e<o;e++){const o=t.ref_coins_findspots_data[e];a.parse_publication(o.bibliography_data)}const i=t.ref_coins_hoard_data.length;for(let e=0;e<i;e++){const o=t.ref_coins_hoard_data[e];a.parse_publication(o.bibliography_data)}a.parse_ordered_coins(t),row_fields.caller=a;return row_fields.draw_item(t)},split_data:function(t,a){return t?t.split(a):[]},parse_publication:function(t){const a=this,e=[],o=t.length;for(let i=0;i<o;i++){const o=t[i];o._publications=[];const s=JSON.parse(o.publications_data),n=s.length;if(n>0){const t=a.split_data(o.ref_publications_authors," # "),i=a.split_data(o.ref_publications_date," # "),r=a.split_data(o.ref_publications_editor," # "),l=a.split_data(o.ref_publications_magazine," # "),_=a.split_data(o.ref_publications_place," # "),p=a.split_data(o.ref_publications_title," # "),c=a.split_data(o.ref_publications_url," # ");for(let a=0;a<n;a++){const n=s[a],d={reference:o.section_id,section_id:n,authors:t[a]||null,date:i[a]||null,editor:r[a]||null,magazine:l[a]||null,place:_[a]||null,title:p[a]||null,url:c[a]||null};o._publications.push(d),e.push(d)}}}return e},parse_ordered_coins:function(t){const a=[],e=this.split_data(t.ref_coins_typology_data," | "),o=e.length,i=this.split_data(t.ref_coins_typology," | "),s=this.split_data(t.ref_coins," | ");for(let t=0;t<o;t++){const o={typology_id:JSON.parse(e[t])[0],typology:i[t]||null,coins:JSON.parse(s[t])||null};a.push(o)}return t._coins_group=a,a},render_map:function(t){const a=t.target,e=t.map_data||[],o=t.map_position;o&&(o.zoom=11),this.map=this.map||new map_factory,this.map.init({target:a,map_position:o,source_maps:[{name:"dare",url:"//dh.gu.se/tiles/imperium/{z}/{x}/{y}.png",options:{maxZoom:11},default:!0},{name:"arcgis",url:"//server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",options:{}},{name:"osm",url:"//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",options:{}}]});const i=this.map_data(e);return this.map.render({map_data:i}),!0},map_data:function(t){console.log("--map_data data:",t);const a=[];for(let e=0;e<t.length;e++){const o={lat:t[e].data.lat,lon:t[e].data.lon,data:{section_id:t[e].section_id,name:t[e].name,place:t[e].place,type:t[e].type,items:t[e].items,total_items:t[e].total_items}};a.push(o)}return console.log("--map_data data_clean:",a),a}};