"use strict";var mints={search_options:{},set_up:function(e){const t=this,o=document.getElementById("search_form");if(o){const e=o.querySelectorAll("input.form-control"),n=e.length;for(var a=0;a<n;a++)t.activate_autocomplete(e[a])}return t.search_rows({ar_query:[],limit:10}).then((function(e){t.draw_rows({target:"rows_list",ar_rows:e.result})})),!0},set_value:function(e,t,o){const a=document.getElementById(e.id+"_values"),n=a.querySelectorAll(".input_values");for(var s=n.length-1;s>=0;s--)if(t===n[s].value)return!1;const r=common.create_dom_element({element_type:"div",class_name:"line_value",parent:a});return common.create_dom_element({element_type:"i",class_name:"icon fa-trash",parent:r}).addEventListener("click",(function(){this.parentNode.remove()})),common.create_dom_element({element_type:"input",class_name:"input_values",parent:r,data_set:e.dataset}).value=t,!0},activate_autocomplete:function(e){const t=this;return $(e).autocomplete({delay:150,minLength:0,source:function(o,a){const n=o.term,s=t.trigger_url,r={q:n,mode:e.dataset.mode,q_name:e.dataset.q_name||null,q_search:e.dataset.q_search||e.dataset.q_name,q_table:e.dataset.q_table||null,dd_relations:e.dataset.dd_relations||null};!0===SHOW_DEBUG&&console.log("[mints.activate_autocomplete] trigger_vars:",r),common.get_json_data(s,r).then((function(t){console.log("[mints.activate_autocomplete] response_data",t);const o="fecha_publicacion"===e.id?t.result.map(e=>(e.label=e.label.substring(0,4),e)):t.result;a(o)}),(function(e){console.error("[activate_autocomplete] Failed get_json!",e)}))},select:function(e,o){return e.preventDefault(),t.set_value(this,o.item.label,o.item.value),this.value="",!1},focus:function(){return!1},close:function(e,t){},change:function(e,t){},response:function(e,t){}}).on("keydown",(function(e){e.keyCode===$.ui.keyCode.ENTER&&$(this).autocomplete("close")})).focus((function(){$(this).autocomplete("search",null)})).blur((function(){})),!0},search:function(e,t){t&&t.preventDefault();const o=this,a=[],n=e.querySelectorAll("input.input_values, input.form-control"),s=n.length;for(let e=0;e<s;e++){const t=n[e];if(t.value.length>0){let e=t.value,o=t.dataset.q_name;if(-1!==t.dataset.q_name.indexOf(" AS ")){if(o=t.dataset.q_name.split(" AS ")[1],"authors"===o){const t=/\,/gi;e=e.replace(t,"")}}const n={name:o,value:e,search_mode:t.dataset.search,table:t.dataset.q_table};a.push(n)}}!0===SHOW_DEBUG&&console.log("search.ar_query:",a);const r=e.querySelector('input[name="operators"]:checked').value,l=o.search_rows({ar_query:a,operator:r}).then((function(e){console.log("search response:",e),o.draw_rows({target:"rows_list",ar_rows:e.result})})),i=document.querySelector(".result");return i&&i.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),l},search_rows:function(e){const t=this,o=(void 0!==e.ar_query&&e.ar_query,e.limit||10),a=e.offset||0,n=e.total||!1,s=e.order||"section_id ASC";e.operator;t.search_options=e;const r=document.getElementById("rows_list");r.style.opacity="0.4";const l=["section_id","lang","name","place_data","place","history","numismatic_comments","bibliography_data","map"],i=!n;return new Promise((function(e,n){data_manager.request({body:{dedalo_get:"records",db_name:page_globals.WEB_DB,lang:page_globals.WEB_CURRENT_LANG_CODE,table:"mints",ar_fields:l,sql_filter:null,limit:o,count:i,offset:a,order:s,resolve_portals_custom:{bibliography_data:"bibliographic_references"}}}).then((function(s){SHOW_DEBUG,r.style.opacity="1",s?(t.search_options.total=s.total&&s.total>0?s.total:t.search_options.total,t.search_options.limit=o,t.search_options.offset=a,e(s)):(console.warn("[mints.search_rows] Error. Received response data is null"),n("[mints.search_rows] Error. Received response data is null"))}))}))},draw_rows:function(e){const t=e.target,o=e.ar_rows||[],a=o.length,n=this.search_options.total,s=this.search_options.limit,r=this.search_options.offset,l=document.getElementById(t);for(;l.hasChildNodes();)l.removeChild(l.lastChild);const i=new DocumentFragment,c=common.create_dom_element({element_type:"div",class_name:"pagination top"});c.appendChild(this.draw_paginator({total:n,limit:s,offset:r,count:a})),i.appendChild(c);for(let e=0;e<a;e++){const t=o[e];SHOW_DEBUG;const a=common.create_dom_element({element_type:"div",class_name:"mints_row_wrapper",data_set:{section_id:t.section_id},parent:i}),n=mint_rows;n.row_object=t,a.appendChild(n.name()),a.appendChild(n.place())}const _=common.create_dom_element({element_type:"div",class_name:"pagination bottom"});return _.appendChild(this.draw_paginator({total:n,limit:s,offset:r,count:a})),i.appendChild(_),l.appendChild(i),!0},draw_paginator:function(e){const t=this,o=e.total,a=e.limit,n=e.offset,s=e.count,r=new DocumentFragment,l=paginator.get_full_paginator({total:o,limit:a,offset:n,n_nodes:10,callback:e=>{t.search_options.offset=e.offset,t.search_options.total=e.total;const o=t.search_rows(t.search_options);return o.then((function(e){const o=document.querySelector(".result");o&&o.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"}),t.draw_rows({target:"rows_list",ar_rows:e.result})})),o}});r.appendChild(l),common.create_dom_element({element_type:"div",class_name:"spacer",parent:r});const i=paginator.get_totals_node({total:o,limit:a,offset:n,count:s});return r.appendChild(i),r}};