var analysis_min=function(exports){"use strict";const t=["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#17becf"];function e(t,i){if(this.constructor===e)throw new Error("Abstract class 'chart_wrapper' cannot be instantiated");e._n_charts_created++,this.id=e._n_charts_created,this.div_wrapper=t,this._display_download=i.display_download||!1,this._download_chart_container=void 0,this.plot_container=void 0,this._display_control_panel=i.display_control_panel||!1,this._controls_container=void 0,this._controls_toggle=void 0,this.controls_content_container=void 0}function i(t,n){if(this.constructor===i)throw new Error("Abstract class 'd3_chart_wrapper' cannot be instantiated");e.call(this,t,n),this.svg=void 0,this._overflow=n.overflow||!1,this._outer_height=n.outer_height||"500px"}function n(t){0==t.attr("opacity")?t.transition().attr("opacity",1):t.transition().attr("opacity",0)}function r(t,e,i){const n=(e-t)/(i-1);return d3.range(i).map((e=>t+e*n))}e._n_charts_created=0,e.prototype.id_string=function(){return`chart${this.id}`},e.prototype.render=function(){this.div_wrapper.replaceChildren(),this.render_plot(),this._display_control_panel&&this.render_control_panel(),this._display_download&&this._render_download_panel()},e.prototype._render_download_panel=function(){const t=this.get_supported_export_formats();if(!t.length)return;this.download_chart_container=common.create_dom_element({element_type:"div",id:`${this.id_string()}_download_chart_container`,class_name:"o-purple download_chart_container",parent:this.div_wrapper});const e=common.create_dom_element({element_type:"select",id:`${this.id_string()}_chart_export_format`,class_name:"chart_format_select",parent:this.download_chart_container});for(const i of t)common.create_dom_element({element_type:"option",value:i,text_content:i.toUpperCase(),parent:e});common.create_dom_element({element_type:"input",type:"button",class_name:"btn primary button_download chart",value:tstring.download||"Download",parent:this.download_chart_container}).addEventListener("click",(()=>{this.download_chart(e.value)}))},e.prototype.render_plot=function(){this.plot_container=common.create_dom_element({element_type:"div",id:`${this.id_string()}_plot_container`,class_name:"o-purple plot_container",parent:this.div_wrapper})},e.prototype.render_control_panel=function(){const t=this;this._controls_container=common.create_dom_element({element_type:"div",id:`${this.id_string()}_control_panel`,class_name:"control_panel",parent:this.div_wrapper}),this._controls_toggle=common.create_dom_element({element_type:"div",id:`${this.id_string()}_control_panel_toggle`,text_content:tstring.control_panel||"Control panel",class_name:"o-red control_panel_toggle opened",parent:this._controls_container}),this._controls_toggle.addEventListener("click",(function(){t._controls_toggle.classList.toggle("opened"),t.controls_content_container.classList.toggle("hide")})),this.controls_content_container=common.create_dom_element({element_type:"div",id:`${this.id_string()}_control_panel_content`,class_name:"o-green control_panel_content hide",parent:this._controls_container})},e.prototype.download_chart=function(t){const e=`chart.${t}`,i=`download_chart_as_${t}`;if(void 0===this[i])throw new Error(`${i} is not implemented!`);this[i](e)},e.prototype.get_supported_export_formats=function(){return[]},Object.setPrototypeOf(i.prototype,e.prototype),i.prototype.render_plot=function(){e.prototype.render_plot.call(this),this.svg=d3.select(this.plot_container).append("svg").attr("version","1.1").attr("xmlns","http://www.w3.org/2000/svg"),this._overflow?(this.svg.attr("width",null).attr("height",this._outer_height),this.plot_container.style="overflow: auto;"):this.svg.attr("width","100%")},i.prototype.get_supported_export_formats=function(){return["svg"]},i.prototype.download_chart_as_svg=function(t){const e=this.svg.node().outerHTML,i=new Blob([e],{type:"image/svg+xml;charset=utf-8"}),n=URL.createObjectURL(i),r=common.create_dom_element({element_type:"a",href:n});r.setAttribute("download",t),r.click(),r.remove(),URL.revokeObjectURL(n)};const s={Basis:d3.curveBasis,"Basis closed":d3.curveBasisClosed,"Basis open":d3.curveBasisOpen,Bundle:d3.curveBundle,"Bump X":d3.curveBumpX,"Bump Y":d3.curveBumpY,Cardinal:d3.curveCardinal,"Cardinal closed":d3.curveCardinalClosed,"Cardinal open":d3.curveCardinalOpen,"Catmull-Rom":d3.curveCatmullRom,"Catmull-Rom closed":d3.curveCatmullRomClosed,"Catmull-Rom open":d3.curveCatmullRomOpen,Linear:d3.curveLinear,"Linear closed":d3.curveLinearClosed,"Monotone X":d3.curveMonotoneX,"Monotone Y":d3.curveMonotoneY,Natural:d3.curveNatural,Step:d3.curveStep,"Step after":d3.curveStepAfter,"Step before":d3.curveStepBefore};function o(){}function a(...t){if(!t.length)throw new Error("There are no input arrays");const e=t[0].length;for(const i of t.slice(1))if(i.length!==e)return!1;for(let i=0;i<e;i++){const e=t[0][i];for(const n of t.slice(1))if(n[i]!==e)return!1}return!0}function _(t){this._data=t,this.key_size=t[0].key.length}function l(t,e=null){const i={max:null,upper_fence:null,quartile3:null,median:null,mean:null,iqr:null,quartile1:null,lower_fence:null,min:null};return i.min=d3.min(t),i.quartile1=d3.quantile(t,.25),i.median=d3.median(t),i.mean=d3.mean(t),i.quartile3=d3.quantile(t,.75),i.max=d3.max(t),i.iqr=i.quartile3-i.quartile1,i.lower_fence=e?d3.quantile(t,e[0]/100):i.quartile1-1.5*i.iqr,i.upper_fence=e?d3.quantile(t,e[1]/100):i.quartile3+1.5*i.iqr,i}o.sqrt=function(t){return Math.ceil(Math.sqrt(t.length))},o.sturges=function(t){return Math.ceil(Math.log2(t.length))+1},o.rice=function(t){return Math.ceil(2*Math.pow(t.length,1/3))},o.doane=function(t){const e=t.length;if(e<2)throw new Error("Doane's rule needs at least 2 datapoints");const i=Math.sqrt(6*(e-2)/((e+1)*(e+3))),n=d3.deviation(t),r=d3.mean(t),s=d3.sum(t),o=Math.sqrt(e*(e+1))/(e-2)*((s-e*r)/(e*Math.pow(n,3)));return 1+Math.ceil(Math.log2(e))+Math.ceil(Math.log2(1+Math.abs(o)/i))},o.scott=function(t){if(t.length<2)throw new Error("Cannot compute standard deviation of an array with less than 2 values");return Math.ceil((d3.max(t)-d3.min(t))*Math.pow(t.length,1/3)/(3.49*d3.deviation(t)))},o.freedman_diaconis=function(t){const e=d3.quantile(t,.75),i=d3.quantile(t,.25),n=e-i;if(i===e)throw new Error("IQR is 0!");return Math.ceil((d3.max(t)-d3.min(t))*Math.pow(t.length,1/3)/(2*n))},_.prototype.key_values=function(t){if(t<1||t>this.key_size)throw new Error(`Rank ${t} does not exist in a key of size ${this.key_size}`);const e=this.key_size-t;return Array.from(new Set(this._data.map((t=>t.key[e]))))},_.prototype.query=function(t){if(t.length!==this.key_size)throw new Error("Key template is of different size than the plot keys");return this._data.filter((e=>{const i=e.key;for(let e=0;e<i.length;e++)if(t[e]&&t[e]!==i[e])return!1;return!0}))},_.prototype.get_key_templates=function(t){if(t<1||t>this.key_size)throw new Error(`Invalid rank ${t} for key with size ${this.key_size}`);const e=this.key_size-t,i=this._data.map((t=>t.key.slice(0,e+1).concat(Array(this.key_size-e-1).fill(null))));if(!i.length)return i;const n=[i[0]];let r=i[0];for(const t of i.slice(1))a(r,t)||(n.push(t),r=t);return n},_.prototype.get_next_key_component_values=function(t){const e=t.length;if(e>=this.key_size)throw new Error(`Input key ${t} is as long or longer than the actual keys!`);const i=t.concat(Array(this.key_size-e).fill(null));return Array.from(new Set(this.query(i).map((t=>t.key[e]))))};const c="ch_group_change",h=new Event(c),d=[10,33];function m(e,n,a,c){i.call(this,e,c),this._tooltip_callback=c.tooltip_callback||null,this._tooltip_callback_options_attributes=c.tooltip_callback_options_attributes||null,this._whiskers_quantiles=c.whiskers_quantiles||null;const h=c.sort_xaxis||n[0].key.length>1||!1;if(!n.length)throw new Error("Data array is empty");this._data=h?n.sort(((t,e)=>t.key.join().localeCompare(e.key.join()))):n;for(const[t,e]of this._data.entries())e.metrics=l(e.values,this._whiskers_quantiles),e.outliers=e.values.filter((t=>t<e.metrics.lower_fence||t>e.metrics.upper_fence)),e.extent=d3.extent(e.values);this._data_extent=d3.extent(this._data.map((t=>t.extent)).flat()),this._ids=this._data.map((t=>t.id)),this._key_titles=a,this._kdm=new _(this._data),this._key2_values=this._kdm.key_size>1?this._kdm.key_values(2):null,this._colors=this._data.map(((e,i)=>t[i%t.length])),this._ylabel=c.ylabel||null,this.yaxis_padding=this._ylabel?62:35,this._full_width=this._data.length<150?330.664701211*Math.sqrt(this._data.length)-170.664701211+this.yaxis_padding:26*this._data.length+this.yaxis_padding,this._kdm.key_size>1&&(this._full_width+=this._key2_values.length*d3.sum(d)),this._full_height=453,this._chart={},this._chart.tooltip_active=null,this._chart.margin={top:15,right:4,bottom:61,left:this.yaxis_padding},this._chart.width=this._full_width-this._chart.margin.left-this._chart.margin.right,this._chart.height=this._full_height-this._chart.margin.top-this._chart.margin.bottom,this._chart.yscale=d3.scaleLinear().range([this._chart.height,0]).domain(this._data_extent).clamp(!0),this._chart.yticks_division=2,this._chart.yaxis=d3.axisLeft(this._chart.yscale).tickFormat(((t,e)=>e%this._chart.yticks_division?"":t.toFixed(1))).ticks(19),this._chart.violin_scale={initial:.8,value:.8},this._chart.violin_bandwidth=(this._chart.width-this._key2_values.length*d3.sum(d))/this._data.length,this._chart.box_scale={initial:.3,value:.3},this._chart.xscale=d3.scaleBand().domain(this._ids).range([0,this._chart.width]),this._chart.key2_start_x=this._kdm.key_size>1?this._compute_key2_start_x():null,this._chart.datum_start_x=this._compute_datum_start_x(),this._chart.xaxis=d3.axisBottom(this._chart.xscale).tickFormat((t=>this._data.find((e=>e.id===t)).key[this._kdm.key_size-1])),this._chart.xticklabel_angle=c.xticklabel_angle||0,this._chart.n_bins=this._data.map((t=>{const e=o.sturges(t.values);return{initial:e,value:e}})),this._chart.histogram=this._data.map(((t,e)=>d3.bin().domain(t.extent).thresholds(r(t.extent[0],t.extent[1],this._chart.n_bins[e].value+1)))),this._chart.bins=this._data.map(((t,e)=>this._chart.histogram[e](t.values))),this._chart.supported_curves=["Basis","Bump Y","Cardinal","Catmull-Rom","Linear","Monotone Y","Natural","Step"],this._chart.violin_curve=s[this._chart.supported_curves[0]],this._graphics={root_g:null,yaxwl_g:null,xaxis_g:null,yaxwl_g:null,yaxis_g:null,key2_dividers_g:null,violins_g:null,violins:[],boxes_g:null,outliers:[],whiskers:[],tooltip_div:null},this._controls={max_bins_multiplier:3,selected_index:0,sections:{general:{title:null,content_container:null},specific:{title:null,content_container:null}},grid_select:null,xticklabel_angle_slider:null,curve_select:null,show_checkboxes:{key2:null,violins:null,boxes:null,whiskers:null,outliers:null},scale:{violin:{slider:null,reset:null},box:{slider:null,reset:null}},violin_n_bins:{slider:null,reset:null,reset_all:null}}}function p(t,e,n){if(i.call(this,t,n),this._whiskers_quantiles=n.whiskers_quantiles||null,!e.length)throw new Error("Data array is empty");this._data=e,this._data_extent=d3.extent(e),this._metrics=l(e,this._whiskers_quantiles),this._outliers=e.filter((t=>t<this._metrics.lower_fence||t>this._metrics.upper_fence)),this._full_height=453,this._full_width=195,this._chart={},this._chart.margin={top:10,right:0,bottom:10,left:33},this._chart.width=this._full_width-this._chart.margin.left-this._chart.margin.right,this._chart.height=this._full_height-this._chart.margin.top-this._chart.margin.bottom,this._chart.yscale=d3.scaleLinear().range([this._chart.height,0]).domain(this._data_extent).clamp(!0),this._chart.yaxis=d3.axisLeft(this._chart.yscale).tickFormat((t=>t.toFixed(1))),this._chart.violin_scale=.8,this._chart.box_scale=.3,this._chart.n_bins=o.sturges(this._data),this._chart.histogram=d3.bin().domain(this._data_extent).thresholds(r(this._data_extent[0],this._data_extent[1],this._chart.n_bins+1)),this._chart.bins=this._chart.histogram(this._data),this._chart.violin_curve=s.Basis,this._graphics={root_g:null}}Object.setPrototypeOf(m.prototype,i.prototype),m.prototype._get_next_key_component_values=function(t){const e=t.length;if(e>=this._kdm.key_size)throw new Error(`Input key ${t} is longer than the data keys`);const i=t.concat(Array(this._kdm.key_size-e).fill(null)),n=this._kdm.query(i).map((t=>t.key[e]));if(!n.length)return n;const r=[n[0]];let s=n[0];for(const t of n.slice(1))t!==s&&(r.push(t),s=t);return r},m.prototype._compute_key2_start_x=function(){const t={},e=this._kdm.get_key_templates(2);let i=0;for(const n of e){const e=this._kdm.query(n);t[n[n.length-2]]=i,i+=d3.sum(d)+this._chart.violin_bandwidth*e.length}return t},m.prototype._compute_datum_start_x=function(){if(1===this._kdm.key_size)return this._ids.map((t=>this._chart.xscale(t)));const t=[];let e=d[1],i=this._data[0].key[this._kdm.key_size-2];for(const n of this._data){const r=n.key[this._kdm.key_size-2];i!==r&&(i=r,e+=d3.sum(d)),t.push(e),e+=this._chart.violin_bandwidth}return t},m.prototype.set_violin_scale=function(t){this._chart.violin_scale.value=t,this._graphics.violins_g.selectAll("*").remove(),this._render_violins(!0)},m.prototype.set_n_bins=function(t,e){const i=this._chart,n=this._data[t].extent;i.n_bins[t].value=e,i.histogram[t].thresholds(r(n[0],n[1],e+1)),i.bins[t]=i.histogram[t](this._data[t].values),this._graphics.violins[t].selectAll("*").remove(),this._render_violin(t)},m.prototype.set_violin_curve=function(t){this._chart.violin_curve=s[t],this._graphics.violins_g.selectAll("*").remove(),this._render_violins(!0)},m.prototype.set_box_scale=function(t){this._chart.box_scale.value=t,this._graphics.boxes_g.selectAll("*").remove(),this._render_boxes(!0)},m.prototype.render_plot=function(){i.prototype.render_plot.call(this),this.svg.attr("viewBox",`0 0 ${this._full_width} ${this._full_height}`),this.svg.on("click",(t=>{t.stopPropagation(),this._hide_tooltip()})),this.plot_container.addEventListener("click",(t=>{t.stopPropagation(),this._hide_tooltip()})),this._graphics.root_g=this.svg.append("g").attr("transform",`translate(${this._chart.margin.left},${this._chart.margin.top})`),this._render_axis(),this._render_ygrid(),this._kdm.key_size>1&&this._render_key2_dividers(),this._render_violins(),this._render_boxes(),this._render_tooltip()},m.prototype._render_axis=function(){const t=this._graphics.root_g;this._graphics.xaxwl_g=t.append("g").attr("transform",`translate(0,${this._chart.height})`);const e=this._graphics.xaxwl_g;if(this._graphics.xaxis_g=e.append("g").call(this._chart.xaxis),this._kdm.key_size>1){const t=this._chart.violin_bandwidth/2;this._graphics.xaxis_g.selectAll("g.tick").attr("transform",((e,i)=>`translate(${this._chart.datum_start_x[i]+t},0)`))}this.apply_xticklabel_angle(),e.append("text").attr("text-anchor","middle").attr("y",50).attr("x",this._chart.width/2).text(this._key_titles[this._key_titles.length-1]),this._graphics.yaxwl_g=t.append("g");const i=this._graphics.yaxwl_g;this._graphics.yaxis_g=i.append("g").call(this._chart.yaxis),i.append("text").attr("text-anchor","middle").attr("transform","rotate(-90)").attr("y",20-this._chart.margin.left).attr("x",-this._chart.height/2).text(this._ylabel)},m.prototype.apply_xticklabel_angle=function(){const t=this._chart.xticklabel_angle,e=this._graphics.xaxis_g;t<10?e.selectAll("text").attr("text-anchor","middle").attr("dy","0.8em").attr("dx","0").attr("transform",`rotate(${-this._chart.xticklabel_angle})`):(e.selectAll("text").attr("text-anchor","end").attr("dy",-t*t*6172839e-11+"em").attr("dx","-0.9em").attr("transform",`rotate(${-this._chart.xticklabel_angle})`),t<50&&e.selectAll("text").attr("dx","-0.7em"))},m.prototype._render_ygrid=function(){this._graphics.yaxis_g.selectAll("g.tick").append("line").attr("x1",0).attr("y1",0).attr("x2",this._chart.width).attr("y2",0).attr("stroke",((t,e)=>e%2?"#E0E0E0":"#D1D1D1")).attr("stroke-width",((t,e)=>e%2?.5:.8)).attr("class",((t,e)=>e%2?"minor":"major")).attr("opacity",0)},m.prototype.apply_ygrid_mode=function(t){const e=this._graphics.yaxis_g.selectAll("g.tick line.major"),i=e.attr("opacity"),r=this._graphics.yaxis_g.selectAll("g.tick line.minor"),s=r.attr("opacity");switch(t){case"None":1==i&&n(e),1==s&&n(r);break;case"Major":0==i&&n(e),1==s&&n(r);break;case"Major + Minor":0==i&&n(e),0==s&&n(r);break;default:throw new Error(`Grid mode '${t}' is not supported?`)}},m.prototype._render_key2_dividers=function(){this._graphics.key2_dividers_g=this._graphics.root_g.append("g");const t=this._graphics.key2_dividers_g,e="gray";for(const[i,n]of this._key2_values.entries()){const r=this._chart.key2_start_x[n],s=t.append("g").attr("transform",`translate(${r},0)`);0!==i&&s.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",this._chart.height).attr("stroke",e).attr("stroke-width",.9).attr("stroke-dasharray",this._chart.height/35),s.append("text").attr("text-anchor","end").attr("transform","rotate(-90)").attr("y","1.3em").attr("x","-0.6em").attr("font-size","0.8em").attr("fill",e).text(n)}},m.prototype._render_violins=function(t=!1){const e=this._chart,i=this._graphics.root_g;t||(this._graphics.violins_g=i.append("g"));const n=this._graphics.violins_g;for(let t=0;t<this._data.length;t++)this._graphics.violins[t]=n.append("g").classed("clickable",!0).attr("transform",`translate(${e.datum_start_x[t]},0)`),this._graphics.violins[t].on("click",(e=>{e.stopPropagation(),this.set_selected_index(t)})),this._render_violin(t)},m.prototype._render_violin=function(t){const e=this._chart.bins[t],i=this._chart.violin_scale.value,n=this._chart.violin_bandwidth,r=this._chart.yscale,s=this._chart.violin_curve,o=d3.max(e,(t=>t.length)),a=d3.scaleLinear().range([0,n]).domain([-o,o]);this._data[t].values.length>1&&this._graphics.violins[t].append("path").datum(e).style("stroke","gray").style("stroke-width",.4).style("fill","#d2d2d2").attr("d",d3.area().x0((t=>a(-t.length*i))).x1((t=>a(t.length*i))).y((t=>r(t.x0))).curve(s))},m.prototype._render_boxes=function(t=!1){const e=this._chart,i=this._graphics.root_g;t||(this._graphics.boxes_g=i.append("g"));const n=this._graphics.boxes_g,r=e.violin_bandwidth,s=this._chart.box_scale.value*r;for(const[t,i]of this._data.entries()){const o=i.metrics,a=this._colors[t],_=n.append("g").classed("clickable",!0).attr("transform",`translate(${e.datum_start_x[t]+r/2},0)`);_.on("click",(e=>{e.stopPropagation(),this.set_selected_index(t)})),this._graphics.outliers[t]=_.append("g");const l=this._graphics.outliers[t];for(const t of i.outliers)l.append("circle").attr("cx",0).attr("cy",e.yscale(t)).attr("r",4).style("fill",a).style("opacity",.7);this._graphics.whiskers[t]=_.append("g");const c=this._graphics.whiskers[t];c.append("line").attr("x1",0).attr("y1",e.yscale(o.lower_fence)).attr("x2",0).attr("y2",e.yscale(o.upper_fence)).attr("stroke",a).attr("stroke-width",2),c.append("line").attr("x1",-s/2).attr("y1",e.yscale(o.lower_fence)).attr("x2",s/2).attr("y2",e.yscale(o.lower_fence)).attr("stroke",a).attr("stroke-width",2),c.append("line").attr("x1",-s/2).attr("y1",e.yscale(o.upper_fence)).attr("x2",s/2).attr("y2",e.yscale(o.upper_fence)).attr("stroke",a).attr("stroke-width",2);const h=_.append("g");i.values.length>1&&h.append("rect").attr("x",-s/2).attr("y",e.yscale(o.quartile3)).attr("width",s).attr("height",e.yscale(o.quartile1)-e.yscale(o.quartile3)).attr("fill",a),h.append("line").attr("x1",-s/2).attr("y1",e.yscale(o.median)).attr("x2",s/2).attr("y2",e.yscale(o.median)).attr("stroke","black").attr("stroke-width",3);const d=h.append("circle").attr("cx",0).attr("cy",e.yscale(o.median)).attr("r",4.5).style("fill","white").attr("stroke","black").attr("stroke-width",2).classed("clickable",!0);this.tooltip_active=null,d.on("click",(e=>{e.stopPropagation(),this.set_selected_index(t),this.tooltip_active!=t&&(this.tooltip_hover(t),this._graphics.tooltip_div.style("display","flex"),this.tooltip_active=t)}))}},m.prototype.set_selected_index=function(t){this._controls.selected_index!==t&&(this._controls.selected_index=t,this._set_specific_controls_section_title(t),this._controls.violin_n_bins.slider.dispatchEvent(h))},m.prototype._set_specific_controls_section_title=function(t){const e=this._data[t];this._controls.sections.specific.title.innerText=`${tstring.settings_for||"Settings for"} ${e.key.join(", ")} (${e.id})`},m.prototype._hide_tooltip=function(){this._graphics.tooltip_div.style("display","none"),this.tooltip_active=null},m.prototype._render_tooltip=function(){const t=common.create_dom_element({element_type:"div",id:`${this.id_string()}_tooltip_div`,class_name:"o-red tooltip_div"});var e,i;e=t,(i=this.plot_container).parentNode.insertBefore(e,i.nextSibling),this._graphics.tooltip_div=d3.select(t),this._hide_tooltip();const n=common.create_dom_element({element_type:"div",id:`${this.id_string()}_tooltip_metrics`,class_name:"tooltip_metrics_div",parent:t});common.create_dom_element({element_type:"div",id:`${this.id_string()}_tooltip_metric_names_div`,class_name:"tooltip_metric_names_div",parent:n}),common.create_dom_element({element_type:"div",id:`${this.id_string()}_tooltip_metric_values_div`,class_name:"tooltip_metric_values_div",parent:n})},m.prototype.tooltip_hover=function(t){const e=this;e._data[t].key;const i=e._data[t].values,n=e._data[t].metrics,r=`${tstring.datapoints||"Datapoints"}<br>${tstring.mean||"Mean"}<br>${tstring.max||"Maximum"}`+(e._whiskers_quantiles?`<br>${tstring.quantile}-${e._whiskers_quantiles[1]}`:"")+`<br>${tstring.quantile||"Quantile"}-75`+`<br>${tstring.median||"Median"}`+`<br>${tstring.quantile||"Quantile"}-25`+(e._whiskers_quantiles?`<br>${tstring.quantile}-${e._whiskers_quantiles[0]}`:"")+`<br>${tstring.min||"Minimum"}`,s=`${i.length}<br>${n.mean.toFixed(2)}<br>${n.max.toFixed(2)}`+(e._whiskers_quantiles?`<br>${n.upper_fence.toFixed(2)}`:"")+`<br>${n.quartile3.toFixed(2)}`+`<br>${n.median.toFixed(2)}`+`<br>${n.quartile1.toFixed(2)}`+(e._whiskers_quantiles?`<br>${n.lower_fence.toFixed(2)}`:"")+`<br>${n.min.toFixed(2)}`;if(e._graphics.tooltip_div.select("div.tooltip_metric_names_div").html(r),e._graphics.tooltip_div.select("div.tooltip_metric_values_div").html(s),e._tooltip_callback){const i={};for(const e of this._tooltip_callback_options_attributes)i[e]=this._data[t][e];e._tooltip_callback(i).then((t=>{const i=e._graphics.tooltip_div.node();t.id=`${e.id_string()}_tooltip_callback_div`,t.classList.add("tooltip_callback_div");const n=i.lastChild;n.classList.contains("tooltip_callback_div")&&n.remove(),i.appendChild(t)}))}},m.prototype.render_control_panel=function(){i.prototype.render_control_panel.call(this),this._controls.sections.general.title=common.create_dom_element({element_type:"div",text_content:tstring.general_settings||"General settings",class_name:"control_panel_toggle control_panel_toggle_section",parent:this.controls_content_container}),this._controls.sections.general.content_container=common.create_dom_element({element_type:"div",parent:this.controls_content_container});const t=common.create_dom_element({element_type:"div",class_name:"control_panel_item controls_block",parent:this._controls.sections.general.content_container});this._render_grid_select(t),this._render_xticklabel_angle_slider(t),this._render_violin_curve_selector(t),this._render_checkboxes(),this._render_scale_sliders(),this._controls.sections.specific.title=common.create_dom_element({element_type:"div",class_name:"control_panel_toggle control_panel_toggle_section",parent:this.controls_content_container}),this._set_specific_controls_section_title(this._controls.selected_index),this._controls.sections.specific.content_container=common.create_dom_element({element_type:"div",parent:this.controls_content_container}),this._render_n_bins_control(),this._control_panel_logic()},m.prototype._render_grid_select=function(t){const e=common.create_dom_element({element_type:"div",parent:t}),i=`${this.id_string()}_grid_select`;common.create_dom_element({element_type:"label",text_content:tstring.grid||"Grid",parent:e,style:{"margin-block":"auto"}}).setAttribute("for",i);const n=common.create_dom_element({element_type:"select",id:i,parent:e});this._controls.grid_select=n,common.create_dom_element({element_type:"option",value:"None",text_content:tstring.none_f||"None",parent:n}),common.create_dom_element({element_type:"option",value:"Major",text_content:tstring.major||"Major",parent:n}),common.create_dom_element({element_type:"option",value:"Major + Minor",text_content:tstring.major_minor||"Major + Minor",parent:n})},m.prototype._render_xticklabel_angle_slider=function(t){const e=common.create_dom_element({element_type:"div",parent:t}),i=`${this.id_string()}_xticklabel_angle_slider`;common.create_dom_element({element_type:"label",text_content:tstring.xticklabel_angle||"X-Tick label angle",parent:e}).setAttribute("for",i);const n=common.create_dom_element({element_type:"input",type:"range",id:i,parent:e});this._controls.xticklabel_angle_slider=n,n.setAttribute("min",0),n.setAttribute("max",90),n.value=this._chart.xticklabel_angle},m.prototype._render_violin_curve_selector=function(t){const e=common.create_dom_element({element_type:"div",parent:t}),i=`${this.id_string()}_curve_select`;common.create_dom_element({element_type:"label",text_content:tstring.violin_curve||"Violin curve",parent:e}).setAttribute("for",i);const n=common.create_dom_element({element_type:"select",id:i,parent:e});this._controls.curve_select=n;for(const t of this._chart.supported_curves)common.create_dom_element({element_type:"option",value:t,text_content:t,parent:n})},m.prototype._render_checkboxes=function(){const t=common.create_dom_element({element_type:"div",class_name:"control_panel_item checkboxes",parent:this._controls.sections.general.content_container});common.create_dom_element({element_type:"div",text_content:`${tstring.show||"Show"}:`,parent:t});const e=common.create_dom_element({element_type:"div",parent:t}),i=`${this.id_string()}_show_key2_checkbox`,n=common.create_dom_element({element_type:"input",type:"checkbox",id:i,parent:e});n.checked=!0,this._controls.show_checkboxes.key2=n;common.create_dom_element({element_type:"label",text_content:this._key_titles[this._kdm.key_size-2],parent:e}).setAttribute("for",i);const r=common.create_dom_element({element_type:"div",parent:t}),s=`${this.id_string()}_show_violins_checkbox`,o=common.create_dom_element({element_type:"input",type:"checkbox",id:s,parent:r});o.checked=!0,this._controls.show_checkboxes.violins=o;common.create_dom_element({element_type:"label",text_content:tstring.violins||"Violins",parent:r}).setAttribute("for",s);const a=common.create_dom_element({element_type:"div",parent:t}),_=`${this.id_string()}_show_boxes_checkbox`,l=common.create_dom_element({element_type:"input",type:"checkbox",id:_,parent:a});l.checked=!0,this._controls.show_checkboxes.boxes=l;common.create_dom_element({element_type:"label",text_content:tstring.boxes||"Boxes",parent:a}).setAttribute("for",_);const c=common.create_dom_element({element_type:"div",parent:t}),h=`${this.id_string()}_show_whiskers_checkbox`,d=common.create_dom_element({element_type:"input",type:"checkbox",id:h,parent:c});d.checked=!0,this._controls.show_checkboxes.whiskers=d;common.create_dom_element({element_type:"label",text_content:tstring.whiskers||"Whiskers",parent:c}).setAttribute("for",h);const m=common.create_dom_element({element_type:"div",parent:t}),p=`${this.id_string()}_show_outliers_checkbox`,u=common.create_dom_element({element_type:"input",type:"checkbox",id:p,parent:m});u.checked=!0,this._controls.show_checkboxes.outliers=u;common.create_dom_element({element_type:"label",text_content:tstring.outliers||"Outliers",parent:m}).setAttribute("for",p)},m.prototype._render_scale_sliders=function(){const t=common.create_dom_element({element_type:"div",parent:this._controls.sections.general.content_container,class_name:"control_panel_item scale_sliders"}),e=common.create_dom_element({element_type:"div",parent:t}),i=`${this.id_string()}_violin_scale_slider`;common.create_dom_element({element_type:"label",text_content:tstring.violin_width||"Violin width",parent:e}).setAttribute("for",i);const n=common.create_dom_element({element_type:"input",type:"range",id:i,parent:e});n.setAttribute("min",0),n.setAttribute("max",1),n.setAttribute("step",.05),n.value=this._chart.violin_scale.initial,this._controls.scale.violin.slider=n,this._controls.scale.violin.reset=common.create_dom_element({element_type:"button",type:"button",class_name:"small",text_content:tstring.reset||"Reset",parent:e});const r=common.create_dom_element({element_type:"div",parent:t}),s=`${this.id_string()}_box_scale_slider`;common.create_dom_element({element_type:"label",text_content:tstring.box_width||"Box width",parent:r}).setAttribute("for",s);const o=common.create_dom_element({element_type:"input",type:"range",id:s,parent:r});o.setAttribute("min",0),o.setAttribute("max",1),o.setAttribute("step",.05),o.value=this._chart.box_scale.initial,this._controls.scale.box.slider=o,this._controls.scale.box.reset=common.create_dom_element({element_type:"button",type:"button",class_name:"small",text_content:tstring.reset||"Reset",parent:r})},m.prototype._render_n_bins_control=function(){const t=common.create_dom_element({element_type:"div",parent:this._controls.sections.specific.content_container,class_name:"control_panel_item n_bins_control"}),e=`${this.id_string()}_violin_n_bins_slider`;common.create_dom_element({element_type:"label",text_content:tstring.violin_resolution||"Violin resolution",parent:t}).setAttribute("for",e);const i=common.create_dom_element({element_type:"input",type:"range",id:e,parent:t});this._controls.violin_n_bins.slider=i,i.setAttribute("min",2),i.setAttribute("max",this._controls.max_bins_multiplier*this._chart.n_bins[this._controls.selected_index].initial),i.value=this._chart.n_bins[this._controls.selected_index].value,this._controls.violin_n_bins.reset=common.create_dom_element({element_type:"button",type:"button",class_name:"small",text_content:tstring.reset||"Reset",parent:t}),this._controls.violin_n_bins.reset_all=common.create_dom_element({element_type:"button",type:"button",class_name:"small",text_content:tstring.reset_all_violins||"Reset all violins",parent:t})},m.prototype._control_panel_logic=function(){this._controls.sections.general.title.addEventListener("click",(()=>{this._controls.sections.general.title.classList.toggle("opened"),this._controls.sections.general.content_container.classList.toggle("hide")})),this._controls.grid_select.addEventListener("change",(()=>{const t=this._controls.grid_select.value;this.apply_ygrid_mode(t)})),this._controls.xticklabel_angle_slider.addEventListener("input",(()=>{this._chart.xticklabel_angle=Number(this._controls.xticklabel_angle_slider.value),this.apply_xticklabel_angle()})),this._controls.curve_select.addEventListener("change",(()=>{this.set_violin_curve(this._controls.curve_select.value)})),this._controls.show_checkboxes.key2.addEventListener("change",(()=>{n(this._graphics.key2_dividers_g)})),this._controls.show_checkboxes.violins.addEventListener("change",(()=>{n(this._graphics.violins_g)})),this._controls.show_checkboxes.boxes.addEventListener("change",(()=>{n(this._graphics.boxes_g)})),this._controls.show_checkboxes.whiskers.addEventListener("change",(()=>{for(const t of this._graphics.whiskers)n(t)})),this._controls.show_checkboxes.outliers.addEventListener("change",(()=>{for(const t of this._graphics.outliers)n(t)})),this._controls.scale.violin.slider.addEventListener("input",(()=>{this.set_violin_scale(Number(this._controls.scale.violin.slider.value))})),this._controls.scale.violin.reset.addEventListener("click",(()=>{this._controls.scale.violin.slider.value=this._chart.violin_scale.initial,this.set_violin_scale(Number(this._controls.scale.violin.slider.value))})),this._controls.scale.box.slider.addEventListener("input",(()=>{this.set_box_scale(Number(this._controls.scale.box.slider.value))})),this._controls.scale.box.reset.addEventListener("click",(()=>{
this._controls.scale.box.slider.value=this._chart.box_scale.initial,this.set_box_scale(Number(this._controls.scale.box.slider.value))})),this._controls.sections.specific.title.addEventListener("click",(()=>{this._controls.sections.specific.title.classList.toggle("opened"),this._controls.sections.specific.content_container.classList.toggle("hide")}));const t=this._controls.violin_n_bins.slider;t.addEventListener("input",(()=>{this.set_n_bins(this._controls.selected_index,Number(t.value))})),t.addEventListener(c,(()=>{t.setAttribute("max",this._controls.max_bins_multiplier*this._chart.n_bins[this._controls.selected_index].initial),t.value=this._chart.n_bins[this._controls.selected_index].value})),this._controls.violin_n_bins.reset.addEventListener("click",(()=>{t.value=this._chart.n_bins[this._controls.selected_index].initial,this.set_n_bins(this._controls.selected_index,Number(t.value))})),this._controls.violin_n_bins.reset_all.addEventListener("click",(()=>{t.value=this._chart.n_bins[this._controls.selected_index].initial;for(const[t,e]of this._chart.n_bins.entries())this.set_n_bins(t,e.initial)}))},Object.setPrototypeOf(p.prototype,i.prototype),p.prototype.render_plot=function(){i.prototype.render_plot.call(this),this.svg.attr("viewBox",`0 0 ${this._full_width} ${this._full_height}`),this._graphics.root_g=this.svg.append("g").attr("transform",`translate(${this._chart.margin.left},${this._chart.margin.top})`),this._render_y_axis(),this._render_violin(),this._render_box()},p.prototype._render_y_axis=function(){this._graphics.root_g.append("g").call(this._chart.yaxis)},p.prototype._render_violin=function(){const t=this._chart.bins,e=this._chart.violin_scale,i=this._chart.yscale,n=this._chart.violin_curve,r=this._graphics.root_g.append("g"),s=d3.max(t,(t=>t.length)),o=d3.scaleLinear().range([0,this._chart.width]).domain([-s,s]);this._data.length<=1||r.append("path").datum(t).style("stroke","gray").style("stroke-width",.4).style("fill","#d2d2d2").attr("d",d3.area().x0((t=>o(-t.length*e))).x1((t=>o(t.length*e))).y((t=>i(t.x0))).curve(n))},p.prototype._render_box=function(){const e=this._chart.yscale,i=t[0],n=this._metrics,r=this._chart.box_scale*this._chart.width,s=this._graphics.root_g.append("g").attr("transform",`translate(${this._chart.width/2},0)`),o=s.append("g");for(const t of this._outliers)o.append("circle").attr("cx",0).attr("cy",e(t)).attr("r",4).style("fill",i).style("opacity",.7);const a=s.append("g");a.append("line").attr("x1",0).attr("y1",e(n.lower_fence)).attr("x2",0).attr("y2",e(n.upper_fence)).attr("stroke",i).attr("stroke-width",2),a.append("line").attr("x1",-r/2).attr("y1",e(n.lower_fence)).attr("x2",r/2).attr("y2",e(n.lower_fence)).attr("stroke",i).attr("stroke-width",2),a.append("line").attr("x1",-r/2).attr("y1",e(n.upper_fence)).attr("x2",r/2).attr("y2",e(n.upper_fence)).attr("stroke",i).attr("stroke-width",2);const _=s.append("g");this._data.length>1&&_.append("rect").attr("x",-r/2).attr("y",e(n.quartile3)).attr("width",r).attr("height",e(n.quartile1)-e(n.quartile3)).attr("fill",i),_.append("line").attr("x1",-r/2).attr("y1",e(n.median)).attr("x2",r/2).attr("y2",e(n.median)).attr("stroke","black").attr("stroke-width",3),_.append("circle").attr("cx",0).attr("cy",e(n.median)).attr("r",4.5).style("fill","white").attr("stroke","black").attr("stroke-width",2)};const u=100,g=[6,15];function y(t,e,n){i.call(this,t,n);const r=n.sort||e[0].key.length>1||!1;this._data=r?e.sort(((t,e)=>t.key.join().localeCompare(e.key.join()))):e,this._kdm=new _(this._data),this._key2_values=this._kdm.key_size>1?this._kdm.key_values(2):null,this._width=this._compute_width(),this._height=114,this._chart={},this._chart.key2_start_x=this._kdm.key_size>1?this._compute_key2_start_x():null,this._chart.datum_start_x=this._compute_datum_start_x(),this._graphics={root_g:null,key2_dividers_g:null,datum_g:null}}Object.setPrototypeOf(y.prototype,i.prototype),y.prototype._compute_width=function(){const t=this._data.length;if(1==this._kdm.key_size)return u*t+6*(t-1);let e=this._key2_values.length*d3.sum(g)-g[0];for(const t of this._key2_values){const i=this._kdm.get_next_key_component_values([t]).length;e+=i*u+6*(i-1)}return e},y.prototype._compute_key2_start_x=function(){const t={},e=this._kdm.get_key_templates(2);let i=0;for(const n of e){const e=this._kdm.query(n);t[n[n.length-2]]=i,i+=d3.sum(g)+e.length*u+6*(e.length-1)}return t},y.prototype._compute_datum_start_x=function(){if(1===this._kdm.key_size)return Array(this._data.length).map(((t,e)=>106*e));const t=[];let e=g[1],i=this._data[0].key[this._kdm.key_size-2];for(const n of this._data){const r=n.key[this._kdm.key_size-2];i!==r&&(i=r,e+=d3.sum(g)-6),t.push(e),e+=106}return t},y.prototype.render_plot=function(){i.prototype.render_plot.call(this),this.svg.attr("viewBox",`0 0 ${this._width} ${this._height}`),this._graphics.root_g=this.svg.append("g"),this._kdm.key_size>1&&this._render_key2_dividers(),this._graphics.datum_g=this._graphics.root_g.append("g");for(let t=0;t<this._data.length;t++)this._render_datum(t)},y.prototype._render_key2_dividers=function(){this._graphics.key2_dividers_g=this._graphics.root_g.append("g");const t=this._graphics.key2_dividers_g,e="gray";for(const[i,n]of this._key2_values.entries()){const i=this._chart.key2_start_x[n],r=t.append("g").attr("transform",`translate(${i},0)`);r.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",this._height).attr("stroke",e).attr("stroke-width",.9).attr("stroke-dasharray",this._height/35),r.append("text").attr("text-anchor","end").attr("transform","rotate(-90)").attr("y","1.3em").attr("x","-0.6em").attr("font-size","0.3em").attr("fill",e).text(n)}},y.prototype._render_datum=function(t){const e=this._data[t],i=this._graphics.datum_g.append("g").attr("transform",`translate(${this._chart.datum_start_x[t]},0)`);this._render_handles(i,e.values),this._render_label(i,e)},y.prototype._render_handles=function(t,e){const i=2*Math.PI/e.length;let n=Math.PI/2;const r=d3.max(e),s=d3.scaleLinear().domain([0,r]).range([0,50]),o=t.append("g").attr("transform","translate(50,50)");for(const t of e){const e=o.append("g");e.append("line").attr("x1",0).attr("y1",0).attr("x2",s(r)*Math.cos(n)).attr("y2",-s(r)*Math.sin(n)).attr("stroke","#e3e3e3").attr("stroke-width",.6),e.append("line").attr("x1",0).attr("y1",0).attr("x2",s(t)*Math.cos(n)).attr("y2",-s(t)*Math.sin(n)).attr("stroke","black").attr("stroke-width",1),n-=i}o.append("circle").style("fill","black").attr("r",2.5)},y.prototype._render_label=function(t,e){const i=t.append("g").attr("transform","translate(50,100)"),n=e.key[this._kdm.key_size-1],r=e.id;i.append("text").attr("text-anchor","middle").attr("y","1.5em").attr("font-size","0.25em").attr("fill","black").text(n),i.append("text").attr("text-anchor","middle").attr("y","3.2em").attr("font-size","0.2em").attr("fill","black").text(`(ID: ${r})`)};const f={form:null,area_name:null,row:null,export_data_container:null,form_items_container:null,weight_chart_container:null,diameter_chart_container:null,clock_chart_container:null,weight_chart_wrapper:null,diameter_chart_wrapper:null,clock_chart_wrapper:null,set_up:function(t){const e=this;e.area_name=t.area_name,e.export_data_container=t.export_data_container,e.row=t.row,e.form_items_container=t.form_items_container,e.weight_chart_container=t.weight_chart_container,e.diameter_chart_container=t.diameter_chart_container,e.clock_chart_container=t.clock_chart_container;const i=e.render_form();return e.form_items_container.appendChild(i),!0},render_form:function(){const t=this,e=new DocumentFragment;t.form=t.form||new form_factory;const i=common.create_dom_element({element_type:"div",class_name:"form-row fields",parent:e});t.form.item_factory({id:"mint",name:"mint",label:tstring.mint||"mint",q_column:"p_mint",value_wrapper:['["','"]'],eq:"LIKE",eq_in:"%",eq_out:"%",is_term:!0,parent:i,callback:function(e){t.form.activate_autocomplete({form_item:e,table:"catalog"})}}),t.form.item_factory({id:"number",name:"number",q_column:"term",q_table:"types",label:tstring.number_key||"Number & Key",is_term:!1,parent:i,group_op:"$or",callback:function(e){t.form.activate_autocomplete({form_item:e,table:"catalog"})}}),t.form.item_factory({id:"material",name:"material",q_column:"ref_type_material",q_table:"any",label:tstring.material||"material",is_term:!1,parent:i,callback:function(e){t.form.activate_autocomplete({form_item:e,table:"catalog"})}}),t.form.item_factory({id:"denomination",name:"denomination",q_column:"ref_type_denomination",q_table:"any",label:tstring.denomination||"denomination",is_term:!1,parent:i,callback:function(e){t.form.activate_autocomplete({form_item:e,table:"catalog"})}}),t.form.item_factory({id:"culture",name:"culture",label:tstring.culture||"culture",q_column:"p_culture",value_wrapper:['["','"]'],eq_in:"%",eq_out:"%",is_term:!0,parent:i,callback:function(e){t.form.activate_autocomplete({form_item:e,table:"catalog"})}}),t.form.item_factory({id:"iconography_obverse",name:"iconography_obverse",label:tstring.iconography_obverse||"iconography obverse",q_column:"ref_type_design_obverse_iconography",value_split:" | ",q_splittable:!0,q_selected_eq:"LIKE",eq_in:"%",eq_out:"%",is_term:!1,parent:i,callback:function(e){t.form.activate_autocomplete({form_item:e,table:"catalog"})}}),t.form.item_factory({id:"iconography_reverse",name:"iconography_reverse",label:tstring.iconography_reverse||"iconography reverse",q_column:"ref_type_design_reverse_iconography",value_split:" | ",q_splittable:!0,q_selected_eq:"LIKE",eq_in:"%",eq_out:"%",is_term:!1,parent:i,callback:function(e){t.form.activate_autocomplete({form_item:e,table:"catalog"})}}),t.form.item_factory({id:"range_slider",name:"range_slider",input_type:"range_slider",label:tstring.period||"Period",class_name:"range_slider",q_column:"ref_date_in,ref_date_end",sql_filter:null,parent:i,callback:function(e){const i=e.node_input,n=i.parentNode.querySelector("#range_slider_in"),r=i.parentNode.querySelector("#range_slider_out");t.get_catalog_range_years().then((function(t){$(i).slider("instance")&&$(i).slider("destroy"),e.sql_filter=null,n.value=t.min,n.addEventListener("change",(function(e){const n=e.target.value>=t.min?e.target.value:t.min;$(i).slider("values",0,n),e.target.value=n})),r.value=t.max,r.addEventListener("change",(function(e){const n=e.target.value<=t.max?e.target.value:t.max;$(i).slider("values",1,e.target.value),e.target.value=n})),$(i).slider({range:!0,min:t.min,max:t.max,step:1,values:[t.min,t.max],slide:function(t,e){n.value=e.values[0],r.value=e.values[1]},change:function(t,i){e.sql_filter="(ref_date_in >= "+i.values[0]+" AND ref_date_in <= "+i.values[1]+")",e.q=i.value}})}))}});const n=common.create_dom_element({element_type:"div",class_name:"form-group field button_submit",parent:e});common.create_dom_element({element_type:"input",type:"submit",id:"submit",value:tstring.search||"Search",class_name:"btn btn-light btn-block primary",parent:n}).addEventListener("click",(function(e){e.preventDefault(),t.form_submit(s)}));common.create_dom_element({element_type:"input",type:"button",id:"button_reset",value:tstring.reset||"Reset",class_name:"btn btn-light btn-block secondary button_reset",parent:n}).addEventListener("click",(function(t){t.preventDefault(),window.location.replace(window.location.pathname)}));const r=t.form.build_operators_node();e.appendChild(r);const s=common.create_dom_element({element_type:"form",id:"search_form",class_name:"form-inline"});return s.appendChild(e),s},form_submit:function(t,e={}){const i=this;"boolean"!=typeof e.scroll_result||e.scroll_result;const n=e.form_items||i.form.form_items,r=i.form.build_filter({form_items:n});if(!r||r.length<1)return!1;const s={weight:document.getElementById("weight_section"),diameter:document.getElementById("diameter_section"),clock:document.getElementById("clock_section")};for(const[t,e]of Object.entries(s))e.classList.add("hide");i.diameter_chart_container.replaceChildren(),i.weight_chart_container.replaceChildren(),i.clock_chart_container.replaceChildren();const o=document.getElementById("result"),a=common.create_dom_element({element_type:"div",class_name:"spinner",parent:o});return i.search_rows({filter:r,limit:0,process_result:{fn:"process_result::add_parents_and_children_recursive",columns:[{name:"parents"}]}}).then((t=>{event_manager.publish("form_submit",t);const e=[];for(const[i,n]of t.entries()){const t=n.section_id,r=n.ref_type_number?n.ref_type_number:`Missing Number & Key (${i})`,s=n.p_mint?n.p_mint[0]:`Missing mint (${n.section_id})`,o=n.ref_type_material?n.ref_type_material:`Missing material (${i})`,a=n.ref_type_denomination?n.ref_type_denomination:`Missing denomination ${i}`,_={},l=n.full_coins_reference_calculable,c=n.full_coins_reference_diameter_max,h=n.full_coins_reference_diameter_min,d=n.full_coins_reference_weight,m=n.full_coins_reference_axis;if(c&&c.length){const t=c.filter(((t,e)=>t&&l[e]));t.length&&(_.diameter_max=t)}if(h&&h.length){const t=h.filter(((t,e)=>t&&l[e]));t.length&&(_.diameter_min=t)}if(d&&d.length){const t=d.filter(((t,e)=>t&&l[e]));t.length&&(_.weight=t)}if(m&&m.length){const t=m.filter((t=>t));t.length&&(_.axis=t)}Object.keys(_).length&&(_.section_id=t,_.number_key=r,_.mint=s,_.type_number=r,_.material=o,_.denomination=a,e.push(_))}const i=e.filter((t=>t.weight)).map((t=>({key:[t.mint,t.number_key],values:t.weight,id:t.section_id,mint:t.mint,type_number:t.number_key}))),n=e.filter((t=>t.diameter_max)).map((t=>({key:[t.mint,t.number_key],values:t.diameter_max,id:t.section_id,mint:t.mint,type_number:t.number_key}))),r=e.filter((t=>t.axis&&t.axis.length)).map((t=>{const e=Array(12).fill(0);for(const i of t.axis)e[i%12]++;return{key:[t.mint,t.number_key],values:e,id:t.section_id}}));a.remove(),i.length&&(s.weight.classList.remove("hide"),this.weight_chart_wrapper=new m(this.weight_chart_container,i,[tstring.mint||"Mint",tstring.number||"Number"],{whiskers_quantiles:[10,90],ylabel:tstring.weight||"Weight",overflow:!0,display_control_panel:!0,display_download:!0,sort_xaxis:!0,tooltip_callback:v,tooltip_callback_options_attributes:["id","type_number","mint"]}),this.weight_chart_wrapper.render()),n.length&&(s.diameter.classList.remove("hide"),this.diameter_chart_wrapper=new m(this.diameter_chart_container,n,[tstring.mint||"Mint",tstring.number||"Number"],{whiskers_quantiles:[10,90],ylabel:tstring.diameter||"Diameter",overflow:!0,display_control_panel:!0,display_download:!0,sort_xaxis:!0,tooltip_callback:v,tooltip_callback_options_attributes:["id","type_number","mint"]}),this.diameter_chart_wrapper.render()),r.length&&(s.clock.classList.remove("hide"),this.clock_chart_wrapper=new y(this.clock_chart_container,r,{overflow:!0,outer_height:"300px",display_download:!0}),this.clock_chart_wrapper.render())}))},search_rows:function(t){const e=this,i=t.filter||null,n=t.ar_fields||["*"],r=t.order||"norder ASC",s=page_globals.WEB_CURRENT_LANG_CODE,o=t.process_result||null,a=null!=t.limit?t.limit:100;return new Promise((function(t){const _=[],l=e.form.parse_sql_filter(i),c={dedalo_get:"records",table:"catalog",ar_fields:n,lang:s,sql_filter:l,limit:a,group:_.length>0?_.join(","):null,count:!1,order:r,process_result:o};data_manager.request({body:c}).then((e=>{const i=page.parse_catalog_data(e.result);t(i)}))}))},get_catalog_range_years:function(){return new Promise((function(t){const e={dedalo_get:"records",db_name:page_globals.WEB_DB,lang:page_globals.WEB_CURRENT_LANG_CODE,table:"catalog",ar_fields:["id","section_id","MIN(ref_date_in + 0) AS min","MAX(ref_date_in + 0) AS max"],limit:0,count:!1,offset:0,order:"id ASC"};data_manager.request({body:e}).then((function(e){let i=0,n=0;if(e.result)for(let t=0;t<e.result.length;t++){const r=e.result[t],s=parseInt(r.min);(0===i||s<i)&&(i=s);n=parseInt(r.max)}t({min:i,max:n})}))}))}};async function v(t){const e=t.id,i=t.type_number,n=t.mint,r={dedalo_get:"records",lang:page_globals.WEB_CURRENT_LANG_CODE,table:"catalog",ar_fields:["*"],section_id:e,limit:1,count:!1},s=(await data_manager.request({body:r})).result||null;if(!s)return common.create_dom_element({element_type:"div",text_content:`Could not find number ${i} for mint ${n} in the database.`});const o=page.parse_catalog_data(s)[0];o.add_denomination=!0;const a=catalog_row_fields.draw_item(o);return a.getElementsByClassName("coins_images")[0].removeAttribute("style"),a}return exports.analysis=f,Object.defineProperty(exports,"__esModule",{value:!0}),exports}({});
//# sourceMappingURL=analysis-min.js.map