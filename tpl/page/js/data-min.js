"use strict";page.parse_type_data=function(e){const r=this;if(Array.isArray(e)){const t=[];for(let _=0;_<e.length;_++)t.push(r.parse_type_data(e[_]));return t}const t=e;if("object"!=typeof t&&(console.log("parse_type_data row:",t),console.trace()),t.parsed)return t;try{t.ref_coins_image_obverse=void 0!==e.ref_coins_image_obverse?common.local_to_remote_path(e.ref_coins_image_obverse):null,t.ref_coins_image_reverse=void 0!==e.ref_coins_image_reverse?common.local_to_remote_path(e.ref_coins_image_reverse):null,t.ref_coins_union&&Array.isArray(t.ref_coins_union)?t.ref_coins_union=page.parse_coin_data(t.ref_coins_union):t.ref_coins_union=t.ref_coins_union?JSON.parse(t.ref_coins_union):null,t.coin_references&&Array.isArray(t.coin_references)?t.coin_references=page.parse_coin_data(t.coin_references):t.coin_references=t.coin_references?JSON.parse(t.coin_references):null,t.uri=r.parse_iri_data(t.uri),t.legend_obverse=t.legend_obverse?r.parse_legend_svg(t.legend_obverse):null,t.legend_reverse=t.legend_reverse?r.parse_legend_svg(t.legend_reverse):null,t.material=t.material?page.trim_char(page.remove_gaps(t.material," | "),"|"):null,t.symbol_obverse=t.symbol_obverse?page.trim_char(page.remove_gaps(t.symbol_obverse," | "),"|"):null,t.symbol_reverse=t.symbol_reverse?page.trim_char(page.remove_gaps(t.symbol_reverse," | "),"|"):null,t.symbol_obverse_data=JSON.parse(t.symbol_obverse_data),t.symbol_reverse_data=JSON.parse(t.symbol_reverse_data),t.term_data=t.term_data?JSON.parse(t.term_data):null,t.term_section_tipo=t.term_section_tipo?JSON.parse(t.term_section_tipo):null,t.term_section_label=t.term_section_label?JSON.parse(t.term_section_label):null,t.parsed=!0}catch(e){console.error("ERROR CATCH ",e),console.warn("row:",t)}return t},page.parse_mint_data=function(e){if(Array.isArray(e)){const r=[];for(let t=0;t<e.length;t++)r.push(page.parse_mint_data(e[t]));return r}const r=e;return"object"!=typeof r&&(console.log("parse_mint_data row:",r),console.trace()),!r||r.parsed,r},page.parse_hoard_data=function(e){if(Array.isArray(e)){const r=[];for(let t=0;t<e.length;t++)r.push(page.parse_hoard_data(e[t]));return r}const r=e;return"object"!=typeof r&&(console.log("parse_hoard_data row:",r),console.trace()),!r||r.parsed,r},page.parse_coin_data=function(e){const r=this;if(Array.isArray(e)){const r=[];for(let t=0;t<e.length;t++)r.push(page.parse_coin_data(e[t]));return r}const t=e;if("object"!=typeof t&&(console.log("parse_coin_data row:",t),console.trace()),!t||t.parsed)return t;try{if(t.image_obverse=t.image_obverse?common.local_to_remote_path(e.image_obverse):null,t.image_obverse_thumb=t.image_obverse?t.image_obverse.replace("/1.5MB/","/thumb/"):null,t.image_reverse=t.image_reverse?common.local_to_remote_path(e.image_reverse):null,t.image_reverse_thumb=t.image_reverse?t.image_reverse.replace("/1.5MB/","/thumb/"):null,t.type_data&&Array.isArray(t.type_data)?(t.type_data=r.parse_type_data(t.type_data),t.mint=t.type_data&&void 0!==t.type_data[0]?t.type_data[0].mint:null,t.type_number=t.type_data&&void 0!==t.type_data[0]?t.type_data[0].number:null,t.type_section_id=t.type_data&&void 0!==t.type_data[0]?t.type_data[0].section_id:null):(t.type_data=t.type_data?JSON.parse(t.type_data):null,t.type_section_id=t.type_data&&void 0!==t.type_data[0]?t.type_data[0]:null),t.type=t.type?page.remove_gaps(t.type," | "):null,t.legend_obverse=t.legend_obverse?r.parse_legend_svg(t.legend_obverse):null,t.legend_reverse=t.legend_reverse?r.parse_legend_svg(t.legend_reverse):null,t.countermark_obverse=t.countermark_obverse?r.parse_legend_svg(t.countermark_obverse):null,t.countermark_reverse=t.countermark_reverse?r.parse_legend_svg(t.countermark_reverse):null,t.ref_auction=t.ref_auction?JSON.parse(t.ref_auction):null,t.ref_auction_date=t.ref_auction_date?JSON.parse(t.ref_auction_date):null,t.ref_auction_number=t.ref_auction_number?JSON.parse(t.ref_auction_number):null,t.ref_auction_group=null,t.ref_auction&&t.ref_auction.length>0){t.ref_auction_group=[];for(let e=0;e<t.ref_auction.length;e++)t.ref_auction_group.push({name:t.ref_auction[e],date:void 0!==t.ref_auction_date[e]?r.parse_date(t.ref_auction_date[e]):"",number:void 0!==t.ref_auction_number[e]?t.ref_auction_number[e]:""})}if(t.ref_related_coin_auction=t.ref_related_coin_auction?JSON.parse(t.ref_related_coin_auction):null,t.ref_related_coin_auction_date=t.ref_related_coin_auction_date?JSON.parse(t.ref_related_coin_auction_date):null,t.ref_related_coin_auction_number=t.ref_related_coin_auction_number?JSON.parse(t.ref_related_coin_auction_number):null,t.ref_related_coin_auction_group=null,t.ref_related_coin_auction&&t.ref_related_coin_auction.length>0){t.ref_related_coin_auction_group=[];for(let e=0;e<t.ref_related_coin_auction.length;e++)t.ref_related_coin_auction_group.push({name:t.ref_related_coin_auction[e],date:void 0!==t.ref_related_coin_auction_date[e]?r.parse_date(t.ref_related_coin_auction_date[e]):"",number:void 0!==t.ref_related_coin_auction_number[e]?t.ref_related_coin_auction_number[e]:""})}t.find_date=r.parse_date(t.find_date),t.mib_uri=page_globals.__WEB_BASE_URL__+page_globals.__WEB_ROOT_WEB__+"/coin/"+t.section_id,t.uri=r.parse_iri_data(t.uri),t.bibliography_data&&Array.isArray(t.bibliography_data)&&(t.bibliography=page.parse_publication(t.bibliography_data)),t.parsed=!0}catch(e){console.error("ERROR CATCH ",e),console.warn("row:",t)}return t},page.parse_catalog_data=function(e){const r=this;if(!e)return[];Array.isArray(e)||(e=[e]);const t=[];try{const a=e.length;for(let n=0;n<a;n++){const a=e[n];a.parsed||(a.coins_data_union=a.coins_data_union?JSON.parse(a.coins_data_union):null,a.coin_references=a.coin_references?JSON.parse(a.coin_references):null,a.ref_coins_image_obverse=common.local_to_remote_path(a.ref_coins_image_obverse),a.ref_coins_image_reverse=common.local_to_remote_path(a.ref_coins_image_reverse),a.ref_coins_image_obverse_thumb=a.ref_coins_image_obverse?a.ref_coins_image_obverse.replace("/1.5MB/","/thumb/"):null,a.ref_coins_image_reverse_thumb=a.ref_coins_image_reverse?a.ref_coins_image_reverse.replace("/1.5MB/","/thumb/"):null,a.ref_type_legend_obverse=a.ref_type_legend_obverse?r.parse_legend_svg(a.ref_type_legend_obverse):null,a.ref_type_legend_reverse=a.ref_type_legend_reverse?r.parse_legend_svg(a.ref_type_legend_reverse):null,a.ref_type_symbol_obverse=a.ref_type_symbol_obverse?r.parse_legend_svg(a.ref_type_symbol_obverse):null,a.ref_type_symbol_reverse=a.ref_type_symbol_reverse?r.parse_legend_svg(a.ref_type_symbol_reverse):null,a.term_data=JSON.parse(a.term_data),a.term_section_id=a.term_data?a.term_data[0]:null,a.children=JSON.parse(a.children),a.parent=a.parent&&Array.isArray(a.parent)?(_=a.parent,page.parse_catalog_data(_)):JSON.parse(a.parent),a.ref_type_averages_diameter=a.ref_type_averages_diameter?parseFloat(a.ref_type_averages_diameter.replace(",",".")):null,a.ref_type_total_diameter_items=a.ref_type_total_diameter_items?parseFloat(a.ref_type_total_diameter_items.replace(",",".")):null,a.ref_type_averages_weight=a.ref_type_averages_weight?parseFloat(a.ref_type_averages_weight.replace(",",".")):null,a.ref_type_total_weight_items=a.ref_type_total_weight_items?parseFloat(a.ref_type_total_weight_items.replace(",",".")):null,a.ref_type_material=page.trim_char(a.ref_type_material,"|"),a.term_section_label=a.term_section_label?JSON.parse(a.term_section_label):null,a.term_section_tipo=a.term_section_tipo?JSON.parse(a.term_section_tipo):null,a.p_mint=a.p_mint?JSON.parse(a.p_mint):null,a.p_period=a.p_period?JSON.parse(a.p_period):null,a.p_territory=a.p_territory?JSON.parse(a.p_territory):null,a.parents=a.parents?JSON.parse(a.parents):null,a.parents_text=a.parents_text?JSON.parse(a.parents_text):null,a.p_culture=a.p_culture?JSON.parse(a.p_culture):null,t.push(a))}for(let r=0;r<a;r++){const _=t[r];if(!_.parsed&&"types"===_.term_table&&_.children){const r=[],t=[];for(let a=0;a<_.children.length;a++){const n=_.children[a],o=e.find(e=>e.section_id==n);if(o&&o.ref_type_averages_weight){const e=o.ref_type_total_weight_items,r=new Array(e).fill(o.ref_type_averages_weight);t.push(...r)}if(o&&o.ref_type_averages_diameter){const e=o.ref_type_total_diameter_items,t=new Array(e).fill(o.ref_type_averages_diameter);r.push(...t)}}const a=t.reduce((e,r)=>e+r,0)/t.length,n=r.reduce((e,r)=>e+r,0)/r.length;_.ref_type_averages_weight=a,_.ref_type_averages_diameter=n,_.ref_type_total_weight_items=t.length,_.ref_type_total_diameter_items=r.length}_.parsed=!0}}catch(e){console.error("ERROR CATCH ",e),console.warn("new_data:",t)}var _;return t},page.parse_publication=function(e){const r=[];try{if(!e)return e;const t=" # ",_=e.length;for(let a=0;a<_;a++){const _=e[a];if(_.parsed)continue;_._publications=[];const n=_.publications_data?JSON.parse(_.publications_data):[],o=n.length;if(o>0){const e=page.split_data(_.ref_publications_authors,t),a=page.split_data(_.ref_publications_date,t),s=page.split_data(_.ref_publications_editor,t),i=page.split_data(_.ref_publications_magazine,t),l=page.split_data(_.ref_publications_place,t),p=page.split_data(_.ref_publications_title,t),c=page.split_data(_.ref_publications_url,t);for(let t=0;t<o;t++){const o=n[t],d={reference:_.section_id,section_id:o,authors:e[t]||null,date:a[t]||null,editor:s[t]||null,magazine:i[t]||null,place:l[t]||null,title:p[t]||null,url:c[t]||null};_._publications.push(d),r.push(d)}}_.parsed=!0}}catch(r){console.error("ERROR CATCH ",r),console.warn("data:",e)}return r},page.parse_map_global_data=function(e){try{const r=e.length;for(let t=0;t<r;t++){const r=e[t];if(!r.parsed){if(r.georef_geojson=r.georef_geojson?JSON.parse(r.georef_geojson):null,r.coins_list=r.coins_list?JSON.parse(r.coins_list):[],r.types_list=r.types_list?JSON.parse(r.types_list):[],r.georef_geojson&&r.georef_geojson.length>0){const e=function(e){let r;switch(e){case"mints":r="mint";break;case"hoards":r="hoard";break;case"findspots":r="findspot"}return r}(r.table),t=r.coins_list?r.coins_list.length:0,_=r.types_list?r.types_list.length:0,a='<span class="note">'+(tstring[e]||e)+"</span> "+r.name,n=(tstring.coins||"Coins")+" "+t+"<br>"+(tstring.types||"Types")+" "+_,o={section_id:r.section_id,title:a,coins_total:t,types_total:_,description:n,ref_section_id:r.ref_section_id,ref_section_tipo:r.ref_section_tipo,table:r.table,name:r.name,term_id:r.section_id},s=page.maps_config.markers[e],i={lat:null,lon:null,geojson:r.georef_geojson,marker_icon:s,data:o};r.item=i}else r.item=null;r.parsed=!0}}}catch(r){console.error("ERROR CATCH ",r),console.warn("ar_rows:",e)}return e},page.parse_iri_data=function(e){const r=[];if(!e||e.length<1)return r;const t=e.split(" | ");for(let e=0;e<t.length;e++){const _=t[e].split(", ");if(_.length>1&&void 0===_[1])continue;const a=1===_.length?_[0]:_[1];let n=1===_.length?"":_[0];if(n.length<1)try{n=new URL(a).hostname}catch(e){console.error(e)}r.push({label:n,value:a})}return r},page.parse_ts_web=function(e){Array.isArray(e)||(e=[e]);for(let r=0;r<e.length;r++){const t=e[r];!0!==t.parsed&&(t.cuerpo=t.cuerpo?t.cuerpo.replaceAll("../../../media",page_globals.__WEB_MEDIA_BASE_URL__+"/dedalo/media"):null,t.entradilla=t.entradilla?t.entradilla.replaceAll("../../../media",page_globals.__WEB_MEDIA_BASE_URL__+"/dedalo/media"):null,t.parsed=!0)}return e},page.parse_tree_data=function(e,r){console.log("ar_rows:",e);const t=[],_=["parent","childrens","space","mib_bibliography"];function a(e){for(let t=_.length-1;t>=0;t--){const a=_[t];e[a]=(r=e[a])?JSON.parse(r):null}var r;return e}const n=e.length;for(let r=0;r<n;r++){const _=a(e[r]);t.push(_)}const o=[];for(let e=n-1;e>=0;e--){const r=t[e];!(!r.parent||!r.parent[0])&&r.parent[0]||(console.warn("Ignored undefined parent_term_id:",r.term_id,r),o.push(r.term_id))}o.length>0&&console.warn("term_id_to_remove:",o);const s=t.filter(e=>-1===o.indexOf(e.term_id));for(let e=0;e<s.length;e++){const t=s[e];if(r&&(-1!==r.indexOf(t.term_id)||t.nd_term_id&&-1!==r.indexOf(t.nd_term_id))&&(t.hilite=!0),r)if(-1!==r.indexOf(t.term_id))t.hilite=!0;else if(t.nd_term_id)for(let e=0;e<t.nd_term_id.length;e++)if(-1!==r.indexOf(t.nd_term_id[e])){t.hilite=!0;break}!0===t.hilite&&i(s,t,!1)}function i(e,r,t){const _=r.parent[0],a=e.find(e=>e.term_id===_);a&&(a.status="opened",i(e,a,!0))}return s};