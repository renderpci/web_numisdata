"use strict";var type={search_options:{},map:null,set_up:function(t){const e=this;return!0===SHOW_DEBUG&&console.log("type set_up options:",t),void 0!==t.section_id&&e.get_row_data({section_id:t.section_id}).then((function(t){console.log("/// response:",t);const a=document.getElementById("row_detail");for(;a.hasChildNodes();)a.removeChild(a.lastChild);const o=t.result.find(t=>"type"===t.id),i=t.result.find(t=>"catalog"===t.id);if(void 0!==o.result[0]){o.result[0].catalog=i.result[0];const t=page.parse_type_data(o.result[0]);e.list_row_builder(t).then((function(t){a.appendChild(t);const e=t.querySelectorAll(".gallery");if(e)for(let t=0;t<e.length;t++)page.activate_images_gallery(e[t])}))}})),!0},get_row_data:function(t){const e=t.section_id,a=t.lang||page_globals.WEB_CURRENT_LANG_CODE,o=[];o.push({id:"type",options:{dedalo_get:"records",table:"types",ar_fields:["*"],lang:a,sql_filter:"section_id = "+parseInt(e),count:!1,resolve_portals_custom:{bibliography_data:"bibliographic_references",ref_coins_union:"coins","coins.bibliography_data":"bibliographic_references",ref_coins_findspots_data:"findspots","findspots.bibliography_data":"bibliographic_references",ref_coins_hoard_data:"hoards","hoards.bibliography_data":"bibliographic_references",denomination_data:"denomination",material_data:"material"}}}),o.push({id:"catalog",options:{dedalo_get:"records",table:"catalog",ar_fields:["section_id","term","term_data","term_table","term_section_tipo","parents"],lang:a,count:!1,sql_filter:"term_data='[\""+parseInt(e)+"\"]' AND term_table='types'",resolve_portals_custom:{parents:"catalog"}}});return data_manager.request({body:{dedalo_get:"combi",ar_calls:o}})},list_row_builder:function(t){const e=this;return new Promise((function(a){e.parse_publication(t.bibliography_data);const o=t.ref_coins_union.length;for(let a=0;a<o;a++){const o=t.ref_coins_union[a];e.parse_publication(o.bibliography_data)}const i=t.ref_coins_findspots_data.length;for(let a=0;a<i;a++){const o=t.ref_coins_findspots_data[a];e.parse_publication(o.bibliography_data)}const n=t.ref_coins_hoard_data.length;for(let a=0;a<n;a++){const o=t.ref_coins_hoard_data[a];e.parse_publication(o.bibliography_data)}e.parse_ordered_coins(t),row_fields.caller=e;a(row_fields.draw_item(t))}))},parse_publication:function(t){return page.parse_publication(t)},parse_ordered_coins:function(t){const e=[],a=page.split_data(t.ref_coins_typology_data," | "),o=a.length,i=page.split_data(t.ref_coins_typology," | "),n=page.split_data(t.ref_coins," | ");for(let t=0;t<o;t++){const o={typology_id:JSON.parse(a[t])[0],typology:i[t]||null,coins:JSON.parse(n[t])||null};e.push(o)}return t._coins_group=e,e},draw_map:function(t){const e=t.map_data,a=t.container,o=t.map_position,i=t.popup_data;this.map=this.map||new map_factory,this.map.init({map_container:a,map_position:o,popup_builder:this.map_popup_builder,popup_options:page.maps_config.popup_options,source_maps:page.maps_config.source_maps});const n=this.map_data(e,i);return this.map.parse_data_to_map(n,null).then((function(){a.classList.remove("hide_opacity")})),!0},map_data:function(t){const e=[];for(let a=0;a<t.length;a++){const o={lat:parseFloat(t[a].data.lat),lon:parseFloat(t[a].data.lon),marker_icon:t[a].marker_icon||null,data:{section_id:t[a].section_id,name:t[a].name,place:t[a].place,type:t[a].type,items:t[a].items,total_items:t[a].total_items}};e.push(o)}return e},map_popup_builder:function(t){const e=t.group[0],a=e.name,o=e.total_items,i=e.section_id,n=common.create_dom_element({element_type:"div",class_name:"popup_wrapper"}),s=common.create_dom_element({element_type:"div",class_name:"popup_item",title:i,parent:n}),_=(common.create_dom_element({element_type:"div",class_name:"text_title",inner_html:a,parent:s}),tstring.total+" "+tstring.items+": "+o);common.create_dom_element({element_type:"div",class_name:"text_description",inner_html:_,parent:s});return n}};