"use strict";var hoards={form:null,pagination:null,list:null,form_node:null,form_container:null,rows_container:null,table:null,set_up:function(e){const t=this;t.form_container=e.form_container,t.rows_container=e.rows_container,t.table=e.table,t.form=new form_factory;const n=t.render_form();return t.form_container.appendChild(n),t.pagination={total:null,limit:10,offset:0,n_nodes:8},event_manager.subscribe("paginate",(function(e){t.pagination.offset=e,t.form_submit()})),t.form_submit(),!0},render_form:function(){const e=this,t=new DocumentFragment,n=common.create_dom_element({element_type:"div",class_name:"form-row fields",parent:t});e.form.item_factory({id:"section_id",name:"section_id",label:tstring.id||"ID",q_column:"section_id",eq:"=",eq_in:"",eq_out:"",parent:n}),e.form.item_factory({id:"name",name:"name",label:tstring.name||"Name",q_column:"name",eq:"LIKE",eq_in:"%",eq_out:"%",parent:n,callback:function(t){e.form.activate_autocomplete({form_item:t,table:"hoards"})}}),e.form.item_factory({id:"place",name:"place",label:tstring.place||"Place",q_column:"place",eq:"LIKE",eq_in:"%",eq_out:"%",parent:n,callback:function(t){e.form.activate_autocomplete({form_item:t,table:"hoards"})}});const o=common.create_dom_element({element_type:"div",class_name:"form-group field button_submit",parent:t});common.create_dom_element({element_type:"input",type:"submit",id:"submit",value:tstring.search||"Search",class_name:"btn btn-light btn-block primary",parent:o}).addEventListener("click",(function(t){t.preventDefault(),e.pagination={total:null,limit:10,offset:0,n_nodes:8},e.form_submit()}));const r=e.form.build_operators_node();return t.appendChild(r),e.form.node=common.create_dom_element({element_type:"form",id:"search_form",class_name:"form-inline form_factory"}),e.form.node.appendChild(t),e.form.node},form_submit:function(){const e=this,t=e.form.node;if(!t)return new Promise((function(e){console.error("Error on submit. Invalid form_node.",t),e(!1)}));const n=e.rows_container;return e.pagination.total?n.classList.add("loading"):page.add_spinner(n),new Promise((function(t){const o="findspots"===e.table?"findspots":"hoards",r=e.pagination.limit,a=e.pagination.offset,i=e.form.build_filter(),l=e.form.parse_sql_filter(i,[]),s=l?"("+l+")":null;!0===SHOW_DEBUG&&console.log("-> coins form_submit sql_filter:",s),data_manager.request({body:{dedalo_get:"records",table:o,ar_fields:["*"],sql_filter:s,limit:r,count:!0,offset:a,order:"name",process_result:null,resolve_portals_custom:{bibliography_data:"bibliographic_references"}}}).then((function(o){const r=page.parse_hoard_data(o.result),i=o.total;console.log("data:",r),e.pagination.total=i,e.pagination.offset=a,r||(n.classList.remove("loading"),t(null)),function(){for(;n.hasChildNodes();)n.removeChild(n.lastChild);n.classList.remove("loading")}(),e.list=e.list||new list_factory,e.list.init({data:r,fn_row_builder:e.list_row_builder,pagination:e.pagination,caller:e}),e.list.render_list().then((function(e){e&&n.appendChild(e),t(e)}))}));const m=document.querySelector(".rows_container");m&&m.scrollIntoView({behavior:"smooth",block:"start",inline:"nearest"})}))},list_row_builder:function(e){return render_hoards.draw_item(e)},map_data_geojson:function(e,t){const n=function(){switch(t.type){case"findspot":return page.maps_config.markers.findspot;case"hoard":return page.maps_config.markers.hoard;default:return page.maps_config.markers.mint}}(),o=Array.isArray(e)?e:[e],r=[];for(let e=0;e<o.length;e++){const a={lat:null,lon:null,geojson:[o[e]],marker_icon:n,data:t};r.push(a)}return r},map_data_point:function(e,t){const n=Array.isArray(e)?e:[e],o=[];for(let e=0;e<n.length;e++){const r={lat:n[e].lat,lon:n[e].lon,marker_icon:page.maps_config.markers.hoard,data:{section_id:null,title:t,description:" "}};o.push(r)}return o}};