{"version":3,"names":["COLOR_PALETTE","chart_wrapper","div_wrapper","options","this","constructor","Error","_n_charts_created","id","_display_download","display_download","_download_chart_container","undefined","plot_container","_display_control_panel","display_control_panel","controls_container","d3_chart_wrapper","call","svg","toggle_visibility","element","attr","transition","linspace","start","stop","nsteps","delta","d3","range","map","i","prototype","id_string","render","replaceChildren","_render_download_panel","render_plot","render_control_panel","supported_formats","get_supported_export_formats","length","download_chart_container","common","create_dom_element","element_type","class_name","style","display","parent","format_select","width","format","value","text_content","toUpperCase","addEventListener","download_chart","filename","download_func_name","Object","setPrototypeOf","select","append","download_chart_as_svg","svg_data","node","outerHTML","svg_blob","Blob","type","url","URL","createObjectURL","tmpLink","href","setAttribute","click","remove","revokeObjectURL","CURVES","Basis","curveBasis","curveBasisClosed","curveBasisOpen","Bundle","curveBundle","curveBumpX","curveBumpY","Cardinal","curveCardinal","curveCardinalClosed","curveCardinalOpen","curveCatmullRom","curveCatmullRomClosed","curveCatmullRomOpen","Linear","curveLinear","curveLinearClosed","curveMonotoneX","curveMonotoneY","Natural","curveNatural","Step","curveStep","curveStepAfter","curveStepBefore","compute_n_bins","array_equal","arrs","size","arr","slice","sqrt","values","Math","ceil","sturges","log2","rice","pow","doane","n","sigma","std","deviation","mean","sum","skew","abs","scott","max","min","freedman_diaconis","quartile3","quantile","quartile1","iqr","TOOLTIP_STYLE","padding","DEFAULT_FLEX_GAP","boxvio_chart_wrapper","data","key_titles","_overflow","overflow","sort_xaxis","_data","sort","a","b","key","join","localeCompare","ele","entries","metrics","calc_metrics","outliers","filter","v","lower_fence","upper_fence","extent","_data_extent","flat","_key_strings","join_key","_key_size","_key_titles","_colors","_","_ylabel","ylabel","yaxis_padding","_full_width","_full_height","_chart","margin","top","right","bottom","left","height","yscale","scaleLinear","domain","clamp","yticks_division","yaxis","axisLeft","tickFormat","d","toFixed","ticks","violin_scale","initial","box_scale","xscale","scaleBand","xaxis","axisBottom","split_key","split","SPLITTER","xticklabel_angle","n_bins","initial_value","histogram","bin","thresholds","bins","supported_curves","violin_curve","_graphics","root_g","yaxwl_g","xaxis_g","yaxis_g","cdividers_g","violins_g","violins","boxes_g","tooltip_div","_controls","max_bins_multiplier","selected_index","median","_query_data","key_tpl","_get_key_templates","templates_wd","obj","JSON","parse","stringify","concat","Array","fill","templates","tmp_template","template","push","_get_next_key_component_values","pkey","psize","values_wd","current_value","get_index_of_key","findIndex","set_violin_scale","scale","selectAll","_render_violins","set_n_bins","chart","_render_violin","set_violin_curve","curve_name","set_box_scale","_render_boxes","_render_axis","_render_ygrid","_render_key2_dividers","_render_tooltip","g","xaxwl_g","apply_xticklabel_angle","text","angle","apply_ygrid_mode","mode","major_lines","major_opacity","minor_lines","minor_opacity","key2_dividers_g","dividers_g","color","key_tpls","index","queried_data","x","divider_g","is_g_ready","key_string","bandwidth","max_count","x_num","datum","area","x0","x1","y","curve","boxes","box_width","group_box","outlier","whiskers","on","tooltip_hover","tooltip_element","new_node","existing_node","parentNode","insertBefore","nextSibling","k","tooltip_text","html","upper_container","direction","_render_grid_select","_render_xticklabel_angle_slider","_render_violin_curve_selector","_render_checkboxes","_render_scale_sliders","_render_n_bins_control","container","select_container","gap","grid_select_id","tstring","grid","grid_select","none_f","major","major_minor","slider_container","xticklabel_angle_slider_id","xticklabel_angle_slider","Number","curve_select_id","curve_select","container_div","show_key2_div","show_key2_checkbox_id","show_key2_checkbox","checked","show","toLowerCase","show_violins_div","show_violins_checkbox_id","show_violins_checkbox","show_violins","show_boxes_div","show_boxes_checkbox_id","show_boxes_checkbox","show_boxes","show_outliers_div","show_outliers_checkbox_id","show_outliers_checkbox","show_outliers","group","violin_container_div","violin_scale_slider_id","violin_width","violin_scale_slider","reset","box_container_div","box_scale_slider_id","box_scale_slider","key_selects","populate_key_select","key_select","select_id","j","ks","violin_n_bins_slider","violin_n_bins_slider_id","violin_resolution","reset_all_violins","chartjs_chart_wrapper","canvas","histogram_wrapper","_density","_n_bins_default","_n_bins","_xlabel","xlabel","_n_decimals","_max_bins_multiplier","_bar_color","download_chart_as_png","toBase64Image","_tweak_c2s","offsetWidth","offsetHeight","animation","reponsive","svgContext","C2S","Chart","config","_config","encodeURIComponent","getSerializedSvg","getContext","contextId","__canvas","getAttribute","name","listener","eventListenerOptions","get_density","set_density","density","bin_centers","plot_data","half_bin_width","data_min","data_max","_get_plotting_data","datasets","label","_get_density_string","scales","title","update","get_n_bins","stepSize","plugins","tooltip","callbacks","_get_tooltip_title_callback","get_bar_color","set_bar_color","bar_color","backgroundColor","bin_width","apply","reduce","partialSum","val","n_decimals","items","dataIndex","chart_data","categoryPercentage","barPercentage","scales_options","offset","callback","labels","Boolean","font","plugins_options","legend","parsing","normalized","self","slider","density_checkbox_id","density_checkbox","color_picker_container","window","iro","ColorPicker","layoutDirection","layout","component","ui","Wheel","Slider","sliderType","rgbaString","analysis","form","area_name","row","export_data_container","form_items_container","diameter_chart_container","weight_chart_container","diameter_chart_wrapper","weight_chart_wrapper","set_up","form_node","render_form","appendChild","fragment","DocumentFragment","form_factory","form_row","item_factory","mint","q_column","value_wrapper","eq","eq_in","eq_out","is_term","form_item","activate_autocomplete","table","q_table","number_key","group_op","material","denomination","submit_group","search","e","preventDefault","form_submit","location","replace","pathname","operators_node","build_operators_node","form_obj","scroll_result","form_items","build_filter","scrollIntoView","behavior","block","inline","search_rows","limit","process_result","fn","columns","then","parsed_data","event_manager","publish","console","log","ref_type_number","p_mint","ref_type_material","ref_type_denomination","tmp_data","calculable","full_coins_reference_calculable","diameter_max","full_coins_reference_diameter_max","diameter_min","full_coins_reference_diameter_min","weight","full_coins_reference_weight","tmp_diameter_max","tmp_diameter_min","tmp_weight","keys","weights","diameters","diameter","ar_fields","order","lang","page_globals","WEB_CURRENT_LANG_CODE","Promise","resolve","sql_filter","parse_sql_filter","request_body","dedalo_get","count","data_manager","request","body","response","page","parse_catalog_data","result"],"sources":["../../lib/charts/chart-wrapper.js","../../lib/charts/d3/d3-chart-wrapper.js","../../lib/charts/d3/utils.js","../../lib/charts/compute-n-bins.js","../../lib/charts/utils.js","../../lib/charts/d3/boxvio-chart-wrapper.js","../../lib/charts/chartjs/chartjs-chart-wrapper.js","../../lib/charts/chartjs/histogram-wrapper.js","analysis.js"],"sourcesContent":["\"use strict\";\n\n/**\n * Width (in pixels) of color picker\n * @type {number}\n */\nexport const COLOR_PICKER_WIDTH = 200\n\n/**\n * Default name for the chart -> when exporting,\n * `<name>.<format>`\n * @type {string}\n */\nconst DEFAULT_CHART_NAME = 'chart'\n\n/**\n * Color palette, totally stolen from matplotlib\n * @type {string[]}\n */\nexport const COLOR_PALETTE = ['#1f77b4', '#ff7f0e', '#2ca02c', '#d62728', '#9467bd', '#8c564b', '#e377c2', '#17becf']\n\n\n/**\n * Chart wrapper class (download panel, plot, and control panel)\n * \n * The `render` method must be called for the chart to be rendered to the DOM!!!\n * \n * Within the provided div wrapper, it will create three divs:\n * 1. If download is supported, a div to containing the download section, with\n *    id `chart<id>_download_chart_container` class `download_chart_container`\n * 2. A div to contain the plot itself, with id `chart<id>_plot_wrapper` class `plot_wrapper` \n * 3. A div to contain the control panel, with id `chart<id>_control_panel` and class `control_panel`\n * \n * It clears the container div during render, so subclasses should work with the dom\n * after the render methods of this superclass (`render_plot` and `render_control_panel`) have been called.\n * In other words, subclasses should override those specific methods instead of the general `render` function\n * \n * Last reminder, the constructor is the place to do data processing exclusively. All rendering to the DOM\n * must be done in the specific render methods. Otherwise, bugs WILL appear.\n * @class\n * @abstract\n * @param {Element} div_wrapper\n * @param {Object} options configuration options\n * @param {boolean} options.display_download whether to display the download panel (default `false`)\n * @param {boolean} options.display_control_panel whether to display the control panel (default `false`)\n */\nexport function chart_wrapper(div_wrapper, options) {\n    if (this.constructor === chart_wrapper) {\n        throw new Error(\"Abstract class 'chart_wrapper' cannot be instantiated\")\n    }\n    chart_wrapper._n_charts_created++;\n    /**\n     * Unique identifier for the chart.\n     * \n     * Subclasses MUST use this in order to assing IDs\n     * to DOM elements, in order to avoid bugs and cross-chart events\n     * @type {number}\n     * @protected\n     */\n    this.id = chart_wrapper._n_charts_created\n    /**\n     * Div element wrapping the chart itself and\n     * the controls\n     * @type {Element}\n     * @protected\n     */\n    this.div_wrapper = div_wrapper\n    /**\n     * Whether to display the download panel\n     * @type {boolean}\n     * @private\n     */\n    this._display_download = options.display_download || false\n    /**\n     * Div container for chart download\n     * @type {Element}\n     * @private\n     */\n    this._download_chart_container = undefined\n    /**\n     * Div inside the div_wrapper, that just wraps the drawing\n     * @type {Element}\n     * @protected\n     */\n    this.plot_container = undefined\n    /**\n     * Whether to display the control panel\n     * @type {boolean}\n     * @private\n     */\n     this._display_control_panel = options.display_control_panel || false\n    /**\n     * Div container for user controls\n     * Used freely by each subclass\n     * @type {Element}\n     * @protected\n     */\n    this.controls_container = undefined\n}\n\n/**\n * Amount of created charts\n * @type {number}\n * @static\n * @private\n */\nchart_wrapper._n_charts_created = 0;\n\n/**\n * Get a string representing the ID of the chart\n * @returns {string} the id as a string\n *          (`'chart1'`, `'chart2'`, ...)\n */\nchart_wrapper.prototype.id_string = function () {\n    return `chart${this.id}`\n}\n\n/**\n * Render the chart\n * \n * Empties the div wrapper and resets properties\n * \n * Subclasses must call this method at the top\n * of their own implementation\n * @name chart_wrapper#render\n * @function\n * @public\n */\nchart_wrapper.prototype.render = function () {\n    // Save this chart_wrapper intance\n    /**\n     * This chart_wrapper intance\n     * @type {chart_wrapper}\n     */\n    const self = this\n    // Remove all children in the div_wrapper\n    this.div_wrapper.replaceChildren()\n\n    // Create the chart download section\n    if (this._display_download) {\n        this._render_download_panel()\n    }\n\n    // Create the div for wrapping the plot\n    this.render_plot()\n\n    // Create the div for the control panel\n    if (this._display_control_panel) {\n        this.render_control_panel()\n    }\n\n}\n\n/**\n * Render the download panel to the DOM\n * @function\n * @private\n * @name chart_wrapper#_render_download_panel\n */\nchart_wrapper.prototype._render_download_panel = function () {\n    const supported_formats = this.get_supported_export_formats()\n    if (supported_formats.length) {\n        this.download_chart_container = common.create_dom_element({\n            element_type: 'div',\n            id: `${this.id_string()}_download_chart_container`,\n            class_name: 'o-purple download_chart_container',\n            style: {\n                'display': 'flex',\n                'flex-direction': 'row',\n                'justify-content': 'center',\n            },\n            parent: this.div_wrapper,\n        })\n        const format_select = common.create_dom_element({\n            element_type: 'select',\n            id: `${this.id_string()}_chart_export_format`,\n            style: {\n                'width': '80%',\n            },\n            parent: this.download_chart_container,\n            // TODO: add ARIA attributes?\n        })\n        for (const format of supported_formats) {\n            common.create_dom_element({\n                element_type: 'option',\n                value: format,\n                text_content: format.toUpperCase(),\n                parent: format_select,\n            })\n        }\n        const chart_download_button = common.create_dom_element({\n            element_type: 'button',\n            text_content: 'Download',\n            style: {\n                'width': '20%',\n            },\n            parent: this.download_chart_container,\n        })\n        chart_download_button.addEventListener('click', () => {\n            this.download_chart(format_select.value)\n        })\n    }\n}\n\n/**\n * Render the plot to the DOM\n * \n * Subclasses should override this method and make\n * use of the plot container\n * @function\n * @protected\n * @name chart_wrapper#render_plot\n */\nchart_wrapper.prototype.render_plot = function () {\n    this.plot_container = common.create_dom_element({\n        element_type: 'div',\n        id: `${this.id_string()}_plot_container`,\n        class_name: 'o-purple plot_container',\n        parent: this.div_wrapper,\n    })\n}\n\n/**\n * Render the control panel to the DOM\n * \n * Subclasses should override this method and make\n * use of the controls container\n * @function\n * @protected\n * @name chart_wrapper#render_control_panel\n */\nchart_wrapper.prototype.render_control_panel = function () {\n    this.controls_container = common.create_dom_element({\n        element_type: 'div',\n        id: `${this.id_string()}_control_panel`,\n        class_name: 'o-green control_panel',\n        parent: this.div_wrapper,\n    })\n}\n\n/**\n * Download the chart as an image\n * \n * For each supported format in the subclass,\n * @see chart_wrapper#get_supported_export_formats\n * the subclass must implement a method called\n * `download_chart_as_<format>`\n * @param {string} format the image format\n * @function\n * @abstract\n * @name chart_wrapper#download_chart\n */\nchart_wrapper.prototype.download_chart = function (format) {\n    /**\n     * File name for the chart\n     * @type {string}\n     */\n    const filename = `${DEFAULT_CHART_NAME}.${format}`\n    /**\n     * Function name for downloading with the particular format\n     * @type {string}\n     */\n    const download_func_name = `download_chart_as_${format}`\n    if (this[download_func_name] === undefined) {\n        throw new Error(`${download_func_name} is not implemented!`)\n    }\n    this[download_func_name](filename)\n}\n\n/**\n * Get the supported chart export formats\n * \n * Subclasses must return their own supported formats, if any, e.g.,\n * `['png', 'jpg', 'eps']`. If no format is supported, there is no\n * need to override this method.\n * @function\n * @returns {string[]} the supported formats\n * @name chart_wrapper#get_supported_export_formats\n */\nchart_wrapper.prototype.get_supported_export_formats = function () {\n    return []\n}","\"use strict\";\n\nimport { chart_wrapper } from \"../chart-wrapper\";\n\n/**\n * D3 chart wrapper class\n * \n * Appends an `svg` tag to the provided div.\n * \n * Subclasses MUST specify the viewBox of the svg, so that it responds to window resizing\n * The created svg tag has width=100%, spanning the width of the parent element. Subclasses\n * can alter this behavior by modifying the svg after the superclass `render_plot` method has been\n * called\n * @param {Element} div_wrapper the div containing the chart\n * @param {Object} options configuration options\n * @param {boolean} options.display_download whether to display the download panel (default `true`)\n * @param {boolean} options.display_control_panel whether to display the control panel (default `true`)\n * @class\n * @abstract\n * @extends chart_wrapper\n */\nexport function d3_chart_wrapper(div_wrapper, options) {\n    if (this.constructor === d3_chart_wrapper) {\n        throw new Error(\"Abstract class 'd3_chart_wrapper' cannot be instantiated\")\n    }\n    chart_wrapper.call(this, div_wrapper, options)\n    /**\n     * D3 selection object for the root `svg` tag\n     * @protected\n     */\n    this.svg = undefined\n\n}\n// Set prototype chain\nObject.setPrototypeOf(d3_chart_wrapper.prototype, chart_wrapper.prototype)\n\n/**\n * Render the plot to the DOM\n * \n * Subclasses must call this method at the top\n * of their own implementation. Then, they can\n * make use of the svg d3.selection object\n * @function\n * @protected\n * @name chart_wrapper#render_plot\n */\nd3_chart_wrapper.prototype.render_plot = function () {\n    chart_wrapper.prototype.render_plot.call(this)\n\n    this.svg = d3.select(this.plot_container)\n        .append('svg')\n        // When drawing SVG to canvas with an `Image`, if we don't add version and xmlns the `Image` will never load :(\n        .attr('version', '1.1')\n        .attr('xmlns', 'http://www.w3.org/2000/svg')\n        .attr('width', '100%')\n}\n\n/**\n * Get the supported chart export formats\n * @function\n * @returns {string[]} the supported formats\n * @name d3_chart_wrapper#get_supported_export_formats\n */\nd3_chart_wrapper.prototype.get_supported_export_formats = function () {\n    return ['svg']\n}\n\n/**\n * Download the chart as svg\n * @param {string} filename the name of the file\n * @function\n * @name d3_chart_wrapper#_download_chart_as_svg\n */\nd3_chart_wrapper.prototype.download_chart_as_svg = function (filename) {\n    const svg_data = this.svg.node().outerHTML\n    const svg_blob = new Blob([svg_data], { type: \"image/svg+xml;charset=utf-8\" })\n    const url = URL.createObjectURL(svg_blob)\n    /**\n     * Temporary link\n     * @type {Element}\n     */\n    const tmpLink = common.create_dom_element({\n        element_type: 'a',\n        href: url,\n    })\n    tmpLink.setAttribute('download', filename)\n    tmpLink.click()\n    tmpLink.remove()\n    URL.revokeObjectURL(url)\n}","/**\n * Toggle visibility of a d3 selection element\n * @param {d3.selection} element the elememt\n */\nexport function toggle_visibility(element) {\n    if (element.attr('opacity') == 0) {\n        element.transition().attr('opacity', 1)\n    } else {\n        element.transition().attr('opacity', 0)\n    }\n}\n\n/**\n * Get an array of values, evenly spaced over an\n * interval\n * \n * https://gist.github.com/davebiagioni/1ac21feb1c2db04be4e6\n * @param {number} start start value\n * @param {number} stop stop value\n * @param {number} nsteps amount of steps\n * @returns {number[]} the values\n */\nexport function linspace(start, stop, nsteps){\n    const delta = (stop-start)/(nsteps-1)\n    return d3.range(nsteps).map((i) => start+i*delta)\n}\n\n/**\n * Map from name to d3 curve\n * https://github.com/d3/d3/blob/main/API.md#curves\n * @type {Object.<string, d3.curve>}\n */\nexport const CURVES = {\n    // cubic basis spline, repeating the end points\n    'Basis': d3.curveBasis,\n    // a closed cubic basis spline\n    'Basis closed': d3.curveBasisClosed,\n    // a cubic basis spline\n    'Basis open': d3.curveBasisOpen,\n    // a straightened cubic basis spline (works only with d3.line, not d3.area!)\n    'Bundle': d3.curveBundle,\n    // a cubic Bézier spline with horizontal tangents\n    'Bump X': d3.curveBumpX,\n    // a cubic Bézier spline with vertical tangents\n    'Bump Y': d3.curveBumpY,\n    // a cubic cardinal spline, with one-sided difference at each end\n    'Cardinal': d3.curveCardinal,\n    // a closed cubic cardinal spline\n    'Cardinal closed': d3.curveCardinalClosed,\n    // a cubic cardinal spline\n    'Cardinal open': d3.curveCardinalOpen,\n    // a cubic Catmull–Rom spline, with one-sided difference at each end\n    'Catmull-Rom': d3.curveCatmullRom,\n    // a closed cubic Catmull–Rom spline\n    'Catmull-Rom closed': d3.curveCatmullRomClosed,\n    // a cubic Catmull–Rom spline\n    'Catmull-Rom open': d3.curveCatmullRomOpen,\n    // a polyline\n    'Linear': d3.curveLinear,\n    // a closed polyline.\n    'Linear closed': d3.curveLinearClosed,\n    // a cubic spline that, given monotonicity in x, preserves it in y\n    'Monotone X': d3.curveMonotoneX,\n    // a cubic spline that, given monotonicity in y, preserves it in x\n    'Monotone Y': d3.curveMonotoneY,\n    // a natural cubic spline\n    'Natural': d3.curveNatural,\n    // a piecewise constant function\n    'Step': d3.curveStep,\n    // a piecewise constant function\n    'Step after': d3.curveStepAfter,\n    // a piecewise constant function\n    'Step before': d3.curveStepBefore,\n}\n","/**\n * Implements methods for computing the number of\n * bins based on the data values\n * \n * Each method takes an array of data values as input\n * and outputs the number of bins\n * @class\n */\nexport function compute_n_bins() {}\n\n/**\n * Compute number of bins with the square root rule\n * @param {number[]} values the datapoints\n * @returns {number} the number of bins \n */\ncompute_n_bins.sqrt = function (values) {\n\treturn Math.ceil(Math.sqrt(values.length))\n}\n\n/**\n * Compute number of bins with the Sturges rule\n * @param {number[]} values the datapoints\n * @returns {number} the number of bins \n */\ncompute_n_bins.sturges = function (values) {\n\treturn Math.ceil(Math.log2(values.length)) + 1\n}\n\n/**\n * Compute number of bins with the Rice rule\n * @param {number[]} values the datapoints\n * @returns {number} the number of bins \n */\ncompute_n_bins.rice = function (values) {\n\treturn Math.ceil(2*Math.pow(values.length, 1/3))\n}\n\n/**\n * Compute number of bins with Doane's formula\n * \n * @param {number[]} values the datapoints\n * @returns {number} the number of bins \n */\ncompute_n_bins.doane = function (values) {\n\tconst n = values.length\n\tif (n < 2) {\n\t\tthrow new Error(\"Doane's rule needs at least 2 datapoints\")\n\t}\n\tconst sigma = Math.sqrt(6*(n-2)/((n+1)*(n+3)))\n\tconst std = d3.deviation(values)\n\tconst mean = d3.mean(values)\n\tconst sum = d3.sum(values)\n\t// The adjusted Fisher-Pearson skewness coefficient\n\t// https://www.itl.nist.gov/div898/software/dataplot/refman2/auxillar/skewness.htm\n\tconst skew = (Math.sqrt(n*(n+1))/(n-2))*((sum-n*mean)/(n*Math.pow(std, 3)))\n\treturn 1 + Math.ceil(Math.log2(n)) + Math.ceil(Math.log2(1+Math.abs(skew)/sigma))\n}\n\n/**\n * Compute number of bins with Scott's normal\n * reference rule\n * @param {number[]} values the datapoints\n * @returns {number} the number of bins \n */\ncompute_n_bins.scott = function (values) {\n\tif (values.length < 2) {\n\t\tthrow new Error(\n\t\t\t\"Cannot compute standard deviation of an array with less than 2 values\"\n\t\t)\n\t}\n\treturn Math.ceil(\n\t\t(d3.max(values)-d3.min(values))*Math.pow(values.length, 1/3)/(3.49*d3.deviation(values))\n\t)\n}\n\n/**\n * Compute number of bins with Freedman-Diaconis' choice\n * @param {number[]} values the datapoints\n * @returns {number} the number of bins \n */\ncompute_n_bins.freedman_diaconis = function (values) {\n\tconst quartile3 = d3.quantile(values, 0.75)\n\tconst quartile1 = d3.quantile(values, 0.25)\n\tconst iqr =  quartile3 - quartile1\n\tif (quartile1 === quartile3) {\n\t\tthrow new Error(\"IQR is 0!\")\n\t}\n\treturn Math.ceil(\n\t\t(d3.max(values)-d3.min(values))*Math.pow(values.length, 1/3)/(2*iqr)\n\t)\n}\n","/**\n * Get a deep copy of an object\n * @param {Object} obj the object\n * @returns a deep copy of the object\n */\nexport function deepcopy(obj) {\n\treturn JSON.parse(JSON.stringify(obj))\n}\n\n/**\n * Insert a dom element after another\n * @param {Eleemnt} new_node the new node \n * @param {Element} existing_node the one to add after of\n */\nexport function insert_after(new_node, existing_node) {\n    existing_node.parentNode.insertBefore(new_node, existing_node.nextSibling);\n}\n\n/**\n * Check if arrays are equal\n * @param {any[][]} arrs the arrays to compare\n * @return {boolean} `true` if they are equal,\n * \t\t   `false` otherwise\n */\nexport function array_equal(...arrs) {\n\tif (!arrs.length) {\n\t\tthrow new Error(\"There are no input arrays\")\n\t}\n\tconst size = arrs[0].length\n\tfor (const arr of arrs.slice(1)) {\n\t\tif (arr.length !== size) {\n\t\t\treturn false\n\t\t}\n\t}\n\tfor (let i = 0; i < size; i++) {\n\t\tconst value = arrs[0][i]\n\t\tfor (const arr of arrs.slice(1)) {\n\t\t\tif (arr[i] !== value) {\n\t\t\t\treturn false\n\t\t\t}\n\t\t}\n\t}\n\treturn true\n}","\"use strict\";\n\nimport { d3_chart_wrapper } from \"./d3-chart-wrapper\";\nimport { COLOR_PALETTE } from \"../chart-wrapper\";\nimport { toggle_visibility, linspace, CURVES } from \"./utils\";\nimport { compute_n_bins } from \"../compute-n-bins\";\nimport { array_equal, deepcopy, insert_after } from \"../utils\"\n\n\n/**\n * CSS style for the tooltip\n * @type {Object.<string, string | number>}\n */\nconst TOOLTIP_STYLE = {\n    'text-align': 'left',\n    'padding': '0.7em',\n    'padding-left': '0.8em',\n    'font-size': '0.9em',\n    'display': 'none',\n}\n\n/**\n * Default flex gap\n * @type {string}\n */\nconst DEFAULT_FLEX_GAP = '1em'\n/**\n * Default margin\n * @type {string}\n */\nconst DEFUALT_MARGIN = '1em'\n\n\n/**\n * TODO: make a superclass (in the middle of this and d3_chart_wrapper) called xy-chart-wrapper\n * which manages the axes, grid, and so on. This will be useful if we add other charts that make\n * use of x and y axis\n *\n * Boxplot + violin chart wrapper\n * \n * Inspired in:\n * - http://bl.ocks.org/asielen/d15a4f16fa618273e10f,\n * - https://d3-graph-gallery.com/graph/violin_basicHist.html,\n * - https://d3-graph-gallery.com/graph/boxplot_show_individual_points.html\n * \n * @param {Element} div_wrapper the div to work in\n * @param {{key: string[], values: number[]}[]} data the input data: an array of objects\n *        with key (array of components, from general to specific) and values (the datapoints)\n *        (KEY COMPONENTS MUST NOT INCLUDE `'_^PoT3sRanaCantora_'`, or things WILL break)\n * @param {string[]} key_titles the title for each key component\n * @param {Object} options configuration options\n * @param {boolean} options.display_download whether to display the download panel (default `false`)\n * @param {boolean} options.display_control_panel whether to display the control panel (default `false`)\n * @param {boolean} options.sort_xaxis whether to sort the xaxis (default `false`)\n * @param {string} options.ylabel the y-label (default `null`)\n * @param {boolean} options.overflow whether to go beyond the width of the plot container (default `false`)\n * @param {number} options.xticklabel_angle the angle (in degrees) for the xtick labels (default `0`)\n * @class\n * @extends d3_chart_wrapper\n */\nexport function boxvio_chart_wrapper(div_wrapper, data, key_titles, options) {\n    d3_chart_wrapper.call(this, div_wrapper, options)\n    /**\n     * Whether to go beyond the width of the plot container\n     * @type {boolean}\n     */\n    this._overflow = options.overflow || false\n    const sort_xaxis = options.sort_xaxis || false\n    if (!data.length) {\n        throw new Error(\"Data array is empty\")\n    }\n    /**\n     * Data: key (general to specific components), index, values,\n     * boxplot metrics, outliers, extent (min and max)\n     * @type {{\n     *  key: string[],\n     *  index: number\n     *  values: number[],\n     *  metrics: {\n     *      max: number,\n     *      upper_fence: number,\n     *      quartile3: number,\n     *      median: number,\n     *      mean: number,\n     *      iqr: number,\n     *      quartile1: number,\n     *      lower_fence: number,\n     *      min: number\n     *  },\n     *  outliers: number[],\n     *  extent: [number, number]\n     * }[]}\n     * @private\n     */\n    this._data = sort_xaxis\n                 ? data.sort((a, b) => a.key.join().localeCompare(b.key.join()))\n                 : data\n    for (const [i, ele] of this._data.entries()) {\n        ele.metrics = calc_metrics(ele.values)\n        ele.outliers = ele.values.filter(\n            (v) => v < ele.metrics.lower_fence || v > ele.metrics.upper_fence\n        )\n        ele.extent = d3.extent(ele.values)\n    }\n    /**\n     * Overall Maximum and minimum of the input data\n     * @type {[number, number]}\n     */\n    this._data_extent = d3.extent(this._data.map((ele) => ele.extent).flat())\n    /**\n     * Existing keys as strings\n     * @type {string[]}\n     * @private\n     */\n    this._key_strings = this._data.map((ele) => join_key(ele.key))\n    /**\n     * Number of components of the key\n     * @type {number}\n     * @private\n     */\n    this._key_size = data[0].key.length\n    /**\n     * Title for each key component\n     * @type {string[]}\n     * @private\n     */\n    this._key_titles = key_titles\n    /**\n     * Colors\n     * @type {string[]}\n     * @private\n     */\n    this._colors = this._data.map((_, i) => COLOR_PALETTE[i % COLOR_PALETTE.length])\n    /**\n     * The label for the y axis\n     * @type {string}\n     * @private\n     */\n    this._ylabel = options.ylabel || null\n    /**\n     * Padding for the y axis, to account for the label and ticks\n     * @type {number}\n     */\n    this.yaxis_padding = this._ylabel ? 62 : 35;\n    /**\n     * Full width of svg\n     * @type {number}\n     */\n    this._full_width = 330.664701211*Math.sqrt(this._data.length) + -170.664701211 + this.yaxis_padding\n    /**\n     * Full height of svg\n     * @type {number}\n     */\n    this._full_height = 453\n    /**\n     * Non-graphic components of the chart: setting, scales,\n     * axis generators, spacing, etc.\n     * @private\n     * @type {{\n     *  margin: {\n     *      top: number,\n     *      right: number,\n     *      bottom: number,\n     *      left: number\n     *  },\n     *  width: number,\n     *  height: number,\n     *  yscale: d3.scaleLinear,\n     *  yticks_division: number,\n     *  yaxis: d3.axisGenerator,\n     *  violin_scale: {initial: number, value: number},\n     *  box_scale: {initial: number, value: number},\n     *  xscale: d3.scaleBand,\n     *  xaxis: d3.axisGenerator,\n     *  xticklabel_angle: number,\n     *  n_bins: {initial: number, value: number}[],\n     *  histogram: d3.binGenerator[],\n     *  bins: d3.Bin[][],\n     *  supported_curves: string[],\n     *  violin_curve: string\n     * }}\n     */\n    this._chart = {}\n    this._chart.margin = { top: 15, right: 4, bottom: 61, left: this.yaxis_padding }\n    this._chart.width = this._full_width - this._chart.margin.left - this._chart.margin.right\n    this._chart.height = this._full_height - this._chart.margin.top - this._chart.margin.bottom\n    this._chart.yscale = d3.scaleLinear()\n        .range([this._chart.height, 0])\n        .domain(this._data_extent)\n        .clamp(true)  // when input outside of domain, its output is clamped to range\n    this._chart.yticks_division = 2  // TODO: make this part of the input options object\n    // TODO: make number of decimals and number of ticks part of input options object\n    this._chart.yaxis = d3.axisLeft(this._chart.yscale)\n        .tickFormat((d, i) => i % this._chart.yticks_division ? '' : d.toFixed(1))\n        .ticks(19)\n    this._chart.violin_scale = {initial: 0.8, value: 0.8}\n    this._chart.box_scale = {initial: 0.3, value: 0.3}\n    this._chart.xscale = d3.scaleBand()\n        .domain(this._key_strings)\n        .range([0, this._chart.width])\n        // .padding(1-this._chart.violin_scale)     // This is important: it is the space between 2 groups. 0 means no padding. 1 is the maximum.\n    this._chart.xaxis = d3.axisBottom(this._chart.xscale)\n        .tickFormat((d) => split_key(d)[1])\n    this._chart.xticklabel_angle = options.xticklabel_angle || 0\n    this._chart.n_bins = this._data.map((ele) => {\n        const initial_value = compute_n_bins.sturges(ele.values)\n        return {\n            initial: initial_value,\n            value: initial_value,\n        }\n    })\n    this._chart.histogram = this._data.map((ele, i) => {\n        return d3.bin().domain(ele.extent)\n            .thresholds(\n                linspace(ele.extent[0], ele.extent[1], this._chart.n_bins[i].value+1)\n            )\n    })\n    this._chart.bins = this._data.map((ele, i) => {\n        return this._chart.histogram[i](ele.values)\n    })\n    this._chart.supported_curves = [\n        'Basis', 'Bump Y', 'Cardinal', 'Catmull-Rom', 'Linear',\n        'Monotone Y', 'Natural', 'Step'\n    ]\n    this._chart.violin_curve = CURVES[this._chart.supported_curves[0]]\n    /**\n     * Graphic components of the chart\n     * @private\n     * @type {{\n     *  root_g: d3.selection,\n     *  xaxwl_g: d3.selection\n     *  xaxis_g: d3.selection,\n     *  yaxwl_g: d3.selection,\n     *  yaxis_g: d3.selection,\n     *  key2_dividers_g: d3.selection,\n     *  violins_g: d3.selection,\n     *  violins: d3.selection[],\n     *  boxes_g: d3.selection,\n     *  outliers: d3.selection[],\n     *  tooltip_div: d3.selection\n     * }}\n     */\n    this._graphics = {\n        // Root g tag (translated to account for the margins)\n        root_g: null,\n        // g tag for the x-axis and label\n        yaxwl_g: null,\n        // g tag for the x-axis\n        xaxis_g: null,\n        // g tag for the y-axis and label\n        yaxwl_g: null,\n        // g tag for the y-axis\n        yaxis_g: null,\n        // g tag for the class dividers\n        cdividers_g: null,\n        // g tag grouping all violins\n        violins_g: null,\n        // individual g tag for each violin\n        violins: [],\n        // g tag grouping all boxes\n        boxes_g: null,\n        // per group: g tag grouping all outliers of each box\n        outliers: [],\n        // div tag of the tooltip\n        tooltip_div: null,\n    }\n    /**\n     * Control panel things\n     * TODO: if modifying a particular violin gets slow\n     * because we have to fetch it based on key, we can\n     * keep track of the selected one so that we only fetch\n     * if when the selected key changes. Or something like that\n     * @private\n     * @type {{\n     *  max_bins_multiplier: number,\n     *  selected_index: number\n     * }}\n     */\n    this._controls = {}\n    this._controls.max_bins_multiplier = 3\n    this._controls.selected_index = 0\n}\n// Set prototype chain\nObject.setPrototypeOf(boxvio_chart_wrapper.prototype, d3_chart_wrapper.prototype)\n\n/**\n * Query the data given a key template\n * @param {string[]} key_tpl the key template. Parts will be matched,\n * `null` counts as wildcard\n * @return {{\n *  key: string[],\n *  values: number[],\n *  metrics: {\n *      max: number,\n *      upper_fence: number,\n *      quartile3: number,\n *      median: number,\n *      mean: number,\n *      iqr: number,\n *      quartile1: number,\n *      lower_fence: number,\n *      min: number\n *  },\n *  outliers: number[],\n *  extent: [number, number]\n * }[]} the filtered data\n */\nboxvio_chart_wrapper.prototype._query_data = function (key_tpl) {\n    if (key_tpl.length !== this._key_size) {\n        throw new Error(\"Key template is of different size than the plot keys\")\n    }\n    return this._data.filter((ele) => {\n        const key = ele.key\n        for (let i = 0; i < key.length; i++) {\n            if (key_tpl[i] && key_tpl[i] !== key[i]) {\n                return false\n            }\n        }\n        return true\n    })\n}\n\n/**\n * Get key templates up to a key number\n * @param {number} i the key number. If 1, all existing keys\n *        will be returned. If 2, all existing keys with a wildcard in\n *        the last component will be returned. If 3, all existing keys\n *        with a wildcard in the last and second-to-last component will\n *        be returned.\n * @returns {string[][]} the templates\n */\nboxvio_chart_wrapper.prototype._get_key_templates = function (i) {\n    if (i < 1 || i > this._key_size) {\n        throw new Error(`Invalid key number ${i}`)\n    }\n    // Convert to real index\n    i = this._key_size - i\n    const templates_wd = this._data.map((ele) => {\n        return deepcopy(ele.key.slice(0,i+1)).concat(Array(this._key_size-i-1).fill(null))\n    })\n    if (!templates_wd.length) return templates_wd\n    // Remove duplicates\n    const templates = [templates_wd[0]]\n    let tmp_template = templates_wd[0]\n    for (const template of templates_wd.slice(1)) {\n        if (!array_equal(tmp_template, template)) {\n            templates.push(template)\n            tmp_template = template\n        }\n    }\n    return templates\n}\n\n/**\n * Get the possible values of the next key component, given a partial key.\n * E.g., if there are 4 components, and you provide the two leftmost ones\n * in the partial key, possible values for the third leftmost one will be\n * given\n * @param {string[]} pkey partial key\n * @returns {string[]} possible values for the next key component\n */\nboxvio_chart_wrapper.prototype._get_next_key_component_values = function (pkey) {\n    const psize = pkey.length\n    if (psize >= this._key_size) {\n        throw new Error(`Input key ${pkey} is longer than the data keys`)\n    }\n    const key_tpl = pkey.concat(Array(this._key_size-psize).fill(null))\n    const values_wd = this._query_data(key_tpl).map((ele) => ele.key[psize])\n    if (!values_wd.length) return values_wd\n    const values = [values_wd[0]]\n    let current_value = values_wd[0]\n    for (const value of values_wd.slice(1)) {\n        if (value !== current_value) {\n            values.push(value)\n            current_value = value\n        }\n    }\n    return values\n}\n\n/**\n * Get the index of a key\n * @param {string[]} key the key \n * @returns the index of the key\n */\nboxvio_chart_wrapper.prototype.get_index_of_key = function (key) {\n    const i = this._data.findIndex((ele) => ele.key.join() === key.join())\n    if (i === -1) {\n        throw new Error(`Key ${key} was not found in data`)\n    }\n    return i\n}\n\n/**\n * Set the scale for the violins\n * @function\n * @param {number} scale the scale [0, 1]\n * @name boxvio_chart_wrapper#set_violin_scale\n */\nboxvio_chart_wrapper.prototype.set_violin_scale = function (scale) {\n    this._chart.violin_scale.value = scale\n    // Remove the violin graphics, only leaving its root g tag (violins_g)\n    this._graphics.violins_g.selectAll('*').remove()\n    this._render_violins(true)\n}\n\n/**\n * Set the number of bins for a particular violin\n * \n * Updates the chart accordingly\n * @param {number} i the index of the violin\n * @param {number} n_bins number of bins\n * @name boxvio_chart_wrapper#set_n_bins\n */\nboxvio_chart_wrapper.prototype.set_n_bins = function (i, n_bins) {\n    const chart = this._chart\n    const extent = this._data[i].extent\n    chart.n_bins[i].value = n_bins\n    chart.histogram[i].thresholds(\n        linspace(extent[0], extent[1], n_bins+1)\n    )\n    chart.bins[i] = chart.histogram[i](this._data[i].values)\n    // Delete the oath of the existing violin and redraw\n    this._graphics.violins[i].selectAll('*').remove()\n    this._render_violin(i)\n}\n\n/**\n * Set the curve for the violins\n * \n * Updates the chart accordingly\n * @param {string} curve_name name of the curve \n * @name boxvio_chart_wrapper#set_violin_curve\n */\nboxvio_chart_wrapper.prototype.set_violin_curve = function (curve_name) {\n    this._chart.violin_curve = CURVES[curve_name]\n    // Remove the violin graphics, only leaving its root g tag (violins_g)\n    this._graphics.violins_g.selectAll('*').remove()\n    this._render_violins(true)\n}\n\n/**\n * Set the scale for the boxes\n * @function\n * @param {number} scale the scale [0, 1]\n * @name boxvio_chart_wrapper#set_box_scale\n */\nboxvio_chart_wrapper.prototype.set_box_scale = function (scale) {\n    this._chart.box_scale.value = scale\n    // Remove the box graphics, only leaving its root g tag (boxes_g)\n    this._graphics.boxes_g.selectAll('*').remove()\n    this._render_boxes(true)\n}\n\n/**\n * Render the plot\n * @function\n * @protected\n * @name boxvio_chart_wrapper#render_plot\n */\nboxvio_chart_wrapper.prototype.render_plot = function () {\n    d3_chart_wrapper.prototype.render_plot.call(this)\n\n    if (this._overflow) {\n        this.svg.attr('width', null)\n        this.svg.attr('height', '500px')\n        this.plot_container.style = \"overflow: auto;\"\n    }\n\n    // Set viewBox of svg\n    this.svg.attr('viewBox', `0 0 ${this._full_width} ${this._full_height}`)\n\n    // Root g tag\n    this._graphics.root_g = this.svg.append('g')\n        .attr('transform', `translate(${this._chart.margin.left},${this._chart.margin.top})`)\n\n    this._render_axis()\n    this._render_ygrid()\n    if (this._key_size > 1) {\n        this._render_key2_dividers()\n    }\n    this._render_violins()\n    this._render_boxes()\n    this._render_tooltip()\n\n}\n\n/**\n * Render the axis\n * @function\n * @private\n * @name boxvio_chart_wrapper#_render_axis\n */\nboxvio_chart_wrapper.prototype._render_axis = function () {\n    const g = this._graphics.root_g\n    // Render X axis\n    this._graphics.xaxwl_g = g.append('g')\n        .attr('transform', `translate(0,${this._chart.height})`)\n    const xaxwl_g = this._graphics.xaxwl_g\n    this._graphics.xaxis_g = xaxwl_g.append('g')\n        .call(this._chart.xaxis)\n    this.apply_xticklabel_angle()\n    // Render X axis label\n    xaxwl_g.append('text')\n        .attr('text-anchor', 'middle')\n        .attr('y', 50)\n        .attr('x', this._chart.width / 2)\n        .text(this._key_titles[this._key_titles.length-1])\n    \n    // Render y axis\n    this._graphics.yaxwl_g = g.append('g')\n    const yaxwl_g = this._graphics.yaxwl_g\n    this._graphics.yaxis_g = yaxwl_g.append('g')\n        .call(this._chart.yaxis)\n    // Render Y axis label\n    yaxwl_g.append('text')\n        .attr('text-anchor', 'middle')\n        .attr('transform', 'rotate(-90)')\n        .attr('y', -this._chart.margin.left + 20)\n        .attr('x', -this._chart.height / 2)\n        .text(this._ylabel)\n\n}\n\n/**\n * Apply an angle to the xtick labels\n * @function\n * @name boxvio_chart_wrapper#apply_xticklabel_angle\n */\nboxvio_chart_wrapper.prototype.apply_xticklabel_angle = function () {\n    const angle = this._chart.xticklabel_angle\n    const xaxis_g = this._graphics.xaxis_g\n    if (angle < 10) {\n        xaxis_g.selectAll('text')\n            .attr('text-anchor', 'middle')\n            .attr(\"dy\", \"0.8em\")\n            .attr(\"dx\", \"0\")\n            .attr('transform', `rotate(${-this._chart.xticklabel_angle})`)\n    } else {\n        xaxis_g.selectAll('text')\n            .attr('text-anchor', 'end')\n            .attr(\"dy\", `${-angle*angle*0.00006172839}em`)\n            .attr(\"dx\", \"-0.9em\")\n            .attr('transform',\n                `rotate(${-this._chart.xticklabel_angle})`\n            )\n        if (angle < 50) {\n            xaxis_g.selectAll('text')\n                .attr('dx', '-0.7em')\n        }\n    }\n}\n\n/**\n * Render the grid for the y-axis\n * @function\n * @private\n * @name boxvio_chart_wrapper#_render_ygrid\n */\nboxvio_chart_wrapper.prototype._render_ygrid = function () {\n    const ticks = this._graphics.yaxis_g.selectAll('g.tick')\n    ticks.append('line')\n        .attr('x1', 0)\n        .attr('y1', 0)\n        .attr('x2', this._chart.width)\n        .attr('y2', 0)\n        .attr('stroke', (_, i) => i % 2 ? '#E0E0E0' : '#D1D1D1')\n        .attr('stroke-width', (_, i) => i % 2 ? 0.5 : 0.8)\n        .attr('class', (_, i) => i % 2 ? 'minor' : 'major')\n        .attr('opacity', 0)  // disabled by default\n}\n\n/**\n * Apply a grid mode to the y axis\n * @param {'None' | 'Major' | 'Major + Minor'} mode the mode\n * @function\n * @name boxvio_chart_wrapper#apply_ygrid_mode\n */\nboxvio_chart_wrapper.prototype.apply_ygrid_mode = function (mode) {\n    const major_lines = this._graphics.yaxis_g.selectAll('g.tick line.major')\n    const major_opacity = major_lines.attr('opacity')\n    const minor_lines = this._graphics.yaxis_g.selectAll('g.tick line.minor')\n    const minor_opacity = minor_lines.attr('opacity')\n    switch (mode) {\n        case 'None':\n            if (major_opacity == 1) {\n                toggle_visibility(major_lines)\n            }\n            if (minor_opacity == 1) {\n                toggle_visibility(minor_lines)\n            }\n            break\n        case 'Major':\n            if (major_opacity == 0) {\n                toggle_visibility(major_lines)\n            }\n            if (minor_opacity == 1) {\n                toggle_visibility(minor_lines)\n            }\n            break\n        case 'Major + Minor':\n            if (major_opacity == 0) {\n                toggle_visibility(major_lines)\n            }\n            if (minor_opacity == 0) {\n                toggle_visibility(minor_lines)\n            }\n            break\n        default:\n            throw new Error(`Grid mode '${mode}' is not supported?`)\n    }\n}\n\n/**\n * Render the dividers for key2\n * @function\n * @private\n * @name boxvio_chart_wrapper#_render_key2_dividers\n */\nboxvio_chart_wrapper.prototype._render_key2_dividers = function () {\n    this._graphics.key2_dividers_g = this._graphics.root_g.append('g')\n    const dividers_g = this._graphics.key2_dividers_g\n    const color = 'gray'\n    const key_tpls = this._get_key_templates(2)\n\n    let i = 0;\n    for (const [index, key_tpl] of key_tpls.entries()) {\n        const queried_data = this._query_data(key_tpl)\n        const x = this._chart.xscale(this._key_strings[i])\n        const divider_g = dividers_g.append('g')\n            .attr('transform', `translate(${x},0)`)\n        if (index !== 0) {\n            divider_g.append('line')\n                .attr('x1', 0)\n                .attr('y1', 0)\n                .attr('x2', 0)\n                .attr('y2', this._chart.height)\n                .attr('stroke', color)\n                .attr('stroke-width', 0.9)\n                .attr('stroke-dasharray', this._chart.height/35)\n        }\n        divider_g.append('text')\n            .attr('text-anchor', 'end')\n            .attr('transform', 'rotate(-90)')\n            .attr('y', '1.3em')  // This is the horizontal axis now\n            .attr('x', '-0.6em')  // This is the vertical axis now\n            .attr('font-size', '0.8em')\n            .attr('fill', color)\n            .text(key_tpl[key_tpl.length-2])\n        // Increase the index by the number of groups in the class\n        i += queried_data.length\n    }\n}\n\n/**\n * Render the violins\n * @function\n * @private\n * @param {boolean} is_g_ready whether the g tag for violins is\n *        set up (default: `false`)\n * @name boxvio_chart_wrapper#_render_violins\n */\nboxvio_chart_wrapper.prototype._render_violins = function (is_g_ready=false) {\n    const chart = this._chart\n    const g = this._graphics.root_g\n\n    // Render\n    if (!is_g_ready) {\n        this._graphics.violins_g = g.append('g')\n    }\n    const violins_g = this._graphics.violins_g\n    for (const [i, key_string] of this._key_strings.entries()) {\n        this._graphics.violins[i] = violins_g.append('g')\n            .attr('transform', `translate(${chart.xscale(key_string)},0)`)\n        this._render_violin(i)\n    }\n\n}\n\n/**\n * Render a violin\n * @function\n * @private\n * @param {boolean} i the index of the violin\n * @name boxvio_chart_wrapper#_render_violins\n */\nboxvio_chart_wrapper.prototype._render_violin = function (i) {\n    const bins = this._chart.bins[i]\n    const violin_scale = this._chart.violin_scale.value\n    const bandwidth = this._chart.xscale.bandwidth()\n    const yscale = this._chart.yscale\n    const violin_curve = this._chart.violin_curve\n\n    // Get the largest count in a bin as it will be maximum width\n    const max_count = d3.max(bins, (bin) => bin.length)\n    // Make a linear scale to map bin counts to bandwidth\n    const x_num = d3.scaleLinear()\n        .range([0, bandwidth])\n        .domain([-max_count, max_count])\n\n    // Only render violin if there is more than 1 datapoint (otherwise there are NaNs around)\n    if (this._data[i].values.length > 1) {\n        this._graphics.violins[i]\n            .append('path')\n            .datum(bins)\n                .style('stroke', 'gray')\n                .style('stroke-width', 0.4)\n                .style('fill', '#d2d2d2')\n                .attr('d', d3.area()\n                    .x0((d) => x_num(-d.length*violin_scale))\n                    .x1((d) => x_num(d.length*violin_scale))\n                    .y((d) => yscale(d.x0))\n                    .curve(violin_curve)\n                )\n    }\n}\n\n/**\n * TODO: refactor\n * Render the boxes (including whiskers and outliers)\n * @function\n * @private\n * @param {boolean} is_g_ready whether the g tag for boxes is\n *        set up (default: `false`)\n * @name boxvio_chart_wrapper#_render_boxes\n */\nboxvio_chart_wrapper.prototype._render_boxes = function (is_g_ready=false) {\n\n    const chart = this._chart\n    const g = this._graphics.root_g\n\n    // Draw\n    if (!is_g_ready) {\n        this._graphics.boxes_g = g.append('g')\n    }\n    const boxes = this._graphics.boxes_g\n    const bandwidth = chart.xscale.bandwidth()\n    const box_width = this._chart.box_scale.value * bandwidth\n\n    const whiskers_lw = 2\n    const median_lw = 3\n\n    // Iterate over the groups\n    for (const [i, ele] of this._data.entries()) {\n\n        const metrics = ele.metrics\n        const color = this._colors[i]\n        const key = ele.key\n\n        const group_box = boxes.append('g')\n            .attr('transform', `translate(${chart.xscale(join_key(key)) + bandwidth / 2},0)`)\n\n        // Draw outliers\n        this._graphics.outliers[i] = group_box.append('g')\n        const outliers = this._graphics.outliers[i]\n        for (const outlier of ele.outliers) {\n            outliers.append('circle')\n                .attr('cx', 0)\n                .attr('cy', chart.yscale(outlier))\n                .attr('r', 4)\n                .style('fill', color)\n                .style('opacity', 0.7)\n        }\n\n        // Draw whiskers\n        const whiskers = group_box.append('g')\n        whiskers.append('line')  // vertical line\n            .attr('x1', 0)\n            .attr('y1', chart.yscale(metrics.lower_fence))\n            .attr('x2', 0)\n            .attr('y2', chart.yscale(metrics.upper_fence))\n            .attr('stroke', color)\n            .attr('stroke-width', whiskers_lw)\n        whiskers.append('line') // lower horizontal\n            .attr('x1', -box_width / 2)\n            .attr('y1', chart.yscale(metrics.lower_fence))\n            .attr('x2', box_width / 2)\n            .attr('y2', chart.yscale(metrics.lower_fence))\n            .attr('stroke', color)\n            .attr('stroke-width', whiskers_lw)\n        whiskers.append('line') // upper horizontal\n            .attr('x1', -box_width / 2)\n            .attr('y1', chart.yscale(metrics.upper_fence))\n            .attr('x2', box_width / 2)\n            .attr('y2', chart.yscale(metrics.upper_fence))\n            .attr('stroke', color)\n            .attr('stroke-width', whiskers_lw)\n\n        // Draw IQR box\n        const iqr = group_box.append('g')\n        // Only draw rectangle if there is more than 1 datapoint (otherwise NaNs appear)\n        if (ele.values.length > 1) {\n            iqr.append('rect')  // iqr rect\n            .attr('x', -box_width / 2)\n            .attr('y', chart.yscale(metrics.quartile3))\n            .attr('width', box_width)\n            .attr('height', chart.yscale(metrics.quartile1) - chart.yscale(metrics.quartile3))\n            .attr('fill', color)\n        }\n        iqr.append('line')  // median line\n            .attr('x1', -box_width / 2)\n            .attr('y1', chart.yscale(metrics.median))\n            .attr('x2', box_width / 2)\n            .attr('y2', chart.yscale(metrics.median))\n            .attr('stroke', 'black')\n            .attr('stroke-width', median_lw)\n        const circle = iqr.append('circle')  // median dot\n            .attr('cx', 0)\n            .attr('cy', chart.yscale(metrics.median))\n            .attr('r', 4.5)\n            .style('fill', 'white')\n            .attr('stroke', 'black')\n            .attr('stroke-width', 2)\n        // Circle events for tooltip\n        circle.on('mouseover', () => {\n            this._graphics.tooltip_div.style('display', null)\n            this.tooltip_hover(i)\n        }).on('mouseout', () => {\n            this._graphics.tooltip_div.style('display', 'none')\n        })\n    }\n\n}\n\n/**\n * Add the tooltip to the DOM\n * @function\n * @private\n * @name boxvio_chart_wrapper#_render_tooltip\n */\nboxvio_chart_wrapper.prototype._render_tooltip = function () {\n    const tooltip_element = common.create_dom_element({\n        element_type: 'div',\n        id: `${this.id_string()}_tooltip_div`,\n        class_name: 'o-red',\n    })\n    insert_after(tooltip_element, this.plot_container)\n    this._graphics.tooltip_div = d3.select(tooltip_element)\n    const tooltip_div = this._graphics.tooltip_div\n    for (const [k, v] of Object.entries(TOOLTIP_STYLE)) {\n        tooltip_div.style(k, v)\n    }\n        \n}\n\n/**\n * Set the tooltip to visible when we hover over\n * @param {number} i index of data\n * @function\n * @name boxvio_chart_wrapper#tooltip_hover\n */\nboxvio_chart_wrapper.prototype.tooltip_hover = function (i) {\n    const decimals = 3\n    const key = this._data[i].key\n    const values = this._data[i].values\n    const metrics = this._data[i].metrics\n    const tooltip_text = `<b>${key.join(', ')}</b>`\n        + '<span style=\"font-size: smaller;\">'\n        + `<br>Datapoints: ${values.length}`\n        + `<br>Mean: ${metrics.mean.toFixed(decimals)}`\n        + `<br>Max: ${metrics.max.toFixed(decimals)}`\n        + `<br>Q3: ${metrics.quartile3.toFixed(decimals)}`\n        + `<br>Median: ${metrics.median.toFixed(decimals)}`\n        + `<br>Q1: ${metrics.quartile1.toFixed(decimals)}`\n        + `<br>Min: ${metrics.min.toFixed(decimals)}`\n        + '</span>'\n    this._graphics.tooltip_div\n        .html(tooltip_text)\n}\n\n/**\n * Render the control panel\n * @function\n * @protected\n * @name boxvio_chart_wrapper#render_control_panel\n */\nboxvio_chart_wrapper.prototype.render_control_panel = function () {\n    d3_chart_wrapper.prototype.render_control_panel.call(this)\n\n    const upper_container = common.create_dom_element({\n        element_type: 'div',\n        parent: this.controls_container,\n        style: {\n            'display': 'flex',\n            'direction': 'flex-row',\n            'justify-content': 'space-between',\n            'align-items': 'center',\n        },\n    })\n    this._render_grid_select(upper_container)\n    this._render_xticklabel_angle_slider(upper_container)\n    this._render_violin_curve_selector(upper_container)\n    this._render_checkboxes()\n    this._render_scale_sliders()\n    this._render_n_bins_control()\n\n}\n\n/**\n * Render the selector for grid mode\n * @function\n * @private\n * @param {Element} container the container element\n * @name boxvio_chart_wrapper#_render_grid_select\n */\nboxvio_chart_wrapper.prototype._render_grid_select = function (container) {\n    const select_container = common.create_dom_element({\n        element_type: 'div',\n        parent: container,\n        style: {\n            'display': 'flex',\n            'gap': DEFAULT_FLEX_GAP,\n        },\n    })\n    const grid_select_id = `${this.id_string()}_grid_select`\n    const grid_select_label = common.create_dom_element({\n        element_type: 'label',\n        text_content: tstring.grid || 'Grid',\n        parent: select_container,\n        style: {'margin-block': 'auto'},\n    })\n    grid_select_label.setAttribute('for', grid_select_id)\n    const grid_select = common.create_dom_element({\n        element_type: 'select',\n        id: grid_select_id,\n        parent: select_container,\n        // TODO: add ARIA attributes?\n    })\n    common.create_dom_element({\n        element_type: 'option',\n        value: 'None',\n        text_content: tstring.none_f || 'None',\n        parent: grid_select,\n    })\n    common.create_dom_element({\n        element_type: 'option',\n        value: 'Major',\n        text_content: tstring.major || 'Major',\n        parent: grid_select,\n    })\n    common.create_dom_element({\n        element_type: 'option',\n        value: 'Major + Minor',\n        text_content: tstring.major_minor || 'Major + Minor',\n        parent: grid_select,\n    })\n    grid_select.addEventListener('change', () => {\n        const mode = grid_select.value\n        this.apply_ygrid_mode(mode)\n    })\n}\n\n/**\n * Render the slider for the xticklabel angle\n * @function\n * @private\n * @param {Element} container the container element\n * @name boxvio_chart_wrapper#_render_xticklabel_angle_slider\n */\nboxvio_chart_wrapper.prototype._render_xticklabel_angle_slider = function (container) {\n    const slider_container = common.create_dom_element({\n        element_type: 'div',\n        parent: container,\n        style: {\n            'display': 'flex',\n            'gap': DEFAULT_FLEX_GAP,\n        },\n    })\n    const xticklabel_angle_slider_id = `${this.id_string()}_xticklabel_angle_slider`\n    const xticklabel_angle_slider_label = common.create_dom_element({\n        element_type: 'label',\n        text_content: tstring.xticklabel_angle || \"X-Tick label angle\",\n        parent: slider_container,\n        style: {'margin-block': 'auto'},\n    })\n    xticklabel_angle_slider_label.setAttribute('for', xticklabel_angle_slider_id)\n    /** @type {Element} */\n    const xticklabel_angle_slider = common.create_dom_element({\n        element_type: 'input',\n        type: 'range',\n        id: xticklabel_angle_slider_id,\n        parent: slider_container,\n    })\n    xticklabel_angle_slider.setAttribute('min', 0)\n    xticklabel_angle_slider.setAttribute('max', 90)\n    xticklabel_angle_slider.value = this._chart.xticklabel_angle\n    xticklabel_angle_slider.addEventListener('input', () => {\n        this._chart.xticklabel_angle = Number(xticklabel_angle_slider.value)\n        this.apply_xticklabel_angle()\n    })\n}\n\n/**\n * Render the selector for the violin curve\n * @function\n * @private\n * @param {Element} container the container element\n * @name boxvio_chart_wrapper#_render_violin_curve_selector\n */\nboxvio_chart_wrapper.prototype._render_violin_curve_selector = function (container) {\n    const select_container = common.create_dom_element({\n        element_type: 'div',\n        parent: container,\n        style: {\n            'display': 'flex',\n            'gap': DEFAULT_FLEX_GAP,\n        },\n    })\n    const curve_select_id = `${this.id_string()}_curve_select`\n    const curve_select_label = common.create_dom_element({\n        element_type: 'label',\n        text_content: tstring.violin_curve || 'Violin curve',\n        parent: select_container,\n        style: {'margin-block': 'auto'},\n    })\n    curve_select_label.setAttribute('for', curve_select_id)\n    const curve_select = common.create_dom_element({\n        element_type: 'select',\n        id: curve_select_id,\n        parent: select_container,\n        // TODO: add ARIA attributes?\n    })\n    for (const curve_name of this._chart.supported_curves) {\n        common.create_dom_element({\n            element_type: 'option',\n            value: curve_name,\n            text_content: curve_name,\n            parent: curve_select,\n        })\n    }\n    curve_select.addEventListener('change', () => {\n        this.set_violin_curve(curve_select.value)\n    })\n}\n\n/**\n * Render the checkboxes of the control panel\n * @function\n * @private\n * @name boxvio_chart_wrapper#_render_checkboxes\n */\nboxvio_chart_wrapper.prototype._render_checkboxes = function () {\n    // Container div\n    const container_div = common.create_dom_element({\n        element_type: 'div',\n        parent: this.controls_container,\n        style: {\n            'display': 'flex',\n            'direction': 'flex-row',\n            'justify-content': 'space-between',\n            'align-items': 'center',\n            'margin-top': DEFUALT_MARGIN,\n        },\n    })\n\n    // Show key 2\n    const show_key2_div = common.create_dom_element({\n        element_type: 'div',\n        parent: container_div,\n    })\n    const show_key2_checkbox_id = `${this.id_string()}_show_key2_checkbox`\n    /** @type {Element} */\n    const show_key2_checkbox = common.create_dom_element({\n        element_type: 'input',\n        type: 'checkbox',\n        id: show_key2_checkbox_id,\n        parent: show_key2_div,\n    })\n    show_key2_checkbox.checked = true\n    /** @type {Element} */\n    const show_key2_label = common.create_dom_element({\n        element_type: 'label',\n        text_content: (tstring.show || 'Show')\n                      + ' '\n                      + this._key_titles[this._key_size-2].toLowerCase(),\n        parent: show_key2_div,\n    })\n    show_key2_label.setAttribute('for', show_key2_checkbox_id)\n    show_key2_checkbox.addEventListener('change', () => {\n        toggle_visibility(this._graphics.key2_dividers_g)\n    })\n    \n    // Show violins\n    const show_violins_div = common.create_dom_element({\n        element_type: 'div',\n        parent: container_div,\n    })\n    const show_violins_checkbox_id = `${this.id_string()}_show_violins_checkbox`\n    /** @type {Element} */\n    const show_violins_checkbox = common.create_dom_element({\n        element_type: 'input',\n        type: 'checkbox',\n        id: show_violins_checkbox_id,\n        parent: show_violins_div,\n    })\n    show_violins_checkbox.checked = true\n    /** @type {Element} */\n    const show_violins_label = common.create_dom_element({\n        element_type: 'label',\n        text_content: tstring.show_violins || 'Show violins',\n        parent: show_violins_div,\n    })\n    show_violins_label.setAttribute('for', show_violins_checkbox_id)\n    show_violins_checkbox.addEventListener('change', () => {\n        toggle_visibility(this._graphics.violins_g)\n    })\n\n    // Show boxes\n    const show_boxes_div = common.create_dom_element({\n        element_type: 'div',\n        parent: container_div,\n    })\n    const show_boxes_checkbox_id = `${this.id_string()}_show_boxes_checkbox`\n    /** @type {Element} */\n    const show_boxes_checkbox = common.create_dom_element({\n        element_type: 'input',\n        type: 'checkbox',\n        id: show_boxes_checkbox_id,\n        parent: show_boxes_div,\n    })\n    show_boxes_checkbox.checked = true\n    /** @type {Element} */\n    const show_boxes_label = common.create_dom_element({\n        element_type: 'label',\n        text_content: tstring.show_boxes || 'Show boxes',\n        parent: show_boxes_div,\n    })\n    show_boxes_label.setAttribute('for', show_boxes_checkbox_id)\n    show_boxes_checkbox.addEventListener('change', () => {\n        toggle_visibility(this._graphics.boxes_g)\n        // (DISABLED) Disable the checkbox for outliers (defined below)\n        // show_outliers_checkbox.disabled = !show_boxes_checkbox.checked\n    })\n\n    // Show outliers\n    const show_outliers_div = common.create_dom_element({\n        element_type: 'div',\n        parent: container_div,\n    })\n    const show_outliers_checkbox_id = `${this.id_string()}_show_outliers_checkbox`\n    /** @type {Element} */\n    const show_outliers_checkbox = common.create_dom_element({\n        element_type: 'input',\n        type: 'checkbox',\n        id: show_outliers_checkbox_id,\n        parent: show_outliers_div,\n    })\n    show_outliers_checkbox.checked = true\n    /** @type {Element} */\n    const show_outliers_label = common.create_dom_element({\n        element_type: 'label',\n        text_content: tstring.show_outliers || 'Show outliers',\n        parent: show_outliers_div,\n    })\n    show_outliers_label.setAttribute('for', show_outliers_checkbox_id)\n    show_outliers_checkbox.addEventListener('change', () => {\n        for (const group of this._graphics.outliers) {\n            toggle_visibility(group)\n        }\n    })\n}\n\n/**\n * Render the sliders of the control panel that\n * control the scale of violins and boxes\n * @function\n * @private\n * @name boxvio_chart_wrapper#_render_scale_sliders\n */\nboxvio_chart_wrapper.prototype._render_scale_sliders = function () {\n    // Container div\n    const container_div = common.create_dom_element({\n        element_type: 'div',\n        parent: this.controls_container,\n        style: {\n            'display': 'flex',\n            'direction': 'flex-row',\n            'justify-content': 'space-between',\n            'align-items': 'center',\n        },\n    })\n\n    // Violin scale\n    const violin_container_div = common.create_dom_element({\n        element_type: 'div',\n        parent: container_div,\n        style: {\n            'display': 'flex',\n            'gap': DEFAULT_FLEX_GAP,\n        },\n    })\n    const violin_scale_slider_id = `${this.id_string()}_violin_scale_slider`\n    const violin_scale_slider_label = common.create_dom_element({\n        element_type: 'label',\n        text_content: tstring.violin_width || 'Violin width',\n        parent: violin_container_div,\n        style: {\n            'margin-block': 'auto',\n        },\n    })\n    violin_scale_slider_label.setAttribute('for', violin_scale_slider_id)\n    /** @type {Element} */\n    const violin_scale_slider = common.create_dom_element({\n        element_type: 'input',\n        type: 'range',\n        id: violin_scale_slider_id,\n        parent: violin_container_div,\n    })\n    violin_scale_slider.setAttribute('min', 0)\n    violin_scale_slider.setAttribute('max', 1)\n    violin_scale_slider.setAttribute('step', 0.05)\n    violin_scale_slider.value = this._chart.violin_scale.initial\n    violin_scale_slider.addEventListener('input', () => {\n        this.set_violin_scale(Number(violin_scale_slider.value))\n    })\n    /** @type {Element} */\n    const violin_scale_slider_reset = common.create_dom_element({\n        element_type: 'button',\n        type: 'button',\n        text_content: tstring.reset || 'Reset',\n        parent: violin_container_div,\n    })\n    violin_scale_slider_reset.addEventListener('click', () => {\n        violin_scale_slider.value = this._chart.violin_scale.initial\n        this.set_violin_scale(Number(violin_scale_slider.value))\n    })\n\n    // Box scale\n    const box_container_div = common.create_dom_element({\n        element_type: 'div',\n        parent: container_div,\n        style: {\n            'display': 'flex',\n            'gap': DEFAULT_FLEX_GAP,\n        },\n    })\n    const box_scale_slider_id = `${this.id_string()}_box_scale_slider`\n    const box_scale_slider_label = common.create_dom_element({\n        element_type: 'label',\n        text_content: tstring.box_width || 'Box width',\n        parent: box_container_div,\n        style: {\n            'margin-block': 'auto',\n        },\n    })\n    box_scale_slider_label.setAttribute('for', box_scale_slider_id)\n    /** @type {Element} */\n    const box_scale_slider = common.create_dom_element({\n        element_type: 'input',\n        type: 'range',\n        id: box_scale_slider_id,\n        parent: box_container_div,\n    })\n    box_scale_slider.setAttribute('min', 0)\n    box_scale_slider.setAttribute('max', 1)\n    box_scale_slider.setAttribute('step', 0.05)\n    box_scale_slider.value = this._chart.box_scale.initial\n    box_scale_slider.addEventListener('input', () => {\n        this.set_box_scale(Number(box_scale_slider.value))\n    })\n    /** @type {Element} */\n    const box_scale_slider_reset = common.create_dom_element({\n        element_type: 'button',\n        type: 'button',\n        text_content: tstring.reset || 'Reset',\n        parent: box_container_div,\n    })\n    box_scale_slider_reset.addEventListener('click', () => {\n        box_scale_slider.value = this._chart.box_scale.initial\n        this.set_box_scale(Number(box_scale_slider.value))\n    })\n}\n\n/**\n * Render the control elements to change the number of bins\n * @function\n * @private\n * @name boxvio_chart_wrapper#_render_n_bins_control\n */\nboxvio_chart_wrapper.prototype._render_n_bins_control = function () {\n    // Render selects for the different key components\n    const key_selects = []\n    /**\n     * Inner function for populating a key select tag\n     * Previous key tags must be populated already\n     * @param {number} i index of the key select \n     */\n    const populate_key_select = (i) => {\n        key_selects[i].replaceChildren()  // Delete existing children\n        const pkey = key_selects.slice(0, i).map((key_select) => key_select.value)\n        const values = this._get_next_key_component_values(pkey)\n        for (const value of values) {\n            common.create_dom_element({\n                element_type: 'option',\n                value: value,\n                text_content: value,\n                parent: key_selects[i],\n            })\n        }\n    }\n    for (let i = 0; i < this._key_size; i++) {\n        const select_id = `${this.id_string()}_key${this._key_size-i}_select`\n        const label = common.create_dom_element({\n            element_type: 'label',\n            text_content: this._key_titles[i],\n            parent: this.controls_container,\n        })\n        label.setAttribute('for', select_id)\n        const key_select = common.create_dom_element({\n            element_type: 'select',\n            id: select_id,\n            parent: this.controls_container,\n        })\n        key_selects.push(key_select)\n        populate_key_select(i)\n        key_select.addEventListener('change', () => {\n            // Repopulate the next key selects\n            for (let j = i+1; j < key_selects.length; j++) {\n                populate_key_select(j)\n            }\n            // Update the selected index\n            this._controls.selected_index = this.get_index_of_key(\n                key_selects.map((ks) => ks.value)\n            )\n            // Update the violin n bins slider\n            violin_n_bins_slider.setAttribute(\n                'max',\n                this._controls.max_bins_multiplier\n                    * this._chart.n_bins[this._controls.selected_index].initial\n            )\n            violin_n_bins_slider.value\n                = this._chart.n_bins[this._controls.selected_index].value\n        })\n    }\n\n    // Slider for n bins\n    const violin_n_bins_slider_id = `${this.id_string()}_violin_n_bins_slider`\n    const violin_n_bins_label = common.create_dom_element({\n        element_type: 'label',\n        text_content: tstring.violin_resolution || 'Violin resolution',\n        parent: this.controls_container,\n    })\n    violin_n_bins_label.setAttribute('for', violin_n_bins_slider_id)\n    const violin_n_bins_slider = common.create_dom_element({\n        element_type: 'input',\n        type: 'range',\n        id: violin_n_bins_slider_id,\n        parent: this.controls_container,\n    })\n    violin_n_bins_slider.setAttribute('min', 2)\n    violin_n_bins_slider.setAttribute(\n        'max',\n        this._controls.max_bins_multiplier\n            * this._chart.n_bins[this._controls.selected_index].initial\n    )\n    violin_n_bins_slider.value = this._chart.n_bins[this._controls.selected_index].value\n    violin_n_bins_slider.addEventListener('input', () => {\n        this.set_n_bins(this._controls.selected_index, Number(violin_n_bins_slider.value))\n    })\n\n    // Reset n bins\n    const violin_n_bins_slider_reset = common.create_dom_element({\n        element_type: 'button',\n        type: 'button',\n        text_content: tstring.reset || 'Reset',\n        parent: this.controls_container,\n    })\n    violin_n_bins_slider_reset.addEventListener('click', () => {\n        violin_n_bins_slider.value = this._chart.n_bins[this._controls.selected_index].initial\n        this.set_n_bins(this._controls.selected_index, Number(violin_n_bins_slider.value))\n    })\n\n    // Reset all n bins\n    const violin_all_n_bins_slider_reset = common.create_dom_element({\n        element_type: 'button',\n        type: 'button',\n        text_content: tstring.reset_all_violins || 'Reset all violins',\n        parent: this.controls_container,\n    })\n    violin_all_n_bins_slider_reset.addEventListener('click', () => {\n        // Update the value of the slider\n        violin_n_bins_slider.value = this._chart.n_bins[this._controls.selected_index].initial\n        for (const [i, n_bins] of this._chart.n_bins.entries()) {\n            this.set_n_bins(i, n_bins.initial)\n        }\n    })\n}\n\n\n// HELPER FUNCTIONS\n\n/**\n * Compute (boxplot) metrics for the data\n * @param {number[]} values the data values\n * @returns {{\n *  max: number,\n *  upper_fence: number,\n *  quartile3: number,\n *  median: number,\n *  mean: number,\n *  iqr: number,\n *  quartile1: number,\n *  lower_fence: number,\n *  min: number,\n * }}\n */\nfunction calc_metrics(values) {\n    const metrics = {\n        max: null,\n        upper_fence: null,\n        quartile3: null,\n        median: null,\n        mean: null,\n        iqr: null,\n        quartile1: null,\n        lower_fence: null,\n        min: null,\n    }\n\n    metrics.min = d3.min(values)\n    metrics.quartile1 = d3.quantile(values, 0.25)\n    metrics.median = d3.median(values)\n    metrics.mean = d3.mean(values)\n    metrics.quartile3 = d3.quantile(values, 0.75)\n    metrics.max = d3.max(values)\n    metrics.iqr = metrics.quartile3 - metrics.quartile1\n    metrics.lower_fence = metrics.quartile1 - 1.5 * metrics.iqr\n    metrics.upper_fence = metrics.quartile3 + 1.5 * metrics.iqr\n\n    return metrics\n}\n\n/**\n * Splitter string\n * @type {string}\n */\nconst SPLITTER = '_^PoT3sRanaCantora_'\n\n/**\n * Join key array into a string\n * @param {string[]} key the key\n * @returns {string} the join\n */\nfunction join_key(key) {\n    return key.join(SPLITTER)\n}\n\n/**\n * Split key string into array\n * @param {string} key the key join\n * @returns {string[]} the split key\n */\nfunction split_key(key) {\n    return key.split(SPLITTER)\n}","\"use strict\";\n\nimport { chart_wrapper } from \"../chart-wrapper.js\";\n\n/**\n * Chart.js chart wrapper class\n * @class\n * @abstract\n * @param {Element} div_wrapper the div conatining the chart\n * @param {Object} options configuration options\n * @param {boolean} options.display_download whether to display the download panel (default `false`)\n * @param {boolean} options.display_control_panel whether to display the control panel (default `false`)\n * @extends chart_wrapper\n */\nexport function chartjs_chart_wrapper(div_wrapper, options) {\n    if (this.constructor === chartjs_chart_wrapper) {\n        throw new Error(\"Abstract class 'chartjs_chart_wrapper' cannot be instantiated\")\n    }\n    chart_wrapper.call(this, div_wrapper, options)\n    /**\n     * Canvas instance, will be created during\n     * render\n     * @type {HTMLCanvasElement}\n     * @protected\n     */\n    this.canvas = undefined\n    /**\n     * Chart instance (chart.js)\n     * @protected\n     */\n    this.chart = undefined\n}\n// Set prototype chain\nObject.setPrototypeOf(chartjs_chart_wrapper.prototype, chart_wrapper.prototype)\n\n/**\n * Render the plot\n * \n * Subclasses must call this method at the top\n * of their own implementation. Then, they can make\n * use of the canvas and the chartjs chart instance\n * @name chartjs_chart_wrapper#render_plot\n * @function\n * @protected\n */\nchartjs_chart_wrapper.prototype.render_plot = function () {\n    chart_wrapper.prototype.render_plot.call(this)\n    // Create canvas\n    this.canvas = common.create_dom_element({\n        element_type: 'canvas',\n        id: 'result_graph',\n        class_name: 'o-blue',\n        parent: this.plot_container,\n    })\n    // Set chart instance to undefined\n    this.chart = undefined\n}\n\n/**\n * Get the supported chart export formats\n * @function\n * @returns {string[]} the supported formats\n * @name chartjs_chart_wrapper#get_supported_export_formats\n */\nchartjs_chart_wrapper.prototype.get_supported_export_formats = function () {\n    return ['png']\n}\n\n/**\n * Download the chart as png\n * @param {string} filename the name of the file\n * @function\n * @name chartjs_chart_wrapper#_download_chart_as_png\n */\nchartjs_chart_wrapper.prototype.download_chart_as_png = function (filename) {\n    /**\n     * Temporary link\n     * @type {Element}\n     */\n    const tmpLink = common.create_dom_element({\n        element_type: 'a',\n        href: this.chart.toBase64Image(),\n    })\n    tmpLink.setAttribute('download', filename)\n    tmpLink.click()\n    tmpLink.remove()\n}\n\n/**\n * FIXME: this is not working...\n * Download the chart as svg\n * @param {string} filename the name of the file\n * @function\n * @name chartjs_chart_wrapper#_download_chart_as_svg\n */\nchartjs_chart_wrapper.prototype.download_chart_as_svg = function (filename) {\n    // Tweak C2S library\n    this._tweak_c2s()\n    // Get original width and height\n    const width = this.canvas.offsetWidth\n    const height = this.canvas.offsetHeight\n    // TODO: Turn off responsiveness and animations\n    this.chart.options.animation = false\n    this.chart.options.reponsive = false\n    // Replicate chart in C2S space\n    const svgContext = C2S(width, height)\n    const svgChart = new Chart(svgContext, this.chart.config._config)\n    // Download\n    /**\n     * Temporary link\n     * @type {Element}\n     */\n    const tmpLink = common.create_dom_element({\n        element_type: 'a',\n        href: 'data:image/svg+xml;utf8,'\n            + encodeURIComponent(svgContext.getSerializedSvg()),\n    })\n    tmpLink.setAttribute('download', filename)\n    tmpLink.click()\n    tmpLink.remove()\n    // TODO: Turn on responsiveness and animations\n    this.chart.options.animation = true\n    this.chart.options.reponsive = true\n}\n\n/**\n * Some tweaks to the canvas2svg library are required for svg export to work\n * \n * Via: https://stackoverflow.com/questions/62249315/export-canvas-to-svg-file\n * @function\n * @private\n * @name chartjs_chart_wrapper#_tweak_c2s\n */\nchartjs_chart_wrapper.prototype._tweak_c2s = function () {\n    C2S.prototype.getContext = function (contextId) {\n        if (contextId === '2d' || contextId === '2D') {\n            return this;\n        }\n        return null;\n    }\n    C2S.prototype.style = function () {\n        return this.__canvas.style;\n    }\n    C2S.prototype.getAttribute = function (name) {\n        return this[name];\n    }\n    C2S.prototype.addEventListener = function (type, listener, eventListenerOptions) {\n        // nothing to do here, but we need this function :)\n    }\n}","\"use strict\";\n\nimport { chartjs_chart_wrapper } from \"./chartjs-chart-wrapper.js\";\nimport { COLOR_PICKER_WIDTH, COLOR_PALETTE } from \"../chart-wrapper.js\";\nimport { compute_n_bins } from \"../compute-n-bins.js\";\n\n/**\n * Histogram wrapper\n * @param {Element}  div_wrapper the div to work in\n * @param {number[]} data the data\n * @param {Object} options configuration options\n * @param {boolean} options.display_download whether to display the download panel (default `false`)\n * @param {boolean} options.display_control_panel whether to display the control panel (default `false`)\n * @param {string} options.xlabel the label for the x-axis (default `null` )\n * @class\n * @extends chartjs_chart_wrapper\n */\nexport function histogram_wrapper(div_wrapper, data, options) {\n    /*\n     * <Function>.call is a method that executes the defined function,\n     * but with the \"this\" variable pointing to the first argument,\n     * and the rest of the arguments being arguments of the function\n     * that is being \"called\". This essentially performs all of\n     * chart_wrapper's constructor logic on histogram_wrapper's \"this\".\n     */\n    chartjs_chart_wrapper.call(this, div_wrapper, options)\n\n    /**\n     * Data values\n     * @type {number[]}\n     * @private\n     */\n    this._data = data\n    /**\n     * Whether to perform a density plot\n     * @type {boolean}\n     * @private\n     */\n    this._density = false\n    /**\n     * Default number of bins\n     * @type {number}\n     * @private\n     */\n    this._n_bins_default = compute_n_bins.sqrt(this._data)\n    /**\n     * Number of bins in the histogram\n     * \n     * Defined as the square root of the\n     * amount of datapoints, computed\n     * during render\n     * @type {number}\n     * @private\n     */\n    this._n_bins = undefined\n    /** Label for the xaxis\n     * @type {string}\n     * @private\n    */\n    this._xlabel = options.xlabel || null\n    /**\n     * Number of decimals to display\n     * @type {number}\n     * @private\n     */\n    this._n_decimals = 3\n    /**\n     * Maximum number of bins as mutiplier of default\n     * @type {number}\n     * @private\n     */\n    this._max_bins_multiplier = 3\n    /**\n     * Default color for the bars in rgba\n     * @type {string}\n     * @private\n     */\n    this._bar_color = COLOR_PALETTE[0]\n}\n// Set prototype chain\nObject.setPrototypeOf(histogram_wrapper.prototype, chartjs_chart_wrapper.prototype)\n\n/**\n * Check whether we are doing a density plot\n * @returns {boolean} `true` if density plot,\n * \t\t\t`false` otherwise\n * @name histogram_wrapper#get_density\n * @function\n */\nhistogram_wrapper.prototype.get_density = function () {\n    return this._density\n}\n\n/**\n * Change the density plot attribute\n * @param density {boolean} `true` if density, `false` otherwise\n * @function\n * @name histogram_wrapper#set_density\n */\nhistogram_wrapper.prototype.set_density = function (density) {\n    this._density = density\n    if (!this.chart) {\n        return\n    }\n    // Update chart\n    const [\n        bin_centers, plot_data, half_bin_width, data_min, data_max\n    ] = this._get_plotting_data()\n    this.chart.data.datasets[0].label = this._get_density_string()\n    this.chart.data.datasets[0].data = plot_data\n    this.chart.options.scales.y.title.text = this._get_density_string()\n    this.chart.update()\n}\n\n/**\n * Get a string representing the plot mode\n * @returns {string} `'Density'` if we are in density\n * \t\t\tmode, `'Frequency'` otherwise\n * @function\n * @private\n * @name histogram_wrapper#_get_density_string\n */\nhistogram_wrapper.prototype._get_density_string = function () {\n    return this._density ? 'Density' : 'Frequency'\n}\n\n/**\n * Get the amount of bins in the histogram\n * @returns {number} the amount of bins\n * @function\n * @name histogram_wrapper#get_n_bins\n */\nhistogram_wrapper.prototype.get_n_bins = function () {\n    return this._n_bins\n}\n\n/**\n * Set a new number of bins for the histogram\n * \n * Updates chart instance accordingly\n * @param {number} n_bins amount of bins\n * @function\n * @name histogram_wrapper#set_n_bins\n */\nhistogram_wrapper.prototype.set_n_bins = function (n_bins) {\n    this._n_bins = n_bins\n    if (!this.chart) {\n        return\n    }\n    // Update chart\n    const [\n        bin_centers, plot_data, half_bin_width, data_min, data_max\n    ] = this._get_plotting_data()\n    this.chart.data.datasets[0].data = plot_data\n    this.chart.options.scales.x.min = data_min\n    this.chart.options.scales.x.max = data_max\n    this.chart.options.scales.x.ticks.stepSize = 2 * half_bin_width\n    this.chart.options.plugins.tooltip.callbacks.title =\n        this._get_tooltip_title_callback(bin_centers, half_bin_width)\n    this.chart.update()\n}\n\n/**\n * Get the color of the bars in the histogram\n * @returns {string} the bar color as an rgba string\n * @function\n * @name histogram_wrapper#get_bar_color\n */\nhistogram_wrapper.prototype.get_bar_color = function () {\n    return this._bar_color\n}\n\n/**\n * Set a new color for the bars in the histogram\n * \n * Updates the chart instance accordingly\n * @param {string} bar_color the new bar color for the histogram\n * @function\n * @name histogram_wrapper#set_bar_color\n */\nhistogram_wrapper.prototype.set_bar_color = function (bar_color) {\n    this._bar_color = bar_color\n    if (!this.chart) {\n        return\n    }\n    this.chart.data.datasets[0].backgroundColor = this._bar_color\n    this.chart.update()\n}\n\n/**\n * Get data needed to generate the chart\n * TODO: there is no need to recompute bin_centers unless the number of bins\n* \t\t has changed\n* @function\n* @name histogram_wrapper#_get_plotting_data\n* @private\n* \n* @returns {[number[], {x: number, y: number}[], number, number, number]}\n* \t\t\tthe bin centers, {bin centers, count per bin}, half of the bin width,\n* \t\t\tthe minimum and maximum of input data\n */\nhistogram_wrapper.prototype._get_plotting_data = function () {\n    const data_max = Math.max(...this._data)\n    const data_min = Math.min(...this._data)\n    const bin_width = (data_max - data_min) / this._n_bins\n    const half_bin_width = 0.5 * bin_width\n    /**\n     * Center of each bin\n     * @type {number[]}\n     */\n    const bin_centers = Array.apply(null, Array(this._n_bins)).map(\n        (value, index) => data_min + (2 * index + 1) * half_bin_width\n    )\n    // We bin with right-open intervals\n    /**\n     * Count per bin\n     * @type {number[]}\n     */\n    let entries = Array.apply(null, Array(this._n_bins)).map(() => 0)\n    for (let i = 0; i < this._data.length; i++) {\n        // If value is max, add it to last bin\n        if (this._data[i] === data_max) {\n            entries[this._n_bins - 1]++\n            continue\n        }\n        // Proceed as usual\n        for (let j = 0; j < this._n_bins; j++) {\n            if (this._data[i] >= bin_centers[j] - half_bin_width\n                && this._data[i] < bin_centers[j] + half_bin_width) {\n                entries[j]++\n                break\n            }\n        }\n    }\n    // Normalize if density\n    if (this._density) {\n        const sum = entries.reduce((partialSum, val) => partialSum + val, 0)\n        for (let j = 0; j < this._n_bins; j++) {\n            entries[j] /= (sum * bin_width);\n        }\n    }\n    return [\n        bin_centers,\n        bin_centers.map((val, i) => ({ x: val, y: entries[i] })),\n        half_bin_width,\n        data_min,\n        data_max,\n    ]\n}\n\n/**\n * Get callback function for tooltip title\n * @param {number[]} bin_centers the bin centers\n * @param {number} half_bin_width half of the bin width\n * @returns the callback function\n * @function\n * @private\n * @name histogram_wrapper#_get_tooltip_title_callback\n */\nhistogram_wrapper.prototype._get_tooltip_title_callback = function (bin_centers, half_bin_width) {\n    // Cannot use `this` inside inner function!!!\n    const xlabel = this._xlabel\n    const n_decimals = this._n_decimals\n    /**\n     * Callback function for the tooltip title\n     * @param {TooltipItem[]} items the tooltip item contexts\n     * @returns {string} the title of the tooltip\n     * @function\n     * @name histogram_wrapper#_get_tooltip_title_callback~inner\n     */\n    const callback = function (items) {\n        if (!items.length) {\n            return ''\n        }\n        const item = items[0]\n        const index = item.dataIndex\n        const min = bin_centers[index] - half_bin_width\n        const max = bin_centers[index] + half_bin_width\n        return `${xlabel}: ${min.toFixed(n_decimals)} `\n            + `- ${max.toFixed(n_decimals)}`\n    }\n    return callback\n}\n\n/**\n * Render the plot\n * @function\n * @protected\n * @name histogram_wrapper#render_plot\n */\nhistogram_wrapper.prototype.render_plot = function () {\n    chartjs_chart_wrapper.prototype.render_plot.call(this)\n\n    this._n_bins = this._n_bins_default\n    const [\n        bin_centers, plot_data, half_bin_width, data_min, data_max\n    ] = this._get_plotting_data()\n\n    // Split chart options\n    const chart_data = {\n        datasets: [{\n            label: this._get_density_string(),\n            data: plot_data,\n            categoryPercentage: 1,\n            barPercentage: 1,\n            backgroundColor: this._bar_color,\n        }],\n    }\n    const scales_options = {\n        x: {\n            type: 'linear',  // otherwise it goes to a category axis...\n            min: data_min,\n            max: data_max,\n            offset: false,\n            grid: {\n                offset: false,\n            },\n            ticks: {\n                stepSize: 2 * half_bin_width,\n                callback: (label, index, labels) => {\n                    return Number(label).toFixed(this._n_decimals)\n                }\n            },\n            title: {\n                display: Boolean(this._xlabel),  // Only display if there is a label\n                text: this._xlabel,\n                font: {\n                    size: 14\n                },\n            }\n        },\n        y: {\n            title: {\n                display: true,\n                text: this._get_density_string(),\n                font: {\n                    size: 14,\n                },\n            },\n        },\n    }\n    const plugins_options = {\n        legend: {\n            display: false,\n        },\n        tooltip: {\n            callbacks: {\n                title: this._get_tooltip_title_callback(bin_centers, half_bin_width),\n            },\n        },\n    }\n\n    // Render the graph\n    this.chart = new Chart(this.canvas, {\n        type: 'bar',\n        data: chart_data,\n        options: {\n            scales: scales_options,\n            plugins: plugins_options,\n            parsing: false,\n            normalized: true,\n        },\n    })\n}\n\n\n/**\n * Render the control panel\n * @function\n * @protected\n * @name histogram_wrapper#render_control_panel\n */\nhistogram_wrapper.prototype.render_control_panel = function () {\n    chartjs_chart_wrapper.prototype.render_control_panel.call(this)\n\n    // Save this histogram wrapper instance, because when we change scope\n    // we may still need to refer to it\n    /**\n     * This histogram_wrapper instance\n     * @type {histogram_wrapper}\n     */\n    const self = this\n    /**\n     * Slider for number of bins\n     * @type {Element}\n     */\n    const slider = common.create_dom_element({\n        element_type: 'input',\n        type: 'range',\n        value: this._n_bins_default,\n        parent: this.controls_container,\n    })\n    slider.setAttribute('min', 1)\n    slider.setAttribute('max', this._max_bins_multiplier * this._n_bins_default)\n    slider.addEventListener('input', () => {\n        this.set_n_bins(Number(slider.value))\n    })\n    /**\n     * Reset button for the slider\n     * @type {Element}\n     */\n    const slider_reset = common.create_dom_element({\n        element_type: 'button',\n        type: 'button',\n        text_content: 'Reset',\n        parent: this.controls_container,\n    })\n    slider_reset.addEventListener('click', () => {\n        slider.value = this._n_bins_default\n        this.set_n_bins(Number(slider.value))\n    })\n\n    const density_checkbox_id = `${this.id_string()}_density_checkbox`\n    /**\n     * Checkbox for density plot\n     * @type {Element}\n     */\n    const density_checkbox = common.create_dom_element({\n        element_type: 'input',\n        type: 'checkbox',\n        id: density_checkbox_id,\n        parent: this.controls_container,\n    })\n    /**\n     * Checkbox label for density plot\n     * @type {Element}\n     */\n    const density_checkbox_label = common.create_dom_element({\n        element_type: 'label',\n        text_content: 'Density',\n        parent: this.controls_container,\n    })\n    density_checkbox_label.setAttribute('for', density_checkbox_id)\n    density_checkbox.addEventListener('change', () => {\n        this.set_density(Boolean(density_checkbox.checked))\n    })\n    /** iro.js color picker */\n    const color_picker_container = common.create_dom_element({\n        element_type: 'div',\n        id: `${this.id_string()}_color_picker_container`,\n        parent: this.controls_container\n    })\n    const color_picker = new window.iro.ColorPicker(color_picker_container, {\n        color: this._bar_color,\n        width: COLOR_PICKER_WIDTH,\n        layoutDirection: 'horizontal',\n        layout: [\n            {\n                component: window.iro.ui.Wheel,\n            },\n            {\n                component: window.iro.ui.Slider,\n            },\n            {\n                component: window.iro.ui.Slider,\n                options: {\n                    sliderType: 'alpha',\n                }\n            },\n        ],\n    })\n    color_picker.on('color:change', function (color) {\n        self.set_bar_color(color.rgbaString)\n    })\n}","/*global tstring, page_globals, Promise, data_manager, common */\n/*eslint no-undef: \"error\"*/\n\n\"use strict\";\n\n\nimport { chart_wrapper } from \"../../lib/charts/chart-wrapper.js\";\nimport { boxvio_chart_wrapper } from \"../../lib/charts/d3/boxvio-chart-wrapper.js\";\nimport { histogram_wrapper } from \"../../lib/charts/chartjs/histogram-wrapper.js\";\n\n\nexport const analysis =  {\n\n\t// Form factory instance\n\tform: null,\n\n\tarea_name\t\t\t\t: null,\n\trow\t\t\t\t\t\t: null,\n\n\t// DOM containers\n\texport_data_container\t\t: null,\n\tform_items_container\t\t: null,\n\tdiameter_chart_container\t: null,\n\tweight_chart_container\t\t: null,\n\n\t/**\n\t * Chart wrapper instance for diameter\n\t * @type {chart_wrapper}\n\t */\n\tdiameter_chart_wrapper: null,\n\t/**\n\t * Chart wrapper instance for weight\n\t * @type {chart_wrapper}\n\t */\n\tweight_chart_wrapper: null,\n\n\n\tset_up : function(options) {\n\n\t\tconst self = this\n\n\t\t// options\n\t\t\tself.area_name\t\t\t\t\t= options.area_name\n\t\t\tself.export_data_container\t\t= options.export_data_container\n\t\t\tself.row\t\t\t\t\t\t= options.row\n\t\t\tself.form_items_container\t\t= options.form_items_container\n\t\t\tself.diameter_chart_container\t= options.diameter_chart_container\n\t\t\tself.weight_chart_container\t\t= options.weight_chart_container\n\n\t\t// form\n\t\tconst form_node = self.render_form()\n\t\tself.form_items_container.appendChild(form_node)\n\n\t\treturn true\n\t},//end set_up\n\n\t/**\n\t * RENDER FORM\n\t */\n\trender_form : function() {\n\n\t\tconst self = this\n\n\t\t// DocumentFragment is like a virtual DOM\n\t\tconst fragment = new DocumentFragment()\n\n\t\t// form_factory instance\n\t\t\tself.form = self.form || new form_factory()\n\n\t\tconst form_row = common.create_dom_element({\n\t\t\telement_type\t: \"div\",\n\t\t\tclass_name\t\t: \"form-row fields\",\n\t\t\tparent\t\t\t: fragment\n\t\t})\n\n\t\t// mint\n\t\t\tself.form.item_factory({\n\t\t\t\tid\t\t\t\t: \"mint\",\n\t\t\t\tname\t\t\t: \"mint\",\n\t\t\t\tlabel\t\t\t: tstring.mint || \"mint\",\n\t\t\t\tq_column\t\t: \"p_mint\",\n\t\t\t\tvalue_wrapper\t: ['[\"', '\"]'], // to obtain [\"value\"] in selected value only\n\t\t\t\teq\t\t\t\t: \"LIKE\",\n\t\t\t\teq_in\t\t\t: \"%\",\n\t\t\t\teq_out\t\t\t: \"%\",\n\t\t\t\tis_term\t\t\t: true,\n\t\t\t\tparent\t\t\t: form_row,\n\t\t\t\tcallback\t\t: function(form_item) {\n\t\t\t\t\tself.form.activate_autocomplete({\n\t\t\t\t\t\tform_item\t: form_item,\n\t\t\t\t\t\ttable\t\t: 'catalog'\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t})\n\t\t\n\t\t// number\n\t\t\tself.form.item_factory({\n\t\t\t\tid \t\t\t: \"number\",\n\t\t\t\tname \t\t: \"number\",\n\t\t\t\tq_column \t: \"term\",\n\t\t\t\tq_table \t: \"types\",\n\t\t\t\tlabel\t\t: tstring.number_key || \"Number & Key\",\n\t\t\t\tis_term \t: false,\n\t\t\t\tparent\t\t: form_row,\n\t\t\t\tgroup_op \t: '$or',\n\t\t\t\tcallback\t: function(form_item) {\n\t\t\t\t\tself.form.activate_autocomplete({\n\t\t\t\t\t\tform_item\t: form_item,\n\t\t\t\t\t\ttable\t\t: 'catalog'\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t})\n\t\t\n\t\t// material\n\t\t\tself.form.item_factory({\n\t\t\t\tid \t\t\t: \"material\",\n\t\t\t\tname \t\t: \"material\",\n\t\t\t\tq_column \t: \"ref_type_material\",\n\t\t\t\tq_table \t: \"any\",\n\t\t\t\tlabel\t\t: tstring.material || \"material\",\n\t\t\t\tis_term \t: false,\n\t\t\t\tparent\t\t: form_row,\n\t\t\t\tcallback\t: function(form_item) {\n\t\t\t\t\tself.form.activate_autocomplete({\n\t\t\t\t\t\tform_item\t: form_item,\n\t\t\t\t\t\ttable\t\t: 'catalog'\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t})\n\t\t\n\t\t// denomination\n\t\t\tself.form.item_factory({\n\t\t\t\tid \t\t\t: \"denomination\",\n\t\t\t\tname \t\t: \"denomination\",\n\t\t\t\tq_column \t: \"ref_type_denomination\",\n\t\t\t\tq_table \t: \"any\",\n\t\t\t\tlabel\t\t: tstring.denomination || \"denomination\",\n\t\t\t\tis_term \t: false,\n\t\t\t\tparent\t\t: form_row,\n\t\t\t\tcallback\t: function(form_item) {\n\t\t\t\t\tself.form.activate_autocomplete({\n\t\t\t\t\t\tform_item\t: form_item,\n\t\t\t\t\t\ttable\t\t: 'catalog'\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t})\n\n\t\t// submit button\n\t\t\tconst submit_group = common.create_dom_element({\n\t\t\t\telement_type\t: \"div\",\n\t\t\t\tclass_name\t\t: \"form-group field button_submit\",\n\t\t\t\tparent\t\t\t: fragment\n\t\t\t})\n\t\t\tconst submit_button = common.create_dom_element({\n\t\t\t\telement_type\t: \"input\",\n\t\t\t\ttype\t\t\t: \"submit\",\n\t\t\t\tid\t\t\t\t: \"submit\",\n\t\t\t\tvalue\t\t\t: tstring.search || \"Search\",\n\t\t\t\tclass_name\t\t: \"btn btn-light btn-block primary\",\n\t\t\t\tparent\t\t\t: submit_group\n\t\t\t})\n\t\t\tsubmit_button.addEventListener(\"click\", function (e) {\n\t\t\t\te.preventDefault()\n\t\t\t\tself.form_submit(form)\n\t\t\t})\n\n\t\t// reset button\n\t\t\tconst reset_button = common.create_dom_element({\n\t\t\t\telement_type\t: \"input\",\n\t\t\t\ttype\t\t\t: \"button\",\n\t\t\t\tid\t\t\t\t: \"button_reset\",\n\t\t\t\tvalue\t\t\t: tstring.reset || 'Reset',\n\t\t\t\tclass_name\t\t: \"btn btn-light btn-block secondary button_reset\",\n\t\t\t\tparent\t\t\t: submit_group\n\t\t\t})\n\t\t\treset_button.addEventListener(\"click\", function (e) {\n\t\t\t\te.preventDefault()\n\t\t\t\twindow.location.replace(window.location.pathname);\n\t\t\t})\n\n\t\t// operators\n\t\t\t// fragment.appendChild( forms.build_operators_node() )\n\t\t\tconst operators_node = self.form.build_operators_node()\n\t\t\tfragment.appendChild( operators_node )\n\n\t\t// the form element itself!\n\t\t\tconst form = common.create_dom_element({\n\t\t\t\telement_type\t: \"form\",\n\t\t\t\tid\t\t\t\t: \"search_form\",\n\t\t\t\tclass_name\t\t: \"form-inline\"\n\t\t\t})\n\t\t\tform.appendChild(fragment)\n\n\n\t\treturn form\n\t},//end render_form\n\n\t/**\n\t * FORM SUBMIT\n\t * Form submit launch search\n\t */\n\tform_submit : function(form_obj, options={}) {\n\t\t\n\t\tconst self = this\n\n\t\t// options\n\t\t\tconst scroll_result\t= typeof options.scroll_result===\"boolean\" ? options.scroll_result : true\n\t\t\tconst form_items\t= options.form_items || self.form.form_items\n\n\t\t// build filter\n\t\t\tconst filter = self.form.build_filter({\n\t\t\t\tform_items: form_items\n\t\t\t})\n\t\t\n\t\t// empty filter case\n\t\t\tif (!filter || filter.length<1) {\n\t\t\t\treturn false\n\t\t\t}\n\n\t\t// scroll to head result\n\t\t\tif (scroll_result) {\n\t\t\t\tthis.diameter_chart_container.scrollIntoView(\n\t\t\t\t\t{behavior: \"smooth\", block: \"start\", inline: \"nearest\"}\n\t\t\t\t);\n\t\t\t}\n\n\t\t// search rows exec against API\n\t\t\tconst js_promise = self.search_rows({\n\t\t\t\tfilter\t\t\t: filter,\n\t\t\t\tlimit\t\t\t: 0,\n\t\t\t\tprocess_result\t: {\n\t\t\t\t\tfn\t\t: 'process_result::add_parents_and_children_recursive',\n\t\t\t\t\tcolumns\t: [{name : \"parents\"}]\n\t\t\t\t}\n\t\t\t})\n\t\t\t.then((parsed_data)=>{\n\n\t\t\t\tevent_manager.publish('form_submit', parsed_data)\n\n\t\t\t\tconsole.log(parsed_data)\n\n\t\t\t\t// const diameters = parsed_data\n\t\t\t\t// \t.map((ele) => ele.full_coins_reference_diameter_max)\n\t\t\t\t// \t.flat()\n\t\t\t\t// \t.filter((v) => v)\n\t\t\t\t// console.log(diameters)\n\n\t\t\t\t// this.diameter_chart_wrapper = new histogram_wrapper(\n\t\t\t\t// \tthis.diameter_chart_container,\n\t\t\t\t// \tdiameters,\n\t\t\t\t// \t{\n\t\t\t\t// \t\txlabel: 'Diameter',\n\t\t\t\t// \t}\n\t\t\t\t// )\n\t\t\t\t// this.diameter_chart_wrapper.render()\n\n\t\t\t\tconst data = []\n\t\t\t\tfor (const [i, ele] of parsed_data.entries()) {\n\t\t\t\t\tconst number_key = ele.ref_type_number ? ele.ref_type_number : `Missing Number & Key (${i})`\n\t\t\t\t\tconst mint = ele.p_mint ? ele.p_mint[0] : `Missing mint (${i})`\n\t\t\t\t\tconst material = ele.ref_type_material ? ele.ref_type_material : `Missing material (${i})` \n\t\t\t\t\tconst denomination = ele.ref_type_denomination ? ele.ref_type_denomination : `Missing denomination ${i}`\n\t\t\t\t\t// if (!['12', '59', '62', '18','11a','14'].includes(name)) continue\n\t\t\t\t\t// if (!['59', '62'].includes(name)) continue\n\t\t\t\t\tconst tmp_data = {}\n\t\t\t\t\tconst calculable = ele.full_coins_reference_calculable\n\t\t\t\t\tconst diameter_max = ele.full_coins_reference_diameter_max\n\t\t\t\t\tconst diameter_min = ele.full_coins_reference_diameter_min\n\t\t\t\t\tconst weight = ele.full_coins_reference_weight\n\t\t\t\t\tif (diameter_max && diameter_max.length) {\n\t\t\t\t\t\tconst tmp_diameter_max = diameter_max.filter((v, i) => v && calculable[i])\n\t\t\t\t\t\tif (tmp_diameter_max.length) {\n\t\t\t\t\t\t\ttmp_data.diameter_max = tmp_diameter_max\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (diameter_min && diameter_min.length) {\n\t\t\t\t\t\tconst tmp_diameter_min = diameter_min.filter((v, i) => v && calculable[i])\n\t\t\t\t\t\tif (tmp_diameter_min.length) {\n\t\t\t\t\t\t\ttmp_data.diameter_min = tmp_diameter_min\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (weight && weight.length) {\n\t\t\t\t\t\tconst tmp_weight = weight.filter((v, i) => v && calculable[i])\n\t\t\t\t\t\tif (tmp_weight.length) {\n\t\t\t\t\t\t\ttmp_data.weight = tmp_weight\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (Object.keys(tmp_data).length) {\n\t\t\t\t\t\ttmp_data.number_key = number_key\n\t\t\t\t\t\ttmp_data.mint = mint\n\t\t\t\t\t\ttmp_data.material = material\n\t\t\t\t\t\ttmp_data.denomination = denomination\n\t\t\t\t\t\tdata.push(tmp_data)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tconsole.log(data)\n\n\t\t\t\t// Weights\n\t\t\t\tconst weights = data.filter(\n\t\t\t\t\t(ele) => ele.weight\n\t\t\t\t).map(\n\t\t\t\t\t(ele) => {return {key: [ele.mint, ele.number_key], values: ele.weight}}\n\t\t\t\t)\n\t\t\t\t// console.log('Weights:')\n\t\t\t\t// console.log(weights)\n\t\t\t\tthis.weight_chart_wrapper = new boxvio_chart_wrapper(\n\t\t\t\t\tthis.weight_chart_container,\n\t\t\t\t\tweights,\n\t\t\t\t\t[tstring.mint || 'Mint', tstring.number_key || 'Number & Key'],\n\t\t\t\t\t{\n\t\t\t\t\t\tylabel: tstring.weight || 'Weight',\n\t\t\t\t\t\toverflow: true,\n\t\t\t\t\t\tdisplay_control_panel: true,\n\t\t\t\t\t\tdisplay_download: true,\n\t\t\t\t\t\tsort_xaxis: true,\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t\tthis.weight_chart_wrapper.render()\n\n\t\t\t\t// Diameters\n\t\t\t\tconst diameters = data.filter(\n\t\t\t\t\t(ele) => ele.diameter_max\n\t\t\t\t).map(\n\t\t\t\t\t(ele) => {return {key: [ele.mint, ele.number_key], values: ele.diameter_max}}\n\t\t\t\t)\n\t\t\t\t// console.log('Diameters:')\n\t\t\t\t// console.log(diameters)\n\t\t\t\tthis.diameter_chart_wrapper = new boxvio_chart_wrapper(\n\t\t\t\t\tthis.diameter_chart_container,\n\t\t\t\t\tdiameters,\n\t\t\t\t [tstring.mint || 'Mint', tstring.number_key || 'Number & Key'],\n\t\t\t\t\t{\n\t\t\t\t\t\tylabel: tstring.diameter || 'Diameter',\n\t\t\t\t\t\toverflow: true,\n\t\t\t\t\t\tdisplay_control_panel: true,\n\t\t\t\t\t\tdisplay_download: true,\n\t\t\t\t\t\tsort_xaxis: true,\n\t\t\t\t\t}\n\t\t\t\t)\n\t\t\t\tthis.diameter_chart_wrapper.render()\n\n\t\t\t})\n\n\t},\n\n\t/**\n\t * SEARCH_ROWS\n\t * Call to API and load json data results of search\n\t */\n\tsearch_rows : function(options) {\n\n\t\tconst self = this\n\n\t\t// sort vars\n\t\t\tconst filter\t\t\t= options.filter || null\n\t\t\tconst ar_fields\t\t\t= options.ar_fields || [\"*\"]\n\t\t\tconst order\t\t\t\t= options.order || \"norder ASC\"\n\t\t\tconst lang\t\t\t\t= page_globals.WEB_CURRENT_LANG_CODE\n\t\t\tconst process_result\t= options.process_result || null\n\t\t\tconst limit\t\t\t\t= options.limit != undefined\n\t\t\t\t\t\t\t\t\t\t? options.limit\n\t\t\t\t\t\t\t\t\t\t: 30\n\t\t\n\t\treturn new Promise(function(resolve){\n\t\t\t// parse_sql_filter\n\t\t\t\tconst group = []\n\t\t\t// parsed filters\n\t\t\t\tconst sql_filter = self.form.parse_sql_filter(filter)\n\t\t\t// request\n\t\t\t\tconst request_body = {\n\t\t\t\t\tdedalo_get\t\t: 'records',\n\t\t\t\t\ttable\t\t\t: 'catalog',\n\t\t\t\t\tar_fields\t\t: ar_fields,\n\t\t\t\t\tlang\t\t\t: lang,\n\t\t\t\t\tsql_filter\t\t: sql_filter,\n\t\t\t\t\tlimit\t\t\t: limit,\n\t\t\t\t\tgroup\t\t\t: (group.length>0) ? group.join(\",\") : null,\n\t\t\t\t\tcount\t\t\t: false,\n\t\t\t\t\torder\t\t\t: order,\n\t\t\t\t\tprocess_result\t: process_result\n\t\t\t\t}\n\t\t\t\tdata_manager.request({\n\t\t\t\t\tbody : request_body\n\t\t\t\t})\n\t\t\t\t.then((response)=>{\n\t\t\t\t\t// data parsed\n\t\t\t\t\tconst data = page.parse_catalog_data(response.result)\n\n\t\t\t\t\tresolve(data)\n\t\t\t\t})\n\t\t})\n\n\t},\n\n}//end analysis\n\n"],"mappings":"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"}