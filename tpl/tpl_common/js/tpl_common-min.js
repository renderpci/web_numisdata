"use strict";var tpl_common={ar_restricted_tc:[],tcin_seconds:0,tcout_seconds:null,margin_secs:0,setup:function(){window.ready((function(){tpl_common.activate_tooltips()}));var e=-1!=navigator.userAgent.indexOf("MSIE"),t=/rv:11.0/i.test(navigator.userAgent);if(e||t){var o=tstring.incompatible_browser||"Warning: Internet explorer is not supported. Please use a modern browser like Chrome, Firefox, Safari, Opera, Edje..";return alert(o),!1}},load_video_search_free:function(e){const t=JSON.parse(e.dataset.video_data),o={trigger_vars:{mode:"load_video_search_free",lang:page_globals.WEB_CURRENT_LANG_CODE,section_id:t.av_section_id,q:t.q},button_obj:e,terms:t.terms};return this.load_video(o)},load_video_search_thematic:function(e){const t=JSON.parse(e.dataset.locator),o={trigger_vars:{mode:"load_video_search_thematic",lang:page_globals.WEB_CURRENT_LANG_CODE,index_locator:t,locator_key:e.dataset.locator_key},term:decodeURIComponent(e.dataset.term)};return this.load_video(o)},load_video_interview:function(e){const t=JSON.parse(e.dataset.data);let o=t.av_section_id;Array.isArray(o)||(o=[o]);const r=parseInt(t.av_section_id_key);if(void 0===o[r])return console.error("Error: av_section_id not found! ",o,r),!1;const s=o[r],a={trigger_vars:{mode:"load_video_interview",lang:page_globals.WEB_CURRENT_LANG_CODE,av_section_id:s},ar_av_section_id:o,av_section_id_key:r};return this.load_video(a)},load_video:function(e){!0===SHOW_DEBUG&&console.log("[tpl_common.load_video] options:",e);tpl_common.load_video_options=window.btoa(JSON.stringify(e));const t=e.ar_av_section_id,o=e.av_section_id_key,r=page_globals.__WEB_TEMPLATE_WEB__+"/page/trigger.web.php",s=e.trigger_vars,a=s.mode,l=s.index_locator,i=e.term||null,n=common.create_dom_element({element_type:"div",id:"video_wrapper",class_name:"video_wrapper loading"}),_=$.fancybox.getInstance();_&&_.close(),$.fancybox.open({src:n,type:"inline",opts:{afterShow:function(e,t){},animationDuration:100,video:{autoStart:!1}}});return common.get_json_data(r,s).then((function(e){if(!0===SHOW_DEBUG&&console.log("[tpl_common.load_video] response:",e),e){let r,_,c,d,u,m,p,g,v,f,y,b,h,E;switch(a){case"load_video_search_thematic":r=e.result.video_url,_=e.full.result.image_url,c=e.result.fragm,d=e.full.result.abstract,u=e.full.result,m=e.full,g=i,f=parseInt(e.result.tcin_secs),y=parseInt(e.result.tcout_secs),h=e.full.result.ar_restricted_fragments,E=e.full.result.av_section_id,v=e.result.subtitles_url,l.length>1&&(b=ui.video_player.build_filmstrip({mode:"indexations",posterframe_url:_,index_locator:l,locator_key:s.locator_key,term:i}));break;case"load_video_search_free":r=e.result[0].fragments[0].video_url,_=e.result[0].image_url,c=e.result[0].fragments[0].fragm,d=e.result[0].abstract,u=e.result[0],m=e.full_reel,p=e.result[0].fragments[0].terms,v=e.result[0].fragments[0].subtitles_url,f=parseInt(e.result[0].fragments[0].tcin_secs),y=parseInt(e.result[0].fragments[0].tcout_secs),h=e.result[0].ar_restricted_fragments,E=e.full_reel.result.av_section_id;break;case"load_video_interview":r=e.result.video,_=e.result.image_url,c=e.result.fragments[0].fragm,d=e.result.abstract,u=e.result,m=!1,p=e.result.terms||null,v=e.result.fragments[0].subtitles_url,f=0,y=null,h=e.result.ar_restricted_fragments,E=e.result.av_section_id,t&&t.length>1&&(b=ui.video_player.build_filmstrip({mode:"tapes",ar_av_section_id:t,av_section_id_key:o,posterframe_url:_}))}r=common.local_to_remote_path(r),_=common.local_to_remote_path(_),!0===SHOW_DEBUG&&console.log("video_url:",r,"posterframe_url",_);const w=[{src:v+"&db_name="+page_globals.WEB_DB,srclang:page_globals.WEB_CURRENT_LANG_CODE_ISO2,label:tstring[page_globals.WEB_CURRENT_LANG_CODE_ISO2],default:!0}];tpl_common.subtitles_url=v+"&db_name="+page_globals.WEB_DB,tpl_common.video_url=r;const C=video_view.build_video_html5({type:["video/mp4"],src:[r],id:"video_player",controls:!0,play:!1,poster:_,class:"",preload:"auto",width:null,height:null,tcin_secs:f,tcout_secs:y,ar_subtitles:w,ar_restricted_fragments:h.map((e=>{if(e)return{tcin_secs:e.tcin_secs,tcout_secs:e.tcout_secs}}))}),B=common.create_dom_element({element_type:"div",class_name:"watermark"}),O=ui.video_player.build_top_info({data:u}),S=ui.video_player.build_footer_info({mode:s.mode,term_text:void 0!==g?g:null,terms:p,av_section_id:E}),N=ui.video_player.build_body_info({mode:a,abstract:d,transcription:c,terms:p});n.appendChild(O),n.appendChild(B),n.appendChild(C),n.appendChild(S),n.appendChild(N),b&&n.appendChild(b);const k=common.create_dom_element({element_type:"div",id:"subtitles_info",class_name:"",text_content:tstring.subtitles_info||"(Transcription and subtitles translated automatically.)",parent:n});C.addEventListener("play",(function(){k.remove()})),n.classList.remove("loading")}else console.warn("[tpl_common.load_video] Error. Received response data is null");return e}))},toggle_element:function(e,t,o){for(let e=o.length-1;e>=0;e--){const r=o[e];r===t?r.classList.toggle("hide"):r.classList.add("hide")}return!0},toggle_summary:function(e,t){const o=e.parentNode.querySelector(".summary"),r=new Promise((function(e,r){if(!0===t){var s=document.querySelectorAll(".summary.active");if(s)for(var a=s.length-1;a>=0;a--)o!==s[a]&&(s[a].style.display="none",s[a].classList.remove("active"));e(!0)}else e(!0)}));return r.then((function(){return"block"===o.style.display?(o.style.display="none",o.classList.remove("active")):(o.style.display="block",o.classList.add("active")),!0})),r},date_to_year:function(e){return/^[0-9]{4}/.exec(e)},fix_body_height:function(){window.innerHeight,document.getElementById("content").offsetHeight,document.getElementById("footer").offsetHeight},replace_url:function(e,t){return common.local_to_remote_path(e)},activate_tooltips:function(){const e=document.querySelectorAll(".tipsy"),t=e.length;if(t>0)for(let o=t-1;o>=0;o--){e[o].remove()}$(".tooltip").tipsy({gravity:"sw",html:!0})}};tpl_common.setup();