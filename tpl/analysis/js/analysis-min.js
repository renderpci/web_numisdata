"use strict";var analysis={form:null,area_name:null,row:null,export_data_container:null,form_items_container:null,chart_wrapper_container:null,chart_wrapper:null,set_up:function(t){const e=this;e.area_name=t.area_name,e.export_data_container=t.export_data_container,e.row=t.row,e.form_items_container=t.form_items_container,e.chart_wrapper_container=t.chart_wrapper_container;const r=e.render_form();return e.form_items_container.appendChild(r),!0},render_form:function(){const t=this,e=new DocumentFragment;t.form=t.form||new form_factory;const r=common.create_dom_element({element_type:"div",class_name:"form-row fields",parent:e});t.form.item_factory({id:"mint",name:"mint",label:tstring.mint||"mint",q_column:"p_mint",value_wrapper:['["','"]'],eq:"LIKE",eq_in:"%",eq_out:"%",is_term:!0,parent:r,callback:function(e){t.form.activate_autocomplete({form_item:e,table:"catalog"})}});const a=common.create_dom_element({element_type:"div",class_name:"form-group field button_submit",parent:e});common.create_dom_element({element_type:"input",type:"submit",id:"submit",value:tstring.search||"Search",class_name:"btn btn-light btn-block primary",parent:a}).addEventListener("click",(function(e){e.preventDefault(),t.form_submit(i)}));common.create_dom_element({element_type:"input",type:"button",id:"button_reset",value:tstring.reset||"Reset",class_name:"btn btn-light btn-block secondary button_reset",parent:a}).addEventListener("click",(function(t){t.preventDefault(),window.location.replace(window.location.pathname)}));const n=t.form.build_operators_node();e.appendChild(n);const i=common.create_dom_element({element_type:"form",id:"search_form",class_name:"form-inline"});return i.appendChild(e),i},form_submit:function(t,e={}){const r=this,a=("boolean"!=typeof e.scroll_result||e.scroll_result,e.form_items||r.form.form_items),n=r.form.build_filter({form_items:a});if(!n||n.length<1)return!1;r.search_rows({filter:n,limit:0}).then((t=>{event_manager.publish("form_submit",t);const e=t.map((t=>t.ref_type_averages_diameter)).filter((t=>null!=t));this.chart_wrapper=new histogram_wrapper(this.chart_wrapper_container,e),this.chart_wrapper.render()}))},search_rows:function(t){const e=this,r=t.filter||null,a=t.ar_fields||["*"],n=t.order||"norder ASC",i=page_globals.WEB_CURRENT_LANG_CODE,s=t.process_result||null,o=null!=t.limit?t.limit:30;return new Promise((function(t){const l=[],_=e.form.parse_sql_filter(r),m={dedalo_get:"records",table:"catalog",ar_fields:a,lang:i,sql_filter:_,limit:o,group:l.length>0?l.join(","):null,count:!1,order:n,process_result:s};data_manager.request({body:m}).then((e=>{const r=page.parse_catalog_data(e.result);t(r)}))}))}};class chart_wrapper{constructor(t){this.div_wrapper=t,this.canvas=void 0}render(){this.canvas=common.create_dom_element({element_type:"canvas",id:"result_graph"}),this.div_wrapper.replaceChildren(this.canvas)}}class histogram_wrapper extends chart_wrapper{constructor(t,e){super(t),this.data=e,this.n_bins=void 0,this.n_decimals=2}get_plotting_data(){this.n_bins=Math.ceil(Math.sqrt(this.data.length));const t=Math.max(...this.data),e=Math.min(...this.data),r=.5*((t-e)/this.n_bins),a=Array.apply(null,Array(this.n_bins)).map(((t,a)=>e+(2*a+1)*r));let n=Array.apply(null,Array(this.n_bins)).map((()=>0));for(let e=0;e<this.data.length;e++)if(this.data[e]!==t){for(let t=0;t<this.n_bins;t++)if(this.data[e]>=a[t]-r&&this.data[e]<a[t]+r){n[t]++;break}}else a[this.n_bins-1]++;return[a,n,r]}render(){super.render();const[t,e,r]=this.get_plotting_data();new Chart(this.canvas,{type:"bar",data:{labels:t.map((t=>t.toFixed(this.n_decimals))),datasets:[{label:"Amount",data:e,categoryPercentage:1,barPercentage:1}]},options:{scales:{x:{grid:{offset:!1},title:{display:!0,text:"Diameter",font:{size:14}}},y:{title:{display:!0,text:"Amount",font:{size:14}}}},plugins:{legend:{display:!1},tooltip:{callbacks:{title:e=>{if(!e.length)return"";const a=e[0].dataIndex,n=t[a]-r,i=t[a]+r;return`Diameter: ${n.toFixed(this.n_decimals)} - ${i.toFixed(this.n_decimals)}`}}}}}})}}
//# sourceMappingURL=analysis-min.js.map