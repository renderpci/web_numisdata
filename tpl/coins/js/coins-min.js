"use strict";var coins={form:null,pagination:null,list:null,form_node:null,form_container:null,rows_container:null,set_up:function(t){const e=this;e.form_container=t.form_container,e.rows_container=t.rows_container,e.form=new form_factory;const n=e.render_form();return e.form_container.appendChild(n),e.pagination={total:null,limit:10,offset:0,n_nodes:8},event_manager.subscribe("paginate",(function(t){e.pagination.offset=t,e.form_submit()})),!0},render_form:function(){const t=this,e=new DocumentFragment,n=common.create_dom_element({element_type:"div",class_name:"form-row fields",parent:e});t.form.item_factory({id:"section_id",name:"section_id",label:tstring.is||"ID",q_column:"section_id",eq:"=",eq_in:"",eq_out:"",parent:n}),t.form.item_factory({id:"collection",name:"collection",label:tstring.collection||"collection",q_column:"collection",eq:"LIKE",eq_in:"%",eq_out:"%",parent:n,callback:function(e){t.form.activate_autocomplete({form_item:e,table:"coins"})}}),t.form.item_factory({id:"ref_auction",name:"ref_auction",label:tstring.auction||"auction",q_column:"ref_auction",eq:"LIKE",eq_in:"%",eq_out:"%",parent:n,callback:function(e){t.form.activate_autocomplete({form_item:e,table:"coins"})}}),t.form.item_factory({id:"mint",name:"mint",label:tstring.mint||"mint",q_column:"mint",eq:"LIKE",eq_in:"%",eq_out:"%",parent:n,callback:function(e){t.form.activate_autocomplete({form_item:e,table:"coins"})}}),t.form.item_factory({id:"findspot",name:"findspot",label:tstring.findspot||"findspot",q_column:"findspot",eq:"LIKE",eq_in:"%",eq_out:"%",parent:n,callback:function(e){t.form.activate_autocomplete({form_item:e,table:"coins"})}}),t.form.item_factory({id:"hoard",name:"hoard",label:tstring.hoard||"hoard",q_column:"hoard",eq:"LIKE",eq_in:"%",eq_out:"%",parent:n,callback:function(e){t.form.activate_autocomplete({form_item:e,table:"coins"})}}),t.form.item_factory({id:"material",name:"material",label:tstring.material||"Material",q_column:"material",eq:"LIKE",eq_in:"%",eq_out:"%",parent:n,callback:function(e){t.form.activate_autocomplete({form_item:e,table:"coins"})}}),t.form.item_factory({id:"denomination",name:"denomination",label:tstring.denomination||"Denomination",q_column:"denomination",eq:"LIKE",eq_in:"%",eq_out:"%",parent:n,callback:function(e){t.form.activate_autocomplete({form_item:e,table:"coins"})}});const o=common.create_dom_element({element_type:"div",class_name:"form-group field button_submit",parent:e});common.create_dom_element({element_type:"input",type:"submit",id:"submit",value:tstring.search||"Search",class_name:"btn btn-light btn-block primary",parent:o}).addEventListener("click",(function(e){e.preventDefault(),t.form_submit()}));const i=t.form.build_operators_node();return e.appendChild(i),t.form.node=common.create_dom_element({element_type:"form",id:"search_form",class_name:"form-inline form_factory"}),t.form.node.appendChild(e),t.form.node},form_submit:function(){const t=this,e=t.form.node;if(!e)return new Promise((function(t){console.error("Error on submit. Invalid form_node.",e),t(!1)}));const n=t.rows_container;return t.pagination.total?n.classList.add("loading"):page.add_spinner(n),new Promise((function(e){const o=t.pagination.limit,i=t.pagination.offset,a=t.form.build_filter(),r=t.form.parse_sql_filter(a,[]),l=r?"("+r+")":null;!0===SHOW_DEBUG&&console.log("-> coins form_submit sql_filter:",l),data_manager.request({body:{dedalo_get:"records",table:"coins",ar_fields:["*"],sql_filter:l,limit:o,count:!0,offset:i,order:"section_id ASC",process_result:null,resolve_portals_custom:{mint_data:"mints"}}}).then((function(o){console.log("--------------- api_response:",o);const a=page.parse_coin_data(o.result),r=o.total;t.pagination.total=r,t.pagination.offset=i,a||(n.classList.remove("loading"),e(null)),function(){for(;n.hasChildNodes();)n.removeChild(n.lastChild);n.classList.remove("loading")}(),t.list=t.list||new list_factory,t.list.init({data:a,fn_row_builder:t.list_row_builder,pagination:t.pagination,caller:t}),t.list.render_list().then((function(t){t&&n.appendChild(t),e(t)}))}))}))},list_row_builder:function(t,e){return coins_row_fields.draw_item(t)}};