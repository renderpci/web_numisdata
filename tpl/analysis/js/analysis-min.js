"use strict";const DEFAULT_BIN_WIDTH=1;var analysis={form:null,area_name:null,row:null,export_data_container:null,form_items_container:null,graph_canvas:null,chart:null,set_up:function(e){const t=this;t.area_name=e.area_name,t.export_data_container=e.export_data_container,t.row=e.row,t.form_items_container=e.form_items_container,t.graph_canvas=e.graph_canvas;const r=t.render_form();return t.form_items_container.appendChild(r),!0},render_form:function(){const e=this,t=new DocumentFragment;e.form=e.form||new form_factory;const r=common.create_dom_element({element_type:"div",class_name:"form-row fields",parent:t});e.form.item_factory({id:"mint",name:"mint",label:tstring.mint||"mint",q_column:"p_mint",value_wrapper:['["','"]'],eq:"LIKE",eq_in:"%",eq_out:"%",is_term:!0,parent:r,callback:function(t){e.form.activate_autocomplete({form_item:t,table:"catalog"})}});const n=common.create_dom_element({element_type:"div",class_name:"form-group field button_submit",parent:t});common.create_dom_element({element_type:"input",type:"submit",id:"submit",value:tstring.search||"Search",class_name:"btn btn-light btn-block primary",parent:n}).addEventListener("click",(function(t){t.preventDefault(),e.form_submit(o)}));common.create_dom_element({element_type:"input",type:"button",id:"button_reset",value:tstring.reset||"Reset",class_name:"btn btn-light btn-block secondary button_reset",parent:n}).addEventListener("click",(function(e){e.preventDefault(),window.location.replace(window.location.pathname)}));const a=e.form.build_operators_node();t.appendChild(a);const o=common.create_dom_element({element_type:"form",id:"search_form",class_name:"form-inline"});return o.appendChild(t),o},form_submit:function(e,t={}){const r=this,n=("boolean"!=typeof t.scroll_result||t.scroll_result,t.form_items||r.form.form_items),a=r.form.build_filter({form_items:n});if(!a||a.length<1)return!1;r.search_rows({filter:a,limit:0}).then((e=>{event_manager.publish("form_submit",e);const t=e.map((e=>e.ref_type_averages_diameter)).filter((e=>null!=e));this.create_histogram(t,1)}))},search_rows:function(e){const t=this,r=e.filter||null,n=e.ar_fields||["*"],a=e.order||"norder ASC",o=page_globals.WEB_CURRENT_LANG_CODE,l=e.process_result||null,i=null!=e.limit?e.limit:30;return new Promise((function(e){const s=[],m=t.form.parse_sql_filter(r),c={dedalo_get:"records",table:"catalog",ar_fields:n,lang:o,sql_filter:m,limit:i,group:s.length>0?s.join(","):null,count:!1,order:a,process_result:l};data_manager.request({body:c}).then((t=>{const r=page.parse_catalog_data(t.result);e(r)}))}))},create_histogram:function(e,t){this.chart&&(this.chart.destroy(),this.graph_canvas.removeAttribute("width"),this.graph_canvas.removeAttribute("height"),this.graph_canvas.removeAttribute("style"));const r=.5*t,n=Math.max(...e),a=Math.min(...e),o=Math.ceil((n-a)/t),l=Array.apply(null,Array(o)).map(((e,t)=>a+(2*t+1)*r));let i=Array.apply(null,Array(o)).map((()=>0));for(let t=0;t<e.length;t++)if(e[t]!==n){for(let n=0;n<o;n++)if(e[t]>=l[n]-r&&e[t]<l[n]+r){i[n]++;break}}else l[o-1]++;this.chart=new Chart(this.graph_canvas,{type:"bar",data:{labels:l,datasets:[{label:"Amount",data:i,categoryPercentage:1,barPercentage:1}]},options:{scales:{x:{grid:{offset:!1},title:{display:!0,text:"Diameter",font:{size:14}}},y:{title:{display:!0,text:"Amount",font:{size:14}}}},plugins:{legend:{display:!1},tooltip:{callbacks:{title:e=>{if(!e.length)return"";const t=e[0].dataIndex;return`Diameter: ${l[t]-r} - ${l[t]+r}`}}}}}})}};
//# sourceMappingURL=analysis-min.js.map