page.parse_type_data=function(e){console.log("------------\x3e parse_type_data data:",e);const _=this;if(Array.isArray(e)){const r=[];for(let a=0;a<e.length;a++)r.push(_.parse_type_data(e[a]));return r}const r=e;return"object"!=typeof r&&(console.log("parse_type_data row:",r),console.trace()),r.parsed||(r.ref_coins_image_obverse=void 0!==e.ref_coins_image_obverse?common.local_to_remote_path(e.ref_coins_image_obverse):null,r.ref_coins_image_reverse=void 0!==e.ref_coins_image_reverse?common.local_to_remote_path(e.ref_coins_image_reverse):null,r.ref_coins_union&&Array.isArray(r.ref_coins_union)&&r.ref_coins_union.length>0&&(r.ref_coins_union=page.parse_coin_data(r.ref_coins_union)),r.uri=_.parse_iri_data(r.uri),r.legend_obverse=r.legend_obverse?_.parse_legend_svg(r.legend_obverse):null,r.legend_reverse=r.legend_reverse?_.parse_legend_svg(r.legend_reverse):null,r.material=r.material?page.trim_char(page.remove_gaps(r.material," | "),"|"):null,r.symbol_obverse=r.symbol_obverse?page.trim_char(page.remove_gaps(r.symbol_obverse," | "),"|"):null,r.symbol_reverse=r.symbol_reverse?page.trim_char(page.remove_gaps(r.symbol_reverse," | "),"|"):null,r.symbol_obverse_data=JSON.parse(r.symbol_obverse_data),r.symbol_reverse_data=JSON.parse(r.symbol_reverse_data),r.parsed=!0),r},page.parse_coin_data=function(e){const _=this;if(Array.isArray(e)){const _=[];for(let r=0;r<e.length;r++)_.push(page.parse_coin_data(e[r]));return _}const r=e;if("object"!=typeof r&&(console.log("parse_coin_data row:",r),console.trace()),r.parsed)return r;if(r.image_obverse=common.local_to_remote_path(e.image_obverse),r.image_obverse_thumb=r.image_obverse?r.image_obverse.replace("/1.5MB/","/thumb/"):null,r.image_reverse=common.local_to_remote_path(e.image_reverse),r.image_reverse_thumb=r.image_reverse?r.image_reverse.replace("/1.5MB/","/thumb/"):null,r.type_data&&Array.isArray(r.type_data)&&r.type_data.length>0&&(r.type_data=_.parse_type_data(r.type_data)),r.type=r.type?page.remove_gaps(r.type," | "):null,r.legend_obverse=r.legend_obverse?_.parse_legend_svg(r.legend_obverse):null,r.legend_reverse=r.legend_reverse?_.parse_legend_svg(r.legend_reverse):null,r.countermark_obverse=r.countermark_obverse?_.parse_legend_svg(r.countermark_obverse):null,r.countermark_reverse=r.countermark_reverse?_.parse_legend_svg(r.countermark_reverse):null,r.ref_auction=r.ref_auction?JSON.parse(r.ref_auction):null,r.ref_auction_date=r.ref_auction_date?JSON.parse(r.ref_auction_date):null,r.ref_auction_number=r.ref_auction_number?JSON.parse(r.ref_auction_number):null,r.ref_auction_group=null,r.ref_auction&&r.ref_auction.length>0){r.ref_auction_group=[];for(let e=0;e<r.ref_auction.length;e++)r.ref_auction_group.push({name:r.ref_auction[e],date:void 0!==r.ref_auction_date[e]?_.parse_date(r.ref_auction_date[e]):"",number:void 0!==r.ref_auction_number[e]?r.ref_auction_number[e]:""})}if(r.ref_related_coin_auction=r.ref_related_coin_auction?JSON.parse(r.ref_related_coin_auction):null,r.ref_related_coin_auction_date=r.ref_related_coin_auction_date?JSON.parse(r.ref_related_coin_auction_date):null,r.ref_related_coin_auction_number=r.ref_related_coin_auction_number?JSON.parse(r.ref_related_coin_auction_number):null,r.ref_related_coin_auction_group=null,r.ref_related_coin_auction&&r.ref_related_coin_auction.length>0){r.ref_related_coin_auction_group=[];for(let e=0;e<r.ref_related_coin_auction.length;e++)r.ref_related_coin_auction_group.push({name:r.ref_related_coin_auction[e],date:void 0!==r.ref_related_coin_auction_date[e]?_.parse_date(r.ref_related_coin_auction_date[e]):"",number:void 0!==r.ref_related_coin_auction_number[e]?r.ref_related_coin_auction_number[e]:""})}return r.find_date=_.parse_date(r.find_date),r.mib_uri=page_globals.__WEB_BASE_URL__+page_globals.__WEB_ROOT_WEB__+"/coin/"+r.section_id,r.uri=_.parse_iri_data(r.uri),r.bibliography_data&&Array.isArray(r.bibliography_data)&&(r.bibliography=page.parse_publication(r.bibliography_data)),r.mint=r.type_dat&&void 0!==r.type_data[0]?r.type_data[0].mint:null,r.type_number=r.type_data&&void 0!==r.type_data[0]?r.type_data[0].number:null,r.parsed=!0,r},page.parse_catalog_data=function(e){const _=this;if(!e)return[];Array.isArray(e)||(e=[e]);const r=[],a=e.length;for(let t=0;t<a;t++){const a=e[t];a.parsed||(a.ref_coins_image_obverse=common.local_to_remote_path(a.ref_coins_image_obverse),a.ref_coins_image_reverse=common.local_to_remote_path(a.ref_coins_image_reverse),a.ref_coins_image_obverse_thumb=a.ref_coins_image_obverse?a.ref_coins_image_obverse.replace("/1.5MB/","/thumb/"):null,a.ref_coins_image_reverse_thumb=a.ref_coins_image_reverse?a.ref_coins_image_reverse.replace("/1.5MB/","/thumb/"):null,a.ref_type_legend_obverse=a.ref_type_legend_obverse?_.parse_legend_svg(a.ref_type_legend_obverse):null,a.ref_type_legend_reverse=a.ref_type_legend_reverse?_.parse_legend_svg(a.ref_type_legend_reverse):null,a.ref_type_symbol_obverse=a.ref_type_symbol_obverse?_.parse_legend_svg(a.ref_type_symbol_obverse):null,a.ref_type_symbol_reverse=a.ref_type_symbol_reverse?_.parse_legend_svg(a.ref_type_symbol_reverse):null,a.term_data=JSON.parse(a.term_data),a.term_section_id=a.term_data?a.term_data[0]:null,a.children=JSON.parse(a.children),a.parent=JSON.parse(a.parent),a.ref_type_averages_diameter=a.ref_type_averages_diameter?parseFloat(a.ref_type_averages_diameter.replace(",",".")):null,a.ref_type_total_diameter_items=a.ref_type_total_diameter_items?parseFloat(a.ref_type_total_diameter_items.replace(",",".")):null,a.ref_type_averages_weight=a.ref_type_averages_weight?parseFloat(a.ref_type_averages_weight.replace(",",".")):null,a.ref_type_total_weight_items=a.ref_type_total_weight_items?parseFloat(a.ref_type_total_weight_items.replace(",",".")):null,a.ref_type_material=page.trim_char(a.ref_type_material,"|"),r.push(a))}for(let _=0;_<a;_++){const a=r[_];if(!a.parsed&&"types"===a.term_table&&a.children){const _=[],r=[];for(let t=0;t<a.children.length;t++){const n=a.children[t],o=e.find(e=>e.section_id==n);if(o&&o.ref_type_averages_weight){const e=o.ref_type_total_weight_items,_=new Array(e).fill(o.ref_type_averages_weight);r.push(..._)}if(o&&o.ref_type_averages_diameter){const e=o.ref_type_total_diameter_items,r=new Array(e).fill(o.ref_type_averages_diameter);_.push(...r)}}const t=r.reduce((e,_)=>e+_,0)/r.length,n=_.reduce((e,_)=>e+_,0)/_.length;a.ref_type_averages_weight=t,a.ref_type_averages_diameter=n,a.ref_type_total_weight_items=r.length,a.ref_type_total_diameter_items=_.length}a.parsed=!0}return r},page.parse_publication=function(e){const _=[],r=e.length;for(let a=0;a<r;a++){const r=e[a];if(r.parsed)continue;r._publications=[];const t=JSON.parse(r.publications_data),n=t.length;if(n>0){const e=page.split_data(r.ref_publications_authors," # "),a=page.split_data(r.ref_publications_date," # "),o=page.split_data(r.ref_publications_editor," # "),i=page.split_data(r.ref_publications_magazine," # "),l=page.split_data(r.ref_publications_place," # "),s=page.split_data(r.ref_publications_title," # "),p=page.split_data(r.ref_publications_url," # ");for(let c=0;c<n;c++){const n=t[c],u={reference:r.section_id,section_id:n,authors:e[c]||null,date:a[c]||null,editor:o[c]||null,magazine:i[c]||null,place:l[c]||null,title:s[c]||null,url:p[c]||null};r._publications.push(u),_.push(u)}}r.parsed=!0}return _},page.parse_iri_data=function(e){const _=[];if(!e||e.length<1)return _;const r=e.split(" | ");for(let e=0;e<r.length;e++){const a=r[e].split(", ");if(a.length>1&&void 0===a[1])continue;const t=1===a.length?a[0]:a[1];let n=1===a.length?"":a[0];if(n.length<1)try{n=new URL(t).hostname}catch(e){console.error(e)}_.push({label:n,value:t})}return _};