"use strict";var type={search_options:{},map:null,set_up:function(t){const e=this;return!0===SHOW_DEBUG&&console.log("type set_up options:",t),void 0!==t.section_id&&e.get_row_data({section_id:t.section_id}).then((function(t){console.log("/// response:",t),console.log("/// row:",t.result[0]);const a=document.getElementById("row_detail");for(;a.hasChildNodes();)a.removeChild(a.lastChild);const o=t.result,s=o.find(t=>"type"===t.id),i=o.find(t=>"catalog"===t.id);if(s.result[0].catalog=i.result[0],void 0!==s.result[0]){const t=page.parse_type_data(s.result[0]);e.list_row_builder(t).then((function(t){a.appendChild(t);const e=t.querySelectorAll(".gallery");if(e)for(let t=0;t<e.length;t++)page.activate_images_gallery(e[t])}))}})),!0},get_row_data:function(t){const e=t.section_id,a=t.lang||page_globals.WEB_CURRENT_LANG_CODE,o=[];o.push({id:"type",options:{dedalo_get:"records",table:"types",ar_fields:["*"],lang:a,sql_filter:"section_id = "+parseInt(e),resolve_portal:!0,resolve_portals_custom:{bibliography_data:"bibliographic_references",ref_coins_union:"coins","coins.bibliography_data":"bibliographic_references",ref_coins_findspots_data:"findspots","findspots.bibliography_data":"bibliographic_references",ref_coins_hoard_data:"hoards","hoards.bibliography_data":"bibliographic_references"},count:!1}}),o.push({id:"catalog",options:{dedalo_get:"records",table:"catalog",ar_fields:["section_id","term","term_data","term_table","term_section_tipo","parents"],lang:a,sql_filter:"term_data like '%\""+parseInt(e)+"\"%' AND term_table ='types'",resolve_portal:!0,resolve_portals_custom:{parents:"catalog"},count:!1}}),console.log("ar_calls:",o);return data_manager.request({body:{dedalo_get:"combi",ar_calls:o}})},list_row_builder:function(t){const e=this;return new Promise((function(a){e.parse_publication(t.bibliography_data);const o=t.ref_coins_union.length;for(let a=0;a<o;a++){const o=t.ref_coins_union[a];e.parse_publication(o.bibliography_data)}const s=t.ref_coins_findspots_data.length;for(let a=0;a<s;a++){const o=t.ref_coins_findspots_data[a];e.parse_publication(o.bibliography_data)}const i=t.ref_coins_hoard_data.length;for(let a=0;a<i;a++){const o=t.ref_coins_hoard_data[a];e.parse_publication(o.bibliography_data)}e.parse_ordered_coins(t),row_fields.caller=e;a(row_fields.draw_item(t))}))},parse_publication:function(t){return page.parse_publication(t)},parse_ordered_coins:function(t){const e=[],a=page.split_data(t.ref_coins_typology_data," | "),o=a.length,s=page.split_data(t.ref_coins_typology," | "),i=page.split_data(t.ref_coins," | ");for(let t=0;t<o;t++){const o={typology_id:JSON.parse(a[t])[0],typology:s[t]||null,coins:JSON.parse(i[t])||null};e.push(o)}return t._coins_group=e,e},render_map:function(t){const e=t.target,a=t.map_data||[],o=t.map_position;if(o&&(o.zoom=11),a.length<1)return null;this.map=this.map||new map_factory,this.map.init({target:e,map_position:o,source_maps:[{name:"dare",url:"//dh.gu.se/tiles/imperium/{z}/{x}/{y}.png",options:{maxZoom:11},default:!0},{name:"arcgis",url:"//server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",options:{}},{name:"osm",url:"//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",options:{}}]});const s=this.map_data(a);return this.map.render({map_data:s}),!0},map_data:function(t){console.log("--map_data data:",t);const e=[];for(let a=0;a<t.length;a++){const o={lat:t[a].data.lat,lon:t[a].data.lon,data:{section_id:t[a].section_id,name:t[a].name,place:t[a].place,type:t[a].type,items:t[a].items,total_items:t[a].total_items}};e.push(o)}return console.log("--map_data data_clean:",e),e}};