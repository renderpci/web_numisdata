"use strict";const DEFAULT_BIN_WIDTH=1;var analysis={form:null,area_name:null,row:null,export_data_container:null,form_items_container:null,chart_wrapper_container:null,chart_wrapper:null,set_up:function(e){const t=this;t.area_name=e.area_name,t.export_data_container=e.export_data_container,t.row=e.row,t.form_items_container=e.form_items_container,t.chart_wrapper_container=e.chart_wrapper_container;const r=t.render_form();return t.form_items_container.appendChild(r),!0},render_form:function(){const e=this,t=new DocumentFragment;e.form=e.form||new form_factory;const r=common.create_dom_element({element_type:"div",class_name:"form-row fields",parent:t});e.form.item_factory({id:"mint",name:"mint",label:tstring.mint||"mint",q_column:"p_mint",value_wrapper:['["','"]'],eq:"LIKE",eq_in:"%",eq_out:"%",is_term:!0,parent:r,callback:function(t){e.form.activate_autocomplete({form_item:t,table:"catalog"})}});const a=common.create_dom_element({element_type:"div",class_name:"form-group field button_submit",parent:t});common.create_dom_element({element_type:"input",type:"submit",id:"submit",value:tstring.search||"Search",class_name:"btn btn-light btn-block primary",parent:a}).addEventListener("click",(function(t){t.preventDefault(),e.form_submit(o)}));common.create_dom_element({element_type:"input",type:"button",id:"button_reset",value:tstring.reset||"Reset",class_name:"btn btn-light btn-block secondary button_reset",parent:a}).addEventListener("click",(function(e){e.preventDefault(),window.location.replace(window.location.pathname)}));const n=e.form.build_operators_node();t.appendChild(n);const o=common.create_dom_element({element_type:"form",id:"search_form",class_name:"form-inline"});return o.appendChild(t),o},form_submit:function(e,t={}){const r=this,a=("boolean"!=typeof t.scroll_result||t.scroll_result,t.form_items||r.form.form_items),n=r.form.build_filter({form_items:a});if(!n||n.length<1)return!1;r.search_rows({filter:n,limit:0}).then((e=>{event_manager.publish("form_submit",e);const t=e.map((e=>e.ref_type_averages_diameter)).filter((e=>null!=e));this.chart_wrapper=new histogram_wrapper(this.chart_wrapper_container,t),this.chart_wrapper.render()}))},search_rows:function(e){const t=this,r=e.filter||null,a=e.ar_fields||["*"],n=e.order||"norder ASC",o=page_globals.WEB_CURRENT_LANG_CODE,i=e.process_result||null,l=null!=e.limit?e.limit:30;return new Promise((function(e){const s=[],m=t.form.parse_sql_filter(r),c={dedalo_get:"records",table:"catalog",ar_fields:a,lang:o,sql_filter:m,limit:l,group:s.length>0?s.join(","):null,count:!1,order:n,process_result:i};data_manager.request({body:c}).then((t=>{const r=page.parse_catalog_data(t.result);e(r)}))}))}};class chart_wrapper{constructor(e){this.div_wrapper=e,this.canvas=void 0}render(){this.canvas=common.create_dom_element({element_type:"canvas",id:"result_graph"}),this.div_wrapper.replaceChildren(this.canvas)}}class histogram_wrapper extends chart_wrapper{constructor(e,t){super(e),this.data=t}render(){super.render();const e=.5,t=Math.max(...this.data),r=Math.min(...this.data),a=Math.ceil((t-r)/1),n=Array.apply(null,Array(a)).map(((t,a)=>r+(2*a+1)*e));let o=Array.apply(null,Array(a)).map((()=>0));for(let r=0;r<this.data.length;r++)if(this.data[r]!==t){for(let t=0;t<a;t++)if(this.data[r]>=n[t]-e&&this.data[r]<n[t]+e){o[t]++;break}}else n[a-1]++;new Chart(this.canvas,{type:"bar",data:{labels:n,datasets:[{label:"Amount",data:o,categoryPercentage:1,barPercentage:1}]},options:{scales:{x:{grid:{offset:!1},title:{display:!0,text:"Diameter",font:{size:14}}},y:{title:{display:!0,text:"Amount",font:{size:14}}}},plugins:{legend:{display:!1},tooltip:{callbacks:{title:t=>{if(!t.length)return"";const r=t[0].dataIndex;return`Diameter: ${n[r]-e} - ${n[r]+e}`}}}}}})}}
//# sourceMappingURL=analysis-min.js.map